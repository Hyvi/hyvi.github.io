<!doctype html><html lang=zh class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.91.2"><link rel=canonical type=text/html href=https://hyvi.github.io/docs/>
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>Blog | Elon`s Blog</title>
<meta name=description content="Elon blog site"><meta property="og:title" content="Blog">
<meta property="og:description" content="Elon blog site">
<meta property="og:type" content="website">
<meta property="og:url" content="https://hyvi.github.io/docs/"><meta property="og:site_name" content="Elon`s Blog">
<meta itemprop=name content="Blog">
<meta itemprop=description content="Elon blog site"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Blog">
<meta name=twitter:description content="Elon blog site">
<link rel=preload href=/scss/main.min.f37c3fb6f746e6bc4c5eba11e2f176c897da8bb403ddc2aaac1d527737818c66.css as=style>
<link href=/scss/main.min.f37c3fb6f746e6bc4c5eba11e2f176c897da8bb403ddc2aaac1d527737818c66.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Elon`s Blog</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/docs/><i class="fas fa-blog"></i><span class=active>Blog</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/tools/><i class="fas fa-tools"></i><span>Tools</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/about/><i class="fas fa-info-circle"></i><span>About</span></a>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block">
<input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off data-offline-search-index-json-src=/offline-search-index.2d2f20daa6aad5ae0d2e50d523d834d9.json data-offline-search-base-href=/ data-offline-search-max-results=10>
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
</div>
<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
</div>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.
</p><p>
<a href=/docs/>返回本页常规视图</a>.
</p>
</div>
<h1 class=title>Blog</h1>
<ul>
<li>1: <a href=#pg-31bc0d9a3f9c6fcad90863cf851f2a50>Archtecture & Design</a></li>
<ul>
<li>1.1: <a href=#pg-6433575aa1c6fb30c18580fd6c71e12c>模型推理架构</a></li>
<li>1.2: <a href=#pg-4af503f1dd9472ac40469957fbffbfbb>云原生模式 CLOUD NATIVE PATTERNS</a></li>
<li>1.3: <a href=#pg-1fd5d390a78e6d939888fef762f950f8>消息队列 资料汇总</a></li>
<li>1.4: <a href=#pg-fac9fad46e4b466f84d47455c4d1fb59>Prometheus Practise</a></li>
<li>1.5: <a href=#pg-668bdfc812447c5db1593be1d6716ec6>Notes for Patterns of Enterprise Application</a></li>
<li>1.6: <a href=#pg-f56f85602f1c6d43b4eb2e67085e6fd8>GPU 那些事儿</a></li>
<li>1.7: <a href=#pg-2d72ba724658ec96a2ca935bd5c05ec1>PlantUML + Archimate 记录</a></li>
<li>1.8: <a href=#pg-e15158a326a1352554ba42fb66497f05>Reliability Engineering 可用性工程</a></li>
<li>1.9: <a href=#pg-bf8ead2470cf57a8b5a58116a2b2600e>About Cncf Projects</a></li>
<li>1.10: <a href=#pg-7aa640ebf687822b9a6f33bb0a4c11a2>Microservice Arch 点点滴滴</a></li>
<li>1.11: <a href=#pg-2100c1911c9bb54654a9c137ab8c0dfa>Big Data Arch</a></li>
<li>1.12: <a href=#pg-e5642f043cdf7d0f1ee9aebaedfc53db>RPC vs Http</a></li>
<li>1.13: <a href=#pg-8838bdb6c8ad83f16e730d71b934e97a>GCP Study</a></li>
<li>1.14: <a href=#pg-bdde9cbfd9f8eeac0cd39a3b3b3d14fb>限流的那些事</a></li>
<li>1.15: <a href=#pg-10107dc58f8047d96fa3f1b7f95bb88e>微服务架构下Deloyment最佳方式探讨</a></li>
<li>1.16: <a href=#pg-b4073f3719895d9f503707326b40ca07>Cloud Computing Service Modeling</a></li>
<li>1.17: <a href=#pg-47077e68da976692ff337a00dcb67e20>控制资源的访问权限</a></li>
<li>1.18: <a href=#pg-7c70474ebd4af8181781d9e1091fabc7>APM资料整理</a></li>
<li>1.19: <a href=#pg-f25771a1b9a619a9f87799d92a815e2a>API Trend 现状</a></li>
<li>1.20: <a href=#pg-20b4d397434e7dd72c0f3ae6fd7e12da>API 兼容性设计</a></li>
<li>1.21: <a href=#pg-b3dd446295c046b0254b164fdf051efc>Web API Spec管理平台</a></li>
<li>1.22: <a href=#pg-e0db42a0d9b10d2a3a014e76ddeeccd1>迁移线上服务方案</a></li>
</ul>
<li>2: <a href=#pg-279d654ff9b8fa3e9d7d6073837f00ac>Kubernetes</a></li>
<ul>
<li>2.1: <a href=#pg-e1c94c926e972f827a4987122e2627b1>K8S Request vs Limit</a></li>
<li>2.2: <a href=#pg-5f43ca090ac49282dc7b5bea45675593>OAM 详解</a></li>
<li>2.3: <a href=#pg-2e2900c0652114a44e5fd808f93a86a1>Kubernates Cluster Architecture</a></li>
</ul>
<li>3: <a href=#pg-33c2c22bdfd4946ed44b4a4b4782e4c5>Golang</a></li>
<ul>
<li>3.1: <a href=#pg-b483bd85453757b9e33563db1772e983>About Golang String</a></li>
<li>3.2: <a href=#pg-7fba756dfa6d3e0c7ed3a45a87196075>Monorepo for Golang With Bazel</a></li>
<li>3.3: <a href=#pg-3b83ac5f286d261b4b7ae1b2137d125b>Golang Pprof 使用梳理</a></li>
<li>3.4: <a href=#pg-f691475805d1a40b7cd3005ba6a3c434>Gorm</a></li>
<li>3.5: <a href=#pg-762d41fcff5885e1e92c42644dfdb847>Golang语言之禅</a></li>
<li>3.6: <a href=#pg-7d846e61c330595767c77bde2caf83bc>Code Review 开始</a></li>
<li>3.7: <a href=#pg-2ba8936b35c18b67399290e83295cff1>Gomonkey Test</a></li>
<li>3.8: <a href=#pg-90baeac0d8907b563e8b6e698754f11a>Daily 0131 Golang 杂乱</a></li>
</ul>
<li>4: <a href=#pg-667335ee14d6b9d70f64cb1d9e53c655>Python</a></li>
<ul>
<li>4.1: <a href=#pg-08974e0fd7594d052e2b07846289496e>Python 面试Problems</a></li>
</ul>
<li>5: <a href=#pg-d7eeb6b04c8fab1ac4227a60a3668820>Javascript</a></li>
<ul>
<li>5.1: <a href=#pg-5460196736761598f7a1f93a910aa267> javascript Number --- 再次结识</a></li>
<li>5.2: <a href=#pg-2d744b2632f4d6b3ed284172e74157c5>nodejs</a></li>
</ul>
<li>6: <a href=#pg-82cd4c4f3e81bf76ca5312564c105113>Team</a></li>
<ul>
<li>6.1: <a href=#pg-d2ec6795a40afc18457d5151e868e278>如何构建基础库</a></li>
<li>6.2: <a href=#pg-5a7d3543e628a73342f5fc1697c86f97>团队建设</a></li>
<li>6.3: <a href=#pg-ed50a7db14ee0960b42cb1b86c185a92>基于Git Flow规范分支和发版问题</a></li>
<li>6.4: <a href=#pg-6080c83f2421c88b230943540db68583>Scrum & Jira 使用问题记录</a></li>
<li>6.5: <a href=#pg-e2438758d0b186abed286c728ccac8eb>《卓有成效的管理者》之决策</a></li>
<li>6.6: <a href=#pg-115f972d66ff5270542d5e87de63e469>《卓有成效的管理者》之我能贡献什么</a></li>
<li>6.7: <a href=#pg-18c13b56515fc44f83c35b9760d79429>Team Topologies 团队拓扑</a></li>
</ul>
<li>7: <a href=#pg-9f3fe661c510a6627ee0f14e1098f0d9>Tools</a></li>
<ul>
<li>7.1: <a href=#pg-5cdb7211381734261870d4aa5318c5f2>Customize Icon for Plantuml</a></li>
<li>7.2: <a href=#pg-aabbd81704488041b3acd03cc439c5b3>抓包工具分析之完全攻略</a></li>
<li>7.3: <a href=#pg-54611c3a046a2410da6e3c5810960b10>SS 全军覆没，v2ray for Macos</a></li>
<li>7.4: <a href=#pg-4f49ec87560075733c7999709debbce8>fencview.vim + xshell + vim + 各种中文编码问题</a></li>
<li>7.5: <a href=#pg-8cb6e4d23fc8071837e2452aeeb69fc9>VIM 转 VSCODE</a></li>
<li>7.6: <a href=#pg-5d7b3c4086b6e4f35dd257f952928dbc>从Jekyll到hugo, 迁移Github Pages</a></li>
</ul>
<li>8: <a href=#pg-44220141a086ff3f15a0de739d16489c>Daily 杂乱记录</a></li>
<ul>
<li>8.1: <a href=#pg-a3c4cafdba401e6278ffa23d11bab6bd>子网掩码</a></li>
<li>8.2: <a href=#pg-240830fcac0d44698ca10107f15b2e3c>OAuth 2.0 Token Exchange协议解读</a></li>
<li>8.3: <a href=#pg-fc19e4d4f6f294cb8a15c2e4677f0cc8>OIDC（OPENID CONNECT）身份认证授权</a></li>
<li>8.4: <a href=#pg-23b1c06675f6773e272050c6049f3aa0>Io wait 告警问题</a></li>
<li>8.5: <a href=#pg-76534db6d623a41b5cf87ab45c00cae7>Daily 0201</a></li>
<li>8.6: <a href=#pg-b1b82d75a4a886e569e8c6c0b1e05147>Daily 0321</a></li>
<li>8.7: <a href=#pg-6c7014cb8bf3434c55dd33c4ecc3e910>Daily 0503</a></li>
<li>8.8: <a href=#pg-1ca7c71430af3a9f7980b371807adbe9>Daily 0607</a></li>
<li>8.9: <a href=#pg-42dc9af5b2030b909b1e6cdc427a47f8>Daily 0612</a></li>
<li>8.10: <a href=#pg-11c618c16edab1f3526f5402311e74c4>Daily 0813</a></li>
<li>8.11: <a href=#pg-79d997335fbe9696d3f0e05d03d6384e>Daily 0821 chrome app/extension</a></li>
<li>8.12: <a href=#pg-4a62dfb087d1255a1733eafeca76273f>Daily 10/09</a></li>
<li>8.13: <a href=#pg-b208d2437975111a7aff23977621a97d>Daily 10/15 配置https</a></li>
<li>8.14: <a href=#pg-4ae1457ece262608778b9af9debde46d>Daily 10/16</a></li>
<li>8.15: <a href=#pg-639931eb8e570838e56327173dc99821>Daily 10/18</a></li>
<li>8.16: <a href=#pg-b58d2181d1aacb4305b0c2a0a310c79c>Daily 10/19 三个月</a></li>
<li>8.17: <a href=#pg-72467628488feb8684a76493e89c7548>Daily 10/24</a></li>
<li>8.18: <a href=#pg-51864cb2d6aa3f64fe663dbf073b454f>Daily 10/30</a></li>
<li>8.19: <a href=#pg-d170c7dffbbbee2dd73fe23d5e9f7249>Daily 1018 vim go + Ycm</a></li>
<li>8.20: <a href=#pg-c121e9bd4252f17d6df7f51fad46f50a>Daily 11.08 Docker安装</a></li>
<li>8.21: <a href=#pg-64dc87cf8322fe024db1792709e6060b>Daily 11/03</a></li>
<li>8.22: <a href=#pg-57b85631ef070b92b6eaadec0585d0ce>Daily 1104</a></li>
<li>8.23: <a href=#pg-6df3950e09f1ed7855c966a0b3a9511d>Daily 1110 DOCKER部署实践总结</a></li>
<li>8.24: <a href=#pg-4e1ee5882d9e62d65822dde8d3e442ea>Daily 1116</a></li>
<li>8.25: <a href=#pg-163d016ec3b8a0cea24d349cd91a92d0>Daily 1127 MYSQL </a></li>
<li>8.26: <a href=#pg-0f7abe9fd840584d9989a663fa49cc9c>Daily 1208</a></li>
<li>8.27: <a href=#pg-1b89093d737fb3e3735edc770710201b>Daily 1215</a></li>
<li>8.28: <a href=#pg-e8bc88a079e7284d75958ee9e69d263e>Daily 1229</a></li>
<li>8.29: <a href=#pg-cd168b78dd4295e42ebc6ea7c8951f33>Daily 2021/11/01 Postive Discipline</a></li>
<li>8.30: <a href=#pg-a6591dd7049ab03f1d864f15c9b03dac>Daily 2022/01/13</a></li>
<li>8.31: <a href=#pg-d7217e8c6dcba63b859a27c5f6578cf8>Daily 5/31</a></li>
<li>8.32: <a href=#pg-0a97a012d24ad5724bc2bb78e1c4660f>Daily 6/1</a></li>
<li>8.33: <a href=#pg-0b39f164c21923e4713cfe173a4d8037>Daily 6/3</a></li>
<li>8.34: <a href=#pg-83405704c229ae1f822f152500ebd082>Daily 9/11</a></li>
<li>8.35: <a href=#pg-a9ba4dfbcd416be7150b8304aa335be1>Daily 9/12</a></li>
<li>8.36: <a href=#pg-5abb1d58ec4fe4729ab279df0840251d>Daily 9/13</a></li>
<li>8.37: <a href=#pg-78e7f3d24a774bffb8590129b266410b>Daily 9/14</a></li>
<li>8.38: <a href=#pg-0fb0beed72ec94421cecb4332c0f17f6>Daily 9/18</a></li>
<li>8.39: <a href=#pg-3098fe12d2ae39d8528f92beb761a9af>Daily 9/21</a></li>
<li>8.40: <a href=#pg-c727370ca88bf63f507c67e9642157c1>Daily 9/22</a></li>
<li>8.41: <a href=#pg-ba27040cd5b9dd2964e945a84c423939>Daily 9/25 #vpn</a></li>
<li>8.42: <a href=#pg-aa028a05e971916505636bfdb54422ab>Daily 9/27 Git 相关知识点</a></li>
<li>8.43: <a href=#pg-3b05a0a3b23c3b160359824339a7ea82>Daily 9/5</a></li>
<li>8.44: <a href=#pg-3e7749c7032db639158bfd853be29f21>Daily 9/6</a></li>
<li>8.45: <a href=#pg-b614d07cd7c901562de1ae291997c681>Daily 9/8</a></li>
<li>8.46: <a href=#pg-d317738cb1682d537736db77b07bded5>又是一年最长假-国庆 Daily 9/29</a></li>
</ul>
<li>9: <a href=#pg-b87911a9f23050e07816f368281711dc>Others</a></li>
<ul>
<li>9.1: <a href=#pg-884b3d38fd53570e0807a61750cf4594>年底的沟通记录</a></li>
<li>9.2: <a href=#pg-742aaec0cddf6176565d7164d847d1be>What We Concern</a></li>
<li>9.3: <a href=#pg-74d39ffcc81b3be2aaf814267528776a>4.2最美东湾露营-那些年我们在一起</a></li>
<li>9.4: <a href=#pg-7f163d76f8d404899255ddfb0e6985c0>INTERVIEW CONCLUSION</a></li>
<li>9.5: <a href=#pg-48aef7a1a6299bd1605c3305fefb810d>港岛径第八段-土地灣-龙脊-大浪灣</a></li>
<li>9.6: <a href=#pg-38834a78fac95d8292f7a33d0dcb970c>黄牛山 .麦理浩径第四段五段 狮子山 笔架山</a></li>
</ul>
</ul>
<div class=content>
<p>This is the <strong>blog</strong> section.</p>
</div>
</div>
<div class=td-content>
<h1 id=pg-31bc0d9a3f9c6fcad90863cf851f2a50>1 - Archtecture & Design</h1>
<div class=lead>用于梳理 架构与设计 相关的笔记，包括 Enterprise Architecture、Scalability/Performance、Design、Microservice、Service Mesh、Patterns、Security。</div>
</div>
<div class=td-content>
<h1 id=pg-6433575aa1c6fb30c18580fd6c71e12c>1.1 - 模型推理架构</h1>
<h2 id=概念解释>概念解释</h2>
<p><strong>Squared loss</strong></p>
<p>a popular loss function, also known as L2 Loss.</p>
<p>Mean square error (MSE) is the average squared loss per example over the whole dataset.</p>
<p><strong>Gradient Descent</strong></p>
<p>SGD(Stochastic Gradient Descent) & Mini-Batch Gradient Descent.</p>
<p><strong>Predict Protocol</strong></p>
<p>This document proposes a predict/inference API independent of any specific ML/DL framework and model server.</p>
<p>This protocol is endorsed by NVIDIA Triton Inference Server, TensorFlow Serving, and ONNX Runtime Server.</p>
<p>Seldon has collaborated with the NVIDIA Triton Server Project and the KServe Project to create a new ML inference protocol. The core idea behind this joint effort is that this new protocol will become the standard inference protocol and will be used across multiple inference services.</p>
<p>详细见： [Predict Protocol - Version 2][2]</p>
<h2 id=对标方案---run-computer-vision-inference-on-large--videos>对标方案 - Run computer vision inference on large videos</h2>
<h3 id=real-time-inference>Real-time Inference</h3>
<p>Real-time inference is ideal for inference workloads where you have real-time, interactive, low latency requirements.</p>
<h4 id=tensorrt-through-nvida-triton>TensorRT through NVIDA Triton</h4>
<p>TensorRT is a C++ library for high performance inference on NVIDIA GPUs and deep learning accelerators.</p>
<p>Tutorial: <a href=https://github.com/NVIDIA/TensorRT/blob/main/quickstart/SemanticSegmentation/tutorial-runtime.ipynb>https://github.com/NVIDIA/TensorRT/blob/main/quickstart/SemanticSegmentation/tutorial-runtime.ipynb</a></p>
<ul>
<li>Load TensorRT Engine</li>
<li>Run inference</li>
</ul>
<p>TensorRT to Triton: <a href=https://github.com/NVIDIA/TensorRT/tree/main/quickstart/deploy_to_triton>https://github.com/NVIDIA/TensorRT/tree/main/quickstart/deploy_to_triton</a></p>
<h3 id=asynchronous-inference>Asynchronous inference</h3>
<p><img src=https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2021/09/29/ML-5668-Architecture.png alt></p>
<p>An Example for SageMaker: Amazon SageMaker Processing Video2frame Model Inference [3]</p>
<p><img src=https://github.com/aws/amazon-sagemaker-examples/raw/d391107c4e301582186f5bac5e4242c1dc6944f1/async-inference/images/e2e.png alt="end-to-end flow with Asynchronous inference endpoint"></p>
<h4 id=prerequisites>Prerequisites</h4>
<p>实操方式： <a href=https://docs.aws.amazon.com/sagemaker/latest/dg/async-inference-create-endpoint-prerequisites.html>https://docs.aws.amazon.com/sagemaker/latest/dg/async-inference-create-endpoint-prerequisites.html</a></p>
<ol>
<li>Create an IAM role for Amazon SageMaker.</li>
<li>Add Amazon SageMaker, Amazon S3 and Amazon SNS Permissions to your IAM Role.</li>
<li>Upload your inference data (e.g., machine learning model, sample data) to Amazon S3.</li>
<li>Select a prebuilt Docker inference image or create your own Inference Docker Image.
<ul>
<li>Use Your Own Inference Code</li>
</ul>
</li>
<li>Create an Amazon SNS topic (optional)
<ul>
<li>Check Your S3 Bucket: <a href=https://docs.aws.amazon.com/sagemaker/latest/dg/async-inference-check-predictions.html>https://docs.aws.amazon.com/sagemaker/latest/dg/async-inference-check-predictions.html</a></li>
</ul>
</li>
</ol>
<h5 id=use-your-own-inference-code-with-hosting-services>Use Your Own Inference Code with Hosting Services</h5>
<p><a href=https://docs.aws.amazon.com/sagemaker/latest/dg/your-algorithms-inference-main.html>https://docs.aws.amazon.com/sagemaker/latest/dg/your-algorithms-inference-main.html</a>，</p>
<p>how Amazon SageMaker interacts with a Docker container that runs your own inference code for hosting services.</p>
<p>How SageMaker Loads Your Model Artifacts</p>
<p>How Containers Serve Requests:</p>
<p>Containers need to implement a web server that responds to /invocations and /ping on port 8080.</p>
<p>How Your Container Should Respond to Inference Requests:</p>
<p>A customer&rsquo;s model containers must respond to requests within 60 seconds.</p>
<h5 id=adapting-your-own-inference-container>Adapting Your Own Inference Container</h5>
<p><a href=https://docs.aws.amazon.com/sagemaker/latest/dg/adapt-inference-container.html>https://docs.aws.amazon.com/sagemaker/latest/dg/adapt-inference-container.html</a></p>
<p>详细介好了基于 sagemaker 来自定义的推理过程。 <a href=https://sagemaker-examples.readthedocs.io/en/latest/frameworks/pytorch/get_started_mnist_deploy.html>https://sagemaker-examples.readthedocs.io/en/latest/frameworks/pytorch/get_started_mnist_deploy.html</a></p>
<h4 id=create>Create</h4>
<ol>
<li>Create a model in SageMaker with CreateModel.</li>
<li>Create an endpoint configuration with CreateEndpointConfig.</li>
<li>Create an HTTPS endpoint with CreateEndpoint.</li>
</ol>
<h4 id=prebuilt-sagemaker-docker-images-for-deep-learning>Prebuilt SageMaker Docker Images for Deep Learning</h4>
<p><a href=https://docs.aws.amazon.com/sagemaker/latest/dg/pre-built-containers-frameworks-deep-learning.html>https://docs.aws.amazon.com/sagemaker/latest/dg/pre-built-containers-frameworks-deep-learning.html</a></p>
<p><img src=https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2018/08/02/pre-trained-models-sagemaker-1.gif alt></p>
<p><a href=https://aws.amazon.com/cn/blogs/machine-learning/bring-your-own-pre-trained-mxnet-or-tensorflow-models-into-amazon-sagemaker/>https://aws.amazon.com/cn/blogs/machine-learning/bring-your-own-pre-trained-mxnet-or-tensorflow-models-into-amazon-sagemaker/</a></p>
<p>Entire process:</p>
<ul>
<li>Step 1: Model definitions are written in a framework of choice.</li>
<li>Step 2: The model is trained in that framework.</li>
<li>Step 3: The model is exported and model artifacts that can be understood by Amazon SageMaker are created.</li>
<li>Step 4: Model artifacts are uploaded to an Amazon S3 bucket.</li>
<li>Step 5: Using the model definitions, artifacts, and the Amazon SageMaker Python SDK, a SageMaker model is created.</li>
<li>Step 6: The SageMaker model is deployed as an endpoint.</li>
</ul>
<p>TensorFlow BYOM: <a href=https://github.com/aws/amazon-sagemaker-examples/blob/main/advanced_functionality/tensorflow_iris_byom>https://github.com/aws/amazon-sagemaker-examples/blob/main/advanced_functionality/tensorflow_iris_byom</a></p>
<p>MXNet BYOM: <a href=https://github.com/aws/amazon-sagemaker-examples/tree/main/advanced_functionality/mxnet_mnist_byom>https://github.com/aws/amazon-sagemaker-examples/tree/main/advanced_functionality/mxnet_mnist_byom</a></p>
<p>Pytorch: <a href=https://github.com/aws/amazon-sagemaker-examples/tree/main/advanced_functionality/pytorch_bring_your_own_gan>https://github.com/aws/amazon-sagemaker-examples/tree/main/advanced_functionality/pytorch_bring_your_own_gan</a></p>
<h3 id=batch-transform>Batch Transform</h3>
<h3 id=serverless-inference>Serverless Inference</h3>
<p>Amazon SageMaker Serverless Inference is a purpose-built inference option that makes it easy for you to deploy and scale ML models. Serverless Inference is ideal for workloads which have idle periods between traffic spurts and can tolerate cold starts.</p>
<h2 id=对标方案---machine-learning-platform-for-ai---eas>对标方案 - Machine Learning Platform for AI - EAS</h2>
<ul>
<li>一健部署</li>
<li>高性能</li>
<li>蓝绿部署</li>
<li>弹性扩缩</li>
<li>编译优化</li>
</ul>
<h2 id=参考>参考</h2>
<ol>
<li>
<p><a href=https://github.com/kserve/kserve/issues/892>https://github.com/kserve/kserve/issues/892</a></p>
</li>
<li>
<p><a href=https://github.com/kserve/kserve/blob/master/docs/predict-api/v2/required_api.md#httprest>https://github.com/kserve/kserve/blob/master/docs/predict-api/v2/required_api.md#httprest</a></p>
</li>
<li>
<p><a href=https://aws.amazon.com/cn/blogs/machine-learning/run-computer-vision-inference-on-large-videos-with-amazon-sagemaker-asynchronous-endpoints/>https://aws.amazon.com/cn/blogs/machine-learning/run-computer-vision-inference-on-large-videos-with-amazon-sagemaker-asynchronous-endpoints/</a></p>
</li>
<li>
<p><a href=https://aws.amazon.com/cn/blogs/machine-learning/how-deepmap-optimizes-their-video-inference-workflow-with-amazon-sagemaker-processing/>https://aws.amazon.com/cn/blogs/machine-learning/how-deepmap-optimizes-their-video-inference-workflow-with-amazon-sagemaker-processing/</a></p>
</li>
<li>
<p><a href=https://www.alibabacloud.com/help/zh/machine-learning-platform-for-ai/latest/architecture>https://www.alibabacloud.com/help/zh/machine-learning-platform-for-ai/latest/architecture</a></p>
</li>
<li>
<p>Kubeflow: <a href=https://github.com/kubeflow>https://github.com/kubeflow</a></p>
</li>
<li>
<p>Amazon SageMaker Processing Video2frame Model Inference <a href=https://github.com/aws-samples/amazon-sagemaker-processing-video2frame-model-inference>https://github.com/aws-samples/amazon-sagemaker-processing-video2frame-model-inference</a>
<br></p>
</li>
<li>
<p><a href=https://github.com/aws/amazon-sagemaker-examples/blob/main/async-inference/Async-Inference-Walkthrough.ipynb>https://github.com/aws/amazon-sagemaker-examples/blob/main/async-inference/Async-Inference-Walkthrough.ipynb</a></p>
</li>
</ol>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4af503f1dd9472ac40469957fbffbfbb>1.2 - 云原生模式 CLOUD NATIVE PATTERNS</h1>
<p>随着底层基础设施的云原生的流行，对上层应用的开发模式带来了变化：</p>
<p><img src=https://raw.githubusercontent.com/ContainerSolutions/cloud-native-patterns/master/assets/images/Screenshot%202020-01-06%20at%2014.07.47.png alt></p>
<h2 id=refs>Refs</h2>
<ol>
<li>
<p>Cloud Native Pattern: <a href=https://github.com/ContainerSolutions/cloud-native-patterns>https://github.com/ContainerSolutions/cloud-native-patterns</a></p>
</li>
<li>
<p>Cornelia Davis: Cloud Native Patterns_ Designing change-tolerant software.pdf</p>
</li>
<li>
<p>Pini Reznik, Jamie Dobson & Michelle Gienow: cloud-native-transformation-practical-patterns-for-innovation
<br></p>
</li>
</ol>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-1fd5d390a78e6d939888fef762f950f8>1.3 - 消息队列 资料汇总</h1>
<p>汇总收集到的关于 MQ 方面的资料，包括 RabbitMQ、Kafka、Pulsar等</p>
<h2 id=基础概念>基础概念</h2>
<table>
<thead>
<tr>
<th>模式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>简单原型</td>
<td>生产者往消息队列中扔消息，消费者从消息队列取消息，一次取一个。缺点是局域网内最大消费速度是2000QPS</td>
</tr>
<tr>
<td>批量处理消息</td>
<td>每次可以取多条消息处理</td>
</tr>
<tr>
<td>多个 Consumer 处理消息 - Push 模式</td>
<td>push模式很难适应消费速率不同的消费者，因为消息发送速率是由broker决定的。push模式的目标是尽可能以最快速度传递消息，但是这样很容易造成consumer来不及处理消息，典型的表现就是拒绝服务以及网络拥塞。中心节点需要监听Consumer 的 ACK 消息用于判断消息是否处理成功，并处理当前的消息。 <br> <img src=https://pjmike-1253796536.cos.ap-beijing.myqcloud.com/p2p_queue.png alt></td>
</tr>
<tr>
<td>多个 Consumer 处理消息 - Pull 模式</td>
<td>而pull模式则可以根据consumer的消费能力以适当的速率消费消息。 这种模式好处，消费者不需要返回 ACK 信息，因为当消费者申请消费下一条消息可以认为上一条领取的消息已经处理完，也不需要处理超时的问题，Consumer 愿意处理到啥时候就到啥时候。<br> 如何保证多个 consumer 处理的消息不会重复了？</td>
</tr>
<tr>
<td>多个消息队列 - Pull 模式</td>
<td>kafka模式 <br><a href="https://img-blog.csdn.net/20180815151605738?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTIxNDIyNDc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70">点击查看图片</a></td>
</tr>
</tbody>
</table>
<br>
<p>详细查看： <a href="https://mp.weixin.qq.com/s?__biz=MzA4MzEzNjA0NA==&mid=222594584&idx=1&sn=d64e5f5768ce48bd0bee1824b30fb1e3&scene=0#rd">流式计算 - kafka(1)</a></p>
<h2 id=案例分析>案例分析</h2>
<h3 id=知乎千万级高性能长连接网关揭秘httpswwwinfoqcnarticleuxru4hr_mlmx3q84mb9m><a href=https://www.infoq.cn/article/UXrU4hr_mlMX3q84MB9M>知乎千万级高性能长连接网关揭秘</a></h3>
<ul>
<li>我们怎么设计通信协议
<ul>
<li>业务解耦
<ul>
<li>基于经典的发布订阅模式</li>
<li>传输的消息是纯二进制数据，网关也无需关心业务方的具体协议规范和序列化方式。</li>
</ul>
</li>
<li>权限设计
<ul>
<li>基于回调的鉴权</li>
<li>Topic 模板变量</li>
</ul>
</li>
<li>消息可靠性保证
<ol>
<li>回执和重传</li>
<li>基于消息队列的接收和发送方式</li>
</ol>
</li>
</ul>
</li>
<li>我们怎么设计系统架构</li>
<li>我们如何构建长连接网关
<ul>
<li>接入层
<ul>
<li>负载均衡
<ul>
<li>为什么不用IP Hash： 分布不均匀和不能准确的标识客户端。</li>
<li>基于七层负载均衡，使用 Nginx 的 Preread机制。实现基于客户端的唯一标识来进行一致性 Hash</li>
</ul>
</li>
</ul>
</li>
<li>订阅</li>
<li>发布</li>
<li>会话</li>
<li>持久化</li>
<li>滑动窗口</li>
</ul>
</li>
</ul>
<h3 id=基于-flink-的资讯场景实时数仓>基于 Flink 的资讯场景实时数仓</h3>
<p><img src=https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3989853951/p97864.png alt=基于Flink的资讯场景实时数仓></p>
<p>如何将 Kafka 和 Flink 进行整合，通过消息队列 Kafka 版和实时计算 Flink 实现实时 ETL 和数据流。</p>
<h2 id=参考资料>参考资料</h2>
<p>[1] Alicloud: 基于Flink的资讯场景实时数仓</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-fac9fad46e4b466f84d47455c4d1fb59>1.4 - Prometheus Practise</h1>
<h2 id=背景>背景</h2>
<p>为什么要自建 Promethues, 云服务商提供的挺好的。</p>
<h2 id=名词解释>名词解释</h2>
<p>刚接触, 还是很多新词汇</p>
<table>
<thead>
<tr>
<th>名词</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>Exportor</td>
<td>用于向Prometheus Server暴露数据采集的endpoint，Prometheus轮训这些Exporter采集并且保存数据；</td>
</tr>
<tr>
<td>ServiceMonitor</td>
<td>a ServiceMonitor describes the set of targets to be monitored by prometheus.</td>
</tr>
<tr>
<td>Prometheus Operator</td>
<td>简单运行 Promethues 在 kubernetes 上，并保持 Kubenetes 本土化的配置选项。<a href=https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/design.md>Prometheus operator design</a></td>
</tr>
</tbody>
</table>
<h3 id=operator>Operator</h3>
<p>An Operator is an application-specific controller that extends the kubernetes API to create , configure, and manage instances of complex stateful applications on behalf of a kubernetes user.</p>
<p>it builds upon the basic kubernetes resource and controller concepts but includes domain or application-specific knowledge to automate common taks.</p>
<p><img src=https://coreos.com/sites/default/files/inline-images/Overview-etcd_0.png alt></p>
<p>An Operator is software that encodes this domain knowledge and extends the kubernetes API through the third party resources mechanism, enabling users to create, configure, and manage applications.</p>
<p>Operator 与 Controller 区别在于：<br> a Controller with the following characteristics qualify as an operator : <br> 1. Contains workload-specific knowledge <br> 2. Manages workload lifecycle <br> 3. Offers a CRD</p>
<h3 id=prometheus>Prometheus</h3>
<p>Monitoring Stacks consist of a collector, a time-series database to store metrics, and a visualization layer.</p>
<p>A popular open-source stack is Prometheus, used along with Grafana as the visualization tool to create rich dashboards.</p>
<p><img src=https://developer-blogs.nvidia.com/wp-content/uploads/2020/10/reference-prometheus-architecture.png alt="Reference Prometheus architecture."></p>
<h3 id=设备插件--device-plugin>设备插件 device-plugin</h3>
<p><a href=https://kubernetes.io/zh/docs/concepts/extend-kubernetes/compute-storage-net/device-plugins/>Kubernates Device Plugin</a> 为 Kubernetes 提供了一个设备插件框架，你可以用它来将硬件资源发布到 Kubelet。 好处有：</p>
<ul>
<li>供应商可以实现设备插件，手动部署或者 DaemonSet 来部署， 而不必定制 Kubernetes 本身的代码。目标设备可以是 GPU、高性能的 NIC、 FPGA、 InfiniBand 适配器。</li>
</ul>
<p><img src=https://developer-blogs.nvidia.com/wp-content/uploads/2020/10/gpu-telemetry.png alt="GPU Telemetry using dcgm-exporter in Kubernetes"></p>
<p>上图说明一个问题： 通过 <code>device-plugin</code> 监控里的 <code>pod-resources socket</code>, 确定跟某一个 pod 相关联的设备信息。</p>
<h2 id=监控指标>监控指标</h2>
<p>GPU Grafana 面板配置： <a href=https://grafana.com/grafana/dashboards/11752>GPU NODES V2</a></p>
<table>
<thead>
<tr>
<th>指标</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>DCGM_FI_DEV_FB_USED</td>
<td>GPU 已用显存</td>
</tr>
<tr>
<td>DCGM_FI_DEV_FB_FREE</td>
<td>GPU 未用显存</td>
</tr>
<tr>
<td>DCGM_FI_DEV_GPU_UTIL</td>
<td>GPU 使用率</td>
</tr>
<tr>
<td>DCGM_MEM_COPY_UTILIZATION</td>
<td>见<a href=https://stackoverflow.com/questions/60521808/what-diff-nvidia-smi-dmon-between-nvidia-smi-for-memory-usage-metics> 内存利用率对比 </a></td>
</tr>
</tbody>
</table>
<h2 id=开始>开始</h2>
<h3 id=使用-dcgmproftester>使用 dcgmproftester</h3>
<p>Generating a load</p>
<h2 id=有感>有感</h2>
<ul>
<li>K8s CRD 无处不在</li>
</ul>
<h2 id=faq>FAQ</h2>
<ol>
<li>DCGM_FI_DEV_FB_FREE 数值和实际的内存对不上的？
<ul>
<li>A: 使用的型号是T4系列，具体的型号是 <a href=https://www.alibabacloud.com/help/zh/doc-detail/108496.htm?#title-n0p-6ch-ma3>ecs.gn6i-c16g1.4xlarge</a>, GPU 显存为 16G， 系统内存为 62G。而 NVIDIA dcgm-exporter 中监控的指标 DCGM_FI_DEV_FB_USED 为 GPU 显存大小，系统的内存通过 node_memory_MemTotal_bytes、node_memory_Buffers_bytes、node_memory_Cached_bytes、node_memory_MemFree_bytes 指标（来自 <a href=https://grafana.com/grafana/dashboards/11752>GPU NODES V2</a> ) 来监控.</li>
<li>A: 当在 GPU 环境下提到内存时，须要区分下说的是 GPU 显存还是系统内存。</li>
</ul>
</li>
<li>DCGM_MEM_COPY_UTILIZATION 内存利用率，<a href=https://stackoverflow.com/questions/60521808/what-diff-nvidia-smi-dmon-between-nvidia-smi-for-memory-usage-metics> 内存利用率对比 </a>
<ul>
<li>Utilization = time over the past sample period / global (device) memory was being read or writted * 100%</li>
</ul>
</li>
</ol>
<h2 id=参考>参考</h2>
<p><a href=https://developer.nvidia.com/blog/monitoring-gpus-in-kubernetes-with-dcgm/>Monitoring GPUs in Kubernetes with DCGM</a></p>
<p><a href=https://coreos.com/blog/introducing-operators.html>Introducing Operators : Putting Operational Knowledge into Software .</a></p>
<p><a href=https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/user-guides/getting-started.md>Promethues Operator User Guide</a></p>
<p>Controllers and Operators, <a href=https://octetz.com/docs/2019/2019-10-13-controllers-and-operators/>https://octetz.com/docs/2019/2019-10-13-controllers-and-operators/</a></p>
<p><a href=https://yunlzheng.gitbook.io/prometheus-book/>Promethues Book 中文 </a></p>
<p><a href=https://github.com/Hyvi/gpu-monitoring-tools>NAIDIA GPU monitoring tools on Linux</a></p>
<p><a href=https://docs.nvidia.com/datacenter/cloud-native/kubernetes/dcgme2e.html>Integrating GPU Telemetry into Kubernetes</a></p>
<p><a href=https://blog.csdn.net/M2l0ZgSsVc7r69eFdTj/article/details/79124770>Promethues 动态发现 Target 和 Relabel 的应用</a></p>
<p><a href=https://blog.csdn.net/u010953692/article/details/107143338>GPU-Nodes-Metrics 12027 设置</a></p>
<p><br></p>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-668bdfc812447c5db1593be1d6716ec6>1.5 - Notes for Patterns of Enterprise Application</h1>
<h2 id=数据源架构模式>数据源架构模式</h2>
<h3 id=表数据入口-table-data-gateway>表数据入口 (Table Data GateWay)</h3>
<p>表数据入口包含了用于访问单个表或视图的所有SQL，如选择、插入、更新、删除等。其他代码调用它的方法来实现所有与数据库的交互.</p>
<p>每个方法都将输入参与映射为一个SQL调用 并在数据库连接上执行该语句。由于表数据入口用于数据读写，因此通常是无状态的。</p>
<h3 id=行数据入口-row-data-gateway>行数据入口 (Row Data GateWay)</h3>
<p>充当数据源中单条记录入口的对象。每行一个对象。</p>
<h3 id=活动记录-active-record>活动记录 (Active Record)</h3>
<p>一个对象，它包装数据库表或视图中某一行，封装数据库访问，并在这些数据上增加领域逻辑。</p>
<p>本质是一个领域模型</p>
<p>Pros</p>
<ul>
<li>容易创建、易于理解</li>
</ul>
<p>Cons</p>
<ul>
<li>要求对象的设计和数据库的设计紧耦合</li>
<li>业务逻辑复杂时。</li>
</ul>
<h3 id=数据映射器data-mapper>数据映射器(Data Mapper)</h3>
<p><img src=https://hyvi.github.io/blog-images/20201107/data-mapping.png alt></p>
<p>在保持对象和数据库（以及映射器本身）彼此独立的情况下，在二者之间移动数据的一个映射层。</p>
<p>对象和关系数据库用来组织数据的机制不同。对象的很多部分（如集合和继承）在关系数据库中不存在。</p>
<h4 id=处理查找方法>处理查找方法</h4>
<p>分离接口解决这一难题：从领域对象到数据映射器的依赖关系。利用领域代码把所有需要查找方法放到一个可以置于领域包中的接口类中。</p>
<blockquote>
<p>在一个包中定义接口，而在另一个与这个包分离的包中实现这个接口。</p>
</blockquote>
<h4 id=把数据映射到领域对象的域>把数据映射到领域对象的域</h4>
<p>映射器需要访问领域对象中的域（属性）。这往往是个问题，因为需要一些公共方法支持领域逻辑不需要的映射器。???</p>
<h4 id=基于元数据的映射>基于元数据的映射</h4>
<p>如何将领域对象中的域映射到数据库列的信息。</p>
<ul>
<li>用显式代码实现，</li>
<li>把元数据作为数据存储在类或单独的文件中。这就是元数据映射。
<ul>
<li>好处是映射器的所有变化通过数据处理，而不用更多的源代码，也不用代码生成或者反射程序。</li>
</ul>
</li>
</ul>
<p>Pros</p>
<ul>
<li>解耦数据库和领域对象</li>
</ul>
<p>Cons</p>
<ul>
<li>引入新的层次。</li>
</ul>
<h2 id=分布模式>分布模式</h2>
<h3 id=远程模式remote-facade>远程模式（Remote Facade)</h3>
<blockquote>
<p>为细粒度对象提供粗粒度的外观来改进网络上的效率</p>
</blockquote>
<p><strong>一个远程外观是一个粗粒度的外观(facade)，它建立在大量的细粒度对象之上，所以细粒度对象都没有远程接口，并且远程外观不包括领域逻辑。 远程外观所要完成功能是把粗粒度的方法转化到底层的细粒度对象上。</strong></p>
<p>在粗粒度对象和细粒度对象之间的一层薄薄的皮肤。</p>
<pre tabindex=0><code class=language-plantuml data-lang=plantuml>@startuml
participant a as &quot;an address facade&quot;
participant b  as &quot;an address&quot; 
[-&gt; a: getAddressData 
a -&gt; b: getCity 
a -&gt; b: getState
a -&gt; b: getZip
@enduml
</code></pre><p>远程外观功能：</p>
<ul>
<li>提供一个粗粒度的接口</li>
<li>提供安全检查</li>
<li>事务控制： 开启一个事务，当做完许多工作之后提交事务。</li>
</ul>
<p><strong>远程外观没有领域逻辑</strong></p>
<h3 id=数据传输对象data-transfer-object>数据传输对象（Data Transfer Object）</h3>
<blockquote>
<p>一个为了减少方法调用次数而在进程间传输数据的对象。</p>
</blockquote>
<p>数据传输对象的价值在于它允许你在一次调用中传输几部分的信息。</p>
<p>数据传输对象通常不仅仅包含一个服务器对象。</p>
<p>通常不能从领域模型中传输对象。原因有：</p>
<ul>
<li>对象常常在复杂的 web 中连接起来，并且能够序列化的话也很难</li>
<li>你通常还不想在客户端看到领域对象类， 应该从领域对象中传输一个简单格式的数据。</li>
</ul>
<p>数据传输对象的常见格式有</p>
<ul>
<li>记录集， 它是一系列的表格记录。</li>
<li>集合数据结构</li>
</ul>
<h4 id=使用时机>使用时机</h4>
<ol>
<li>当你需要在一个方法调用中在两个进程之间传输多个数据项，应使用数据传输对象模式。</li>
<li>做为不同软件层中各种组件的通用数据源</li>
</ol>
<h4 id=faq>FAQ</h4>
<ol>
<li>
<p>是用单一数据传输对象来处理整个交互，还是用不同的数据传输对象来处理不同的请求。</p>
</li>
<li>
<p>是为请求房和发送方各自准备一个数据传输对象，还是用一个单一的数据传输对象来负责交付。</p>
</li>
</ol>
<h2 id=离线并发模式>离线并发模式</h2>
<p>乐观离线锁， 悲观离线锁，粗粒度锁，隐含锁</p>
<h3 id=乐观离线锁>乐观离线锁</h3>
<p>通过检查在会话读取一条记录后，没有其他的会话修改该数据来保证数据的一致性。</p>
<h3 id=悲观离线锁>悲观离线锁</h3>
<blockquote>
<p>每次只允许一个业务事务访问数据以防止并发业务事务中的冲突</p>
</blockquote>
<h4 id=运用机制>运用机制</h4>
<p>通过 3 步来实现悲观离线锁： 决定需要使用哪种锁类型，构建一个锁管理对象，定义业务事务使用锁的过程。</p>
<p>锁类型有：</p>
<ul>
<li>exclusive write lock 独占写锁</li>
<li>exclusive read lock 独占读锁</li>
<li>read / write lock 读写锁</li>
</ul>
<h2 id=分布式锁>分布式锁</h2>
<p>分布式环境下锁的全局唯一资源，使请求串行化，实际表现互斥锁，解决业务幂等问题。</p>
<p>强一致性、服务本身高可用使最基本的需求，其他的比如支持自动续费，自动释放机制，高度抽象接入简单，可视化，可管理等。</p>
<ul>
<li>基于 Redis 缓存的分布式锁<sup>[1]</sup>
<ul>
<li>存在单点<strong>问题</strong>，一旦涉及到 redis 集群，就会出现重复加锁的情况。</li>
<li>基于超时时间无法续租<strong>问题</strong>，随机数(fencing token<sup>[2]</sup>)解决了锁被其他任务释放的问题，但是还是无法解决超时导致的锁释放的问题。<strong>Redission</strong> 采用了 <code>Watch dog</code> 模式来解决这个问题的，具体是后台开启一个线程，每隔一定的时间去检查该锁 还有多久超时，然后给这个锁进行续租。</li>
<li>异步主从同步<strong>问题</strong></li>
</ul>
</li>
<li>基于存储层的可靠的解决方案，比如 zookeeper / ETCD</li>
</ul>
<h2 id=会话状态模式>会话状态模式</h2>
<p>客户端会话模式、服务器会话模式、数据库会话模式</p>
<p>当服务器会话状态也需要持久化时， 服务器会话状态和数据库会话状态之间区别是： <strong>是否将服务器会话状态中的数据转化为表格形式。</strong></p>
<h2 id=参考>参考</h2>
<p>[1] Somersames: <a href=https://somersames.xyz/2020/08/03/Redis%E5%AE%9E%E7%8E%B0%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%98%AF%E5%AE%8C%E7%BE%8E%E7%9A%84%E5%90%97%EF%BC%9F/>Redis 实现的分布式锁是完美的吗？</a></p>
<p>[2] Martin Kleppmann: <a href=https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html>How to do distributed locking</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-f56f85602f1c6d43b4eb2e67085e6fd8>1.6 - GPU 那些事儿</h1>
<h2 id=概念解释>概念解释</h2>
<h4 id=mapreduce>MapReduce</h4>
<p>为离线批处理服务的模型，分成 Map 任务分发和 Reduce 结果收集两个阶段，能以相同方式处理不同数据来源的大数据作业。</p>
<p>根据数据来源的不同和作业特点分为</p>
<ul>
<li>批计算</li>
<li>流计算, 处理连续的大规模数据流，将无界的数据流划分成固定大小的有界批处理子集</li>
<li>内存计算, 中间数据需要大量的迭代处理 ，把Map任务中的中间数据保存到内存中。</li>
<li>图计算，有依赖关系的多个子任务的 MapReduce 迭代计算形式。</li>
<li>交互计算, 对计算延迟敏感，或是包含多种计算模式的复杂作业。</li>
</ul>
<h4 id=spark-和-flink>Spark 和 Flink</h4>
<p>大数据处理框架，提供基于 MapReduce 模式的批处理、流计算、内存计算和图计算等多种计算模式 ，来处理不同输入形式的大数据作业。</p>
<h5 id=flink>Flink</h5>
<p>虽然没有使用 Flink, 但是需要了解 Flink 能做什么。</p>
<ul>
<li>事件驱动型应用</li>
<li>数据分析应用</li>
<li>数据管道应用</li>
</ul>
<p>详细查看 <a href=https://flink.apache.org/zh/usecases.html>Flink 应用场景</a></p>
<h5 id=spark>Spark</h5>
<h4 id=bsp>BSP</h4>
<p>并行计算模型中， 大同步并行模型，该模型可表示由多个超级步组成的计算过程。在每个超级步中各处理器执行局部计算，再完成点点数据同行，最后全局同步检查来确定所有处理器是否完成运算。</p>
<h4 id=dot-模型>DOT 模型</h4>
<p>在BSP基础上，研究者扩展可用于大数据计算计算模型。</p>
<p>采用矩阵形式化描述大数据处理的计算和通信行为. 将计算过程分为三个层次： 数据层、操作层、转换层。</p>
<h4 id=dota-模型>DOTA 模型</h4>
<p>中科院徐志伟团队提出, 在原来的 DOT 模型基础上，增加聚合层（A-Layer）回合处理转移层的中间数据并且完成最终结果。</p>
<h4 id=p-dot-模型>p-DOT 模型</h4>
<p>该模型沿用 BSP 的思路把大数据计算任务视为 p 阶段的 DOT 模型。在多次迭代的计算阶段内，p-DOT 模型由数据层、计算层、通信层构成。</p>
<h2 id=并行计算>并行计算</h2>
<p>来自《并行计算》</p>
<h2 id=mpi>MPI</h2>
<p>MPI 是一个跨语言的通信协议，支持高效方便的点对点、广播和组播。</p>
<p>MPI 属于 OSI 参考模型的第五层或者更高，他的实现可能通过传输层的 sockets 和 TCP 覆盖大部分的层。</p>
<p>MPI 标准不断演化，MPI-1 模型不包括共享内存概念。</p>
<p>MPI 有很多实现，例如 mpich 或者 openmpi</p>
<h2 id=mps>MPS</h2>
<p>The Multi-Process Service (MPS) is an alternative, binary-compatible implementation of the CUDA Application Programming Interface (API).</p>
<p>The MPS runtime architecture is designed to transparently enable co-operative multi-process CUDA applications, typically MPI jobs, to utilize Hyper-Q capabilities on the latest NVIDIA (Kepler-based) GPUs.</p>
<h2 id=kuberentes下-gpu-资源的使用>Kuberentes下 GPU 资源的使用</h2>
<p><strong>在一个 1 GPU 上跑多个 Job?</strong>, 按照文章的思路是可以实现的。</p>
<p>社区讨论</p>
<ul>
<li><a href=https://github.com/NVIDIA/k8s-device-plugin/issues/169>https://github.com/NVIDIA/k8s-device-plugin/issues/169</a></li>
<li><a href=https://github.com/kubernetes/kubernetes/issues/52757>https://github.com/kubernetes/kubernetes/issues/52757</a></li>
</ul>
<p><a href=https://github.com/tkestack/gpu-manager>TKE 上实现 GPU Share</a> 从测试数据以及 GIGAStack 产品，这种方案在正式环境上run起来的</p>
<ul>
<li><a href=https://pokerfacesad.github.io/2020/02/07/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0%E3%80%8AGaiaGPU%20Sharing%20GPUs%20in%20Container%20Clouds%E3%80%8B/>论文笔记《GaiaGPU：Sharing GPUs in Container Clouds》</a></li>
<li><a href=https://cloud.tencent.com/developer/article/1389547>GaiaStack上的GPU虚拟化技术</a></li>
<li><a href=https://ieeexplore.ieee.org/abstract/document/8672318>GaiaGPU: Sharing GPUs in Container Clouds 论文地址</a></li>
<li><a href=https://cloud.tencent.com/developer/article/1496699>Kubernetes 多卡GPU使用和分析</a></li>
</ul>
<p><a href=https://github.com/AliyunContainerService/gpushare-scheduler-extender>GPU Sharing Scheduler Extender in Kubernetes</a> 阿里云上实现 GPU Share</p>
<ul>
<li><a href=https://www.alibabacloud.com/blog/gpu-sharing-scheduler-extender-now-supports-fine-grained-kubernetes-clusters_594926>GPU Sharing Scheduler Extender Now Supports Fine-Grained Kubernetes Clusters </a></li>
<li><a href=https://github.com/AliyunContainerService/gpushare-scheduler-extender/blob/master/docs/designs/designs.md>GPU Sharing in Kubernetes</a> 阿里云共享 GPU 的设计。</li>
</ul>
<p><a href=https://github.com/NTHU-LSALAB/KubeShare>KubeShare - Share GPU between Pods in Kubernetes </a> 学校试验， 不确定在生产环境稳定运行。</p>
<p><a href=https://docs.google.com/document/d/1mdgMQ8g7WmaI_XVVRrCvHPFPOMCm5LQD5JefgAh6N8g/edit>Supporting MIG in Kubernetes</a> k8s-device-plugin 从0.7.0版本开始，支持 MIG（Multi-Instance GPUs)</p>
<ul>
<li>release <a href=https://github.com/NVIDIA/k8s-device-plugin/tree/v0.7.0#enabling-gpu-support-in-kubernetes>https://github.com/NVIDIA/k8s-device-plugin/tree/v0.7.0#enabling-gpu-support-in-kubernetes</a></li>
<li>社区讨论 <a href=https://github.com/NVIDIA/k8s-device-plugin/issues/180>https://github.com/NVIDIA/k8s-device-plugin/issues/180</a></li>
</ul>
<h3 id=gpu-虚拟化方案>GPU 虚拟化方案</h3>
<p>想解决 GPU 资源合理分配问题，先将设备虚拟化。</p>
<p><a href=https://cloud.tencent.com/developer/article/1496699>Kubernetes 多卡GPU使用和分析</a> 文章里将 GPU 节点先进行虚拟化，更改上报给 kubelet 的 DeviceID， 以及在 kubelet 调用 <code>Allocate()</code> 请求时将虚拟 DeviceID 转化为 对应的实际 DeviceID.</p>
<p>[ GPU 虚拟化技术（四） - GPU 分片虚拟化 ]（http://cloud.it168.com/a2018/0611/3208/000003208253.shtml?1） 提到分片从两个维度来定义：</p>
<ul>
<li>是对 GPU 在时间片段上的划分，一个物理 GPU 的计算 engine 在几个 vGPU 之间共享，而调度时间片一般都在 1ms - 10ms 左右，</li>
<li>是对 GPU 资源的划分，主要是指对 GPU 显存的划分，由于安全隔离的要求，每个 vGPU 独享分配给它的显存，不会与其他 vGPU 共享。</li>
</ul>
<p>该文章提到更深入的 GPU 分片技术框架。</p>
<h3 id=gpu-非虚拟化方案>GPU 非虚拟化方案</h3>
<p><em>todo</em></p>
<h3 id=nvidia-gpu-operator>NVIDIA GPU OPERATOR</h3>
<p>在 <a href=http://hyvi.github.io/docs/architecture/2020-11-06-prometheus-practise/#%E8%AE%BE%E5%A4%87%E6%8F%92%E4%BB%B6--device-plugin>Prometheus Proactise之设备插件 device-plugin</a> 提到 Kubernetes 下如何支持新的硬件。</p>
<p>Configuring and Managing nodes with these hardware resources require configuration of multiple software components such as drivers, container runtimes or other libraries which are difficult and prone to errors.</p>
<p>The Nvidia GPU Operator uses the operator framework within kubernetes to automate the management of all NVIDIA software components needed to provison GPU. These components include the NVIDIA drivers (to enable CUDA), Kubernetes device plugin for GPUs, the NVIDIA Container Toolkit, automatic node labelling using GFD, DCGM based monitoring and others.</p>
<h2 id=参考>参考</h2>
<p>[1] xtaohub.com: 一切靠自己的 MPI 框架</p>
<p>[2] stackoverflow: How do I use Nvidia Multi-process Service (MPS) to run multiple non-MPI CUDA applications?</p>
<p>[3] Enward: NVIDIA MPS总结</p>
<p>[4] NVIDIA: 《CUDA_Multi_Process_Service_Overview》</p>
<p><a href=https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/overview.html#getting-started>NVIDIA GPU OPERATOR</a></p>
<p><a href=https://www.cnblogs.com/timlly/p/11471507.html#324-nvidia-kepler%E6%9E%B6%E6%9E%84>深入了解 GPU 硬件架构及运行机制</a> 非常全面的介绍</p>
<p><a href=https://pop0726.github.io/bxjs/text/catalog/content1.htm>并行计算</a> 在线课程，必读</p>
<p><a href>论文：面向大数据复杂应用的 GPU 协同计算模型</a></p>
<p><a href=https://flink.apache.org/zh/usecases.html>Flink 应用场景</a></p>
<p><br></p>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-2d72ba724658ec96a2ca935bd5c05ec1>1.7 - PlantUML + Archimate 记录</h1>
<h2 id=背景>背景</h2>
<p>画好一张图(能表达清楚内容)不容易，画出漂亮的的一张图更难。好的工具对于完成这件事已经完成一半，剩下另外一半需要作图者发挥了 。</p>
<h2 id=工具>工具</h2>
<ul>
<li>PlantUML, PlantUML能记录所有的变更，也能转化为漂亮的图型.</li>
<li>VS Code, 其中PlantUML的插件可以实时查看图形</li>
<li>Archimate, 一套能解决各种架构图的成熟的方案, 覆盖非常多的Case</li>
</ul>
<h2 id=详细>详细</h2>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>ArchiMate Cookbook, 在Kanmi APP里阅读</p>
</li>
<li>
<p>ArchiMate 各种图介绍， <a href=https://www.hosiaisluoma.fi/blog/category/archimate/>https://www.hosiaisluoma.fi/blog/category/archimate/</a></p>
</li>
<li>
<p>《企业架构建模 - ArchiMate 语言》 <a href=https://www.slideshare.net/zhoujg/archimate>https://www.slideshare.net/zhoujg/archimate</a></p>
</li>
<li>
<p>TOGAF 学习， <a href=https://www.cnblogs.com/zhoujg/>https://www.cnblogs.com/zhoujg/</a></p>
</li>
<li>
<p><a href=http://blog.ifjy.me/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/2016/07/16/PlantUML%E8%AF%AD%E6%B3%95%E9%80%9F%E6%9F%A5.html>PlantUML 语法速查手册</a></p>
</li>
<li>
<p><a href=https://plantuml-documentation.readthedocs.io/en/latest/index.html>PlantUML 参数设置手册</a></p>
</li>
</ol>
<p><br></p>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-e15158a326a1352554ba42fb66497f05>1.8 - Reliability Engineering 可用性工程</h1>
<p>可用性工程到底指什么 ？ 当提到可用性建设的时候，其实是需要建设什么内容？</p>
<h2 id=行业标杆>行业标杆</h2>
<p>2019年的时候了解到Google SRE团队在建设的可靠性工程， 2019年百度对外公布其可用性工程建设的情况。</p>
<h3 id=百度可用性功能建设>百度可用性功能建设</h3>
<h4 id=可用性的问题>可用性的问题</h4>
<h4 id=可用性工程的需求>可用性工程的需求</h4>
<h4 id=可用性工程技术标准>可用性工程技术标准</h4>
<ul>
<li>预防故障发生能力</li>
<li>程序
代码、测试、变更规范</li>
<li>操作
操作规范，操作审计</li>
<li>运营
容量规划</li>
<li>防攻击</li>
<li>平台/第三方服务
服务SLA</li>
<li>基础设施
基础设施SLA</li>
<li>预防故障扩散能力</li>
<li>故障快速发现能力</li>
<li>故障定位止损能力</li>
<li>灾难恢复能力</li>
</ul>
<h4 id=落地>落地</h4>
<p>如何落地</p>
<h2 id=参考>参考</h2>
<ol>
<li>百度服务可用性工程建设, 形成了一套可用性功能技术标准。
<a href=https://www.infoq.cn/article/C4PddPgiGNFGTqD6pZAK>https://www.infoq.cn/article/C4PddPgiGNFGTqD6pZAK</a></li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-bf8ead2470cf57a8b5a58116a2b2600e>1.9 - About Cncf Projects</h1>
<p>CNCF Project vs CNCF Member Project 这有什么区别？</p>
<h2 id=projects>Projects</h2>
<h3 id=opentelemetry>OpenTelemetry</h3>
<p>OpenTelemetry 在遇到以下无法解决的问题情况下出现了。</p>
<ul>
<li>应用程序被锁定在特定解决方案的仪表中</li>
<li>针对开源软件的特定解决方案的仪表基本上是不可能的</li>
</ul>
<p>于是需要设计一个可观测的系统来解决以上问题，在设计上需要满足基本的需求<sup>[4]</sup>：</p>
<ul>
<li>要求：独立的仪表(instrumentation，这个翻译总觉得怪异，)、遥测和分析</li>
<li>要求：零依赖性</li>
<li>要求：严格的后向兼容和长期支持</li>
</ul>
<h4 id=概念>概念</h4>
<h5 id=信号-signal>信号 signal</h5>
<p>不同类型的遥测，我们称之为<strong>信号</strong>，主要的信号是追踪</p>
<p>OpenTelemetry 是一个跨领域的关注点(cross-cutting concern)</p>
<p><img src=https://raw.githubusercontent.com/rootsongjc/cloud-native-library/master/content/opentelemetry-obervability/images/f5-1.png alt title="所有 OpenTelemetry 信号都建立在一个共享的上下文传播系统之上。其他的，非可观测性的交叉关注也可以使用上下文传播机制来通过分布式系统传输他们的数据。"></p>
<h5 id=instrumentation>Instrumentation</h5>
<p>仪表（在 《OpenTelemetry 可观测性的未来》这样翻译的）</p>
<p>但是，来自谷歌：the particular instruments used in a piece of music / measuring instruments regarded collectively.</p>
<h5 id=otlp>OTLP</h5>
<p>OpenTelemetry protocol (OTLP)， 定义了 Open Telemetry 里 Tracing\Metrics\Logging 的 protobuf 的协议格式。 比如 <a href=https://github.com/open-telemetry/opentelemetry-proto/blob/main/opentelemetry/proto/trace/v1/trace.proto> Tracing </a></p>
<h5 id=propagators-and-context>Propagators and Context</h5>
<p>Propagators: Used to serialize and deserialize specific parts of telemetry data such as span context and Baggage in Spans.</p>
<p>Traces can extend beyond a single process. This requires context propagation, a mechanism where identifiers for a trace are sent to remote processes.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#000>otel</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SetTextMapPropagator</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>propagation</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>TraceContext</span><span style=color:#000;font-weight:700>{})</span>
</code></pre></div><p><code>TextMapPropagator</code> injects values into and extracts values from carries as text.</p>
<h5 id=carrier>Carrier</h5>
<p>A carrier is the medium used by Propagators to read values from and write values to.</p>
<h4 id=结合-newrelic-tracing-的实践>结合 Newrelic Tracing 的实践</h4>
<p><a href=https://docs.newrelic.com/docs/integrations/open-source-telemetry-integrations/opentelemetry/opentelemetry-quick-start/> OpenTelemetry and Newrelic 结合 </a>, 中间通过 opentelemetry-go 来连接。</p>
<p><img src=https://docs.newrelic.com/44724d5e137a64a9b9f426e1bcddc445/native_otlp.svg alt></p>
<p>也可以通过 opentelemetry-collector (e.g. binary, sidecar, or daemonset). 方式来做。</p>
<p><img src=https://docs.newrelic.com/2500a84a188882f4b0ecf1d270689112/native_otlp_with_collector.svg alt></p>
<h4 id=结合-alibaba-tracing-analysisarms的实践>结合 Alibaba Tracing Analysis（ARMS）的实践</h4>
<p><a href=https://www.alibabacloud.com/help/en/application-real-time-monitoring-service/latest/what-is-tracing-analysis>What is Tracing Analysis</a>， 从 Architecture 看是支持 Opentracing Basing SDK</p>
<blockquote>
<p>Tracing Analysis is compatible with SDKs from various open source communities and supports the OpenTracing standard.</p>
</blockquote>
<h3 id=apache-dolphinscheduler>Apache DolphinScheduler</h3>
<p>A distributed and easy-to-extend visual workflow scheduler system, undergoing incubation at ASF.</p>
<h3 id=megaease>MegaEase</h3>
<p>开源、自主可控、低层本、高可用的 Cloud Native 平台</p>
<ul>
<li>服务编排和服务治理</li>
<li>流量调度和流量管理</li>
<li>应用服务观测性 & DevOps</li>
<li>关键中间件运维及管理</li>
<li>基础资源调度</li>
</ul>
<p><img src=https://megaease.com/imgs/cloud.native.stack.zh.png alt></p>
<p><img src=https://megaease.com/imgs/cloud.native.arch.zh.png alt></p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p><a href=https://juejin.im/post/5d3572c1e51d45776147620f>OpenTelemetry-可观察性的新时代 </a></p>
</li>
<li>
<p><a href="https://landscape.cncf.io/project=member">CNCF 项目或者成员项目</a></p>
</li>
<li>
<p>OpenTelemetry: Propagators API</p>
</li>
<li>
<p>Ted Young，译者 Jimmy Song: OpenTelemetry可观察性指南</p>
</li>
<li>
<p>Uptrace: OpenTelemetry instrumentations for Go</p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-7aa640ebf687822b9a6f33bb0a4c11a2>1.10 - Microservice Arch 点点滴滴</h1>
<p><img src=https://www.jrebel.com/sites/rebel/files/image/2020-04/sl9-1567597621813-min.jpg alt="image via: https://www.infoq.com/presentations/uber-microservices-distributed-tracing/"></p>
<h2 id=pattern-microservice-architecture>Pattern: microservice architecture</h2>
<p>&ldquo;An architectural style that structures an application as a set of deployable/executable units, a.k.a. services&rdquo;</p>
<ul>
<li>Highly maintainable and testable</li>
<li>Minimal lead time (time from commit to deploy)</li>
<li>Loosely coupled</li>
<li>Independently deployable</li>
<li>Implements a business capability</li>
<li>Owned/developed/tested/deployed by a small team</li>
</ul>
<h2 id=行业架构最佳实践>行业架构最佳实践</h2>
<p><a href=https://docs.oracle.com/en/solutions/oci-best-practices/index.html#GUID-5F2D2745-934E-409A-A7BA-D0976F727845>Best practices framework for Oracle Cloud Infrastructure</a> <em>TODO</em></p>
<h2 id=行业架构分享>行业架构分享</h2>
<p>不断更新行业的一些架构分享，进行分析总结。</p>
<h3 id=designing-loosely-coupled-servicesslides>Designing loosely coupled services[Slides]</h3>
<p>by Chris Richardson, 介绍了几种类型 coupling 及其缺点和如何设计 loosely coupled 微服务.</p>
<p>Runtime coupling，订单服务需要等待客户服务返回时才给出响应，减少了可用性</p>
<p>Design time coupling，当客户服务变化时，订单服务也跟着变化。减少了开发的独立性</p>
<p>Minimizing design time coupling</p>
<ul>
<li>DRY</li>
<li>Consume as little as possible</li>
<li>Icebergs: expose as little as possible</li>
<li>Using a database-per-service</li>
</ul>
<p>Reducing runtime coupling</p>
<ul>
<li><a href=#resilience-patterns---circuit-breaker>Use resilience patterns for synchronous communication</a></li>
<li>Self-contained service</li>
<li>Improving availability: replace service with module</li>
<li>Use asynchronous messaging</li>
<li>Improving availability: <a href=#resilience-patterns---sagas>sagas</a></li>
<li>Improving availability: move responsibility + CQRS</li>
</ul>
<p>Avoiding infrastructure coupling</p>
<ul>
<li>Use private infrastructure: minimizes resource contention and blast radius</li>
<li>Use &ldquo;Private&rdquo; message brokers</li>
<li>Fault isolated swim lanes</li>
</ul>
<h2 id=模式-patterns>模式 PATTERNS</h2>
<h3 id=data-management>Data Management</h3>
<h4 id=database-per-microservice>Database per Microservice</h4>
<h4 id=cqrs>CQRS</h4>
<h4 id=event-sourcing>Event Sourcing</h4>
<h4 id=materialized-view-patterns>Materialized View Patterns</h4>
<p>Generate prepopulated views over the data in one or more data stores when the data isn&rsquo;t ideally formatted for required query operations. this can help support efficient querying and data extraction, and improve application performance.</p>
<h5 id=context-and-problem>Context and problem</h5>
<p>选择存储数据的方式跟数据本身的格式、数据大小、数据完整性以及所使用的存储种类， 但是，这样带来查询的不好的影响。比如当查询数据的子集时，必须取出所有的相关的数据，比如查询一些客户的订单概览</p>
<h5 id=solution>Solution</h5>
<p>为了支持高效率的查询，通用的解决办法是，提前生成数据视图（materializes the data in a format suited to the required results set.）
<img src=https://docs.microsoft.com/en-us/azure/architecture/patterns/_images/materialized-view-pattern-diagram.png alt></p>
<h3 id=messaging>Messaging</h3>
<h3 id=design-and-implementation>Design and Implementation</h3>
<h4 id=bff>BFF</h4>
<h4 id=api-gateway>API GateWay</h4>
<h4 id=strangler>Strangler</h4>
<h4 id=consumer-driven-contract-tracing>Consumer-Driven Contract Tracing</h4>
<h4 id=externalized-configuration>Externalized Configuration</h4>
<h4 id=facilitators>Facilitators</h4>
<p>Facilitators<sup>[5]</sup> are simple a new type that has access to the type you wished you had generic methods on.
比如，如果你是 ORM framework 的设计者，想提供一些查询表格的方法。你提供了一个中间类型（Querier），这个中间类型允许你写一些 generic querying functions。</p>
<h4 id=resilience-patterns---sagas>Resilience Patterns - Sagas</h4>
<p><a href=https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/saga/saga> Saga distributed transactions </a>, a way to manage data consistency across microservices in distributed transaction scenarios。</p>
<ol>
<li>Choreography</li>
<li>Orchestration.</li>
</ol>
<h4 id=resilience-patterns---circuit-breaker>Resilience Patterns - Circuit Breaker</h4>
<p>" used to limit the amount of requests to a service based on configured thresholds &ndash; helping to prevent the service from being overloaded " &ndash; 断路器</p>
<p>同时，通过监控多少个请求失败了，来阻止其他的请求进入到服务里</p>
<p>CircuitBreaker 使用 sliding window 来存储和集合发生的请求。 可以选择 count-based 也可以选择 time-based。</p>
<p><a href=https://github.com/rubyist/circuitbreaker>Circuit Breakers in Go</a> Golang语言的实现.</p>
<p><img src=https://docs.microsoft.com/en-us/azure/architecture/patterns/_images/circuit-breaker-diagram.png alt="Image via: https://docs.microsoft.com/en-us/azure/architecture/patterns/circuit-breaker"></p>
<h4 id=resilience-patterns---bulkhead>Resilience Patterns - Bulkhead</h4>
<p>" Isolates services and consumers via <strong>partitions</strong> &ldquo;, 舱壁模式, 在航运领域，舱壁是船的一部分，合上舱口后可以保护船的其他部分。</p>
<ul>
<li>SemophoreBulkhead, work well across a variety of threading and io models. it is based on a semaphore.</li>
<li>ThreadPoolBulkhead, uses a bounded queue and a fixed thread pool.</li>
</ul>
<p>防止级联失败发生. 但对应用来说该模式增加了负担.</p>
<p><img src=https://www.jrebel.com/sites/rebel/files/image/2020-04/image-jrebel-blog-microservices-performance-vector-7.jpg alt="image via: https://www.jrebel.com/blog/microservices-resilience-patterns"></p>
<p>什么时候使用：</p>
<ul>
<li>Isolate resources used to consume a set of backend services, especially if the application can provide some level of functionality even when one of the services is not responding.</li>
<li>Isolate critical consumers from standard consumers</li>
<li>Prodect the application from cascading failures</li>
</ul>
<h4 id=request_id>Request_id</h4>
<p><a href=https://medium.com/cstech/better-logging-approach-for-microservices-3cc2c45e7aaa>Better Logging Approach For Microservices</a> request_id在日志中打印，由请求方生成发起</p>
<p>从<a href=#%E5%8F%82%E8%80%83>What is the X-REQUEST-ID http header?</a>说明来看，建议是client生成x-request-id.</p>
<h4 id=resilience-patterns---ratelimiter>Resilience Patterns - RateLimiter</h4>
<p>限流的基础算法</p>
<ul>
<li>漏桶算法
<ul>
<li>漏桶算法的实现往往依赖于队列，请求到达如果队列未满则直接放入队列，然后有一个处理器按照固定频率从队列头取出请求进行处理。 如果请求量大，则会导致队列满，那么新来的请求就会被抛弃。</li>
</ul>
</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/623378-d8ca6373e1fbddae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p>
<ul>
<li>令牌桶算法
<ul>
<li>
<p>一个存放固定容量令牌的桶，按照固定速率往桶里添加令牌。桶中存放的令牌数有最大上限，超出之后 就会被丢弃或拒绝。当流量或者网络请求到达时，每个请求都要获取一个令牌，如果能获取到，则直接处理，并且令牌桶删除一个令牌。如果获取不到，则该请求就要被限流，要么直接丢弃，要不再缓冲区等待。</p>
</li>
<li>
<p>长期来看，所限制的请求速率的平均值等于 rate（每秒向桶添加令牌的速率r） 的值</p>
</li>
<li>
<p>实际请求达到的速率为 M， 达到的最大速率为 M = b + r (其中b 为令牌桶的最大值)</p>
</li>
</ul>
</li>
</ul>
<p><img src=https://upload-images.jianshu.io/upload_images/623378-992f9c0b0ab82143.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240 alt></p>
<br>
<h2 id=参考>参考</h2>
<p>What is the X-REQUEST-ID http header? <a href=https://stackoverflow.com/questions/25433258/what-is-the-x-request-id-http-header>https://stackoverflow.com/questions/25433258/what-is-the-x-request-id-http-header</a>)</p>
<p>Resilience4j is a fault tolerance library designed for Java8 and functional programming <a href=https://github.com/resilience4j/resilience4j>https://github.com/resilience4j/resilience4j</a></p>
<p>Azure Cloud Design Patterns, used in the cloud for building reliable, scalable, secure applications <a href=https://docs.microsoft.com/en-us/azure/architecture/patterns/index-patterns>https://docs.microsoft.com/en-us/azure/architecture/patterns/index-patterns</a></p>
<center> ·End· </center>
<p>.NET Microservices: Architecture for Containerized .NET Applications （PDF 在Kami 上）https://docs.microsoft.com/en-us/dotnet/architecture/microservices/</p>
<p>[5] JBD: Generics facilitators in Go</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-2100c1911c9bb54654a9c137ab8c0dfa>1.11 - Big Data Arch</h1>
<h2 id=背景>背景</h2>
<h2 id=行业案例>行业案例</h2>
<h3 id=腾讯游戏大数据应用>腾讯游戏大数据应用</h3>
<p><a href="https://pan.baidu.com/disk/home#/all?vmode=list&path=%2F0%20%E6%9E%B6%E6%9E%84%E5%A4%A7%E4%BC%9A%E8%B5%84%E6%96%99%2FArchSummit%202015%20shenzhen%2F%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%83%8C%E5%90%8E%E7%9A%84%E4%BB%B7%E5%80%BC%E4%B8%93%E9%A2%98">大数据背后的价值 - 腾讯游戏大数据应用</a></p>
<ul>
<li>大数据落地应用 = 数据 + 系统 + 算法 + 应用场景</li>
<li>腾讯游戏用户数据分层体系</li>
<li>腾讯游戏数据处理系统架构</li>
</ul>
<h3 id=饿了么数据仓库治理及数据应用>饿了么数据仓库治理及数据应用</h3>
<p><a href="https://pan.baidu.com/disk/home#/all?vmode=list&path=%2F0%20%E6%9E%B6%E6%9E%84%E5%A4%A7%E4%BC%9A%E8%B5%84%E6%96%99%2FArchSummit%202015%20shenzhen%2F%E5%A4%A7%E6%95%B0%E6%8D%AE%E8%83%8C%E5%90%8E%E7%9A%84%E4%BB%B7%E5%80%BC%E4%B8%93%E9%A2%98">大数据背后的价值 - 饿了么数据仓库治理及数据应用 </a></p>
<h4 id=数据仓库的建设>数据仓库的建设</h4>
<h5 id=标准化和规范化>标准化和规范化</h5>
<h5 id=统一日志搜集框架>统一日志搜集框架</h5>
<h4 id=原则>原则</h4>
<ul>
<li>主题划分</li>
<li>数据一致性</li>
<li>维度建设</li>
</ul>
<h4 id=todo>TODO</h4>
<ul>
<li>数据权限管理</li>
<li>数据使用记录</li>
<li>数据开放平台</li>
</ul>
<h3 id=uber-freight-carrier-metrics-with-near-real-time-analytics>Uber Freight Carrier Metrics With Near-Real-Time Analytics</h3>
<p><img src=https://hyvi.github.io/blog-images/20220903/uber-freight-carrier-system-design.png alt="Uber Final System Design"></p>
<p>目录</p>
<ol>
<li>Introduction</li>
<li>How We Did It
<ul>
<li>Backend Requirement</li>
<li>Potential Solution Considered</li>
<li>Final System Design</li>
<li>Data Schema</li>
<li>Flink stateful Stream Process</li>
<li>Hybrid Pinot Table</li>
<li>Golang GRPC Service</li>
</ul>
</li>
<li>Impact</li>
<li>Conclusion</li>
</ol>
<h2 id=通用方案>通用方案</h2>
<h3 id=存储读取写入>存储读取/写入</h3>
<p><a href=https://zhuanlan.zhihu.com/p/113892824>Data Lake 系列： 关于 EMRFS S3 优化的提交程序，你了解吗</a> 文章与 FileOutputCommitter 进行了比较。</p>
<p>同时在 <a href=https://github.com/rdblue/s3committer>github repo s3committer</a> 引出了 <a href=https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpuoverview.html> multi-part upload API </a> 技术，可以用于处理大文件上传慢的问题。</p>
<p>但是对于小文件上传问题， 是否可以就并发上传就行了呢？ No</p>
<p>方案： 压缩上传，上传完成后通过 <code>AWS Lambda</code> 来解压缩。 其中通过流（Stream）的方式解决 <em>Only 500MB of disk space per instance</em> 的限制<sup>[1]</sup>，但执行时间有15分钟的限制，对于超大文件还是有。</p>
<h2 id=参考>参考</h2>
<p>[1] John Paul Hayes: How to extract a HUGE zip file in an Amazon S3 bucket by using AWS Lambda and Python</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-e5642f043cdf7d0f1ee9aebaedfc53db>1.12 - RPC vs Http</h1>
<p>在评估 4G SDK 方案中，嵌入同事方案中使用 RPC 方案与服务器通信，让我感觉很奇怪，因为在我们的 web server 里通信一般都是 https 通信方式。</p>
<h2 id=rpc>RPC</h2>
<p>wikipedia&rsquo;s List of network protocols (OSI model)</p>
<p>RPC 属于 Session Layer,</p>
<h2 id=http-vs-rpc>HTTP vs RPC</h2>
<p><img src=https://pic1.zhimg.com/80/v2-7d859132076fe279e570ffcd6e7545d8_720w.jpg alt></p>
<p>rpc 是远端过程调用，其调用协议通常包含传输协议和序列化协议。</p>
<p>传输协议包含：如著名的 [gRPC](grpc / grpc.io) 使用的 http2 协议，也有如 dubbo 一类的自定义报文的 tcp 协议。
序列化协议包含：如基于文本编码的 xml json，也有二进制编码的 protobuf hessian 等。</p>
<h2 id=http-长连接>HTTP 长连接</h2>
<p>在参考<sup>[2]</sup> 中提到 httpServer 怎么处理长连接的： httpServer 创建一个 goroutine，更确切的说，是为了为一个新的 tcp 连接去创建一个 goroutine， 详细参考文章的源码。</p>
<h2 id=compare-grpc-services-with-http-apis>Compare gRPC services with HTTP APIs</h2>
<p>gRPC is designed for HTTP/2, vs HTTP 1.x:</p>
<ul>
<li>binary framing and compression.</li>
<li>Multiplexing of multiple HTTP/2 calls over a single TCP connection. Multiplexing eliminates <a href=#head-of-line-blocking>head-of-line-blocking</a></li>
</ul>
<table>
<thead>
<tr>
<th>Feature</th>
<th>gRPC</th>
<th>HTTP APIs with JSON</th>
</tr>
</thead>
<tbody>
<tr>
<td>Contract</td>
<td>Required (<code>.proto</code>)</td>
<td>Optional (OpenAPI)</td>
</tr>
<tr>
<td>Protocol</td>
<td>HTTP/2</td>
<td>HTTP</td>
</tr>
<tr>
<td>Payload</td>
<td><a href=#performance>Protobuf (small, binary)</a></td>
<td>JSON (large, human readable)</td>
</tr>
<tr>
<td>Prescriptiveness</td>
<td><a href=#strict-specification>Strict specification</a></td>
<td>Loose. Any HTTP is valid.</td>
</tr>
<tr>
<td>Streaming</td>
<td><a href=#streaming>Client, server, bi-directional</a></td>
<td>Client, server</td>
</tr>
<tr>
<td>Browser support</td>
<td><a href=#limited-browser-support>No (requires grpc-web)</a></td>
<td>Yes</td>
</tr>
<tr>
<td>Security</td>
<td>Transport (TLS)</td>
<td>Transport (TLS)</td>
</tr>
<tr>
<td>Client code-generation</td>
<td><a href=#code-generation>Yes</a></td>
<td>OpenAPI + third-party tooling</td>
</tr>
</tbody>
</table>
<blockquote>
<p>表格来自 <a href=https://docs.microsoft.com/en-us/aspnet/core/grpc/comparison>https://docs.microsoft.com/en-us/aspnet/core/grpc/comparison</a></p>
</blockquote>
<h3 id=head-of-line-blocking>Head-of-line Blocking</h3>
<blockquote>
<p>详细描述了HOL <a href=https://engineering.cred.club/head-of-line-hol-blocking-in-http-1-and-http-2-50b24e9e3372>https://engineering.cred.club/head-of-line-hol-blocking-in-http-1-and-http-2-50b24e9e3372</a></p>
</blockquote>
<p>Key Points:</p>
<ul>
<li>Frame</li>
<li>Message</li>
<li>Stream</li>
</ul>
<p>The HOL Blocking issue is resolved at the HTTP layer in HTTP/2, but it now moves to the TCP layer.</p>
<p>HTTP/3 or QUIC solves HOL Blocking at TCP layer by leveraging UDP instead of TCP as the transport protocol.</p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>既然有 http，为什么还要 RPC 调用？
<a href=https://www.zhihu.com/question/41609070>https://www.zhihu.com/question/41609070</a></p>
</li>
<li>
<p>Golang httpServer 对 KeepAlive 长连接的处理方式
<a href=https://blog.csdn.net/jeffrey11223/article/details/81222774>https://blog.csdn.net/jeffrey11223/article/details/81222774</a></p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-8838bdb6c8ad83f16e730d71b934e97a>1.13 - GCP Study</h1>
<h2 id=问题>问题</h2>
<p><em>场景一</em>
用户 在客户端 A 上传了数据到<code>数据处理服务 X</code>，并对数据进行了处理，得到<code>处理结果</code>
用户 在客户端 B 上能够获取<code>数据处理服务 X</code>的<code>处理结果</code>
( <code>数据处理服务 X</code> 对于此用户来说是透明的 )</p>
<p><em>场景二</em>
数据运营管理平台，用户登录后在直接访问各个服务数据 API 的时候需要鉴权。</p>
<h2 id=名词解释>名词解释</h2>
<p><em>API 表面 (API surface)</em>
API 的公共接口 。API surface 包含各种方法，以及这些方法中使用的参数和返回类型。</p>
<p><em>Service Management</em>
Google Cloud 基础架构服务， 创建并管理 API 和服务。</p>
<p><em>Extensible Service Proxy(ESP)</em>
基于 NGINX 的服务代理，类似 Isto Service Mesh 方式。</p>
<h2 id=cloud-endpoints-架构>Cloud endpoints 架构</h2>
<p>它给出了 API 管理系统，通过 ESP 或 Endpoints Frameworks 提供
<a href=https://cloud.google.com/endpoints/docs/frameworks/frameworks-extensible-service-proxy#endpoints_frameworks>比较可扩展服务代理和 Endpoints Frameworks</a></p>
<h3 id=esp-可扩展服务代理>ESP 可扩展服务代理</h3>
<p><img src="https://cloud.google.com/endpoints/docs/images/endpoints-architecture.png?hl=zh-cn" alt=endpoint-introduce></p>
<p>供给侧：</p>
<ol>
<li>配置 endpoints: 在 OpenAPI 配置文件中描述 API Surface 并配置 Endpoints 功能（例如 API 密钥或者身份验证规则）</li>
<li>部署 endpoints 配置：定义的 API 后，使用 <code>Cloud SDK</code> 将其部署到 Service Managerment.</li>
<li>部署 API 后端： 将 ESP 和 API 后端部署到受支持的 Google Cloud 后端，例如 Compoute Engine。ESP 会与 Endpoints 后端服务协同运作，以在运行时保护和监控您的 API。</li>
</ol>
<p><img src="https://cloud.google.com/endpoints/docs/images/endpoints_arch.png?hl=zh-cn" alt="Endpoints auchitect"></p>
<p>组件：</p>
<ul>
<li>ESP</li>
<li>Service Control</li>
<li>Cloud SDK</li>
<li>Google Cloud Console</li>
</ul>
<p><img src="https://cloud.google.com/endpoints/docs/images/endpoints_kube.png?hl=zh-cn" alt="K8S ESP"></p>
<p>这张图更清晰了给出 endpoints 的架构</p>
<h3 id=endpoints-frameworks>Endpoints Frameworks</h3>
<p>如果需要开发一个基于 GCP 上的 Restful 服务，需要使用 Endpoint Frameworks, 它解决了什么问题？
内置了一个 API 网关，拦截所有请求并执行所有必要的检查（例如身份验证），然后再将请求转发到 API 后端。后端响应后，会收集遥测数据并进行报告。</p>
<p><img src=https://cloud.google.com/endpoints/docs/images/frameworks-architecture.png alt="Endpoints Frameworks"></p>
<p>如下功能都在 Endpoints Management 里面完成。</p>
<ul>
<li>身份验证</li>
<li>API 密钥</li>
<li>监控</li>
<li>日志</li>
<li>配额</li>
<li>开发者门户
<ul>
<li><a href=https://cloud.google.com/endpoints/docs/images/frameworks-architecture.png>示例</a> Google cloud endpoints 从 openapi 文件 解析并展示 API 页面。我们 API 平台 可以参考下。</li>
</ul>
</li>
</ul>
<p><a href=https://github.com/cloudendpoints/endpoints-python> A python framework for building RESTful APIs on Google App Engine</a>
<a href=https://github.com/GoogleCloudPlatform/go-endpoints>Cloud Endpoint for Go</a> 已经 DEPRECATED，但是有借鉴的意义。</p>
<h3 id=实践>实践</h3>
<p>选择身份验证方式在 endpoints 中实践身份验证。<a href=https://cloud.google.com/endpoints/docs/frameworks/python/authentication-method>Cloud Endpoints 身份验证和 API 密钥</a></p>
<h2 id=identity-and-security>Identity and security</h2>
<h3 id=authentication>Authentication</h3>
<ul>
<li>None</li>
<li>API key
<ul>
<li>Identifies your project using a simple API key to check quota（限额） and access</li>
<li>API 密钥用于识别正在调用API的调用方项目（应用或网站），而身份验证令牌用于识别正在使用应用或者网站的用户（人员）</li>
<li>API 密钥的用途
<ul>
<li><strong>项目识别</strong> - 识别正在调用相应API的应用或项目</li>
<li><strong>项目授权</strong> - 检查调用方应用是否拥有API的权限，以及是否已在其他项目中启用API</li>
</ul>
</li>
</ul>
</li>
<li>OAuth Client ID（以最终用户身份进行身份验证）
requests user consent（同意） so your app can acces the user&rsquo;s data
<ul>
<li>你需要代表应用的最终用户访问资源，如您的应用需要访问应用用户的 Google BigQuery 的数据集</li>
<li>你需要以用户身份而非作为你的应用进行身份认证。</li>
<li>两个用途
<ul>
<li><strong>用户身份验证</strong> - 安全的验证调用方用户的真实的身份是否与宣称的一致</li>
<li><strong>用户授权</strong> - 检查用户是否应具备发出此请求的权限</li>
</ul>
</li>
</ul>
</li>
<li>Service account
Enables server-to-server, app-level authentication using robot account</li>
</ul>
<p>GCP API 使用 OAuth 2.0 协议进行用户账号和服务账号的身份验证。 OAuth2.0 身份验证过程确定<code>主账号</code>和应用</p>
<ul>
<li>用户账号 作为 <code>Google 账号</code>进行管理</li>
<li>服务账号 由 Cloud IAM 管理， 代表非人类用户。</li>
</ul>
<p>哪种适合，查看 <a href=https://cloud.google.com/docs/authentication#authentication_strategies> Authentication strategies </a></p>
<blockquote>
<p>API 密钥用于识别项目，身份验证用于识别用户</p>
</blockquote>
<blockquote>
<p>API密钥是不安全的； 由于客户端通常可以访问API密钥，因此API密钥容易被他人窃取。密钥被窃取后，由于没有到期时间，因此可以无限期的使用，除非项目所有者撤销密钥或者重新生成密钥，API 密钥的安全性没有身份验证令牌高。</p>
</blockquote>
<h3 id=实践-1>实践</h3>
<p><a href=https://cloud.google.com/endpoints/docs/quickstart-endpoints>Cloud EndPoints 快速入门</a> 实践文档。
<a href=https://github.com/GoogleCloudPlatform/endpoints-quickstart>点击查看示例仓库地址</a> 案例代码</p>
<p>心得</p>
<ul>
<li>当增加 API 密钥和限流的功能时，不需要更改后端服务任何代码</li>
<li>API 的监控通过 Google Cloud Console 来查看，非常方便。</li>
</ul>
<h2 id=分析>分析</h2>
<p>针对场景一</p>
<ol>
<li>客户端有自己的业务后台服务，客户端 A 的业务后台服务 A，简称”后台 A“， 客户端 B 则简称”后台 B“， 那么后台 A、B 访问<code>数据处理服务 X</code>属于 server-to-server 的方式来进行身份认证的。缺点是应用级的鉴权。
<a href=https://cloud.google.com/dataprep/docs/concepts/cross-bq-datasets>访问跨项目 BigQuery 数据集</a>
<a href=https://stackoverflow.com/questions/35479025/cross-project-management-using-service-account>Cross project management using service account</a></li>
</ol>
<ul>
<li>给后台 A 创建 Service-Account A, 并授予<code>数据处理服务 X</code>的资源创建、计算、查看角色</li>
<li>给后台 B 创建 Service-Account B, 并授予<code>数据处理服务 X</code>的资源查看、计算角色</li>
<li><del>问题是 两个 service-account 之间资源理应是隔离的，没办法解决同一用户获得数据的问题。</del></li>
<li>在 Console 中将 Service-Account B 添加到后台 A，并赋予查看、计算角色</li>
</ul>
<ol start=2>
<li>客户端没有自己的业务后台服务
在 google cloud 里，Firebase 解决移动端用户身份验证
Firebase 用户认证和 IAM 的结合？</li>
</ol>
<ul>
<li>客户端 A 开发在同一登录 Congnito 中创建 Service-Account A, 并授予<code>数据处理服务 X</code>的资源创建、计算、查看角色</li>
<li>用户在客户端 A 使用 Congito 登录后，根据 Service-Account A 生成 STS Token，返回给客户端 A</li>
<li>客户端 A 使用 STS Token 直接访问<code>数据处理服务 X</code>， 进行资源的创建，计算，查看</li>
<li>客户端 B 开发也在 Congnito 中创建 Service-Account B, 并授予<code>数据处理服务 X</code>的资源查看、计算角色</li>
<li>用户在客户端 B 使用 Congito 登录后，根据 Service-Account B 生成 STS Token，返回给客户端 B</li>
<li>客户端 B 使用 STS Token 直接访问<code>数据处理服务 X</code>， 进行资源的创建，计算，查看
用户访问的资源是隔离的。怎么处理？</li>
</ul>
<p>针对场景二</p>
<ol>
<li>使用 OAuth Client ID 方式登录
”以最终用户身份进行身份验证“
<em>你的应用如何验证用户身份，Google Cloud 使用的 firebase 身份验证</em>
以下步骤为实现无后台的数据运营平台。</li>
</ol>
<ul>
<li>完成服务 X 的上线，服务 X 需要接入数据运营平台，通过 IAM 并对用户 A 授予所有资源的查看权限。</li>
<li>用户 A 通过 OAuth2.0 登录后，提示他需要哪些服务的权限（Auth Scope），</li>
<li>进入”服务 X"，通过查询服务 X 的资源，并展示。</li>
</ul>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>Cloud EndPoints 简介
<a href="https://cloud.google.com/endpoints/docs/openapi/about-cloud-endpoints?hl=zh-cn">https://cloud.google.com/endpoints/docs/openapi/about-cloud-endpoints?hl=zh-cn</a></p>
</li>
<li>
<p>Cloud Endpoints 架构概览
<a href="https://cloud.google.com/endpoints/docs/images/endpoints_arch.png?hl=zh-cn">https://cloud.google.com/endpoints/docs/images/endpoints_arch.png?hl=zh-cn</a></p>
</li>
<li>
<p>Cross project management using serivce account
<a href=https://stackoverflow.com/questions/35479025/cross-project-management-using-service-account>https://stackoverflow.com/questions/35479025/cross-project-management-using-service-account</a></p>
</li>
<li>
<p>以最终用户身份进行身份验证
<a href=https://cloud.google.com/docs/authentication/end-user>https://cloud.google.com/docs/authentication/end-user</a></p>
</li>
<li>
<p>使用 firebase 在 App Engine 上对用户进行身份验证
<a href=https://cloud.google.com/appengine/docs/standard/python/authenticating-users-firebase-appengine#managing-user-data-in-datastore>https://cloud.google.com/appengine/docs/standard/python/authenticating-users-firebase-appengine#managing-user-data-in-datastore</a>
例子比较简单，并没有结合 IAM 来实现权限控制。</p>
</li>
<li>
<p>IBM OAuth 2.0 工作流程
<a href=https://www.ibm.com/support/knowledgecenter/zh/SSPREK_9.0.2/com.ibm.isam.doc/config/concept/con_oauth20_workflow.html#con_oauth20_workflow>https://www.ibm.com/support/knowledgecenter/zh/SSPREK_9.0.2/com.ibm.isam.doc/config/concept/con_oauth20_workflow.html#con_oauth20_workflow</a></p>
</li>
<li>
<p>《OAuth 2.0 实战》
百度网盘 -> 我的文档, 在Kami上阅读</p>
</li>
<li>
<p>[认证 & 授权]
<a href=https://www.cnblogs.com/linianhui/category/929878.html>https://www.cnblogs.com/linianhui/category/929878.html</a></p>
</li>
<li>
<p>[OIDC in Action] 详细流程展示OIDC过程
<a href=https://www.cnblogs.com/linianhui/category/1121078.html>https://www.cnblogs.com/linianhui/category/1121078.html</a></p>
</li>
<li>
<p>sample for oidc 上面文档的代码
<a href=https://github.com/linianhui/oidc.example>https://github.com/linianhui/oidc.example</a></p>
</li>
<li>
<p>Identity Server 4 - Hybird Flow - MVC 客户端身份认证
<a href=https://www.cnblogs.com/cgzl/p/9253667.html>https://www.cnblogs.com/cgzl/p/9253667.html</a>
<a href=https://www.cnblogs.com/cgzl/tag/OAuth2/>https://www.cnblogs.com/cgzl/tag/OAuth2/</a></p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-bdde9cbfd9f8eeac0cd39a3b3b3d14fb>1.14 - 限流的那些事</h1>
<h2 id=背景>背景</h2>
<p>限制 API 的请求数量是网络安全的一部分，大量的 API 请求导致高负载。
在学习 rudr 过程中也提到 rate limiting 可以做为 trait， 那么使用起来非常方便，业务开发并不需要关心限流逻辑。</p>
<h2 id=glossary>Glossary</h2>
<p><strong>traffic shaping</strong></p>
<p>packet are delayed until they conform</p>
<p><strong>traffic policing</strong></p>
<p>non-conforming packets may be discarded(dropped) or may be reduced in priority.</p>
<h2 id=what-and-the-importance>What and The Importance</h2>
<h3 id=what-is-api-rate-limiting>What Is API Rate Limiting</h3>
<p>集群流控： 集群流量不均匀导致总体限流效果不佳的问题，仅靠单机纬度去限制的话无法精准限制总体流量。</p>
<h3 id=best-practices-for-api-rate-limiting>Best Practices For API Rate Limiting</h3>
<h3 id=how-to-throttle-api-calls>How to Throttle API Calls</h3>
<h3 id=three-methods-of-implementing-api-rate-limiting>Three Methods of Implementing API Rate-Limiting</h3>
<h4 id=adaptive-system-protection-系统自适应限流>Adaptive System Protection （系统自适应限流）</h4>
<ul>
<li>Load 自适应</li>
<li>CPU usage</li>
<li>平均 RT</li>
<li>并发线程数</li>
<li>入口 QPS</li>
</ul>
<h4 id=request-queues>Request Queues</h4>
<h4 id=throttling>Throttling</h4>
<p>API Used by setting up a temporary state, allowing the API to assess each request</p>
<h4 id=rate-limiting-algorithms>Rate-limiting Algorithms</h4>
<p><strong>Leaky Bucket</strong></p>
<ul>
<li>as a meter，与 Token bucket 算法互为 mirror，
<ul>
<li>Token bucket 固定的 rate 增加 token；而另外一个是 固定的 rate 漏水</li>
<li>Token bucket 请求从桶中获取 token, 获取不到时则限流；而另外一个是往漏斗中滴水，滴满时则限流。</li>
</ul>
</li>
<li>as a queue，用于匀速排队的方式严格控制请求通过的间隔时间。</li>
</ul>
<p><strong>Fixed Window</strong></p>
<p><strong>Sliding Log</strong></p>
<p><strong>Sliding Window</strong></p>
<h2 id=rate-limiting-影响>Rate Limiting 影响</h2>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>Everything You need to Know About API Rate Limiting
<a href=https://nordicapis.com/everything-you-need-to-know-about-api-rate-limiting/>https://nordicapis.com/everything-you-need-to-know-about-api-rate-limiting/</a></p>
</li>
<li>
<p>Sentinel: 集群流控，https://github.com/alibaba/Sentinel/wiki/集群流控
<br></p>
</li>
</ol>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-10107dc58f8047d96fa3f1b7f95bb88e>1.15 - 微服务架构下Deloyment最佳方式探讨</h1>
<h2 id=背景>背景</h2>
<p>服务的升级和重构上线，跟服务如何平滑的部署、流量迁移有着密不可分的关系。</p>
<h2 id=参考>参考</h2>
<p><a href=https://docs.flagger.app/how-it-works>Flagger</a><br>
Flagger is a Kubernetes operator that automates the promotion of canary deployments using Istio, Linkerd, App Mesh, Nginx, Contour or Gloo routing for traffic shifting and prometheus metrics for canary analysis.</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b4073f3719895d9f503707326b40ca07>1.16 - Cloud Computing Service Modeling</h1>
<h2 id=简介>简介</h2>
<p>2020年需要重新思考架构模型，我们以怎样的方式对外提供服务，是Service， 一起看下有哪些Service吧</p>
<h2 id=service-model>Service Model</h2>
<p>常见的应该有Iaas(Host)、Paas(Build)、Saas(Consume)、Faas, 而在这边文章"Future of Cloud Computing Architectrue"里提到的Service更多类型</p>
<p><img src=https://hyvi.github.io/blog-images/20200102/Future%20of%20Cloud%20Computing%20Stack.png alt="Cloud Computing Stack"></p>
<p>每一种提供了不同的灵活性和控制，如下图：</p>
<p><img src=https://hyvi.github.io/blog-images/20211002/5-layer-diagram.png alt="Saas vs Paas vs Iaas Service Model"></p>
<h3 id=function-as-a-service-todo>Function-as-a-service TODO</h3>
<h3 id=software-as-a-service>Software-as-a-Service</h3>
<p>The Saas model 为你的业务提供基于云的web应用的访问能力，无须install new infrastructure</p>
<h4 id=the-twelve-factor-app>The Twelve-Factor APP</h4>
<p><a href=https://12factor.net/>https://12factor.net/</a> 为提供Saas服务提供了方法论:</p>
<ul>
<li>使用标准化流程自动配置</li>
<li>和操作系统之间尽可能的划清界限，在各个系统中提供<strong>最大的可移植性</strong></li>
<li>适合<strong>部署</strong>在现代的<strong>云计算平台</strong>， 从而在服务器和系统管理方面节省资源</li>
<li>将开发环境和生产环境的差异降至最低，并使用持续交付实施敏捷开发。</li>
<li>可以在工具、架构和开发流程不发生明显变化的前提下实现扩展。</li>
</ul>
<h4 id=身份认真和授权-todo>身份认真和授权 TODO</h4>
<p>License Model for Saas or alias &ldquo;Sass License&rdquo;, 感觉类似“<a href=https://aws.amazon.com/cn/cognito/dev-resources/>AWS cognito</a>”<br>
vs IAM</p>
<p><a href=https://aws.amazon.com/cn/blogs/china/aws-kms-enables-secure-data-encryption-across-tenants/>文章展示了AWS各个服务之间的交互逻辑</a></p>
<h3 id=platform-as-a-service>Platform-as-a-service</h3>
<p>With this model, a third-party vendor provides your business with a platform upon which your business can develop and run application.</p>
<h3 id=infrastructure-as-a-service>Infrastructure-as-a-service</h3>
<p>allow your business to have complete, scalable control over the management and customization of your infrastructure .</p>
<h2 id=patterns-in-microservice>Patterns in microservice</h2>
<p><img src=https://res.infoq.com/articles/architecture-trends-2020/en/resources/1Architecture-2020-Q2-1587042627643.jpg alt="architecture trends 2020"></p>
<h3 id=eda>EDA</h3>
<p><img src=https://miro.medium.com/max/468/1*YPhljs4qcqtN08dA54fdwA.png alt="Service composition - anit pattern"></p>
<ul>
<li>tightly coupled, because the calling service needs to know the URL payload and related detail of the service it calls</li>
<li>a change in functionality require a coordinated effort between multiple teams</li>
</ul>
<p><img src=https://miro.medium.com/max/1166/1*TtaEDXMTFpPqHj0a-7lxiw.png alt="Event notifications and event-driven architectures"></p>
<h3 id=asyncapi-todo>AsyncAPI #TODO</h3>
<h3 id=data-architecture>Data Architecture</h3>
<h4 id=data-mesh>Data Mesh</h4>
<blockquote>
<p>the next enterprise data platform architecture is in the convergence of Distributed Domain Driven Architecture, Self-serve Platform Design, and Product Thinking with Data<sup>[5]</sup>.
&mdash; Zhamak Dehghani</p>
</blockquote>
<h4 id=data-gateways>Data Gateways</h4>
<p>somewhat like API gateways but focus on the data aspect.</p>
<h3 id=policy-as-code-todo>Policy as Code #TODO</h3>
<h3 id=designing-for-___>Designing for ___</h3>
<h4 id=designing-for-resilience>Designing for resilience</h4>
<h4 id=designing-for-abservability>Designing for abservability</h4>
<h4 id=designing-for-portability>Designing for portability</h4>
<p>whether that’s for multi-cloud or hybrid-cloud. In most cases, there are no reasons for architects to design for the lowest common denominator to enable true multi-cloud portability or avoiding vendor lock-in.</p>
<h4 id=designing-for-sustainability>Designing for sustainability</h4>
<p>This is emerging because people are realizing the software industry is responsible for a level of carbon usage comparable to the aviation industry<sup>[6]</sup>.</p>
<h3 id=dapr>Dapr</h3>
<div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden>
<iframe src=https://www.youtube.com/embed/eJCu6a-x9uo style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="Nark Russinovich: The Future of Cloud Natvie Applications with Open Application Model and Dapr"></iframe>
</div>
<p>It is describing as a set of"microservice building blocks for cloud and edge" also is meant to be agnostic</p>
<blockquote>
<p>Dapr is completely platform agnostic, meaning you can run your applications locally, on any Kubernetes cluster, and other hosting environments that Dapr integrates with. This enables developers to build microservice applications that can run on both the cloud and edge with no code changes,"</p>
</blockquote>
<p><img src=https://github.com/dapr/dapr/raw/master/img/overview.png alt="Dapr is a portable, event-driven, runtime for building distributed applications across cloud and edge."></p>
<h4 id=dapr-building-blocks>Dapr building blocks</h4>
<ul>
<li>Service Invocation</li>
<li>State management</li>
<li>Plubish and subscribe messaging between services</li>
<li>Event driven resource bindings</li>
<li>Virtual actors &ndash; A pattern for stateless and stateful objects that make concurrency simple with method and state encapsulation. Dapr provides many capabilities in its virtual actor runtime including concurrency, state, life-cycle management for actor activation/deactivation and timers and reminders to wake up actors<sup>[7]</sup>.</li>
<li>Distributed tracing between services</li>
<li>Resillency</li>
</ul>
<h4 id=sidecar-architecture-and-supported-infrastructures>Sidecar architecture and supported infrastructures</h4>
<p>Dapr exposes its APIs as a sidecar architecture, either as a container or as a process, not requiring the application code to include any Dapr runtime code.</p>
<p><img src=https://cloudblogs.microsoft.com/uploads/prod/2019/10/overview-sidecar.png alt="Dapr running as a side-car process"></p>
<h4 id=multi-cloud-open-components-bindings-pub-sub-state-from-azure-aws-gcp>Multi-Cloud, open components (bindings, pub-sub, state) from Azure, AWS, GCP</h4>
<p>Dapr is completely platform agnostic, meaning you can run your applications locally, on any Kubernetes cluster, and other hosting environments that Dapr integrates with. This enables developers to build microservice applications that can run on both the cloud and edge with no code changes.</p>
<h4 id=dapr-和-service-mesh-的区别>Dapr 和 Service-Mesh 的区别</h4>
<p><img src=https://docs.dapr.io/images/service-mesh.png alt="service-mesh vs dapr"></p>
<p>共同点：</p>
<ul>
<li>基于 mTLS 加密的服务到服务的安全通信</li>
<li>服务到服务的度量指标收集</li>
<li>服务度到服务的分布式跟踪</li>
<li>故障重试恢复能力</li>
</ul>
<p>Dapr 以开发者为中心，提供了通过了名称进行服务发现和调用的方式。Dapr 还提供了其他应用级的构建块，如状态管理、发布/订阅、参与者等</p>
<h2 id=principles-in-microservice>Principles in Microservice</h2>
<ol>
<li>Create an organizational model that provide independence and antonomy to teams</li>
<li>services are independently deployable</li>
<li>services are independently scalable</li>
<li>they do not have a single point of failure - only degradation</li>
<li>the design employ asynchronous communication between services</li>
<li>no shared functionality , code or data exists in the system .</li>
<li>Component are easy to understand and the are small services with boundary</li>
</ol>
<h2 id=思考>思考</h2>
<p>接触到“AWS解决方案架构师”，负责企业客户应用在AWS的架构咨询和设计。在微服务架构设计，数据库等领域有丰富的经验。<br>
是技术产品还是技术架构师呢？ 那AWS这些云产品由什么位置来规划的？<br>
是技术架构师又偏技术业务，这是云服务架构师的之路, 最后做技术架构咨询。</p>
<h2 id=todo>TODO</h2>
<p>[ ] 企业软件架构模式，见kami app</p>
<h2 id=参考>参考</h2>
<p>[1] <a href=https://www.sjsu.edu/people/robert.chun/courses/CS247/s4/I.pdf>Futrue of Cloud Computing Architecture.pdf</a></p>
<p>[2] IBM: IaaS vs. PaaS vs. SaaS, Understand and compare the three most popular cloud computing service models</p>
<p>[3] InfoQ: Software Architecture and Design InfoQ Trends Report—April 2020</p>
<p>[4] InfoQ 趋势报告：架构和设计领域技术演变详解 2019</p>
<p>[5] Zhamak Dehghani: How to Move Beyond a Monolithic Data Lake to a Distributed Data Mesh</p>
<p>[6] Thomas Betts, Holly Cummins: Software Architecture and Design InfoQ Trends Report &ndash; April 2021</p>
<p>[7] Microsoft Open Source Blog: Announcing Distributed Application Runtime (Dapr), an open source project to make it easier for every developer to build microservice applications</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-47077e68da976692ff337a00dcb67e20>1.17 - 控制资源的访问权限</h1>
<p>这是一个最好的时代，也是一个最焦虑的时代，如果你停滞不前，时代抛弃你的时候，连一句再见都不会说。</p>
<h2 id=what>What</h2>
<p>Identity & Access Mangement, 身份验证以及访问控制，一种对资源提供可控安全的访问解决方案。
用来控制对 AWS 资源的访问权限，把资源 (Resouuce) 上的操作 (Action) 授权给谁 (identity)</p>
<p><img src=https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/images/intro-diagram%20_policies_800.png alt="IAM: https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/intro-structure.html"></p>
<p>图中三种 <a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html>Authorization</a>，看完这个链接，不止 three type :</p>
<ul>
<li>Identity-based polices
To provide your users with permission to access the AWS resource in their own account
<ul>
<li>Managed policy （托管策略）
<ul>
<li>AWS Managed policy,</li>
<li>Customer managed policy,</li>
</ul>
</li>
<li>inline policy（内联策略）: embedded in an IAM identity(a user, group, or role)</li>
</ul>
</li>
<li>Resource-based polices
Popular for granting cross-account access, Resource-based policies are <strong>inline only</strong>, not managed</li>
<li>Other polices
Should be used carefully</li>
</ul>
<p>Q: 这三种跟 Policy 的三种类型有什么区别？
A: 下面三种隶属于 Identity-based policy, 详细见：<a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html>Identity-Based Policies</a></p>
<h2 id=how>How</h2>
<ul>
<li>如何优雅的定义 Resource</li>
<li>如何优雅的定义 Action</li>
<li>Identity</li>
<li>Policy</li>
</ul>
<h3 id=resource>Resource</h3>
<p>AWS 给出的答案是： ARN（AWS Resource Namespace), ARN 是一个命名规则，用于无歧义的对 AWS 的资源进行命名。</p>
<p><a href=https://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html#api-gateway-calling-api-permissions>AWS 针对调用 API 的许可控制。 </a> 对 API 许可的资源格式定义非常全面，值得借鉴</p>
<h3 id=identity>Identity</h3>
<p>User, Group, Roles
<img src=https://hyvi.github.io/blog-images/20191130/IAM-Identity.webp alt></p>
<h3 id=action>Action</h3>
<p>Action 也就是针对 AWS 上的服务提供的 API。
Condition Context Keys，是 AWS IAM 中支持的一个功能。即在定义 Policy 时可以使用一些变量，支持复杂的表达式。</p>
<h3 id=policy--todo>Policy TODO</h3>
<p><a href=https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html>Policies Type</a>, 详细描述有哪些 Policy 种类，几乎覆盖大部分的场景</p>
<ul>
<li>Identity-based policies</li>
<li>Resource-based policies</li>
<li>Permissions boundaries</li>
<li>Organizations SCPS</li>
<li>Accss control lists(ACLs)</li>
<li>Session Policies</li>
</ul>
<p>用来描述授权策略的一种描述语言，用于描述谁在 xx 条件下对 xx 资源具有 xx 操作。 组成如下：</p>
<ul>
<li>
<p>“Version”</p>
</li>
<li>
<p>Statement： 具体策略的内容，可以是一个或者多个</p>
<ul>
<li>Effect: Allow 或者 Deny</li>
<li>Action: 具体操作，参见 <a href=http://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_actionsconditions.html>AWS Service Actions and Condition Context Keys for Use in IAM Policies.</a></li>
<li>Resource: 具体的资源</li>
</ul>
</li>
</ul>
<p>一个 identity 所有的多个 Policy 会发生冲突，IAM 采用的策略可以概括为 8 个字： ~凡事声明， 一票否决~</p>
<ul>
<li>凡事声明： 默认情况下， Resource 是禁止访问的，只有显式声明了对资源的 Allow 权限，才允许访问。</li>
<li>一票否决： 即便是有 Policy 开启了 Allow, 一旦其他的 Policy 中出现对 Resource 的 Deny 声明，一律 Deny</li>
</ul>
<h4 id=open-policy-agent>Open Policy Agent</h4>
<p><a href=https://segmentfault.com/a/1190000022753560>入门： Open Policy Agent:简化了微服务授权</a></p>
<ul>
<li>OPA定义一套DSL语言rego,</li>
<li>上文中提到微服务架构下借助nginx实现权限控制的一种方式</li>
</ul>
<p><a href=https://github.com/NewbMiao/opa-koans>OPA 入门系列</a></p>
<p>中文资料</p>
<h2 id=iam-实践-todo>IAM 实践 TODO</h2>
<p>AWS IAM is supporting a role-based access control(RBAC), paradigm by defining permissions within policies and attaching those to applicable principlas(IAM users and roles)</p>
<p>besides supporting both identity- and resource- based policies, IAM has alway supported aspects of attribute-based access control(ABAC) via the optional condition policy element and &ldquo;expressions in which you use condition operators(equal, less than, etc.) to match the condition in the policy against values in the request&rdquo;, such as IP address or time of day.</p>
<p>furthermore it has supported authorization based on tags.</p>
<h2 id=implement--todo>Implement TODO</h2>
<p><del>怎么实现这个系统，以及各个系统怎么接入</del>
当我继续深入了解<code>IAM</code>，接触到一个全新的概念<code>零安全架构</code>，来源于 Google Enterprise Security <a href=https://cloud.google.com/beyondcorp/#researchPapers>BeyondCorp: a new approach to enterprise security</a>, 同时同行也在实践这个方案，比如中通安全 <a href=https://www.secrss.com/articles/6752>中通下一步的 IAM 架构设计</a>,
接下来需要充分对这个架构的理解。</p>
<p>各个系统依赖于这个 IAM 权限控制系统，要实现的话两步走：</p>
<ul>
<li>怎么实现这个系统
<ul>
<li>基于 <a href=https://github.com/ory/hydra>hydra</a> 来实现 OAuth2.0 和 OIDC</li>
<li>基于 keto，参考实现权限系统</li>
</ul>
</li>
<li>各个系统怎么接入</li>
</ul>
<p>所有服务以一种语言实现， IAM 的功能作为 SDK 的方式集成在服务之中，SDK 依赖弹性伸缩的数据服务，辅以上层负载均衡依照 AK 将请求路由到不同的分区，以期保证性能的同时，达到更高的灵活度。</p>
<h3 id=hydra>hydra</h3>
<p>拉取hydra代码， 本地启动服务:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker-compose -f quickstart.yml -f quickstart-postgres.yml up --build
</code></pre></div><h2 id=todo>TODO</h2>
<ul>
<li><input disabled type=checkbox> 细读 <a href=https://cloud.google.com/beyondcorp/>BeyondCorp: A new approuch to enterprise security</a></li>
<li><input checked disabled type=checkbox> 细读<a href=https://www.secrss.com/articles/6752>浅谈助力零信任安全架构的云 IAM 设计</a> 理解整个系统的架构</li>
<li><input disabled type=checkbox> 细读 <a href=https://www.authlete.com/resources/templates/sequence-diagrams/>Sequence diagrams of OAuth 2.0 in Authelete</a></li>
</ul>
<h2 id=参考>参考</h2>
<p><a href=https://www.jianshu.com/p/f59745ae7fad> AWS IAM 从入门再到入门 </a> 提到一些有用的工具</p>
<p><a href=https://segmentfault.com/a/1190000013437169> IAM 身份验证以及访问控制 </a> 提到临时访问凭证的方案。</p>
<p><a href=https://yq.aliyun.com/articles/67180> 阿里云 RAM 策略整理 </a> 对 Policy 详细的讲解。对于“RAM 角色身份的授权策策略检查逻辑” 最后两步不是很理解。为什么“检查 RAM 角色所属的主账号是否有授权”， 以及检查“该资源是否支持跨账号 ACL 许可” ？</p>
<p><a href=http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/pdf/ram-intro-cn-zh-2016-09-26.pdf> 阿里云 访问控制 pdf 文件 </a> 产品简介，了解 RAM-User 和 RAM-Role 的定义。</p>
<p><a href="https://blog.csdn.net/bob_dadoudou/article/details/24718653?utm_source=tuicool&utm_medium=referral"> Restful Api 的访问控制方式</a></p>
<p><a href=https://www.geek-share.com/detail/2664431666.html> 当前国内外云计算平台的访问控制机制分析</a> 图挂了。</p>
<p><a href=https://www.aqniu.com/learn/37733.html>零信任的 5W1H</a> 解释什么是零信任。回答了这个概念。</p>
<p><a href=https://cloudacademy.com/blog/amazon-cognito-manage-mobile-data/>Amazon Cognito allow secure authentication in a world where mobile apps are regularly being accessed by individuals using multiple smart devices</a> 资源怎么被 APP 使用。</p>
<p><a href=https://juejin.im/entry/5af3b1dcf265da0b7f449041>贝壳找房权限服务的探索和实践</a> 贝壳找房权限服务的实践分享</p>
<p><a href=https://www.infoq.com/news/2019/02/iam-tags-attribute-based-access/>AWS Identity and Access Management Gains Tags and Attribute-Based Access Control</a>
2019.2.8 IAM 这一发布表示 Support the ability to embrace attribue-based access control (ABAC) and match aws resources with IAM principals dynamically to &ldquo;simplify permissions management at scale&rdquo;</p>
<p><a href=https://medium.com/@darutk>Takahiko Kawasaki</a> Co-founder and representative director of Authlete, Inc., working as a software engineer since 1997. 图做的非常清晰.</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-7c70474ebd4af8181781d9e1091fabc7>1.18 - APM资料整理</h1>
<h2 id=背景>背景</h2>
<p>NewRelic工作上使用、到Sentry接入所有应用，是时候需要对这些资料进行系统化的梳理。随着深入了解这些工具，APM出现在视线里，究竟什么是APM，它的来龙去脉是怎样的呢， 它解决了什么问题（或者目的是什么）？这篇文章根据自己检索到资料，对这些问题进行阐述</p>
<h2 id=名词解释>名词解释</h2>
<ul>
<li>管理模型</li>
</ul>
<h2 id=apm>APM</h2>
<p>Application Performance Management的缩写, “应用性能管理”，由Gartner归纳抽象出的一个管理模型。<br>
APM模型中一共分五个层次：<br>
<img src=http://static.oschina.net/uploads/space/2015/0403/095747_t0Na_118000.jpg alt></p>
<h3 id=end-user-experience>End User Experience</h3>
<p>首先关注的是终端用户对应用性能的真实体验。目的是帮助管理者准备、详尽地了解真实用户体验是什么样子。</p>
<h3 id=runtime-application-architecture>Runtime Application Architecture</h3>
<p>应用架构映射，目的是解决企业应用架构黑盒或灰盒的现状。</p>
<ul>
<li>应用的完整架构</li>
<li>单词请求的应用架构</li>
</ul>
<h3 id=business-transactions>Business Transactions</h3>
<p>应用事务分析<br>
GA大量的埋点，怎么做到不需要修改任何一行代码，我们并可以对应用取得的数据分析应用事务</p>
<ul>
<li>确定上下文的事务操作，是同一个用户</li>
<li>确定所有事务操作的每一个步骤，是唯一一个动作</li>
</ul>
<h3 id=deep-dive-component-monitoring>Deep Dive Component Monitoring</h3>
<p>深度应用诊断，</p>
<ul>
<li>在不修改用户代码的前提下，取得代码运行时性能数据</li>
<li>终端用户数据、运行时性能数据、数据指标数据、服务运行指标数据，有效关联</li>
<li>有太多的关注点，怎么方便的部署采集端</li>
<li>不影响原应用的性能。</li>
</ul>
<h3 id=analytics--reporting>Analytics / Reporting</h3>
<ul>
<li>处理数据要及时，必要时要做到实时的处理，问题可能随时都会发生；</li>
<li>数据的分析报告要准确 ，大量的数据本身无价值的，按照无业务模型进行分析、预测才能有其价值体现。</li>
</ul>
<h2 id=vs-sentry>VS Sentry</h2>
<p>“错误日志监控”也可称为“业务逻辑监控”，旨在对业务系统运行过程中产生的错误日志进行收集归纳和监控告警。<br>
就是“APM应用性能监控”。 但又与APM不同，APM系统主要注重应用层的行为分析， 收集到更多是运营方向的数据。<br>
而 Sentry所做是收集应用底层代码的奔溃信息，便于排查代码异常。简单来说，排障工具！<br>
Sentry解决的问题：</p>
<ul>
<li>无法第一时间感知错误</li>
<li>错误信息的获取相对低效</li>
<li>日志的处理方式不灵活</li>
<li>监控覆盖面有限</li>
</ul>
<p>Sentry 是一个现代化的错误日志记录和聚合平台，支持所有的主流开发语言和平台，并提供了现代化UI。</p>
<h2 id=参考>参考</h2>
<p><a href=https://my.oschina.net/ciogao/blog/395520>什么是真正的APM</a><br>
<a href=http://www.sohu.com/a/162399042_733939>运维开发实践——基于Sentry搭建错误日志监控系统 </a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-f25771a1b9a619a9f87799d92a815e2a>1.19 - API Trend 现状</h1>
<h2 id=graphql>GraphQL</h2>
<p>2012年 facebook内部开发，2015年公开公布，2018年 GraphQL项目转移到新成立的GraphQL基金会。<br>
有利有弊, 对于简单的API并不是好的选择。</p>
<ul>
<li>避免服务器大量冗余数据的返回</li>
<li>不能有效利用查询结构的web缓存</li>
<li>带来的灵活性和丰富性的同时 增加了复杂度</li>
</ul>
<p><a href=https://github.blog/2016-09-14-the-github-graphql-api/>The GitHub GraphQL API</a> 采用GraphQL API解决两大问题：</p>
<ol>
<li>scalability, 一次性同时提供客户端需要的信息，而不是像RESTFul API那样重复的请求几次获取需要的数据</li>
<li>Collect some meta-information about our endpoint 给不同endpoint不同的OAuth权限范围，更灵活的分页，只获取用户需要的数据.</li>
</ol>
<h2 id=open-apiswagger-api>OPEN API(Swagger API)</h2>
<p>OPEN API 从Swagger API 2.0发展而来<br>
<a href=https://www.programmableweb.com/news/whats-difference-between-rest-and-swagger/analysis/2018/08/06>What&rsquo;s the difference between Swagger and REST</a></p>
<blockquote>
<p>the net result is that OAS(OPEN API Spec) is considered to be a standard specification for describing REST APIS. not just for developers to consume, it is also intended for usage by software .</p>
</blockquote>
<p>是什么，一大特点</p>
<blockquote>
<p>Versus older architectural styles, the specifics of the REST architectural style — their simplicity, their elegance, and their ability to rely on existing standard networking protocols like the one that makes the World Wide Web work (aka the &ldquo;Hypertext Transfer Protocol&rdquo; or &ldquo;HTTP&rdquo;) — have made it one of the more enduring and popular architectural styles for networkable APIs. This is one reason that REST APIs are sometimes also called &ldquo;Web APIs.&rdquo; Although it is not a requirement, most REST APIs rely on HTTP (the Web&rsquo;s official protocol) to perform their magic.</p>
</blockquote>
<p>这里解释REST架构API 为什么被称为 “Web API”</p>
<h2 id=restful-api>Restful API</h2>
<p><a href=http://www.ruanyifeng.com/blog/2014/05/restful_api.html>RESTFul API设计指南</a><br>
前端设备与后端进行通信，导致API架构的流行，甚至出现“API First”的思想。<br>
RESTFul API是目前比较成熟的一套互联网应用程序的API设计理论。</p>
<blockquote>
<p>协议<br>
域名<br>
版本<br>
路径<br>
HTTP动词<br>
过滤信息<br>
状态码<br>
错误处理<br>
返回结果<br>
Hypermedia API<br>
其他</p>
</blockquote>
<h3 id=rest-api-backword-compatibility>Rest API backword compatibility</h3>
<ul>
<li>Tests</li>
<li>Always add parameters</li>
<li>Do not make optional parameters be mandatory</li>
<li>Always add additional HTTP response code returned by the API</li>
<li>Never delete or modify existing HTTP Response code behavior</li>
<li>Change URLs wisely</li>
</ul>
<h2 id=wsdlweb-services-description-language->WSDL(Web Services Description Language )</h2>
<p>网络服务描述语言</p>
<blockquote>
<p>are complimentary to other older but still deeply entrenched networkable API architecture like &ldquo;remote procedure call " or &ldquo;RPC "</p>
</blockquote>
<p>VS REST API</p>
<blockquote>
<p>OAS is complimentary to the REST architectural style</p>
</blockquote>
<h2 id=参考>参考</h2>
<ol>
<li>How to maintain Rest API backward compatibility?
<a href=https://zubialevich.blogspot.com/2018/09/backward-compatibility.html>https://zubialevich.blogspot.com/2018/09/backward-compatibility.html</a></li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-20b4d397434e7dd72c0f3ae6fd7e12da>1.20 - API 兼容性设计</h1>
<h2 id=简介>简介</h2>
<p>向后兼容的一般目标是： 服务升级到新的minor版本或者patch后客户端不应该被破坏</p>
<h2 id=名词解释>名词解释</h2>
<h3 id=source-compatibility>Source Compatibility</h3>
<p>code that compiled against version X of an API will also compile against version Y .</p>
<h3 id=binary-compatibility>Binary Compatibility</h3>
<p>code that compiled against version X of an API will run correctly in an environment that has version Y of the same API.</p>
<h2 id=向后兼容性的改变>向后兼容性的改变</h2>
<ul>
<li>为API服务添加一个API接口</li>
<li>为API接口添加一个方法</li>
<li>为方法添加一个HTTP绑定</li>
<li>为请求消息添加一个字段</li>
<li>为响应消息添加一个字段</li>
<li>为枚举类型添加一个值</li>
<li>添加output-only的资源字段</li>
</ul>
<h2 id=不向后兼容的更改>不向后兼容的更改</h2>
<ul>
<li>删除或重命名一个服务，字段或者枚举值</li>
<li>更改HTTP绑定</li>
<li>更改某个字段类型</li>
<li>更改资源名称格式</li>
<li>修改已有请求的可见性</li>
<li>在HTTP定义中改变URL格式</li>
<li>在资源消息中添加读/写字段</li>
</ul>
<h2 id=参考>参考</h2>
<p><a href=https://segmentfault.com/a/1190000009157548#articleHeader14> Google API 设计指南 - 兼容性 </a><br>
<a href=https://developers.google.com/youtube/compatibility_guidelines> Backward Compatibility Guidelines </a><br>
<a href=https://google-cloud.gitbook.io/api-design-guide/> API Gesign Guide </a> Google针对网络API的通用设计指南<br>
<a href=https://github.com/kijiproject/wiki/wiki/API-Compatibility-v2> API Compatibility v2</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b3dd446295c046b0254b164fdf051efc>1.21 - Web API Spec管理平台</h1>
<h2 id=背景>背景</h2>
<p>后台服务对外最重要的是提供API接口，上百上千的接口，怎么保持一种规范/约束，才能让接口在创建、更新、废弃生命周期中是有据可循的呢？</p>
<ul>
<li>接口的创建是按照什么规范?</li>
<li>接口的更新是对业务方无影响或者影响非常小的？</li>
<li>接口的废弃是怎样的方式？</li>
</ul>
<h2 id=调研>调研</h2>
<h3 id=业界解决方案>业界解决方案</h3>
<h4 id=apiary>apiary</h4>
<ul>
<li>Support API Blueprint\Swagger API</li>
</ul>
<blockquote>
<p>DNA for your API &mdash; powerful, open sourced and developer-friendly. The ease of Markdown combined with the power of automated mock server , tests, validations, proxies, and code samples in your language bindings</p>
</blockquote>
<ul>
<li>Server Mock</li>
<li>Documentation</li>
<li>Traffic Inpspector</li>
</ul>
<h4 id=mulesofthttpswwwmulesoftcomplatformapimanager><a href=https://www.mulesoft.com/platform/api/manager>MuleSoft</a></h4>
<p>the most widely used integration platform</p>
<p>总结： 有接口管理、实时使用数据指标、流量突变告警、</p>
<h4 id=apimatichttpswwwapimaticio><a href=https://www.apimatic.io/>APIMATIC</a></h4>
<ul>
<li>instant SDK, Code Samples, Test Cases</li>
<li>Continuous Code Generation</li>
<li>API Transformer</li>
</ul>
<p>总结： 其中代码生成、持续的代码生成、API转换都是非常需要的功能。</p>
<h4 id=apigee-cloudgooglecomapigee><a href=cloud.google.com/apigee>Apigee </a></h4>
<p>google提供跨云环境的API管理</p>
<ul>
<li>Web API Design</li>
<li>Mastering Full Lifecycle API</li>
<li>Management with Analytics</li>
<li>Securing APIs in the Age of Connected Experiences</li>
</ul>
<p>总结： 基本上满足文章开头的三个问题。</p>
<h4 id=kong>Kong</h4>
<p>介绍很少</p>
<h4 id=其他>其他</h4>
<ul>
<li><a href=www.apigility.org>apigility </a></li>
<li><a href=#>Falcon</a> Python web framework</li>
<li><a href=#>Amazon API Gateway</a> traffic management, authorization and access control, monitoring and API version management</li>
<li><a href=speccy.io>SPECCY</a> a handy toolkit for OpenAPI, with a linter to enforce quality rules, documention rendering and resolution</li>
</ul>
<h3 id=公司解决方案>公司解决方案</h3>
<h2 id=结论>结论</h2>
<h3 id=一期>一期</h3>
<p>API生命周期管理：API新建和显示（For Humans, For Machines），API使用，API弃用，版本管理，授权与访问控制</p>
<h4 id=todo-list>TODO LIST</h4>
<h3 id=二期>二期</h3>
<p>API的健康状态管理： API流量、API错误率等。打通与APM之间的数据。</p>
<h4 id=todo-list-1>TODO LIST</h4>
<h3 id=三期>三期</h3>
<p>支持更多的功能： API在线编写， API不规范的提示，API调式，API MOCK，API自动测试，代码生成（SDK和sample）</p>
<ul>
<li>Traffic Inspector<br>
提供代理方式，开发者可以把数据发送到调试代理上，通过比对数据和协议内容，来定位问题。<a href=apiary.io>想法来自 apiary.io</a></li>
</ul>
<h4 id=todo-list-2>TODO LIST</h4>
<h2 id=参考>参考</h2>
<p><a href=https://mathieu.fenniak.net/the-api-checklist/>The Web API Checklist &ndash; 43 Things To Think About When Designing, Testing, and Releasing your API</a><br>
<a href=https://www.cnblogs.com/weidagang2046/archive/2011/06/04/idempotence.html>理解HTTP幂等性</a><br>
<a href=http://design.apievangelist.com>API EVANGELIST</a><br>
<a href=https://apiblueprint.org>API Blueprint</a><br>
<a href=https://www.how2shout.com/tools/free-open-source-tools-api-creation-management-testing.html#comments>13 Free & Open Source Tools For API Creation, Management & Testing</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-e0db42a0d9b10d2a3a014e76ddeeccd1>1.22 - 迁移线上服务方案</h1>
<h2 id=背景>背景</h2>
<p>迁移服务器或者服务升级的事情时，需要对使用方来说是无感知的<br>
那怎么做到新旧代码或者新旧服务的平稳过渡呢？ 根据不同的情况具体的方案也是不一样的。</p>
<h2 id=调研>调研</h2>
<p>对各大公司进行做服务升级或者迁移的方案学习。吸取有用的方案。</p>
<h3 id=模拟客户端的请求前端做灰度上线>模拟客户端的请求，前端做灰度上线</h3>
<p>部署新旧服务， 完成AB测试， 灰度上线<br>
数据库数据怎么解决的？</p>
<h2 id=可行的方案>可行的方案</h2>
<p>结合目前的我们的基础设施，可执行的方案。</p>
<h2 id=最佳实践>最佳实践</h2>
<p>最后，我们的最佳实践是什么，我们实践后的总结</p>
<h2 id=参考>参考</h2>
<p><a href=https://hyvi.github.io>记一次从Rails直Golang的接口迁移</a>
<br></p>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-279d654ff9b8fa3e9d7d6073837f00ac>2 - Kubernetes</h1>
<div class=lead>用于梳理 k8s 相关的笔记</div>
</div>
<div class=td-content>
<h1 id=pg-e1c94c926e972f827a4987122e2627b1>2.1 - K8S Request vs Limit</h1>
<p>不断有pod被重启，但是并不知道原因</p>
<h2 id=名词解析>名词解析</h2>
<p><code>BestEffort</code>: for a Pod to be given a Qos of BestEffort, the container in the Pod must not have any memory or CPU limits or requests.</p>
<p><code>Burstable</code>: The Pod does not meet the criteria for QoS class Guaranteed, At least one Container in the Pod has a memory orr CPU request</p>
<p><code>Guaranteed</code>: Every Container in the Pod must have CPU limit and a CPU request, and they must be same, Every Container in the Pod must have a memory limit and a memory request , and the must be the same.</p>
<h2 id=要点>要点</h2>
<p><em>Request</em>： 容器使用的最小资源要求，不限制容器的最大可使用资源。</p>
<p><em>Limit</em>： 容器能使用资源的资源的最大值，设置为0表示使用资源无上限。</p>
<blockquote>
<p>Memory目前只支持Request，Limit必须强制等于Request，这样确保容器不会因为内存的使用量超过了Request但没有超过Limit的情况下被意外的Kill掉</p>
</blockquote>
<p>如果仅仅容器的内存使用量超过了Request但没有超过Limit的情况下，容器是不会被Kill掉的，所以上面这句话中”容器被意外的Kill掉“是其他原因导致的。比如出现内存资源抢占时。</p>
<h2 id=kubernetes-中资源的抢占>Kubernetes 中资源的抢占</h2>
<h3 id=可压缩资源的抢占策略>可压缩资源的抢占策略</h3>
<p>&mdash; 按照Request的比值进行分配</p>
<h3 id=不可压缩资源的抢占策略>不可压缩资源的抢占策略</h3>
<p>按照优先级的不同，进行Pod的驱逐。</p>
<p>优先级？详细官网说明：<a href=https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/#evicting-end-user-pods>Evicting end-user Pods</a></p>
<ol>
<li>Request=Limit=0</li>
<li>0 &lt; Request &lt; Limit &lt; Infinity</li>
<li>0 &lt; Request==Limit</li>
</ol>
<blockquote>
<p>由于对不可压缩的资源，发生抢占的情况会出Pod被意外Kill掉的情况，所以建议对于不可以压缩的资源(Memory, Disk) 的设置为0&lt;Requst==Limit</p>
</blockquote>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>Kubernetes 资源分配之Request和Limit解析
<a href=https://cloud.tencent.com/developer/article/1004976>https://cloud.tencent.com/developer/article/1004976</a></p>
</li>
<li>
<p>Configure Quality of Service for Pods
<a href=https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/>https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/</a></p>
</li>
<li>
<p>Kubernets 针对资源紧缺处理方式的配置（有点过时）
<a href=https://www.kubernetes.org.cn/1150.html>https://www.kubernetes.org.cn/1150.html</a></p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-5f43ca090ac49282dc7b5bea45675593>2.2 - OAM 详解</h1>
<h2 id=名词解释>名词解释</h2>
<p><strong>Actor Pattern (Actor 模型）</strong>
来自 Dapr 项目中的一个 concept. <del>Dapr 项目也实现了 OAM 规范</del>, Dapr 为未来 APP 开发方式。</p>
<blockquote>
<p>Dapr is a progamming model and not an application mdoel, so it operates in a lower abstraction. OAM is intended to solve the problem of modeling an application and all dependencies.</p>
<p>Dapr will not model the application&rsquo;s architecture.</p>
</blockquote>
<p>它是一个并行计算的数学模型，最初为由大量独立的微处理器组成的高并行计算机所开发。Actor 模型的理念非常简单： 天下万物皆为 Actor。 Actor 之间通过发送消息来通信， 消息的传递是异步的。每个 Actor 是完全独立的，同时执行它们的操作。</p>
<p>当一个 actor 接收到消息后，它能做如下三件事情中一件：</p>
<ul>
<li>Create more actors</li>
<li>Send messages to other actors</li>
<li>Designates what to do with the next message</li>
</ul>
<p>更多点击链接：<a href=https://www.brianstorti.com/the-actor-model/>10 分钟了解 Actor 模型</a>，这本书也提到《七周七并发模型》，下载了电子版放在 MarginNote 3 里来细读。</p>
<p>Dapr 里实现了 Virtual Actor pattern<sup>[2]</sup>,</p>
<blockquote>
<p>The Dapr actor runtime provides a simple turn-based Access model for accessing actor methods</p>
</blockquote>
<h2 id=背景>背景</h2>
<p><strong>Application Developers</strong> &ndash; 编写程序实现业务价值，大部分不清楚 k8s 等其他基础设施。</p>
<p><strong>Application Operators</strong> &ndash; 熟知集群的能力、稳定性、性能，以服务 Developers， 帮助 developer 配置、部署、操作应用（eg, updating, scaling, recovery)。 他们应该被称为 PaaS engineers。</p>
<p><strong>Infra Operators</strong> &ndash; 服务 application operators, 应该被称为 IaaS 工程师。</p>
<p>OAM 的出现，解决了三者之间的合作问题 (Problems of Cooperation), 存在哪些常见的问题呢？</p>
<h3 id=interactions-between-infra-operators-and-application-operators>Interactions between Infra Operators and Application Operators</h3>
<p>Application operator discover and manage capability that could potentially be in conflict with each other .</p>
<ul>
<li>DisCovery the spec of new capability is difficult</li>
<li>Confirming the existence of specific capability in a particular cluster is difficult</li>
<li>Conflicts in capability could be troublesome
<ul>
<li>Orthogonal</li>
<li>Composable</li>
<li>Conflicting</li>
</ul>
</li>
</ul>
<h4 id=oams-traits>OAM&rsquo;s Traits</h4>
<p>In OAM, &ldquo;Traits&rdquo; are how we create capabilities with <strong>discorverability</strong> and <strong>manageability</strong>.
大部分的 traits 为 infra operator 来定义并实现的。</p>
<p>需要注意的是，Traits 并不等同于 K8s 插件， 一个集群有多个网络相关的 Traits， 比如“dynamic QoS trait”, “brandwidth control trait” 和 &ldquo;traffic mirror trait&rdquo;, 这些都是通过 CNI Plugin 来提供的。</p>
<h3 id=interactions-between-application-operators-and-application-developers>Interactions between Application Operators and Application Developers</h3>
<p>Developers' Voices Should be Heard</p>
<ul>
<li>several parameters for an application,</li>
<li>Cannot be scaled</li>
<li>Is a batch job, not a long running service</li>
<li>Requires highest level security, etc</li>
</ul>
<h4 id=oams-component>OAM&rsquo;s Component</h4>
<p>In OAM, we try to logically decouple K8s API objects, so developers can fill in their own intentions, and still be able to convey information to operatiors in structured manner.</p>
<h4 id=the-applicationconfiguration>The ApplicationConfiguration</h4>
<p>ApplicationConfiguration 实例化应用，牵涉到 Component&rsquo;s 名称和所应用到 Traits</p>
<p>合作流程的方式 ：</p>
<ol>
<li>基础平台提供不同的 workload Type</li>
<li>开发者选择 workload type 定义 component.yaml</li>
<li>Application operator 执行 <code>kubectl apply -f component.yaml</code> 安装这个 component</li>
<li>Application operator 定义 ApplicationConfiguration 实例化这个应用。</li>
<li>最后，Application Operator 执行 <code>kubectl apply -f app-config.yaml</code> 触发整个应用的部署。</li>
</ol>
<h2 id=oam>OAM</h2>
<p>A specification for describing applications as well as its operational capabilities,</p>
<p>In OAM, an Application is made from three core concepts,</p>
<ol>
<li>The first is the Components, which might a collection of microservices, a database and a cloud load balancer</li>
<li>the second concept is a collection of Traits which describe the operational characteristics of the application such as capabilities like auto-scaling and ingress.</li>
<li>Finally, to transform these descriptions into a concrete application, operators use a configuration file to assemble components with corresponding traits to form a specific instance of an application.</li>
</ol>
<p><img src=https://github.com/oam-dev/spec/raw/master/assets/how-it-works.png alt></p>
<h3 id=traits>Traits</h3>
<p>represents a piece of add-on functionality that attaches to a component instance,
such as traffic routing rules(including load balancing policy, network ingress routing, circuit breaking, rate limiting) , auto-scaling policies, upgrade strageies, and more .</p>
<p><img src=https://github.com/oam-dev/rudr/raw/master/docs/media/traitcomic.PNG alt="traits schematic comic"></p>
<h3 id=component>Component</h3>
<p><img src=https://res.infoq.com/articles/oam-alibaba/en/resources/1The-Open-Application-Model-from-Alibaba-s-Perspective-1-1576678834717.jpg alt=Components></p>
<p>三部分组成：</p>
<ul>
<li>Workload 描述：怎么运行这个组件 (component)</li>
<li>Component 描述： 运行的是什么东西</li>
<li>一组可重写的参数。</li>
</ul>
<h4 id=workload-type-内置类型>Workload Type 内置类型</h4>
<p>如何选择内置的 workload type，根据三个方面来决定（如下）， 当然也可以扩展类型。</p>
<ul>
<li>Does this component expose service endpoint or not ?</li>
<li>Is this component relicable or not</li>
<li>Is this component long-runtime or one-time ( is daemonized or not )</li>
</ul>
<p><img src=https://res.infoq.com/articles/oam-alibaba/en/resources/1The-Open-Application-Model-from-Alibaba-s-Perspective-2-1576678834385.jpg alt="workload type"></p>
<h4 id=overwritable-parameter>Overwritable parameter</h4>
<p>to operators, which part of my app definition is overridable</p>
<h3 id=applicationconfiguration>ApplicationConfiguration</h3>
<p>Application Configuration 的一个简单例子如下：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>core.oam.dev/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ApplicationConfiguration</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>my-awesome-app</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>components</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>componentName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>nginx</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>instanceName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>web-front-end</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>parameterValues</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>connections</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>4096</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>traits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>auto-scaler</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>properties</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>minimum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>maximum</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>security-policy</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>properties</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>allowPrivilegeEscalation</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p>其中</p>
<ul>
<li>parameterValues &ndash; Operator 使用这个字段来复写<code>connections</code>的值为 4096</li>
<li>Trait <code>auto-scaler</code> &ndash; operator apply autoscaler trait (e.g. HPA) to the component.</li>
<li>Trait <code>security-policy</code> &ndash; operator 应用安全策略规则到 component</li>
</ul>
<p>Note: operator 可以增加更多的 traits 到列表， 比如可以增加&rsquo;Canary Deployment Trait' 使应用更新符合 canary rollout strategy.</p>
<h3 id=scopes>Scopes</h3>
<p>Application scopes are used to logically group components together by providing application boundaries that represent common group behaviors and/or dependencies.</p>
<p><img src=https://raw.githubusercontent.com/oam-dev/rudr/master/docs/media/appscopecomic.PNG alt="why scopes"></p>
<p><a href=https://github.com/oam-dev/rudr/blob/master/docs/concepts/scopes.md>rudr scopes</a></p>
<h2 id=rudr-实践>Rudr 实践</h2>
<p>缺国外云上的 k8s 环境，用于实践。
根据 <a href=https://github.com/oam-dev/rudr/tree/master/docs>rudr doc</a> 实践</p>
<ul>
<li>helm 的使用</li>
<li>rudr 目前的情况</li>
<li>developer: 如何 Writing a Trait
<a href=https://github.com/oam-dev/rudr/blob/master/docs/developer/writing_a_trait.md>https://github.com/oam-dev/rudr/blob/master/docs/developer/writing_a_trait.md</a></li>
<li>developer: how to implement your own workload type: support openfaas && prometheums as first extended workload.
<a href=https://github.com/oam-dev/rudr/pull/481>https://github.com/oam-dev/rudr/pull/481</a></li>
</ul>
<h3 id=安装-minikube-deprecated>安装 minikube (deprecated)</h3>
<p><a href=https://minikube.sigs.k8s.io/docs/start/>minikube start</a>
下载 minikube.iso 文件速度太慢了，5kb/s</p>
<pre tabindex=0><code>minikube-v1.6.0.iso: 19.92 MiB / 150.93 MiB 13.20% 9.44 KiB p/s ETA 3h56
</code></pre><p>放弃了。
使用 vultr 上 2c4m 机器来跑</p>
<h3 id=在-vultr-上安装-microk8s>在 vultr 上安装 microk8s</h3>
<p>之前没有使用过 microk8s。也可以使用远程使用公司的电脑。</p>
<h4 id=创建-ubuntu-1804-系统使用-microk8s使用-helm3-安装-rudr>创建 ubuntu 18.04 系统，使用 microk8s，使用 helm3 安装 rudr</h4>
<p>参考 <a href=https://github.com/oam-dev/rudr/blob/master/docs/setup/install.md>Installing rudr</a>。</p>
<p><strong>helm3</strong>
Github Homepage: <a href=https://github.com/helm/helm>https://github.com/helm/helm</a>
Helm is a tool for managing Charts. Charts are packages of pre-configured kubernetes resources. Think of it like apt/yum/homebrew for Kubernetes.</p>
<p>Charts can be stored on disk, or fetched from remote chart repositories(like Debian or RedHat packages)</p>
<p><strong>microk8s</strong>
Homepage: <a href=https://github.com/ubuntu/microk8s>https://github.com/ubuntu/microk8s</a>
The smallest, fastest Kubernetes.
Single-package fully conformant lightweight kubernetes
Perfect for:</p>
<ul>
<li>Developer workstations</li>
<li>IoT</li>
<li>Edge</li>
<li>CI/CD</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>snap install microk8s --classic

microk8s.enable helm3

git clone https://github.com/oam-dev/rudr.git

microk8s.helm3 install rudr ./rudr/charts/rudr --wait

</code></pre></div><h4 id=installing-implementations-for-traits>Installing Implementations for Traits</h4>
<p>Ingress，Manual Scaler, autoscaler
比如 Ingress，那么从 Helm3 hub 中选择 Ingress 的实现即可。
同样， autoscaler 选择一种实现 并部署即可。</p>
<h4 id=deploy-a-sample-rudr-application-using-the-tutorial>Deploy a sample Rudr application using the tutorial</h4>
<p>教程： <a href=https://github.com/oam-dev/rudr/blob/master/docs/tutorials/deploy_and_update.md>Tutorial: Deploy, inspect, and update a Rudr application and its components</a></p>
<p>比较简单的完成。
心得： 如果 Traits 比较丰富并且能轻松获取到使用文档的话，对于 Application Operator 来说，是非常方便的对 Application 的加上增强或者限制的功能。</p>
<h2 id=oam-的未来>OAM 的未来</h2>
<p>working with the community on OAM spec as well as K8s implementation</p>
<h2 id=参考>参考</h2>
<p>[1] Phil Bernstein Sergey Bykov Alan Geller Gabriel Kliot Jorgen Thelin: Orleans: Distributed Virtual Actors for Programmability and Scalability</p>
<p>[2] Dapr: Actors overview: Overview of the actors building block</p>
<p>[3] The Open Application Model from Alibaba&rsquo;s Perspective <a href=https://www.infoq.com/articles/oam-alibaba/>https://www.infoq.com/articles/oam-alibaba/</a></p>
<p>[4] 开放应用模型 OAM <a href=https://www.jianshu.com/p/da9bf3357247>https://www.jianshu.com/p/da9bf3357247</a></p>
<p>[5] A Kubernetes implementation of the Open Application Model specification <a href=https://github.com/oam-dev/rudr>https://github.com/oam-dev/rudr</a></p>
<p>[6] Automating Event-Based Continuous Delivery on Kubernetes with <a href=cd-on-k8s-with-keptn>keptn</a>, The keptn project provides a clear separation of concerns, allowing developer, DevOps and site reliability engineers to update delivery pipelines, 这个更加细，包括 SLO 指标、包括 blue\green deploy</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-2e2900c0652114a44e5fd808f93a86a1>2.3 - Kubernates Cluster Architecture</h1>
<div class=lead>分析kubernetes的架构</div>
<h2 id=cloud-controller-mananger>Cloud Controller Mananger</h2>
<p>解耦 Kubernetes 和底层云原生基础的交互。让两者的更新以不同的速度进行。</p>
<p>Cloud-controller-manager 使用插件机制，让不同的 cloud providers 集成 Kubernetes 到他们的平台。</p>
<p><img src=https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg alt></p>
<p>Cloud controller manager runs in the control plane as a relicated set of processes(usuallyh, these are containers in Pods). Each cloud-controller-manager implements multiple controllers in a single process.</p>
<p>The controllers inside the cloud controller manager include:</p>
<ul>
<li>Node Controller</li>
<li>Route Controller</li>
<li>Service Controller</li>
</ul>
<p><a href=https://github.com/kubernetes/cloud-provider-alibaba-cloud/blob/master/docs/zh/usage.md>cloud-provider-alibaba-cloud</a> 使用阿里云负载均衡来访问服务。链路更短，</p>
<p>原链路： SLB &ndash;> Node &ndash;> Pod</p>
<p>新链路： SLB &ndash;> Pod</p>
<h2 id=参考资料>参考资料</h2>
<p><a href=https://developer.ibm.com/cn/tv/2018/opentec-k8s/>IBM 微讲堂：Kubernetes 系列</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-33c2c22bdfd4946ed44b4a4b4782e4c5>3 - Golang</h1>
<div class=lead>用于梳理 golang 相关的笔记</div>
</div>
<div class=td-content>
<h1 id=pg-b483bd85453757b9e33563db1772e983>3.1 - About Golang String</h1>
<h2 id=问题>问题</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
	<span style=color:#4e9a06>&#34;fmt&#34;</span>
<span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>bys</span>  <span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>]</span><span style=color:#204a87;font-weight:700>byte</span>

	<span style=color:#000>bys</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span>  <span style=color:#4e9a06>&#39;h&#39;</span>
	<span style=color:#000>bys</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span>  <span style=color:#4e9a06>&#39;e&#39;</span>
	<span style=color:#000>bys</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>=</span>  <span style=color:#4e9a06>&#39;i&#39;</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#204a87>string</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bys</span><span style=color:#000;font-weight:700>[:])</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;hei&#34;</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[20]byte(&#39;h&#39;,&#39;e&#39;,&#39;i&#39;) === \&#34;hei\&#34;&#34;</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>输出： [20]byte(&lsquo;h&rsquo;,&lsquo;e&rsquo;,&lsquo;i&rsquo;) === &ldquo;hei&rdquo;</p>
<h2 id=要点>要点</h2>
<ul>
<li>the internal structure of any string type is declared like:</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>_string</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
   <span style=color:#000>elements</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#204a87;font-weight:700>byte</span> <span style=color:#8f5902;font-style:italic>// underlying bytes
</span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>len</span>      <span style=color:#204a87;font-weight:700>int</span>   <span style=color:#8f5902;font-style:italic>// number of bytes
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>
</code></pre></div><ul>
<li>
<p>String types are all comparable, When comparing two strings, <strong>their underlying bytes will be compared, one byte by one byte.</strong></p>
</li>
<li>
<p>if one string is a prefix of the other one and the other one is longer, then the other one will viewed as the large one.</p>
</li>
<li>
<p>when a byte slice is converted to a string, <strong>the underlying byte sequence of the result string is also just a deep copy of the byte slice</strong>.</p>
</li>
</ul>
<h2 id=延伸>延伸</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
	<span style=color:#4e9a06>&#34;fmt&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>s</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Go101.org&#34;</span>

<span style=color:#8f5902;font-style:italic>// len(s) is a constant expression, 
</span><span style=color:#8f5902;font-style:italic>// whereas len(s[:]) is not.
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>a</span> <span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>128</span> 
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>b</span> <span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>[:])</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>128</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>b</span><span style=color:#000;font-weight:700>)</span> <span style=color:#8f5902;font-style:italic>// 4 0	
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>

</code></pre></div><p>为什么会出现不一样的结果，一个要点是： <strong>the special type deduction rule in bitwise shift operator operation</strong></p>
<ul>
<li>
<p>当位运算左元素为 <strong>untyped value</strong>， 并且右元素为 constant 时，运算的结果类型保持与左元素一样。</p>
</li>
<li>
<p>当位运算左元素为 <strong>untyped value</strong>， 并且右元素为 non-constant 时，首先左元素类型转化为 assumed type (it would assume if the bitwise shift operator operation were replaced by its left operand alone)</p>
</li>
</ul>
<p>根据上面两个 rule, 上面语句变成：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>a</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>128</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>b</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>s</span><span style=color:#000;font-weight:700>[:])</span> <span style=color:#ce5c00;font-weight:700>/</span> <span style=color:#0000cf;font-weight:700>128</span>
</code></pre></div><p>为什么会有这样的 rule ？</p>
<blockquote>
<p>avoid the cases that some bitwise shift operations retuan different results on different architectures but the differences will not be detected in time.</p>
</blockquote>
<p>举个例子</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>m</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>uint</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#8f5902;font-style:italic>// The following three lines are equivalent to each other.
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>x</span> <span style=color:#204a87;font-weight:700>int64</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>m</span> 
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>y</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>int64</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>z</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>int64</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>m</span>
</code></pre></div><center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-7fba756dfa6d3e0c7ed3a45a87196075>3.2 - Monorepo for Golang With Bazel</h1>
<h2 id=背景>背景</h2>
<blockquote>
<p>ProtocolBuffer + gRPC + Bazel + Monorepo + Microservice is the common poly glot pattern which is also used in Google and other tech companies</p>
</blockquote>
<p>微服务面临的问题是大量的 repo（成百上千）， 尤其在依赖库的管理、规范的落地，非常麻烦困难。</p>
<p>需求点</p>
<ul>
<li>使用同一的 go.mod 来管理依赖</li>
<li>在不同的应用里可以服用共同的代码块</li>
<li>可以执行单个应用的测试也可以执行所有应用的测试</li>
<li>可以构建单个应用或者所有的应用</li>
</ul>
<h2 id=新概念>新概念</h2>
<h3 id=bazel>Bazel</h3>
<blockquote>
<p>Bazel is an open-source build and test tool similar to Make, Maven, and Gradle. It uses a human-readable, high-level build language. Bazel supports projects in multiple languages and builds outputs for multiple platforms. Bazel supports large codebases across multiple repositories, and large numbers of users.</p>
</blockquote>
<h3 id=rule>Rule</h3>
<blockquote>
<p>A rule defines a series of actions that Bazel performs on inputs to produce a set of outputs.</p>
</blockquote>
<p>rule_go 为 golang 编写的 rules。</p>
<p>对 Rule 进一步的了解，学习如何编写 rule，资料入口: rule_go 的作者系列文档： <a href=https://github.com/jayconrod/rules_go_simple>A simple set of Go rules for Bazel, used for learning and experimentation.</a></p>
<h3 id=gazelle>Gazelle</h3>
<blockquote>
<p>Gazelle is a build file generator for Bazel projects. It can create new BUILD.bazel files for a project that follows language conventions, and it can update existing build files to include new sources, dependencies, and options. Gazelle natively supports Go and protobuf,</p>
</blockquote>
<h2 id=实践>实践</h2>
<p>《Create Go Monorepo with Go-modules and Bazel》</p>
<p>Example: <a href=https://github.com/PxyUp/go_monorepo>https://github.com/PxyUp/go_monorepo</a></p>
<h3 id=gazelle-使用>Gazelle 使用</h3>
<pre tabindex=0><code>bazel run //:gazelle
</code></pre><p>疑惑点：</p>
<ul>
<li><input checked disabled type=checkbox> 每个 module 需要写 BUILD.bazel 配置文件，带来额外的麻烦。
<ul>
<li>Gazelle build file generator，原生支持 Go / protobuf</li>
</ul>
</li>
<li>如何跟 reviewdog(golangci-linter) 结合</li>
<li><input checked disabled type=checkbox> <del>不支持 IDE， 给习惯用 IDE 的来说是不愿意的接受</del></li>
<li>如何处理 grpc 生成的代码
<ul>
<li>共享生成的仓库</li>
</ul>
</li>
</ul>
<h2 id=结论>结论</h2>
<ul>
<li>有利于代码共享，解决各自孤立的状态</li>
<li>有利于统一依赖库，统一升级，确保安全。</li>
<li>新的技术，激活技术氛围和兴趣</li>
</ul>
<h2 id=faq>FAQ</h2>
<p>Q: how do you set up a CI/CD pipeline for a mono repo? When a code change to the repository triggers CI</p>
<p>A: <a href=http://blog.shippable.com/ci/cd-of-microservices-using-mono-repos>http://blog.shippable.com/ci/cd-of-microservices-using-mono-repos</a>， 更多内容参考： <a href=https://github.com/korfuri/awesome-monorepo/blob/master/README.md>https://github.com/korfuri/awesome-monorepo/blob/master/README.md</a></p>
<h2 id=参考>参考</h2>
<p><a href=https://github.com/atlassian/bazel-tools>Bazel 结合 golangci-linter</a></p>
<p><a href=https://www.reddit.com/r/golang/comments/dfod3o/guide_create_monorepo_with_go_modules_and_bazel/>Guide: Create monorepo with Go Modules and Bazel</a></p>
<p><a href=https://www.reddit.com/r/golang/comments/gjo2ei/building_ubers_go_monorepo_with_bazel/>Monorepo at Uber</a></p>
<p><a href=https://conan.io/>cmake + Conan：decentralized and multi-platform package manager to create and share all your native binaries.</a></p>
<p><a href=https://hardyantz.medium.com/>Monorepo with bazel and go module： 践行者</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-3b83ac5f286d261b4b7ae1b2137d125b>3.3 - Golang Pprof 使用梳理</h1>
<h2 id=背景>背景</h2>
<p>当前碰到的问题：</p>
<ul>
<li>部分服务 CPU 负载比较高</li>
<li>服务内存使用量比较大</li>
<li>服务高延迟（内存 CPU 负载都不高情况）</li>
</ul>
<p>golang 开发中有一些定位这些问题的套路和工具，在本文中汇总，记录并不断改进解决问题的思路。</p>
<p>从两个方面考虑：</p>
<ul>
<li>系统监控统计级别数据指标
<ul>
<li>goroutine 数量</li>
<li>堆 (heap) 内存使用量</li>
<li>栈 (stack) 内存使用量</li>
<li>其他&mldr;（待补充）</li>
</ul>
</li>
<li>问题定位所需的详细数据
<ul>
<li>获取系统实时堆内存分配详细信息：具体到这个内存在哪里分配的。</li>
<li>获取系统实时所有 goroutine 调用堆栈信息：具体到这个 goroutine 是在哪里启动的，以及当前在干什么</li>
<li>获取系统实时堆内存调优辅助统计信息： 具体是在哪里分配了多少内存，以及 TOP N 分别是哪些，甚至是每个内存分配的来源图</li>
</ul>
</li>
</ul>
<h2 id=diagnostics>Diagnostics</h2>
<h3 id=获取系统实时堆内存分配详情>获取系统实时堆内存分配详情</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#8f5902;font-style:italic>// 引入 pprof
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;net/http/pprof&#34;</span>
<span style=color:#8f5902;font-style:italic>// 在 http router 上加入
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>debugMux</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandleFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/debug/pprof/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandlerFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>pprof</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Index</span><span style=color:#000;font-weight:700>))</span>
</code></pre></div><p><code>curl -XGET "http://192.168.149.150:8080/debug/pprof/heap?debug=2"</code> 获取 heap 内存的详细信息，其中 8080 是你开启的 http server 的端口，debug=2 意味着需要输出详细信息</p>
<h3 id=获取系统实时所有-goroutine-调用栈信息>获取系统实时所有 goroutine 调用栈信息</h3>
<p>通过<code>curl -XGET "http://192.168.149.150:8080/debug/pprof/goroutine?debug=2"</code>拿到的就是 goroutine 的详细信息</p>
<h3 id=获取系统实时堆内存调优辅助统计信息>获取系统实时堆内存调优辅助统计信息</h3>
<p><code>go tool pprof -inuse_space http://192.168.149.150:8080/debug/pprof/heap</code>，进入 pprof 交互模式后，可以通过 top, tree 等进一步查看统计信息，同时，也可以通过 png 命令，将内存信息输出成图片，以图片的形式显示内存的分配、占用情况</p>
<h3 id=获取-trace-数据>获取 trace 数据</h3>
<p>通过：<code>curl -XGET "http://127.0.0.1:8080/debug/pprof/trace?seconds=30" -o 002_trace_2017_09_08.out</code>我们将获取一个 30 秒的 trace 数据 (trace_02.out)，通过<code>go tool trace 002_trace_2017_09_08.out</code></p>
<p>也是各种坑， 比如页面打开空白： <a href=https://github.com/golang/go/issues/25151>gotip tool trace xxx.out</a></p>
<h3 id=profile>Profile</h3>
<p>侧重于统计程序各 goroutine 自身的运行状况，更加适用于分析针对 cpu 密集型逻辑导致的 latency 过高问题</p>
<h4 id=cpu>cpu</h4>
<h4 id=heap>heap</h4>
<p>pprof 的 top 会列出 5 个统计数据：</p>
<ul>
<li>flat: 本函数占用的内存量</li>
<li>flat%: 本函数内存占使用中内存总量的百分比</li>
<li>sum%: 前面每一行 flat 百分比的和</li>
<li>cum： 是累计量，假如 main 函数调用了函数 f, 函数 f 占用的内存量，也会记进来</li>
<li>cum%: 是累计量占总量的百分比</li>
</ul>
<p>Memory profiling records the stack trace when a heap allocation is made</p>
<p>Stack allocations are assumed to be free and are not tracked in the memory profile.</p>
<p>Memory profiling, like CPU profiling is sample based, by default memory profiling samples 1 in every 1000 allocations this rate can be changed.</p>
<p>Because of memory profiling is samples based and because it tracks allocation not use , using memory profiling to determine your Application&rsquo;s overall memory usage is difficult .</p>
<h5 id=heap-不能-定位内存泄漏>Heap &ldquo;不能&rdquo; 定位内存泄漏</h5>
<p><img src="https://segmentfault.com/img/remote/1460000019222668?w=1008&h=868/view" alt></p>
<ol>
<li>该 goroutine 只调用了少数几次，但是消耗大量的内存</li>
<li>该 goroutine 调用次数非常多，虽然协程调用过程中消耗的内存不多，但该调用路径上，协程数量巨大，造成大量的内存消耗，并且这些 goroutine 由于某种原因无法退出，占用的内存不会释放。</li>
</ol>
<p>第二种情况， 就是<strong>goroutine 泄漏</strong>， 这是通过 heap 无法发现的，所以 heap 在定位内存泄漏这件事情上，发挥作用不大。</p>
<h5 id=goroutine-泄漏怎么导致内存泄漏>goroutine 泄漏怎么导致内存泄漏</h5>
<ul>
<li>每个 goroutine 占用 2kb 内存</li>
<li>goroutine 执行过程中存在一些变量，如果这些变量指向堆中的内存，GC 会认为这些内存仍在使用，不会对其进行回收，这些内存无法使用，造成内存泄漏
a. goroutine 本身的栈占用的空间
b. goroutine 中的变量所占用的堆内存，这一部分是能通过 heap profile 体现出来的。</li>
</ul>
<h5 id=如何定位-goroutine-内存泄漏>如何定位 goroutine 内存泄漏</h5>
<p>pprof 查看当前 heap 里谁（哪一段代码分配）占用内存比较大，
so 正确的做法是导出两个时间点的 heap profile 信息文件，使用 &ndash;base 参数进行对比</p>
<blockquote>
<p>来自 <a href=https://colobu.com/2019/08/20/use-pprof-to-compare-go-memory-usage/>Hi, 使用多年的 go pprof 检查内存泄漏的方法居然是错的？!</a></p>
</blockquote>
<p><a href=https://lessisbetter.site/2019/05/18/go-goroutine-leak/>实战 Go 内存泄漏</a> 通过监控工具和 go pprof 的 diff 方式来定位内存泄漏的问题，非常详细了，定位 goroutine 泄漏的方式</p>
<ul>
<li>
<p>查看某条调用路径上，当前阻塞在此 goroutine 的数量</p>
<ul>
<li><code>go tool pprof http://ip:port/debug/pprof/goroutine?debug=1</code></li>
</ul>
</li>
<li>
<p>查看所有 goroutine 的运行栈，可以显示阻塞在此的时间</p>
<ul>
<li><code>go tool pprof http://ip:port/debug/pprof/goroutine?debug=2</code></li>
</ul>
</li>
</ul>
<p><a href=https://juejin.im/post/5d9ff459f265da5b8a5160f5>goroutine 究竟占了多少内存？</a>, 先来看看结论</p>
<ul>
<li>goroutine 所占用的内存，均在栈中进行管理</li>
<li>goroutine 所占用的栈空间的大小，由 runtime 按需进行分配</li>
<li>以 64 位环境的 JVM 为例，会默认固定为每个线程分配 1M 栈空间，如果大小分配不当，会出现栈溢出的问题</li>
</ul>
<p><a href=https://juejin.im/post/5ce11d1ee51d4510601117fd>我是如何在大型代码库上使用pprof调查 Go 中的内存泄漏</a></p>
<ul>
<li>pprof的工作方式是使用画像。？？？ 画像是一组显示导致特定事件实例的调用顺序堆栈的追踪，例如内存分配.</li>
<li>如果内存消费是已个相关的考虑因素的话， 当数据不稀疏或者可以转换为顺序索引时，使用amp[int]T也没问题，但是通常应该使用切片实现。
<ul>
<li>扩容一个切片时，切片可能会使操作变慢，在map中这种变慢可以忽略不计。</li>
</ul>
</li>
</ul>
<h5 id=go-内存原理>Go 内存原理</h5>
<p>然后来了解内存中的几个概念</p>
<p><strong>分段栈</strong></p>
<p>早起版本中，Go 给 goroutine 分配固定的 8kb 的内存区域，当 8kb 空间不够了怎么办？</p>
<p>GO 会在每个函数入口处插入一小段前置代码，它能够检查栈空间十分被消耗殆尽，如果用完了，会调用 morestack() 函数来扩展空间。</p>
<p>带来的问题： 熟知的 hot split problem （热点分裂问题）</p>
<p><strong>连续栈</strong></p>
<p>从 Go1.4 之后，正式使用连续机制，二倍大小空间进行复制</p>
<p><strong>mem.Sys</strong>: Sys measures the virtual address space reserved by Go runtime for the heap, stacks, and other internal data structures.</p>
<p><strong>mem.Alloc</strong> : 已经被分配并仍在使用的字节数, the same as mem.HeapAlloc</p>
<p><strong>mem.TotalAlloc</strong>: 从开始运行到现在分配的内存总数</p>
<p><strong>mem.HeapAlloc</strong>: 堆当前的用量, 具体如下两个</p>
<ul>
<li>all reachable objects</li>
<li>unreachable objects that the garbage collector has not yet freed</li>
</ul>
<p><strong>mem.HeapSys</strong>: 包含堆当前和已经被释放但尚未归还操作系统的用量, 以及预留的空间.</p>
<p><strong>mem.HeapIdle</strong>:</p>
<p><strong>mem.HeapReleased</strong>:</p>
<p>以上详细解释参考 <a href=https://golang.org/pkg/runtime/#MemStats>runtime#Memstats</a></p>
<p><a href=https://github.com/q191201771/pprofplus>pprofplus</a> 将内存绘制成曲线图来查看内存的变化</p>
<p><a href=https://studygolang.com/articles/610>golang 手动管理内存</a> #TODO 为什么加这个链接?</p>
<h6 id=内存使用分析方法>内存使用分析方法</h6>
<p><a href=https://mikespook.com/2014/12/%E7%90%86%E8%A7%A3-go-%E8%AF%AD%E8%A8%80%E7%9A%84%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8/> 理解 go 语言的内存使用 </a> 中三种方式</p>
<ul>
<li>通过 runtime 包的 ReadMemStats 函数
<ul>
<li><a href="https://webcache.googleusercontent.com/search?q=cache:a6taX0NwR4cJ:https://forum.golangbridge.org/t/memory-usage-when-reading-large-files/10432+&cd=3&hl=zh-CN&ct=clnk">Memory Usage when reading large file</a> 提问者读一定大小的文件到内存，而实际上分配的内存远高于文件大小。</li>
</ul>
</li>
<li>通过 pprof 包, pprof 仅仅是获取了样本，而不是真正 的值，是非常重要的？
<ul>
<li><a href=https://groups.google.com/forum/#!topic/golang-nuts/Rhr758e7vo0>tools/techniques for tracking down &ldquo;too many open files&rdquo; </a>: the memory profile shows where the things ware created, not where they &lsquo;live&rsquo;.</li>
</ul>
</li>
<li>通过 gc-trace 调式环境变量</li>
<li>cgo 或者syscall 内存泄漏，怎么办？
<ul>
<li>Also CGO / syscall (eg: malloc / mmap) memory is not tracked by go. <a href=https://stackoverflow.com/questions/24863164/how-to-analyze-golang-memory>How to analyze golang memory</a></li>
<li><a href=https://www.pengrl.com/p/29054/>Go语言使用cgo时的内存管理笔记</a> 如何定位cgo内存泄漏 #TODO</li>
<li><a href=https://povilasv.me/go-memory-management-part-3/>Golang cgo memory</a></li>
</ul>
</li>
</ul>
<p><a href=https://draveness.me/golang/>Go 语言设计与实现</a> 详细从源码分析内存分配原理 #TODO</p>
<h5 id=linux-内存结构>linux 内存结构</h5>
<p>VIRT: 亦虚拟内存，虚拟地址空间大小，是程序映射并可以访问的内存数量, 参考下图对虚拟内存的解释,</p>
<p>RES: 亦常驻内存，进程虚拟空间中已经映射到物理内存的那部分的大小。</p>
<p>SHR: 亦共享内存，进程占用的共享内存大小，比如程序会依赖于很多外部的动态库(.so)。</p>
<p><img src=https://img.orchome.com/group1/M00/00/00/KmCudld5_zmAajUHAABd80xLId0540.png alt></p>
<p><a href=https://www.orchome.com/298>理解 virt res shr 之间的关系 - linux</a></p>
<p>mem: 物理内存</p>
<p>swap: 虚拟内存，即可以把数据存在在硬盘的数据</p>
<p>shared： 共享内存 , 存在物理内存中</p>
<p>buffers: 用于存放要输出到 disk 的数据的</p>
<p>cached: 存放从 disk 上读取的数据</p>
<blockquote>
<p>点击查看图片， 来自 <a href=https://cloud.tencent.com/developer/article/1404071>内存与 I/O 的交换</a>, 详细讲解了 file-backed pages vs anonymous pages.</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>total_mem</td>
<td>物理内存总量</td>
</tr>
<tr>
<td>used_mem</td>
<td>已使用的物理内存量</td>
</tr>
<tr>
<td>free_mem</td>
<td>空闲的物理内存量</td>
</tr>
<tr>
<td>shared_mem</td>
<td>共享内存量</td>
</tr>
<tr>
<td>buffer</td>
<td>buffer 所占的内存量，翻译为缓冲区缓存</td>
</tr>
<tr>
<td>cache</td>
<td>cache 所占内存量，翻译为页面缓存</td>
</tr>
<tr>
<td>real_used</td>
<td>实际使用的内存量</td>
</tr>
<tr>
<td>real_free</td>
<td>实际空闲的内存量</td>
</tr>
<tr>
<td>total_swap</td>
<td>swap 总量</td>
</tr>
<tr>
<td>used_swap</td>
<td>已使用的 swap</td>
</tr>
<tr>
<td>free-swap</td>
<td>空闲的 swap</td>
</tr>
</tbody>
</table>
<pre tabindex=0><code>real_used = used_mem - buffer - cache
real_free = free_mem + buffer + cache
total_mem = used_mem + free_mem
</code></pre><p><a href=https://xuxinkun.github.io/2016/05/16/memory-monitor-with-cgroup/>Docker 容器内存监控 </a></p>
<p><a href=https://github.com/digoal/blog/blob/master/201701/20170111_02.md>Linux cgroup - memory 子系统讲解</a>, 非常全面的介绍的 cgroup 里的内存概念</p>
<p>这里面涉及到多个内存相关概念：</p>
<ul>
<li>tmpfs
<ul>
<li><a href=https://segmentfault.com/a/1190000014737366> tmpfs 详解</a></li>
<li>临时文件系统，驻留在内存中</li>
<li>tmpfs 大小： 只有真正在 tmpfs 存储数据了，才会去占用。</li>
</ul>
</li>
<li>page cache
<ul>
<li><strong>page</strong>: The virtual memory is divided in pages .</li>
<li>Page cache 主要用来作为文件系统上的文件数据的缓存来用，尤其是针对当进程对文件有 read/write 操作的时候。<a href=https://github.com/digoal/blog/blob/master/201701/20170111_02.md>什么是 page cache</a></li>
</ul>
</li>
<li>rss, <a href=https://www.jianshu.com/p/3bab26d25d2e>内存耗用：VSS/RSS/PSS/USS 的介绍</a>
<ul>
<li>anonymous and swap cache, not including tmpfs (shmem), in bytes</li>
</ul>
</li>
<li>anonymous cache
<ul>
<li>先了解匿名映射： 进程使用 malloc 申请内存，或使用 mmap(MAP_ANONYMOUS 的方式）申请的内存</li>
<li>再了解文件映射： 进行使用 mmap 映射文件系统的文件，包括普通文件，也包括临时文件系统 (tmpfs), 另外 Sys v 的 IPC 和 POSIX 的 IPC 也是。</li>
</ul>
</li>
<li>swap cache
<ul>
<li>Swap 机制： 当内存不够的时候，我们可以选择性的将一块磁盘、分区或者一个文件当成交换空间，将内存上一些临时用不到的数据放到交换空间上，以释放内存资源给急用的进程。</li>
<li>Inactive（anon 匿名映射）, 这部分内存能被交换出去的。 需要注意的是，内核也将共享内存作为计数统计进了 Inactive（anon）中去了（是的，共享内存也可以被 Swap）。</li>
</ul>
</li>
</ul>
<pre tabindex=0><code>active_file + inactive_file = cache - size of tmpfs

active_anon + inactive_anon = anonymous memory + file cache for tmpfs + swap cache
</code></pre><p><a href=https://techtalk.intersec.com/2013/07/memory-part-1-memory-types/>Memory - Part 1: Memory Types</a></p>
<p>按照两个维度来划分内存</p>
<ul>
<li>whether memory is private ( specific to that process ) or shared
<ul>
<li>private</li>
<li>shared</li>
</ul>
</li>
<li>whether the memory is file-backed or not (in which case it is said the be anonymous )
<ul>
<li><strong>anonymous</strong>: purely in RAM</li>
<li><strong>file-backed</strong>: When a memory map is file-backed, the data is loaded from disk</li>
</ul>
</li>
</ul>
<p>见下表：</p>
<table>
<thead>
<tr>
<th></th>
<th>PRIVATE</th>
<th>SHARED</th>
</tr>
</thead>
<tbody>
<tr>
<td>ANONYMOUS</td>
<td>stack, malloc(),<br> mmap(ANON, PRIVATE), <br>brk()/sbrk()</td>
<td>mmap(ANON, SHARED)</td>
</tr>
<tr>
<td>FILE-BACKED</td>
<td>nmap(fd, PRIVATE) <br> binary/shared libraries</td>
<td>mmapn(fd, SHARED)</td>
</tr>
</tbody>
</table>
<p><a href=https://segmentfault.com/a/1190000022472459>采坑记 - go 服务内存暴涨</a> , 对 MADV_FREE 结合页表来分析，更加详细</p>
<p>内存分配</p>
<ul>
<li>在 Linux 下，malloc 需要在其管理的内存不够用时，调用 brk 或 mmap 系统调用 ( syscall ) 找内核扩充其可用地址空间</li>
<li>OS 用页表来管理进程的地址空间，其中记录了页的状态、对应的物理页地址等信息，一页通常是 4kb</li>
<li>当进程读 / 写尚未分配的页面时，会出发一个缺页中断 ( page fault ), 这时内核才会分配页面，在页表中标记为已分配，然后再恢复进程的执行。</li>
</ul>
<p>内存回收</p>
<ul>
<li>当 free 觉得有必要的时候，会调用 sbrk 或 munmap 缩小地址空间，这是针对一整段地址空间都空出来的情况</li>
<li>但更多的时候只释放其中一部分内容（比如连续的 ABCDE 五个页面中只释放 C 和 D）， 并不需要（也不能）把地址空间缩小</li>
<li>free 可以通过 madvise 告诉内存”这一段我不用了"</li>
</ul>
<p>madvise</p>
<ul>
<li>通过 madvise(addr, length, advise) 这个系统调用，告诉内核可以如何处理从 addr 开始的 length 字节。</li>
<li>在 Linux Kernel 4.5 之前， 只支持 MADV_DONTNEED，内核会在进程的页表中将页标记为"未分配”， 从而进程的 RSS 就会变小。</li>
</ul>
<p>go 1.12 的改进</p>
<ul>
<li>从 kernel 4.5 开始，Linux 支持了 MADV_FREE.</li>
</ul>
<h4 id=threadcreate>threadcreate</h4>
<h4 id=goroutine>goroutine</h4>
<h4 id=block>block</h4>
<h4 id=mutex>mutex</h4>
<p>实践 web 方式 <a href=https://rakyll.org/mutexprofile/>Mutex profle</a></p>
<p><del>里面提到的 PPT 在本地分析不出数据，</del>, 因为没有用 goroutine</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>f</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>factors</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>mu</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Lock</span><span style=color:#000;font-weight:700>()</span>
  <span style=color:#000>m</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>++</span>
  <span style=color:#000>mu</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Unlock</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#000>mu</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Lock</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>f</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>factors</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>m</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>++</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#000>mu</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Unlock</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><h3 id=trace>Trace</h3>
<h4 id=synchronization-blocking-profile>Synchronization blocking profile</h4>
<p>来自 rhys Hiltner 分析。</p>
<p>the thing that we are spending here is seconds that we&rsquo;re spent waiting. we have kind of the goroutine name at the top of the stack.</p>
<p>关于方框中"of"前面的的 0, 表示 &ldquo;zero time was spent inside of the box of 4.43. 来自 <a href="https://www.youtube.com/watch?v=N3PWzBeLX2M">Profiling and Optimizing Go, 关于 Type:CPU 的图解，时间： 11:00</a></p>
<h4 id=goroutines>goroutines</h4>
<p>goroutines that were running in that propram during those few seconds that i was recoording and listed.</p>
<p>根据 Execution time\Network wait time\Sync block time\Blocking syscall time\Sechedule wait time 的情况后，可以通过 graph 图了解 goroutine 详细情况。<code>参考 [10]</code></p>
<h3 id=flame>Flame</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pprof -http <span style=color:#4e9a06>&#34;localhost:12345&#34;</span> <span style=color:#4e9a06>&#39;http://127.0.0.1:53668/block?id=19105152&amp;raw=1&#39;</span>
</code></pre></div><p>查看 goroutine 中执行时间。</p>
<p>在参考 [7] 的视频 11:43 开始实际操作使用 Flame 定位程序执行慢的问题。</p>
<h3 id=debugging>Debugging</h3>
<h3 id=runtime-statistics-and-events>Runtime statistics and events</h3>
<h2 id=实践>实践</h2>
<p>定位高延迟的服务。</p>
<p>使用 logrus 打印日志文件，其中 Logrus 使用全局锁导致，goroutine 之间竞争写锁。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang>
<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>entry</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>Entry</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>write</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>entry</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mu</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Lock</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>entry</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>mu</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Unlock</span><span style=color:#000;font-weight:700>()</span>
	<span style=color:#000>serialized</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>entry</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Formatter</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Format</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>entry</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stderr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Failed to obtain reader, %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>entry</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Out</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>serialized</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fprintf</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stderr</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Failed to write to log, %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#000;font-weight:700>}</span>
	<span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>}</span>

</code></pre></div><p>在这篇 <a href=https://www.reddit.com/r/golang/comments/6irpt1/is_there_a_golang_logging_library_around_that/dj8m1sk/>Is there a golang logging library around that doesn&rsquo;t lock the calling goroutine for logging?</a> 链接里也提到 logrus 写锁怎么处理</p>
<ul>
<li>协程异步写日志，但是会占内存</li>
<li>换 zap 库</li>
</ul>
<p>其实并没有解答为什么延迟非常高的问题。</p>
<h2 id=todo>TODO</h2>
<p><a href=https://www.cnblogs.com/charlieroro/p/10180827.html>docker cgroup 技术之 memory</a> 看起来挺详细的分析文档，待细看。</p>
<p><a href=https://colobu.com/2019/08/28/go-memory-leak-i-dont-think-so/>Go 内存泄漏？ 不是那么简单</a></p>
<p><a href=https://www.cnblogs.com/qcrao-2018/p/10520785.html>图解 Go 语言内存分配</a></p>
<p><a href=https://www.pengrl.com/p/29054/>Go语言使用cgo时的内存管理笔记</a>, 简单教你如何定位cgo导致的内存泄漏</p>
<p><a href=https://povilasv.me/go-memory-management-part-3/>cgo内存分析 进阶版</a>, 三部曲，英文.</p>
<p>Rakyll 一系列的调优</p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>go tool proof 郝琳的中文说明 #TODO
<a href=https://github.com/hyper0x/go_command_tutorial/blob/master/0.12.md>https://github.com/hyper0x/go_command_tutorial/blob/master/0.12.md</a></p>
</li>
<li>
<p>Profiling Go Programs 官方 Blog #TODO
<a href=https://blog.golang.org/pprof>https://blog.golang.org/pprof</a></p>
</li>
<li>
<p>一次 Golang 程序内存泄漏分析之旅
<a href=http://lday.me/2017/09/02/0012_a_memory_leak_detection_procedure/>http://lday.me/2017/09/02/0012_a_memory_leak_detection_procedure/</a> 链接访问有点问题，可以用 google cache 查看文字</p>
</li>
<li>
<p>一次 Golang 程序延迟过大问题的定位过程
<a href=http://lday.me/2017/09/13/0013_a_latency_identification_procedure/>http://lday.me/2017/09/13/0013_a_latency_identification_procedure/</a></p>
</li>
<li>
<p>go tool trace
<a href=https://making.pusher.com/go-tool-trace/>https://making.pusher.com/go-tool-trace/</a> #TODO</p>
</li>
<li>
<p>Go 程序的性能监控与分析 pprof
<a href=https://www.cnblogs.com/sunsky303/p/11058808.html>https://www.cnblogs.com/sunsky303/p/11058808.html</a></p>
</li>
<li>
<p>Rhys Hiltner - An Introduction to &ldquo;go tool trace&rdquo;
<a href="https://www.youtube.com/watch?v=V74JnrGTwKA">https://www.youtube.com/watch?v=V74JnrGTwKA</a></p>
</li>
<li>
<p>关于 Go 程序调式、分析和优化 来自 Brad Fitzpatrick 的分享 #TODO
<a href=https://studygolang.com/articles/4716>https://studygolang.com/articles/4716</a></p>
</li>
<li>
<p>Golang remote profiling and flamegraphs, 对各种图阐述的比较清晰
<a href=https://matoski.com/article/golang-profiling-flamegraphs/>https://matoski.com/article/golang-profiling-flamegraphs/</a></p>
</li>
<li>
<p>Using Go 1.10 new trace features to debug an integration test, 这边文章描述了 trace 使用过程，赞
<a href=https://medium.com/@cep21/using-go-1-10-new-trace-features-to-debug-an-integration-test-1dc39e4e812d>https://medium.com/@cep21/using-go-1-10-new-trace-features-to-debug-an-integration-test-1dc39e4e812d</a></p>
</li>
<li>
<p>Profiling Go programs with pprof #TODO
<a href=https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/>https://jvns.ca/blog/2017/09/24/profiling-go-with-pprof/</a></p>
</li>
<li>
<p>rakyll blog #TODO
<a href=https://rakyll.org/archive/>https://rakyll.org/archive/</a>
<br></p>
</li>
<li>
<p>Diagnostics 官文 #TODO
<a href=https://golang.org/doc/diagnostics.html>https://golang.org/doc/diagnostics.html</a></p>
</li>
<li>
<p>实战 Go 内存泄漏
<a href=https://segmentfault.com/a/1190000019222661>https://segmentfault.com/a/1190000019222661</a></p>
</li>
</ol>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-f691475805d1a40b7cd3005ba6a3c434>3.4 - Gorm</h1>
<p>TIME_WATI 数量达到 300 多个， 连接中的数量只有几个。</p>
<h2 id=设置>设置</h2>
<p>设置下最大连接数（100）和闲置连接数（50）以及<del>连接的时间（1 小时）</del></p>
<p>从 [2] 文章测评来看，unlimited ConnMaxLifetime 的情况下，时间和内存分配上都会少。 该 ConnMaxLifetime 使用场景如：</p>
<blockquote>
<p>你的 SQL 数据库实现了最大的连接生存期， 或你希望在负载均衡器后面方便的切换数据库 （这句话不是很懂）</p>
</blockquote>
<h3 id=setmaxidleconns-设置>SetMaxIdleConns 设置</h3>
<p>维护一个大的空闲连接池，副作用是有的，占用内存。另外一种可能是，如果一个连接空闲太久，那么它也可能变得不可用。例如 Mysql 的 wait_timeout 设置将自动关闭 8 小时内未使用的任何连接（默认情况下）， 当发生这种情况时，sql.DB 会优雅的处理它。 在放弃之前，将自动重试两次连接，之后 Go 将从池中删除坏连接并创建新连接。</p>
<h3 id=超出连接限制>超出连接限制</h3>
<p>如果数据连接限制为 5 个，一旦达到 5 个连接的硬限制，pg 数据库驱动程序立即返回一条 sorry, too many clients already 错误信息， 而不是完成插入操作。</p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>分析 golang sql 连接池大量的 time wait 问题
<a href=http://xiaorui.cc/archives/5771>http://xiaorui.cc/archives/5771</a></p>
</li>
<li>
<p>配置 sql.DB 获得更好的性能
<a href=https://colobu.com/2019/05/27/configuring-sql-DB-for-better-performance/>https://colobu.com/2019/05/27/configuring-sql-DB-for-better-performance/</a></p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-762d41fcff5885e1e92c42644dfdb847>3.5 - Golang语言之禅</h1>
<h2 id=理解>理解</h2>
<h3 id=each-package-fulfils-a-single-purpose--保持每个package的单一目的性>Each package fulfils a single purpose 保持每个package的单一目的性</h3>
<blockquote>
<p>A well designed Go package provides a single idea, a set of related behaviours.
A good Go package starts by choosing a good name.
Think of your package&rsquo;s name as an elevator pitch to describe what it provides, using just one word.</p>
</blockquote>
<h3 id=handle-errors-explicitly--显式处理errors>Handle errors explicitly 显式处理errors</h3>
<p>Robust programs are composed from pieces that handle the failure cases before they pat themselves on the back.
The verbosity of <code>if err != nil { return err }</code> is outweighed by the value of deliberately handling each failure condition at the point at which they occur.
Panic and recover are not exceptions, they aren&rsquo;t intended to be used that way.</p>
<h3 id=return-early-rather-than-nesting-deeply--提前返回胜过深嵌套>Return early rather than nesting deeply 提前返回胜过深嵌套</h3>
<p>Every time you indent you add another precondition to the programmer&rsquo;s stack consuming one of the 7 ±2 slots in their short term memory.
Avoid control flow that requires deep indentation.
Rather than nesting deeply, keep the success path to the left using guard clauses.</p>
<h3 id=leave-concurrency-to-the-caller--把并发交给调用者>Leave concurrency to the caller 把并发交给调用者</h3>
<p>Let the caller choose if they want to run your library or function asynchronously, don&rsquo;t force it on them. If your library uses concurrency it should do so transparently.</p>
<h3 id=before-you-launch-a-goroutine-know-when-it-will-stop-使用goroutine之前想清楚它什么时候结束>Before you launch a goroutine, know when it will stop 使用goroutine之前想清楚它什么时候结束</h3>
<p>Goroutines own resources; locks, variables, memory, etc.
The sure fire way to free those resources is to stop the owning goroutine.</p>
<h3 id=avoid-package-level-state>Avoid package level state</h3>
<p>Seek to be explicit, reduce coupling, and spooky action at a distance by providing the dependencies a type needs as fields on that type rather than using package variables.</p>
<h3 id=simplicity-matters>Simplicity matters</h3>
<p>Simplicity is not a synonym for unsophisticated.
Simple doesn&rsquo;t mean crude, it means <em>readable</em> and <em>maintainable</em>.
When it is possible to choose, defer to the simpler solution.</p>
<h3 id=write-tests-to-lock-in-the-behaviour-of-your-packages-api--编写单元测试保证package-api行为>Write tests to lock in the behaviour of your package&rsquo;s API 编写单元测试，保证Package API行为</h3>
<p>Test first or test later, if you shoot for 100% test coverage or are happy with less, regardless your package&rsquo;s API is your contract with its users.
Tests are the guarantees that those contracts are written in.
Make sure you test for the behaviour that users can observe and rely on.</p>
<h3 id=if-you-think-its-slow-first-prove-it-with-a-benchmark>If you think it&rsquo;s slow, first prove it with a benchmark</h3>
<p>So many crimes against maintainability are committed in the name of performance.
Optimisation tears down abstractions, exposes internals, and couples tightly.
If you&rsquo;re choosing to shoulder that cost, ensure it is done for good reason.</p>
<h3 id=moderation-is-a-virtue>Moderation is a virtue</h3>
<p>Use goroutines, channels, locks, interfaces, embedding, in moderation.</p>
<h4 id=thress-attribute-of-channel>thress attribute of Channel</h4>
<ul>
<li>Gurarantee Of Delivery
<ul>
<li>Ticker的实现为什么使用Delayed Guarantee类型的Channel</li>
<li>Ticker为什么会丢失</li>
</ul>
</li>
<li>State</li>
<li>With or Without Data</li>
</ul>
<h3 id=maintainability-counts-可维护性>Maintainability counts 可维护性</h3>
<p>Clarity, readability, simplicity, are all aspects of maintainability.
Can the thing you worked hard to build be maintained after you’re gone?
What can you do today to make it easier for those that come after you?</p>
<p>翻译原文： <a href=https://github.com/davecheney/the-zen-of-go>https://github.com/davecheney/the-zen-of-go</a></p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>The Behavior Of Channels #TODO
<a href=https://www.ardanlabs.com/blog/2017/10/the-behavior-of-channels.html>https://www.ardanlabs.com/blog/2017/10/the-behavior-of-channels.html</a></p>
</li>
<li>
<p>Go proverbs
<a href=https://www.kancloud.cn/cserli/golang/524388>https://www.kancloud.cn/cserli/golang/524388</a></p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-7d846e61c330595767c77bde2caf83bc>3.6 - Code Review 开始</h1>
<h2 id=简介>简介</h2>
<p>整个golang团队20多人，没有code review ，对项目质量、对结果产出、对新人的成长，对团队交流的氛围影响大。 看过<a href=https://www.infoq.cn/article/QJi1Kqm4pH3UNAqNzl3l>Google 代码评审规范</a>，解决了我之前一些疑问和也让我坚定的去Code Review。<br>
当没有code review时候，要求重构，而重构价值是释放历史包袱，并没有产生任何其他价值</p>
<ul>
<li>我们的提交是这样的</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000>b8e45c</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>Slove</span> <span style=color:#000>Confilct</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
<span style=color:#0000cf;font-weight:700>0</span><span style=color:#000>a39ecd</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>FIXS</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>vendor</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
<span style=color:#0000cf;font-weight:700>7817</span><span style=color:#000>d14</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>debug</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
<span style=color:#0000cf;font-weight:700>67539e2</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>debug</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
<span style=color:#0000cf;font-weight:700>9044356</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>Slove</span> <span style=color:#000>Confilct</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
<span style=color:#000>d47db91</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>FIXS</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>ss</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
<span style=color:#0000cf;font-weight:700>8913</span><span style=color:#000>c30</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>Slove</span> <span style=color:#000>Confilct</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
<span style=color:#0000cf;font-weight:700>2</span><span style=color:#000>d407d2</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>FIXS</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>logger</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#000>b9af055</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>打印日志</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span> 
<span style=color:#0000cf;font-weight:700>1124e92</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>打印日志</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span> 
<span style=color:#0000cf;font-weight:700>88</span><span style=color:#000>d0eac</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>修改log</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span> 
<span style=color:#000>ad0b3dd</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>修改日志</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span> 
<span style=color:#0000cf;font-weight:700>4</span><span style=color:#000>aa0740</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>答应日志</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span> 
<span style=color:#0000cf;font-weight:700>824658</span><span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>修改日志</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span> 
<span style=color:#0000cf;font-weight:700>178</span><span style=color:#000>c30c</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#000>打印日志</span> <span style=color:#ce5c00;font-weight:700>-</span>  <span style=color:#0000cf;font-weight:700>7</span> <span style=color:#000>weeks</span> <span style=color:#000>ago</span> <span style=color:#ce5c00;font-weight:700>-</span> 
</code></pre></div><blockquote>
<p>在pull request的时候，认真review下所有的commit，该合并得合并，该修改得修改</p>
</blockquote>
<ul>
<li>
<p>我们的命名是这样的<br>
这里不截图纪念了.</p>
</li>
<li>
<p>我们的代码分支和发版是这样的<br>
本地打包,更恶心的是代码不提交本地打包的.</p>
</li>
<li>
<p>我们的单元测试是这样的<br>
几乎没有</p>
</li>
</ul>
<p>我们开始要做Code Review， 从哪里开始了？</p>
<h2 id=方式>方式</h2>
<p>谁对谁在什么时候用什么方式去做什么？</p>
<h3 id=第一个谁>第一个“谁”</h3>
<h4 id=代码评审员>代码评审员</h4>
<p>如果项目存在两人或者两人以上开发</p>
<ul>
<li>如果开发提交代码，则应用项目负责人</li>
<li>如果应用负责人也参与开发，则由另外任一一位开发做一次review，然后上一级的负责人做第二次review。</li>
</ul>
<p>如果应用负责人和开发是同一个人，这时候为“小组Leader”</p>
<h4 id=自动lint工具>自动Lint工具</h4>
<p>借助自动化完成代码最基本的审核， 比如reviewdog & golangci-lint， 更多相关知识<a href=https://github.com/reviewdog/action-golangci-lint>Github Action-golangci-lint</a></p>
<h3 id=第二个谁>第二个“谁”</h3>
<p>业务开发人员对应用提交的pull request</p>
<h3 id=什么时候>什么时候</h3>
<p>提交Review时的当天或者第二天须完成</p>
<h3 id=什么方式>什么方式</h3>
<p>依照代码审核规范， 目前缺少自己的审核规范，
类似规范参考</p>
<ul>
<li>代码审查规范
<ul>
<li><a href=https://www.infoq.cn/article/QJi1Kqm4pH3UNAqNzl3l>Google 代码评审规范</a></li>
<li><a href=https://jimmysong.io/eng-practices/>谷歌工程实践 by jimmysong</a></li>
</ul>
</li>
<li>代码规范[golang]
<ul>
<li><a href=https://www.bwplotka.dev/2020/how-thanos-would-program-in-go/>How Thanos Would Program in Go</a>
<ul>
<li>参考runutil包解决defer中error的检查问题, 相比写匿名函数更加的优雅</li>
<li>包 <code>pkg/errors</code> 比标准的<code>fmt.Errorf</code> + <code>%w</code>更可读</li>
<li>待补充</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id=做什么>做什么</h3>
<p>阅读提交的代码并给出建议完成审核</p>
<h2 id=落地>落地</h2>
<h3 id=reviewdog--golangci-lint在gitlab上配置实践>reviewdog & golangci-lint在gitlab上配置实践</h3>
<p>熟悉github action方式， 借鉴其优点； 在一个项目中实践，然后推广到其他项目中。</p>
<ul>
<li>如何做到所有项目不需要自行配置或者简单的配置（比如增加一个配置现成的文件），并且使用同一个套代码检查标准？
<ul>
<li><del>制作包含reviewdog.yml的配置文件，如果做linter升级的话，更新tag为latest最新的镜像即可.</del>, 已经完成了</li>
<li><del>在一半的项目上增加reviewdog</del></li>
<li>目前linter设置为golint和errcheck方式, 下一步增加golangci-lint检查代码</li>
</ul>
</li>
<li>目前没有非常成熟的方案，需要花费一些时间去解决现有开源方案中的问题。
<ul>
<li><em>reviewdog 结合 golangci-lint 使用，修改其输出格式, <a href=https://gitlab.com/Hyvi/reviewdog-test/-/blob/gitlab-ci-test2/.gitlab-ci.yml>more link</a></em>
在<a href=https://github.com/calmato/presto-pay/blob/master/api/user/Makefile>presto-pay</a>是使用golangci-lint,但是reviewdog在官网上没有golangci-lint的案例</li>
</ul>
</li>
</ul>
<p><strong>失败</strong></p>
<ul>
<li>golangci-lint自身大而全的能力，导致其功能本身不稳定，不如golint或errcheck那么纯粹</li>
</ul>
<h3 id=reviewdog--golinterrcheckgovet-在-gitlab-上配置实践>reviewdog & golint/errcheck/govet/&mldr; 在 gitlab 上配置实践</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>reviewdog</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>stage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>review</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># 自定义镜像, 包含统一的reviewdog配置文件和需要安装的reviewdog/golangci-lint版本</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>golang:custom-latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>before_script</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>curl -sfL https://raw.githubusercontent.com/reviewdog/reviewdog/master/install.sh| sh -s -- -b $(go env GOPATH)/bin v0.10.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.27.0</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>export GITLAB_API=&#34;https://examplegitlab.com/api/v4&#34;  </span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>reviewdog -conf=/etc/reviewdog/reviewdog.yml  -reporter=gitlab-mr-discussion  -guess -fail-on-error=true</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>only</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>merge_requests</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p>reviewdog.yml 配置如下</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#204a87;font-weight:700>runner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>golangci</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>cmd</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>golangci-lint run --config=/etc/reviewdog/golangci/golangci.yml ./...</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>errorformat</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>&#39;%E%f:%l:%c</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>%m&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>&#39;%E%f:%l</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>%m&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#39;%C%.%#&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>level</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>warning</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><p>更多：</p>
<ul>
<li>reviewdog 结合各种错误检查，详细见: <a href=https://gitlab.com/reviewdog/reviewdog/-/blob/master/.reviewdog.yml>reviewdog.yml</a></li>
<li>使用预设的errformat, 例如通过参数<code>-f=golangci-lint</code>，更多的预设errformat使用 <code>reviewdog -list</code> 查看， 点击链接<a href=https://github.com/reviewdog/errorformat/blob/master/fmts/go.go> go.go </a></li>
<li>在gitlab里配置参考gitlab上的工程：<a href=https://gitlab.com/Hyvi/reviewdog-test/-/blob/gitlab-ci-test2/.gitlab-ci.yml>reviewdog test</a></li>
<li>exit code的处理
<ul>
<li>errcheck 命令在检查到 err 时，exit code为0 （通过echo $?查看, 更多查看<a href=https://www.tldp.org/LDP/abs/html/exit-status.html#EXITSTATUSREF>Chapter 6. Exit and Exit Status</a>）</li>
<li>reviewdog默认的 exit code 为0， 当加上 -fail-on-error=true时候则会返回1（当检查到不规范的时候）</li>
<li>errcheck | reviewdog 根据现象是当errcheck 的 exit code 为1时，job会失败。 解决办法是 ( errcheck 2>&1 || true ) | reviewdog</li>
</ul>
</li>
</ul>
<p>在这个过程中，不断增加的检查机制, 并说明理由\目的</p>
<p><a href=https://github.com/thanos-io/thanos>thanos</a> 代码规范推荐的代码 linter 工具 <code>go vet</code>, 同时也推荐 golangci-lint,
但 golangci-lint 无法配置的原因, 将考虑一个个配置其默认的 <a href=https://golangci-lint.run/usage/linters/>linter</a> , 建议参考Thanos 里配置的 <a href=https://www.bwplotka.dev/2020/how-thanos-would-program-in-go/#golangci-lint>linters</a></p>
<ul>
<li>govet</li>
<li>errcheck</li>
<li>staticcheck</li>
<li>unused</li>
<li>gosimple</li>
<li>structcheck</li>
<li>varcheck</li>
<li>ineffassign</li>
<li>deadcode</li>
<li>typecheck</li>
</ul>
<h4 id=golint>golint</h4>
<h4 id=errcheck>errcheck</h4>
<h4 id=go-vet>go vet</h4>
<h2 id=todo>TODO</h2>
<p>反复阅读代码评审规范.
不断增加或修正 linter</p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>reviewdog
<a href=https://github.com/reviewdog/reviewdog#reporter-github-pullrequest-review-comment--reportergithub-pr-review>https://github.com/reviewdog/reviewdog#reporter-github-pullrequest-review-comment--reportergithub-pr-review</a></p>
</li>
<li>
<p>golangci-lint
<a href=https://github.com/golangci/golangci-lint>https://github.com/golangci/golangci-lint</a></p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-2ba8936b35c18b67399290e83295cff1>3.7 - Gomonkey Test</h1>
<h2 id=简述>简述</h2>
<p>项目中重视单元测试，选择使用简单的第三库来实现 mock，是至关重要的，有太多的方法、依赖、全局变量需要 Mock。</p>
<h2 id=各领风骚>各领风骚</h2>
<h3 id=gomonkey>gomonkey</h3>
<p><a href=https://github.com/agiledragon/gomonkey>gomonkey is a library to make monkey patching in unit tests easy </a></p>
<blockquote>
<p>gomonkey should work on any amd64 system</p>
</blockquote>
<h3 id=heading>&mldr;</h3>
<h2 id=只取一瓢>只取一瓢</h2>
<ul>
<li>Tsung is an open-source distributed load testing tool that makes it easy to stress test websockets (as well as many other protocols.)， 比如对 Websocket 长连接的压测<sup>[3]</sup></li>
</ul>
<h2 id=参考>参考</h2>
<p>[1] <a href=https://blog.csdn.net/wf19930209/article/details/79536506>X86、X86_64 和 AMD64 的由来</a></p>
<blockquote>
<p>时机落后的 Intel 开始支持 AMD64 的指令集， 但是换了名字，叫x84_64， 表示x86指令集的64扩展<br>
<strong>x86_64, x64, AMD64</strong> 基本上是同一个东西</p>
</blockquote>
<p>[2] [gomonkey 博主简书] (<a href=https://www.jianshu.com/u/1381dc29fed9>https://www.jianshu.com/u/1381dc29fed9</a>) golang开发</p>
<p>[3] Gary Rennie: The Road to 2 Million Websocket Connections in Phoenix.</p>
<p>[4] eranyanay: Going Infinite, handling 1M websockets connections in Go
<br></p>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-90baeac0d8907b563e8b6e698754f11a>3.8 - Daily 0131 Golang 杂乱</h1>
<h2 id=golang-还是学习吧>golang, 还是学习吧</h2>
<p><strong>已经两个月没有更新了</strong></p>
<h3 id=guru-for-vim-go-todo>guru for vim-go #TODO</h3>
<p><a href=https://docs.google.com/document/d/1_Y9xCEMj5S-7rv2ooHpZNH15JgRT5iM742gJkw5LtmQ/edit#>Using Go Guru</a> 详细介绍了 guru 功能点</p>
<p><a href=https://github.com/fatih/vim-go/wiki/Tutorial#guru>vim go tutorial#guru</a> 看到对 scope 的介绍，简单易懂的教程。</p>
<blockquote>
<p>Pointer analysis scope: some queries involve pointer analysis, a technique for answering questions of the form &ldquo;what might this pointer point to?&rdquo;.</p>
</blockquote>
<blockquote>
<p>vim-go automatically tries to be smaart and sets the current packages import path as the scope for you.</p>
</blockquote>
<h3 id=go-stack>go stack</h3>
<p>了解 golang runtime 的堆栈信息，学习如何查看 golang stack trace</p>
<p><a href=https://segmentfault.com/a/1190000017498101>Go 堆栈的理解</a></p>
<ul>
<li>堆栈跟踪，堆栈的参数</li>
<li>变量是在堆 ( heap ) 还是堆栈 ( stack ) 上</li>
</ul>
<h3 id=go-list>go list</h3>
<p>如何列出依赖的外部 package <a href=https://groups.google.com/forum/#!topic/golang-nuts/611QEJqkDKw>List external dependencies of package</a></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>list</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>f</span> <span style=color:#a40000>&#39;</span><span style=color:#000;font-weight:700>{{</span><span style=color:#000>join</span> <span style=color:#000;font-weight:700>.</span><span style=color:#000>Deps</span> <span style=color:#4e9a06>&#34;\n&#34;</span><span style=color:#000;font-weight:700>}}</span><span style=color:#a40000>&#39;</span> <span style=color:#000;font-weight:700>|</span>  <span style=color:#000>xargs</span> <span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>list</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>f</span> <span style=color:#a40000>&#39;</span><span style=color:#000;font-weight:700>{{</span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>not</span> <span style=color:#000;font-weight:700>.</span><span style=color:#000>Standard</span><span style=color:#000;font-weight:700>}}{{.</span><span style=color:#000>ImportPath</span><span style=color:#000;font-weight:700>}}{{</span><span style=color:#000>end</span><span style=color:#000;font-weight:700>}}</span><span style=color:#a40000>&#39;</span>
</code></pre></div><p>或者使用 <a href=https://github.com/cespare/deplist>deplist</a></p>
<h4 id=go-modules-410-gone>go modules 410 Gone</h4>
<p>原因： 由于你的 go 库声明为 go1.12 格式，此时将没有 SUMDB 校验信息，因而在一个 go1.13 项目中引用这样的旧的库格式会产生校验错误，进而报错为 410 Gone。</p>
<p>解决办法：</p>
<ul>
<li>对于使旧格式库的人来说， 以下方式帮你顺利下载库和完成引用。</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#204a87>export</span> <span style=color:#000>GONOSUMDB</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;github.com/hedzr/errors,</span><span style=color:#000>$GONOSUMDB</span><span style=color:#4e9a06>&#34;</span>
<span style=color:#8f5902;font-style:italic>## OR</span>

<span style=color:#204a87>export</span> <span style=color:#000>GOSUMDB</span><span style=color:#ce5c00;font-weight:700>=</span>off
</code></pre></div><ul>
<li>对于该库的拥有者而言，下面的办法是正确的处理方案，在 go.mod 中修改库宣告的版本格式为 1.13. 例如：</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#000>module</span> <span style=color:#000>github</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>com</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>hedzr</span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#000>errors</span>

<span style=color:#204a87;font-weight:700>go</span> <span style=color:#0000cf;font-weight:700>1.13</span>  <span style=color:#8f5902;font-style:italic>// go 1.12
</span><span style=color:#8f5902;font-style:italic></span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
  <span style=color:#4e9a06>&#34;encoding/json&#34;</span>
  <span style=color:#4e9a06>&#34;net/http&#34;</span>
<span style=color:#000;font-weight:700>)</span>
<span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>Profile</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>Name</span>    <span style=color:#204a87;font-weight:700>string</span>
  <span style=color:#000>Hobbies</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>string</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandleFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>foo</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ListenAndServe</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;:3000&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>
<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>foo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>w</span> <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ResponseWriter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>r</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>profile</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>Profile</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;Alex&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;snowboarding&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;programming&#34;</span><span style=color:#000;font-weight:700>}}</span>
  <span style=color:#000>js</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>json</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Marshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>profile</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>w</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>StatusInternalServerError</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span>
  <span style=color:#000;font-weight:700>}</span>
  <span style=color:#000>w</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Header</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>Set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Content-Type&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;application/json&#34;</span><span style=color:#000;font-weight:700>)</span>
  <span style=color:#000>w</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>js</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>

</code></pre></div><p>先来段 go 代码，上面代码是返回 JSON 数据，是不是郁闷，为什么还要定义 struct Profile，没有 python/js/ 等等灵活呀</p>
<p>再看下 GO 怎么读 JSON 数据的</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-GOlang data-lang=GOlang><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
	<span style=color:#4e9a06>&#34;encoding/json&#34;</span>
	<span style=color:#4e9a06>&#34;fmt&#34;</span>
	<span style=color:#4e9a06>&#34;net/http&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>test_struct</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>Test</span> <span style=color:#204a87;font-weight:700>string</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>parseGhPost</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>rw</span> <span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ResponseWriter</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>request</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>decoder</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>json</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewDecoder</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>request</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Body</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>t</span> <span style=color:#000>test_struct</span>
	<span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>decoder</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Decode</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>t</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#204a87>panic</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>t</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Test</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HandleFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>parseGhPost</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ListenAndServe</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;:8080&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>}</span>

</code></pre></div><p>*** curl -X POST -d &ldquo;{"test": "that"}&rdquo; http://localhost:8080 *** 测试</p>
<p><code>Bolt</code>是 GO 语言 key/value 存储数据库，</p>
<blockquote>
<p>The API will be small and only focus on getting values and setting values. That&rsquo;s it.</p>
</blockquote>
<blockquote>
<p>Bolt is currently used in high-load production environments serving databases as large as 1TB. Many companies such as Shopify and Heroku use Bolt-backed services every day.</p>
</blockquote>
<pre tabindex=0><code>db.Update(func(tx *bolt.Tx) error {
	b := tx.Bucket([]byte(&quot;MyBucket&quot;))
	err := b.Put([]byte(&quot;answer&quot;), []byte(&quot;42&quot;))
	return err
})
</code></pre><p>更新数据库 是不是写起来很费劲呀！</p>
<pre tabindex=0><code>db.View(func(tx *bolt.Tx) error {
	b := tx.Bucket([]byte(&quot;MyBucket&quot;))
	v := b.Get([]byte(&quot;answer&quot;))
	fmt.Printf(&quot;The answer is: %s\n&quot;, v)
	return nil
})
</code></pre><p>读数据一样，就不能直接 SET／GET 吗？</p>
<p>用 Go 自带的 http 参考这个文章 <a href=https://astaxie.gitbooks.io/build-web-application-with-golang/en/06.2.html>How to use sessions in Go</a> 写了 session 机制</p>
<p>技术选型：如何选择一个合适的 Go http routing 呢？ 那这篇文章告诉你答案：<a href=https://github.com/julienschmidt/go-http-routing-benchmark>go http routing benchmark</a></p>
<blockquote>
<p>This benchmark suite aims to compare the performance of HTTP request routers for Go by implementing the routing structure of some real world APIs. Some of the APIs are slightly adapted, since they can not be implemented 1:1 in some of the routers.</p>
</blockquote>
<p><a href=http://www.cnblogs.com/DjangoBlog/p/5267006.html>再 tornado 中异步无阻塞的执行耗时任务</a> 原理得看，run_on_executor 装饰器对传递进来的函数封装，用 io_loop. TODO</p>
<h4 id=罗列-go-资源>罗列 GO 资源：</h4>
<p><a href=https://github.com/dgryski/go-perfbook/blob/master/performance.md>Go perfbook</a> Writing and Optimizing Go code</p>
<p><a href=http://colobu.com/categories/Go/>Go 中文资料</a> 杂乱，须整理成自己的知识网</p>
<p><a href=https://github.com/valyala/fasthttp>fasthttp </a> 这个性能，相比 GO 自带的 http，相差很远</p>
<h4 id=ruby-点点滴滴奇奇怪怪>ruby 点点滴滴，奇奇怪怪</h4>
<p>[Ruby 中的 @ % # $ 等各种千奇百怪的符号的含义等』 (http://www.cnblogs.com/likeyu/archive/2012/02/22/2363912.html)
@开始是实例变量、@@开始的变量是类变量
$ 开始的变量是全局变量，在程序的任何地方都可以引用。</p>
<ul>
<li>若左边最后一个表达式前带<em>号的话，将右边多余的元素以数组的形式代入这个带</em>的表达式中。若右边没有多余元素的话，就把空数组代入其中</li>
</ul>
<p>?! 两个符号，一个表示布尔值，另外一个表示需要注意的</p>
<h3 id=参考>参考</h3>
<ol>
<li>
<p>go modules 410 Gone
<a href=https://juejin.im/post/5e0ec5d75188253aa20e858e>https://juejin.im/post/5e0ec5d75188253aa20e858e</a></p>
</li>
<li>
<p>Go Modules with Private Git Repositories
<a href=https://medium.com/cloud-native-the-gathering/go-modules-with-private-git-repositories-dfe795068db4>https://medium.com/cloud-native-the-gathering/go-modules-with-private-git-repositories-dfe795068db4</a></p>
</li>
</ol>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-667335ee14d6b9d70f64cb1d9e53c655>4 - Python</h1>
<div class=lead>用于梳理 Python 相关的笔记</div>
</div>
<div class=td-content>
<h1 id=pg-08974e0fd7594d052e2b07846289496e>4.1 - Python 面试Problems</h1>
<p><a href=http://codingpy.com/article/essential-python-interview-questions/>Python面试必须要看的15个问题</a></p>
<ul>
<li>到底什么是Python? //考察语言特性</li>
<li>补充缺失的代码</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>print_directory_contents</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sPath</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#4e9a06>&#34;&#34;&#34;
</span><span style=color:#4e9a06>    这个函数接受文件夹的名称作为输入参数，
</span><span style=color:#4e9a06>    返回该文件夹中文件的路径，
</span><span style=color:#4e9a06>    以及其包含文件夹中文件的路径。
</span><span style=color:#4e9a06>
</span><span style=color:#4e9a06>    &#34;&#34;&#34;</span>
    <span style=color:#8f5902;font-style:italic># 补充代码</span>
</code></pre></div><ul>
<li>你如何管理不同版本的代码？</li>
<li>下面代码会输出什么：</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>f</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>l</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>[]):</span>
    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#204a87>range</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>x</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>l</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87>print</span> <span style=color:#000>l</span>

<span style=color:#000>f</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>f</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,[</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>])</span>
<span style=color:#000>f</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><ul>
<li>这两个参数是什么意思：*args，**kwargs？我们为什么要使用它们？</li>
<li>下面这些是什么意思：@classmethod, @staticmethod, @property？</li>
<li>递归和生成器（generator）的使用</li>
<li>简要描述Python的垃圾回收机制（garbage collection）。</li>
<li>将下面的函数按照执行效率高低排序。它们都接受由0至1之间的数字构成的列表作为输入。这个列表可以很长。一个输入列表的示例如下：[random.random() for i in range(100000)]。你如何证明自己的答案是正确的。</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>
<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>f1</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>lIn</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>l1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>sorted</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>lIn</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>l2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>l1</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>l2</span><span style=color:#000;font-weight:700>]</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>f2</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>lIn</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>l1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>lIn</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>l2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>sorted</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l1</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>l2</span><span style=color:#000;font-weight:700>]</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>f3</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>lIn</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>l1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>lIn</span><span style=color:#000;font-weight:700>]</span>
    <span style=color:#000>l2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>sorted</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>l1</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>[</span><span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>l1</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#0000cf;font-weight:700>0.5</span><span style=color:#000;font-weight:700>)]</span>
		
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d7eeb6b04c8fab1ac4227a60a3668820>5 - Javascript</h1>
<div class=lead>用于梳理 Javascript 相关的笔记</div>
</div>
<div class=td-content>
<h1 id=pg-5460196736761598f7a1f93a910aa267>5.1 - javascript Number --- 再次结识</h1>
<div class=lead>2013-01-27 javascript基本功</div>
<p>javascript类型划为两大类：原始类型（甭管这样的翻译是否规范，英文为primitive type) 和 对象类型。原始类型又划为四大类：数值、字符串、布尔值，还有两个特殊的类型：null 和 undefined 。
废话少说，直接进入主题：<em>javascript number的几点</em></p>
<ol>
<li>与其他语言相比，javascript number不同点</li>
</ol>
<blockquote>
<p>JavaScript does not make a distinction between integer values
and floating-point values. All numbers in JavaScript are represented as floating->point values.</p>
</blockquote>
<ol start=2>
<li>javascript number表达的数值是有限的，于是就有overflow, underflow。</li>
</ol>
<blockquote>
<p>Arithmetic in JavaScript does not raise errors in cases of overflow, underflow, or division by zero.
(-)Infinity when overflow, (-)0 when underflow
Division by zero is not an error in JavaScript: it simply returns infinity or negative
infinity.</p>
</blockquote>
<ol start=3>
<li>javascript number 中特殊的NaN</li>
</ol>
<blockquote>
<p>There is one exception, however: zero divided by zero does not have a well-defined value, and the result of this operation is the special not-a-number value, printed as NaN. NaN also arises if you attempt to</p>
<ul>
<li>divide infinity by infinity</li>
<li>take the square root of a negative number</li>
<li>use arithmetic operators with non-numeric operands that
cannot be converted to numbers</li>
</ul>
</blockquote>
<pre><code>
	Infinity // A read/write variable initialized to Infinity.
	Number.POSITIVE_INFINITY // Same value, read-only.
	1/0 // This is also the same value.
	Number.MAX_VALUE + 1 // This also evaluates to Infinity.
	Number.NEGATIVE_INFINITY // These expressions are negative infinity.
	-Infinity
	-1/0 
	-Number.MAX_VALUE - 1
	NaN // A read/write variable initialized to NaN.
	Number.NaN // A read-only property holding the same value.
	0/0 // Evaluates to NaN.
	Number.MIN_VALUE/2 // Underflow: evaluates to 0
	-Number.MIN_VALUE/2 // Negative zero
	-1/Infinity // Also negative 0
	-0
</code></pre>
<ol start=4>
<li>javascript NaN != NaN</li>
</ol>
<blockquote>
<p>The not-a-number value has one unusual feature in JavaScript: it does not compare equal to any other value, including itself. This means that you can’t write x == NaN to determine whether the value of a variable xis NaN. Instead, you should write x != x. That expression will be true if, and only if, x is NaN. The function isNaN()is similar. It returns trueif its argument is NaN, or if that argument is a non-numeric value such as a string or an object. The related function isFinite()returns trueif its argument is a number other than NaN, Infinity, or -Infinity.</p>
</blockquote>
<ol start=5>
<li>
<p>.3-.2 == .1 & .2-.1 == .1</p>
</li>
<li>
<p>-0 === 0</p>
</li>
</ol>
<pre><code>
    var zero = 0; // Regular zero
    var negz = -0; // Negative zero
    zero === negz // => true: zero and negative zero are equal 
    1/zero === 1/negz // => false: infinity and -infinity are not equal
</code></pre>
<p>这算是对之前文章http://hyvi.sinaapp.com/2012/10/09/javascript-nan/ 做了个补充。
twitter上的代码：</p>
<pre><code>  
    [0,7,5,10,4,15,2,13,4,16,4,10,1].map(function(a){return this[a];},typeof("")+typeof(0)+NaN+"d.").join("") 
</code></pre>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-2d744b2632f4d6b3ed284172e74157c5>5.2 - nodejs</h1>
<div class=lead>nodejs 资料收集</div>
<h2 id=done>DONE</h2>
<ol>
<li>用c++写node本地插件，<a href=https://github.com/joyent/node/tree/master/test/addons/hello-world>hello-world</a>. 编译构建使用<a href=https://github.com/TooTallNate/node-gyp>node-gyp</a>
其中对c++代码不太熟悉，好难懂的样子，回头学习下<em>TODO</em></li>
<li>性能测试，群里聊到Siege， brenchmark.js， ab(apache benchmark)</li>
<li><a href=https://speakerdeck.com/hunvreus/api-plus-static-clients>API + Static Clients</a></li>
</ol>
<ul>
<li>对cors技术解决方案</li>
<li>对session实现的技术方案</li>
</ul>
<h2 id=todo>TODO</h2>
<p><a href="http://weibo.com/1880082254/z5KR7zF4t?type=repost">CMD vs AMD</a> 理解CommonJS与RequireJS</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-82cd4c4f3e81bf76ca5312564c105113>6 - Team</h1>
<div class=lead>关于团队、打(ZHI)工(YE)人(REN)</div>
</div>
<div class=td-content>
<h1 id=pg-d2ec6795a40afc18457d5151e868e278>6.1 - 如何构建基础库</h1>
<h2 id=简介>简介</h2>
<p>提供一个库，沉淀共性的功能点。</p>
<p>是Library，而不是 Framework。</p>
<p>有哪些内容呢？</p>
<h2 id=参考1-gitlab-labkit>参考1 Gitlab Labkit</h2>
<p>LabKit is minimalist library to provide functionality for Go services at GitLab.</p>
<ul>
<li>Correlation</li>
<li><strong>Loggging</strong></li>
<li>Masking</li>
<li><strong>Metrics</strong></li>
<li><strong>Monitoring</strong></li>
<li>FIPS</li>
<li><strong>Tracing</strong></li>
<li><strong>ErrorTracking</strong></li>
</ul>
<h2 id=参考2-go-zero>参考2 go-zero</h2>
<ul>
<li>鉴权</li>
<li>加解密</li>
<li>日志记录</li>
<li>异常捕获</li>
<li>监控报警</li>
<li>数据统计</li>
<li>并发控制</li>
<li>链路追踪</li>
<li>超时控制</li>
<li>自动熔断</li>
<li>自动降载</li>
<li>缓存控制</li>
</ul>
<p><img src=https://raw.githubusercontent.com/zeromicro/zero-doc/main/doc/images/architecture.png alt></p>
<h2 id=参考3-micro>参考3 Micro</h2>
<p><a href=https://micro.dev/architecture>Micro Architecture</a></p>
<p><img src=https://micro.dev/images/micro-3.0.png alt></p>
<p>Wrapppers are a form of middleware that can be used with go-micro services, They can Wrap both the Client and Server handlers</p>
<ul>
<li>Breaker</li>
<li>endpoint</li>
<li>Monitoring</li>
<li>ratelimiter</li>
<li>service</li>
<li>trace</li>
<li>validator</li>
</ul>
<h2 id=参考4-dapr>参考4 Dapr</h2>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-5a7d3543e628a73342f5fc1697c86f97>6.2 - 团队建设</h1>
<h2 id=贝尔宾的团队的九种角色>贝尔宾的团队的九种角色</h2>
<p><img src=https://hyvi.github.io/blog-images/20211013/roles-of-team.jpeg alt="roles in team"></p>
<table>
<thead>
<tr>
<th>类型</th>
<th>特征</th>
<th>团队贡献</th>
<th>不足</th>
</tr>
</thead>
<tbody>
<tr>
<td>执行者<br>实干家</td>
<td>保守、尽职、中规中矩、通达常理</td>
<td></td>
<td>灵活性一般，对新想法不敏感</td>
</tr>
<tr>
<td>ME, Monitor Evaluator</td>
<td>个性小心谨慎、聪明、拥有广阔视野，能顾全大局并作出最有利的判断</td>
<td></td>
<td>有时过于吹毛求疵或按规矩办事</td>
</tr>
</tbody>
</table>
<blockquote>
<p>对于团队成员而言，一个人可以同时具备多种角色，而且一个团队随着工作项目发展阶段的推进，某些角色的优先度也会发生变化</p>
</blockquote>
<p>对以上角色进行归类，分别为执行团队任务活动的「行动导向型」、协调团队内外部人际关系的「人际导向型」、以及负责想法创意与提供专家智慧的「谋略导向型」角色。</p>
<p><img src=https://hyvi.github.io/blog-images/20211013/role-category.jpeg alt="roles cat"></p>
<h2 id=理解和驾驭团队发展的五个阶段>理解和驾驭团队发展的五个阶段</h2>
<h3 id=纵向团队和横向团队>纵向团队和横向团队</h3>
<h3 id=高效团队的特点>高效团队的特点</h3>
<ol>
<li>共同目标</li>
<li>职责分明</li>
<li>共同的价值观</li>
<li>成员个人能力强</li>
<li>集体能力高</li>
<li>自我管理和自我激励</li>
<li>个性互补</li>
<li>能力互补</li>
<li>有效决策</li>
<li>相互支持</li>
<li>灵活性</li>
<li>系统思维，了解十加一的危与机</li>
<li>不断学习</li>
<li>不责备他人</li>
</ol>
<p>未完待续&mldr;</p>
<h2 id=组织能力的杨三角>组织能力的杨三角</h2>
<p><img src=https://wiki.mbalib.com/w/images/a/ab/%E6%9D%A8%E4%B8%89%E8%A7%92%E7%90%86%E8%AE%BA.png alt=“杨三角”理论框架图></p>
<p>“杨三角”由员工能力、员工思维模式和员工治理方式三个方面组成</p>
<h2 id=参考>参考</h2>
<p>[1] R.梅雷迪思•贝尔宾（R. Meredith Belbin）: 团队角色</p>
<p>[2] 莱恩：【團隊管理】管理者想建立高績效團隊，先找到這9種成員－貝爾賓團隊角色理論(Belbin Team Roles)，你的團隊需要那些角色？</p>
<p>[3] MBA 智库百科：杨三角理论</p>
<p>[4] 杨国安： 《组织能力的杨三角 - 企业持续成功的秘诀》</p>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ed50a7db14ee0960b42cb1b86c185a92>6.3 - 基于Git Flow规范分支和发版问题</h1>
<h2 id=背景>背景</h2>
<p>一个人一个小的微服务, 多个人一个微服务开发的时候，流程还是很要必要的</p>
<h2 id=方式>方式</h2>
<p>Git Flow 和 pull request 结合</p>
<p>Standard-Version</p>
<h2 id=参考>参考</h2>
<p><a href=https://danielkummer.github.io/git-flow-cheatsheet/index.zh_CN.html>git-flow 备忘清单, 这大概是了解到清晰的flow了</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-6080c83f2421c88b230943540db68583>6.4 - Scrum & Jira 使用问题记录</h1>
<h2 id=scrum-结合-jira>Scrum 结合 Jira</h2>
<h3 id=story>Story</h3>
<ul>
<li>Story的时间不能超过3天的时间。如果超过了三天，先拆解。</li>
<li>技术Story和Story必须拆分subtask，估时和工时在subtask上填写</li>
<li>所有的Story需要关联需求。</li>
<li>处于”测试中“单： 根据测试种类处理
<ul>
<li>”开发人员测试“ ， 创建测试subtask， 开发人员部署测试环境，开发自测接口， 测试完成后”点击测试通过“</li>
<li>”无需测试“， 开发人员直接点击”测试通过“</li>
<li>”测试人员测试“， 开发人员跟测试人员沟通测试完成时间，并跟进，直到测试人员完成并点击”测试通过“ ； 当测试人员无时间测试时，开发人员改为修改subtask的assignee为自己，并自行测试。</li>
</ul>
</li>
<li>处于”验收中“， 可通过GT 找BA或者Leader进行验收。</li>
<li>当jira单处于”Done“完成状态时，可以不用做任何操作了，如果上线，联系leader创建运维单。</li>
<li>Story的时间超了，怎么处理？
<ul>
<li>在原来的Story的subtask上log上超出的时间。前提是这个subtask确实需要花这么时间。</li>
<li>新增subtask，在新的subtask上log上时间。 前提是这个Story里还包含了一开始并没有考虑到其他的子任务。</li>
<li>新增Story，前提是存在一种情况，时间评估差距很大，这个Story的完成需要依赖于其他的Story。</li>
</ul>
</li>
</ul>
<h3 id=subtask>Subtask</h3>
<ul>
<li>不创建无关的subtask</li>
<li>Story状态是否需要更改 是根据subtask完成情况来定
<ul>
<li>BA或者Leader对Story宣讲完成后， Story状态更改为 ”待开发“</li>
<li>DEV对Story以及subtask有了解清楚并没有疑问后，Story状态更改为“待开发”</li>
<li>subtask已经开始开发了，Story状态更改为“开发中”</li>
<li>subtask里开发工作已经完成，Story状态更改为”待测试“</li>
<li>subtask都完成后，Story状态更改为”待验收“</li>
</ul>
</li>
</ul>
<h3 id=通用>通用</h3>
<ul>
<li>使用明确的形容词， 避免使用类似如下形容词 ：
<ul>
<li>“相关的”</li>
<li>“ 部分</li>
<li>“</li>
</ul>
</li>
<li>每日 log work。（如果你做不到每日更新，可以至少两天做一次更新）</li>
<li>Sprint 启动后 jira 单（技术 Story+Story）的增加修改删除由 scrum master 来操作， 勿擅自操作。</li>
<li>周中会议前更新会议内容</li>
<li>不管是 Story、技术 Story、运维单还是 BUG 单，找 reporter 验收。
<ul>
<li>为什么 Story Owner 找 reporter 验收？ 正常逻辑是我做完了改状态就 OK 了，才符合流水化作业。</li>
</ul>
</li>
<li>不做的单 拒绝</li>
<li>Jira 单拆分时并不了解需求。</li>
</ul>
<h3 id=sprint指标>Sprint指标</h3>
<p>Sprint不仅仅有完成率的指标，另外还有更多的指标可以了解Sprint的状态</p>
<ul>
<li>迭代变更率： = 插入和移出任务数、计划任务数 * 100% （任务数仅限：story + Tech Story）</li>
<li>迭代投入比： 迭代工作投入比 + 运维投入比（Jira 总投入时间 / 团队总数<em>10</em>8）</li>
<li>需求积压：</li>
<li>平均开发周期：Story、Tech Story 在看板中启动开发到完成所耗的平均天数</li>
<li>迭代逾期关闭</li>
</ul>
<h2 id=运维>运维</h2>
<p>类似“线上问题和故障”</p>
<blockquote>
<p>每天都会在产品和研发群发布”线上问题日报“， 以报表形式展示每个业务团队的问题存量，以及这些问题的持续时长 &mdash; 来自有赞</p>
</blockquote>
<p>针对运维单的问题，可以同样的思路来处理。运维单不处理最终积压的问题会在某个时刻点爆发。</p>
<p>TODO: <strong>如何整理出这样的报告？</strong></p>
<h2 id=bug-管理>Bug 管理</h2>
<p>&ldquo;Bug 看板”中统一管理</p>
<h3 id=bug-流程>Bug 流程</h3>
<p>测试 Bug 必须关联到 Jira 模块、影响版本和解决版本， 我们可以根据“模块”和“经办人”来统计某个版本中遗留的测试 Bug 存量分布。</p>
<h3 id=bug-描述标准模板>Bug 描述标准模板</h3>
<p>重现步骤、实际结果、期待结果、抓包数据</p>
<h2 id=复盘>复盘</h2>
<p>使用“海星图”， “KISS”或“做的不错的 / 应该做的更好的”方法进行复盘 ，复盘的改进措施会被录入到“复盘 Action 跟进看板”， 每个 Action 必须是可执行的具体措施，且有一个主要负责人（JIRA 经办人）和完成日期（JIRA 到期时期）。</p>
<h3 id=scrum-之星>Scrum 之星</h3>
<p>激励动机，利出一孔</p>
<ul>
<li>即时激励四个原则
<ul>
<li>提倡什么，反对什么</li>
<li>注重精神激励，同时兼顾物质激励，前者为主</li>
<li>及时给员工反馈</li>
<li>公开透明、有理有据、有事实</li>
</ul>
</li>
</ul>
<h2 id=定位>定位</h2>
<h3 id=pm-program-manager>PM (Program Manager)</h3>
<p>负责的事情有：</p>
<ul>
<li>和客户交谈，组织用户调查，发现用户需求</li>
<li>了解和比较竞争对手的产品</li>
<li>怎么让软件变得可用 (Usable)、有用（Useful）</li>
<li>怎么改进团队的流程</li>
</ul>
<p>更全面的任务有：</p>
<ul>
<li>带领团队形成团队的目标 / 远景，把抽象的目标转化为可执行的、具体的、优美的设计</li>
<li>管理软件的具体功能的生命周期（需求 / 设想 / 设计 / 实现 / 测试 / 修改 / 发布 / 升级 / 迁移 / 淘汰）</li>
<li>创建并维护软件的规格说明，让它成为开发 / 测试人员及时准确的指导，而不是障碍</li>
<li>代表客户和用户的利益，主动收集用户反馈，预期用户新的需求。协调并决定各种需求的优先级</li>
<li>分析并带领其他成员形成对缺陷 / 变更需求的一致意见，并确保实施。</li>
<li>带领其他成员确保项目保持功能 / 时间 / 资源的合理平衡，跟踪项目进展，确保团队发布让客户满意的软件。</li>
<li>收集团队项目管理和软件工程的各种数据，客观分析项目实施过程中优缺点，推动项目成员秩序改进，从而提升士气。</li>
</ul>
<h3 id=pm-做开发和测试之外的所有事情>PM 做开发和测试之外的所有事情</h3>
<p>Program Manager vs Project Manager</p>
<table>
<thead>
<tr>
<th>Project Manager</th>
<th>Program Manager</th>
</tr>
</thead>
<tbody>
<tr>
<td>是团队的行政领导者，带领大家在项目中工作</td>
<td>和大家平等工作，推动团队完成软件的功能</td>
</tr>
<tr>
<td>通常是团队外和外界打交道的唯一代表</td>
<td>一个团队可以有很多的 PM</td>
</tr>
<tr>
<td>对项目的功能有最后的决定权</td>
<td>和其他团队成员一起大形成决议</td>
</tr>
<tr>
<td>管事也管人</td>
<td>管事不管人</td>
</tr>
<tr>
<td>不一定做具体的工作</td>
<td>一定做具体的工作</td>
</tr>
</tbody>
</table>
<p>为什么不让 PM 领导开发和测试人员，这样 PM 工作起来不是更梳理“ ?</p>
<p><strong>如果 PM 得到团队成员的支持，会是怎样的呢？</strong></p>
<p>成为项目流程的主人 &mdash; 驱动流程，组织会议，实践 Scrum，保证进度；代表团队向上级 / 伙伴团队 / 客户 / 市场部门报告项目进度；团队成员都乐意和你交流，你赢得了大家的尊重；你不用自己写一行代码，也同样可以积极影响项目和产品。</p>
<p><strong>反之， 如果得不到团队成员的支持？</strong></p>
<p>你会在各种会议或流程中浪费大家的时间，发一些大家不读的 Status Mail， 不能凝聚团队，形不成共识；你对团队的状态不太了解。也不能有效和准确的像有关方报告团队的情况并获得支持；你对行业和产品的发展方向把握不准，对项目和产品造成负面的影响。</p>
<h2 id=软件设计和实现>软件设计和实现</h2>
<h3 id=从-spec-到实现>从 Spec 到实现</h3>
<p>一个开发人员拿到设计文档 (spec) 之后，他会做下面几个事情。</p>
<ol>
<li>估计开发任务所需的时间</li>
<li>会试着歇一写快速原型的代码，看看效果会怎样。期间发现了若干问题，与 PM 沟通后，最终达成了一致意见。</li>
<li>在看到初始效果和了解实现的细节后，开始写**设计文档（Technical Spec、Design Document），写好之后，可以请同事一起来复审设计文档（复审可选，因为一般情况下任务都不大）</li>
<li>设计文档写好之后，按照设计文档写代码。在实现过程中，他又发现一些意想不到的问题，与 PM 沟通后，找到了解决方案。</li>
<li>写好代码后，对照设计文档和代码指南进行自我复审，重构代码。</li>
<li>创建或者更新单元测试</li>
<li>进行单元测试（不仅要自己创建或更新单元测试，还要通过整个模块或者系统的单元的测试）</li>
<li>得到一个可以测试的版本，交给相关的测试人员测试，或者在网上进行公开测试，如 A/B 测试等。</li>
<li>修复测试人员或者用户发现的问题，等到问题都被解决得差不多了，在请同事进行代码复审。</li>
<li>根据代码复审的意见修改代码，完善单元测试和相关的文档，然后把代码签入到代码仓库中。</li>
</ol>
<h2 id=testing-process-in-scrum>Testing Process in Scrum</h2>
<p>敏捷测试在实践中出现两种声音：</p>
<ul>
<li>将测试与 Sprint 分离， 看做是与开发截然分开的“下一个阶段”</li>
<li>测试作为 Sprint 的一部分，当 Sprint 结束时所有的测试工作也结束</li>
</ul>
<p>前者带来的问题</p>
<ol>
<li>导致在实践敏捷开发过程中遇到种种问题： 要么是忽略了代码质量，导致在频繁的迭代过程中，每个迭代的问题层出不穷；</li>
<li>沿用原有的方法安排对系统的系统测试，导致测试团队疲于奔命，却总也赶不上开发所要求的的进度。</li>
</ol>
<p><a href=https://www.infoq.cn/article/2010/12/dn-agile-test-1>什么是敏捷软件测试</a> #TODO</p>
<blockquote>
<p>敏捷开发中不把测试单独拿出来描述的原因，恰恰是在敏捷开发中，测试不再是一个单独的，和开发独立的过程，而是变成了驱动开发、衡量产出的主要手段，成为敏捷开发中所有工程师在工作时必须时刻考虑和实践的一个部分。</p>
</blockquote>
<p><a href=https://www.infoq.cn/article/agile-test>究竟什么是敏捷测试</a></p>
<blockquote>
<p>敏捷测试是基于自动化测试的</p>
</blockquote>
<p>详细Scrum的敏捷测试。</p>
<ul>
<li>Product Backlog, 测试需要考虑客户的价值大小（优先级）\工作量基本估算外，需要认真研究与产品相关的用户行为模式，产品的质量需求，哪些质量特性时我们需要考虑的？</li>
<li>Sprint Backlog， 需要明确具体要实现的功能特性和任务，作为测试，这个时候后特别关注“Definnition of Done”， 任务完成的验收标准。</li>
<li>在每个Sprint实施阶段，主要完成完成Sprint backlog所定义的任务，这时出了TDD或单元测试之外，应该进行持续集成或者通常说的 BVT （build virification Test)。 如果有专职的测试人员角色，一方面可以完成测试用例、集成测试框架，协助开发人员进行单元测试；另一方面可以按照针对新视线的功能进行更多的探索式测试，同事开发验收测试的脚本。如果没有专职的测试热源角色，这些事情也是要完成的。只是由整个团队来完成。</li>
<li>验收测试可以自动化测试工具万恒，但一般情况，不可能做到100%的自动化测试。</li>
</ul>
<p>来自 <a href=https://www.scrum.org/forum/scrum-forum/16296/best-practices-testing-process-scrum>Best Practices for Testing Process in Scrum</a></p>
<p>In Scrum, a cross functional Development Team has all the resources needed to complete a &lsquo;Done&rsquo; Increment by the end of a Sprint.</p>
<h3 id=solution-one>Solution One</h3>
<p>Breaking each selected product backlog item into many small subtasks which can be devlivered and tested.</p>
<p>Taking the help of testing team during integreation testing itself</p>
<p>the testing team starts writing test cases based on each task.</p>
<p>testing team helps dev team during the integration testing and they test each sub-story deployed in test enviroments.</p>
<h3 id=solution-two>Solution Two</h3>
<p>Testing should be factored during sprint circle</p>
<p>As per definition Development Team are cross functional team and they should be able to test the solution, during the sprint cycle.</p>
<h3 id=solution-three>Solution Three</h3>
<p>QA Team write test cases accourding to Acceptance criteria DoD for each Story</p>
<p>so Dev Team will take the responsibility of the testing for each cases in the story.</p>
<p>Test Cases will be part of DoR for the story</p>
<p>来自 <a href=https://www.zhihu.com/question/20377132>知乎：敏捷流程中测试如何开展</a></p>
<p>来自 <a href=https://www.ituring.com.cn/article/details/1016>Kaverjody: 我的测试之旅</a></p>
<p>问题：</p>
<ul>
<li>每个迭代里， 开测试计划评审会议， 产生测试计划文档并得到批复的话，将会是一笔非常大的管理开销，而且每个测试计划的重复信息都很大。</li>
<li>缺陷追踪实践，记录版本的时间长，修改这个问题可能几分钟搞定了。</li>
<li>迭代开始时，测试人员却很空，空的无事可做，到了迭代结束的时候却是忙的不得了。</li>
</ul>
<p>解决：</p>
<ul>
<li>开发项是新提出的概念，将软件的规格说明书撰写、设计、实现和测试封装在一起，作为最小的原子化产品组件（Component）。原子化的意思是保持开发项之间的互相依赖在可以做到的最低水平；移除或重排任何开发项的时候，对其他开发项不产生（或产生最小的）影响。</li>
<li>在迭代开始前，先有技术报告或需求文档，由此而产生出开发项；然后是和以往的项目一样的入口阶段，确实项目日程并且生成相关的高阶文档，包括集成计划文档，项目计划文档，模块测试策略以及开发测试计划文档都在此时创建。</li>
<li>所有开发项相关的测试活动都在 Sprint 内完成，这些测试被称为 DIT（开发项测试），测试用例本身还是属于以往的功能测试级别。但是开发项的测试计划、测试执行、报告等一些列过程全部都要在一个 Sprit 中完成，测试用例的自动化比例未做硬性规定</li>
<li>项目成员主要分为开发和测试两类工程师，但是角色的定义并不是拿来当做不可以逾越的红色使用，必要的情况下，开发工程师也可以承担部分测试任务甚至整个人投入测试，或者测试工程师也会与开发一起，结对开发代码。</li>
<li>开发人员的工作安排会受到测试工作的影响，每日站会或者平时工作中，可能会发现软件不容易测试，就需要开发人员协助检查以及修改代码提高软件的可测试性。</li>
</ul>
<h2 id=参考>参考</h2>
<p><a href=https://www.infoq.cn/article/requirement-lifecycle-management-based-on-jira>基于 JIRA 的产品需求全生命周期管理实践</a></p>
<p><a href=https://www.einfochips.com/blog/the-role-of-automated-build-verification-test-bvt-in-agile-devops-methodologies/>The Role of Automated Build Verification Test (BVT) in Agile-DevOps Methodologies</a></p>
<p>&lt;现代软件工程构建之法> by 邹欣</p>
<p><a href="http://www.51testing.com/html/20/n-3709920-2.html?nomobile=1">BVT & BAT（版本验证测试和版本验收测试）</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-e2438758d0b186abed286c728ccac8eb>6.5 - 《卓有成效的管理者》之决策</h1>
<h2 id=背景>背景</h2>
<p>任务繁多，<strong>决策</strong>是其中一项。<br>
当遇到如何决策的时候，特别费脑，不知道如何决定，应该是不知道如何去决定的。缺少思路，被各种杂乱无章的问题围绕，跳不出来，也迟迟没有给出最终的决定。<br>
而通过这边文章，Get一种方式，帮助理清楚思路，快速做出决策。</p>
<h2 id=方法论>方法论</h2>
<p>待补充</p>
<h2 id=后续>后续</h2>
<p>时间管理也是一个问题，工作中事情并不是有计划的单一事项，而是各种无关的事情需要处理。<br>
如果每天在这种杂乱的事情中周旋，时间长了必定没有任何特别的产出。<br>
理想的状态是： 保持一条重要事情的主线，其他事情围绕主线可慢可不做的开展。</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-115f972d66ff5270542d5e87de63e469>6.6 - 《卓有成效的管理者》之我能贡献什么</h1>
<h2 id=背景>背景</h2>
<p>最近思考的一个问题之一： 怎么让团队有明显的产出，虽然有这个问题，但又因为日常工作中的琐事太多，往往很少有时间去思考这个问题。时间久了慢慢忘记了，特此在此记录下来。</p>
<p>标题来自《卓有成效的管理者》by 彼得·德鲁克</p>
<h2 id=方法论>方法论</h2>
<h3 id=what>WHAT</h3>
<p>我能有什么贡献？</p>
<h3 id=why>WHY</h3>
<p>重视贡献是有效性的关键<br>
重视贡献的管理者，其所作作为是与众不同的<br>
重视贡献能挖掘工作中尚未发挥的能力</p>
<h3 id=what-1>WHAT</h3>
<h4 id=贡献>贡献</h4>
<p>管理者若想做点贡献，就必须在这三个方面下功夫。</p>
<ul>
<li>直接成果</li>
<li>树立新的价值观以及对这些价值观的重新确认</li>
<li>培养和开发明天所需要的人才</li>
</ul>
<h3 id=who>WHO</h3>
<h4 id=作为管理者能为这个团队做或贡献什么>作为管理者，能为这个团队做（或贡献）什么</h4>
<h4 id=作为团队中的成员能为这个团队做或贡献什么>作为团队中的成员，能为这个团队做（或贡献）什么？</h4>
<h3 id=how>HOW</h3>
<h4 id=如何使专业人员的工作卓有成效>如何使专业人员的工作卓有成效</h4>
<p>知识分子有责任让别人了解自己。<br>
“为了便于你为机构作出贡献，你需要我做些什么贡献？ 需要我在什么时候，以哪种形式，用什么方式来提供这些贡献”</p>
<h4 id=正确的人际关系>正确的人际关系</h4>
<h5 id=相互沟通>相互沟通：</h5>
<p>“我们的组织和我，期望你作出怎样的贡献? 我应该期望你做什么呢？如何使你的知识和能力得到最大的发挥？”</p>
<h5 id=团队合作-强调贡献有助于横向的沟通因此能够促成团队合作>团队合作： 强调贡献有助于横向的沟通，因此能够促成团队合作</h5>
<p>“谁需要我的产出，并使它产生效益”</p>
<h5 id=自我发展-个人能否有所发展很大程度上在于你是否重视贡献>自我发展： 个人能否有所发展，很大程度上在于你是否重视贡献</h5>
<p>“我对组织能有什么最大的贡献”</p>
<h5 id=培养他人-重视贡献的管理者启发他人寻求自我发展>培养他人： 重视贡献的管理者启发他人寻求自我发展</h5>
<p>管理者的标准是以需求任务为基准，要求很高，高度的期望，远大的目标，是具有重大冲击力的工作</p>
<h4 id=有效的会议>有效的会议</h4>
<p>从会议中得到什么，会议的目的是什么，应该是什么</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-18c13b56515fc44f83c35b9760d79429>6.7 - Team Topologies 团队拓扑</h1>
<div class=lead>Conway&rsquo;s law、Dunbar 鄧巴係數、Team Fist Mindset、Minimal Cognitive Load</div>
<p>起初，对"Cognitive Load" 一词非常好奇，又了解到在 Matthew Skelton 的 <a href=https://book.douban.com/subject/35528423/>《高效能团队模式》</a> 中介绍其与团队的建设有密切的联系，在查找书籍过程中，也有读后感的文章对此书进行了总结，比如 <a href=https://lab.howie.tw/2020/11/Team-Topologies-team-first-mindset.html>Team Topologies - 團隊優先思考模式</a>，觉得非常好，得好好细读，一直放在浏览器标签上舍不得关闭，今早早起趁此赶紧消化下，顺便记录下来，往后查阅。</p>
<h2 id=名字解释>名字解释</h2>
<p>文章涉及几个专业名词。</p>
<table>
<thead>
<tr>
<th>名词</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>Conway&rsquo;s Law</td>
<td>組織內團隊組成的架構，就會直接影響你的軟體系統架構會長成什麼樣子。因為團隊架構決定溝通模式，溝通模式就會影響軟體系統架構</td>
</tr>
<tr>
<td>Dunbar 鄧巴係數</td>
<td>团队中可以深入互相信任且 share working memory 的人数基本上大概是 5 个人左右，极限就是 15 人。而能互相信任的上限大概是 50 个人， 当超过 150 人时就已经高过了社交认知的上限，就连要记住对方的名字都难。</td>
</tr>
<tr>
<td>Team Fist Mindset</td>
<td>团队优先思考模式，</td>
</tr>
<tr>
<td>Minimal Cognitive Load</td>
<td>話說我們每個人的 working memory 其實是很有限的，所以要慎選佔用我們記憶體的事物</td>
</tr>
<tr>
<td>谷仓效应</td>
<td>各部门就像一间「小公司」，各自为政、自负盈亏，只专注在自身的营运利益，而非整个企业的利益，最终导致整个组织功能失调、企业走向衰败。</td>
</tr>
<tr>
<td>Stream-aligned Team</td>
<td>organized around the flow of work and has the ability to deliver value directly to the customer or end user. <img src=https://www.scaledagileframework.com/wp-content/uploads/2021/02/Organize_Agile_Teams_F01_WEB.png alt></td>
</tr>
<tr>
<td>Digital platform</td>
<td>A digital platform is a foundation of self-service APIs, tools, services, knowledge and support which are arranged as a compelling internal product.</td>
</tr>
</tbody>
</table>
<h2 id=team-dynamics>Team Dynamics</h2>
<p>Team dynamics describe the behavior relationship between the member of a group .</p>
<p>Team dynamics are the unconscious, psychological forces that influence the direction of a team&rsquo;s behaviour and performance. They are like undercurrents in the sea, which can carry boats in a different direction to the one they intend to sail .</p>
<p>Google 内部研究，影响 Team Dynamics 的因素有哪些？</p>
<ul>
<li>Team Size</li>
<li>Team Lifespan</li>
<li>Team Relationship</li>
<li>Team Cognition 团队的认知</li>
</ul>
<p>好的团队基础就是小巧精干且长存的团队。5-9 人， 固定的团队成员一起为了一个目标工作得时间至少一年以上。</p>
<h2 id=tunkmans-stages-of-group-development>Tunkman&rsquo;s stages of group development</h2>
<p>这个说明了为什么团队至少一年以上。从团队组成到真的可以产出绩效，至少经历以下四个阶段</p>
<p><img src=https://s3-us-west-2.amazonaws.com/courses-images/wp-content/uploads/sites/1972/2017/07/04222605/Screen-Shot-2017-08-04-at-3.25.50-PM.png alt></p>
<ul>
<li>Forming</li>
<li>Storming</li>
<li>Norming</li>
<li>Performing</li>
</ul>
<p>来自 <a href=https://courses.lumenlearning.com/suny-principlesmanagement/>Principles of Management</a></p>
<h2 id=team-fist-mindset>Team Fist Mindset</h2>
<p>团队优先思考模式， 是什么？</p>
<ul>
<li>团队对某个软件负责，并且持续的关注与改善</li>
<li>Daily 要承诺参与并且不要迟到</li>
<li>团队对于内部事务要持续讨论</li>
<li>专注于 Team Goal</li>
<li>帮助他人移除 blocking thing</li>
<li>Mentor 新人，相互帮助成长</li>
<li>避免争输赢的争论，要能包容探索各种可能性的言论</li>
</ul>
<h2 id=minimal-cognitive-load-最小化的认知负担>Minimal Cognitive Load （最小化的认知负担）</h2>
<p>如果要让团队能以高效的模式运转，首先要以小巧精干的长期的团队为单元，并且限制或与减少不必要的沟通。随着系统越来越复杂，团队与团队之间要建立沟通的规范。</p>
<ul>
<li>Intrinsic Cognitive Load</li>
<li>Extraneous Cognitive Load</li>
<li>Germane Cognitive Load</li>
</ul>
<p><img src=https://1.bp.blogspot.com/-HQWt_LjHo0Q/X6c-P4Ssg1I/AAAAAAAB-MQ/oU1sws5oUmop3JIUDCwmN4lePx8EtEUOgCLcBGAsYHQ/s1600/screenshot_20190725-081022.jpg alt></p>
<p>如何最小化认知负担？</p>
<ul>
<li>好的 IDE 和 tool 或者是培训来降低 Intrinsic Cognitive Load</li>
<li>通过 SOP 或者专业的 Infra Team / DevOps Team 来帮助建设优化开发部署流程，消减工程师的 Extraneous Cognitive Load</li>
<li>让工程师更专注于产生价值的 Germane Cognitive Load， 设计更好的系统来解决客户的问题。</li>
</ul>
<p>另外，Three ways to reduce team cognitive load and improve flow<sup>[2]</sup>:</p>
<ul>
<li>Create well-defined team interaction patterns</li>
<li>Use independent,stream-aligned teams<sup>[1]</sup></li>
<li>Build the thinnest viable platform (TVP)</li>
</ul>
<h2 id=团队的拆分>团队的拆分</h2>
<p>按照康威定律，团队的切分与组织的沟通模式会决定你的系统架构</p>
<h3 id=好的-api>好的 API</h3>
<p>好的 API 是团队间的好的沟通模式，如果没有可能造成<code>谷仓效应</code>。 怎么定义好的 API<sup>[5]</sup>：</p>
<ul>
<li>OPENAPI 定义 API</li>
<li>使用文档 / Wiki</li>
<li>好的用户体验</li>
<li>版本 and testing approach</li>
<li>最佳实践和原则</li>
<li>Work Info （未来的路线和 bug 修复时间）</li>
<li>Communication preferences (when/how)</li>
</ul>
<p>把其他团队当成顾客。</p>
<h3 id=管理依赖>管理依赖</h3>
<p>Track dependencies using simple tools and remove blocking dependencies</p>
<h3 id=管理团队间交流>管理团队间交流</h3>
<p>Consciously design inter-team communications using team interaction mode</p>
<h3 id=好的文档>好的文档</h3>
<p>Overcommunicate using just enough written documentation</p>
<h2 id=digital-platforms>Digital platforms</h2>
<ul>
<li>Digital platforms<sup>[6]</sup> are portfolios of technical products.</li>
<li>Developing a digital platform is a strategic decision and not to be taken lightly. Besides the direct financial considerations, digital platforms also exert pressure on the relationships within your organisation.</li>
<li>Digital platforms are force multipliers（火力加乘）, so there is a fine line between developing a competitive advantage and introducing a significant productivity blocker.</li>
</ul>
<h2 id=参考>参考</h2>
<p>[1] Organizing Agile Teams and ARTs: Team Topologies at Scale Overview</p>
<p>[2] Matthew Skelton and Manuel Pais: Forget monoliths vs. microservices. Cognitive load is what matters</p>
<p>[3] Justin Kitagawa: Platforms at Twilio: Unlocking Developer Effectiveness</p>
<p>[4] 阿贝好威： Team Topologies - 團隊優先思考模式</p>
<p>[5] Matthew Skelton and Manuel Pais: Are poor team interaction killing your devops transformation</p>
<p>[6] Cristóbal García García and Chris Ford: Mind the platform execution gap</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-9f3fe661c510a6627ee0f14e1098f0d9>7 - Tools</h1>
<div class=lead>工欲善其事必先利其器</div>
</div>
<div class=td-content>
<h1 id=pg-5cdb7211381734261870d4aa5318c5f2>7.1 - Customize Icon for Plantuml</h1>
<h2 id=说明>说明</h2>
<p>记录如何定制 PlantUML 中的图标</p>
<h2 id=操作>操作</h2>
<p><em>在mac下操作</em></p>
<ul>
<li>处理图片</li>
<li>编码生成 Sprite</li>
<li>定义宏函数</li>
</ul>
<h3 id=处理图片>处理图片</h3>
<p>如果是png图片，则进行大小的裁剪，一般是48 * 48 px，如果非 png 图片，下面命令也会重新生成 48 像素的正方形图片。</p>
<pre tabindex=0><code>qlmanage -t -s 48 -o . logo.svg 
</code></pre><p><em>qlmanage 命令为 MAC 系统自带的</em></p>
<h3 id=对-png-的图片编码>对 PNG 的图片编码</h3>
<pre tabindex=0><code>java -jar ~/Downloads/plantuml.jar -encodesprite 16z logo.svg.png
</code></pre><p>生成的代码如下;</p>
<pre tabindex=0><code>sprite $logo [48x48/16z] {
pPLNWWCX34F7zTt_n5imtbHcbhyedGYGXR6FJuRw6-YIdhn5hkdXBuZL12VbtRWa_cuO5aeLv9sQE1O8ycAHwwrRv2gqyv6hrGJiZ6yWfn6Tko6BO1UCbPSh
1GR79S1Ulvw7_E2bTVQwktHo3s94Q7jwEpqA9b1_L2Oh0txBW21gbjiF1Y5gV-9tE5LpK9EuEQMrI_5oxkVJ5WLhfXEJfYBZDr3JiBAYZpz-PMMjwr34W40E
SD0Pc_P7JlwWPMOCbOuPQT0nUclErdCxOd354tLeqtDyb9uPB-tkj3H7g9MNmhqpGPQT-eEIIht5O4hPMHBwl9H2hHZatD4eo3olpWUD0JyiueSLUaXbWNg4
PHdZ_yqt2QdGz_9vyxxitiVD-xvVJ_RhrNuztA-t-_Lylr_izwFzVhVkfxBPhpyPtm
}

</code></pre><h3 id=定义宏函数>定义宏函数</h3>
<p>定义宏函数，加入资源文件里，通过 !inlcude 的方式引入资源文件。这里是为了其他地方更方便的引用。</p>
<pre tabindex=0><code>!define EMQX(_alias, e_label) rectangle &quot;&lt;color:black&gt;&lt;$emqx&gt;&lt;/color&gt;\r e_label&quot; as _alias &lt;&lt;EMQX&gt;&gt;
</code></pre><h2 id=最后>最后</h2>
<p>&mldr;记录下来而已</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-aabbd81704488041b3acd03cc439c5b3>7.2 - 抓包工具分析之完全攻略</h1>
<h2 id=背景>背景</h2>
<p>抓包分析是调式前后端协议的杀手锏，用好工具节省大量的时间去写代码优化代码。</p>
<h2 id=名词解释>名词解释</h2>
<p><strong>HTTP Strict transport security(HSTS)</strong><br>
HTTP严格传输安全<br>
HSTS禁止浏览器使用无效证书。</p>
<p><strong>Certificate Transparency</strong><br>
为了解决CA存在的问题（故意或者恶意签发证书等），目的是提供一种开发的审计和监控系统，可以让任何域名所有者或者CA确定证书是否被错误签发或者被恶意使用，从而提供HTTPS网站的安全性。<br>
<a href=https://www.certificate-transparency.org/how-ct-works> how ct works </a></p>
<p><strong>HTTP Public Key Pinning</strong><br>
用来防范由「伪造或不正当的手段获得网站证书」造成中间人攻击。<br>
工作原理： 通过响应头或者<meta>标签告诉浏览器当前网站的证书指纹，以及过期时间等其他信息.<br>
Google已经针对不验证服务器证书的APP给出了警告，这些APP将来会有被Play store拒之门外的危险,<a href="https://support.google.com/faqs/answer/6346016?hl=en">参考</a></p>
<blockquote>
<p>Chrome 69 版本开始移除对HPKP的支持</p>
</blockquote>
<p><strong>OCSP Stapling</strong><br>
OCSP(Online Certifacte Status Protocol, 在线证书状态协议)是用来检验证书合法性的在线查询服务。<br>
TLS握手阶段，实时查询OCSP接口，并在获得结果前阻塞后续流程。但导致建立TLS连接时间变得更长。 而 OCSP Stapling, 是服务器主动获取OCSP查询结果并随着证书一起发给客户端，从而让客服端跳过自己去验证的过程，提高TLS握手效率</p>
<h2 id=工具>工具</h2>
<p>有fiddler, charles, wiresharks,</p>
<h3 id=fiddler>fiddler</h3>
<p>使用中间人（man-in-middle）的方式来实现的。</p>
<ul>
<li>本地化的工具，是一个使用本地127.0.0.1:8888 的HTTP代理。
~任何能够设置HTTP代理为127.0.0.1:8888的浏览器和应用程序都可以使用Fiddler~</li>
</ul>
<h4 id=为什么不能代理所有的http请求>为什么不能代理所有的HTTP请求</h4>
<p>因为在操作系统层面，没有“HTTP request”这一概念，只有TCP连接。<br>
Contacting a HTTP proxy means changing the HTTP request slightly as well as contacting the proxy server instead of the host named in the URL.<br>
所以这个逻辑是写在发送HTTP requests的软件代码里。<br>
curl和wget有他们自己的实现HTTP Request的代码，并使用了自己的配置文件（-x选项）。两者都没有实现基于配置的逻辑，也没有使用Mac OS 系统提供的HTTP Libraries(这个库使用了代理设置）</p>
<h3 id=charles>charles</h3>
<p>原理类似fiddler，但是mac上使用的简单的工具.</p>
<h3 id=mitmproxy>mitmproxy</h3>
<p>原理是中间人的方式来实现, 再加个proxy, 中间人代理软件，可以用来拦截、修改、保存HTTP/HTTPS请求。</p>
<blockquote>
<p>An interactive console program than allows traffic flows to be intercepted, inspected, modified and replayed.
优点是可自定制化开发，命令行模式，适合code geek和键盘控</p>
</blockquote>
<ul>
<li>Regurlar</li>
<li>Transparent</li>
<li>Reverse Proxy</li>
<li>Upstream Proxy</li>
<li>SOCKS Proxy</li>
</ul>
<p><img src=https://docs.mitmproxy.org/stable/schematics/proxy-modes-flowchart.png alt=" Modes of Operation"></p>
<h4 id=透明代理>透明代理</h4>
<p>重定向机制，可以将目的地为Internet上的服务器的TCP连接透明地重新路由到侦听代理服务器上。这通常采用与代理服务器相同的主机上的防火墙形式。比如Linux下的iptables\或者OSX中的pf。具体如何操作见参考中的"Mac 上使用mitmproxy对ios app进行抓包”</p>
<h4 id=安装和使用>安装和使用</h4>
<p><a href=http://rui0.cn/archives/498>MitmProxy 使用教程 for MAC</a><br>
更关心<a href=https://docs.mitmproxy.org/stable/howto-transparent/#macos>Transparent Proxying使用</a></p>
<h5 id=transparent-proxying-在mac上实践>Transparent Proxying 在Mac上实践</h5>
<p>参考官方文档，对mac下进行全局抓包的尝试。如下：</p>
<ul>
<li>Enable IP forwarding.</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo sysctl -w net.inet.ip.forwarding<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span>
</code></pre></div><ul>
<li>Place the following two lines in <strong>/etc/pf.conf</strong>.</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>rdr pass on en0 inet proto tcp to any port <span style=color:#ce5c00;font-weight:700>{</span>80, 443<span style=color:#ce5c00;font-weight:700>}</span> -&gt; 127.0.0.1 port <span style=color:#0000cf;font-weight:700>8080</span>
</code></pre></div><p>This rule tells pf to redirect all traffic destined for port 80 or 443 to the local mitmproxy instance running on port 8080. You should replace <code>en0</code> with the interface on which your test device will appear.</p>
<blockquote>
<p>rdr rules in pf.conf above apply only to inbound traffic. They will NOT redirect traffic coming from the box running pf itself.</p>
</blockquote>
<ul>
<li>Configure pf with the rules.</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo pfctl -f pf.conf
</code></pre></div><p>Mac系统默认使用/etc/pf.conf， 调式完之后需要重置</p>
<ul>
<li>And now enable it.</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo pfctl -e
</code></pre></div><ul>
<li>Fire up mitmproxy.</li>
</ul>
<p>You probably want a command like this:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mitmproxy --mode transparent  --showhost
</code></pre></div><p>The <code>--mode transparent</code> option turns on transparent mode, and the <code>--showhost</code> argument tells
mitmproxy to use the value of the Host header for URL display.</p>
<ul>
<li>Finally, configure your test device.</li>
</ul>
<p>Set the test device up to use the host on which mitmproxy is running as the default gateway and install the mitmproxy certificate authority on the test device</p>
<p>到此, 可以抓包en0显卡上的流量, 但是抓包不了Mac本地上的流量。<br>
但是这并没有解决抓包APP里HTTPS的流量问题，因为出现如下错误：<br>
“ warn: 192.168.2.3:56243: Client Handshake failed. The client may not trust the proxy&rsquo;s certificate for e.crashlytics.com. "<br>
解决办法见： &ldquo;破解SSL Pinning&rdquo;</p>
<p>另外上述方法也没有办法抓包本机电脑上的流量； 需要进一步设置： <a href=https://docs.mitmproxy.org/stable/howto-transparent/>Work-around to redirect traffic originating from the machine itself</a></p>
<ul>
<li>pf解决Mac自身流量抓包</li>
</ul>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#8f5902;font-style:italic>##The ports to redirect to proxy</span>
<span style=color:#000>redir_ports</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;{http, https}&#34;</span>

<span style=color:#8f5902;font-style:italic>##The address the transparent proxy is listening on</span>
<span style=color:#000>tproxy</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;127.0.0.1 port 8080&#34;</span>
<span style=color:#8f5902;font-style:italic>##The user the transparent proxy is running as</span>
<span style=color:#000>tproxy_user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;nobody&#34;</span>

<span style=color:#8f5902;font-style:italic>##The users whose connection must be redirected.</span>
<span style=color:#8f5902;font-style:italic>##</span>
<span style=color:#8f5902;font-style:italic>##This cannot involve the user which runs the</span>
<span style=color:#8f5902;font-style:italic>##transparent proxy as that would cause an infinite loop.</span>
<span style=color:#8f5902;font-style:italic>##</span>

rdr pass proto tcp from any to any port <span style=color:#000>$redir_ports</span> -&gt; <span style=color:#000>$tproxy</span>
pass out route-to <span style=color:#ce5c00;font-weight:700>(</span>lo0 127.0.0.1<span style=color:#ce5c00;font-weight:700>)</span> proto tcp from any to any port <span style=color:#000>$redir_ports</span> user <span style=color:#ce5c00;font-weight:700>{</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$tproxy_user</span> <span style=color:#ce5c00;font-weight:700>}</span>
</code></pre></div><p>转发处理nobody之外的所有用户的流量到mitmproxy上。 为了避免循环，所以以nobody用户身份来启动mitmproxy。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo -u nobody mitmproxy --mode transparent --showhost
</code></pre></div><p>** 发现有些流量不见了 **
排查发现因为wifi下启用了socks代理，导致一些流量不见了, 转发到shadowsocks socks5代理去了。</p>
<h5 id=使用socks5的方式抓包所有的流量>使用socks5的方式抓包所有的流量</h5>
<p><a href=https://blogs.msdn.microsoft.com/aaddevsup/2018/04/11/tracing-all-network-machine-traffic-using-mitmproxy-for-mac-osx/>Tracing All Network Machine Traffic Using MITMProxy for Mac OSX</a><br>
跟regular proxy一样，需要client/应用支持或者更改。比如chrome更改网络方式为代理模式。比如不能对Curl的请求抓包不了<br>
同理，socks5也存在透明代理，不过实现的方式不一样, 比如tsocks</p>
<blockquote>
<p>tsocks provides transparent network access through a SOCKS version 4 or 5 proxy (usually on a firewall). tsocks intercepts the calls applications make to establish TCP connections and transparently proxies them as necessary.</p>
</blockquote>
<h4 id=破解https的ssl-pinning-todo>破解https的SSL Pinning TODO</h4>
<p><a href=https://crifan.github.io/app_capture_package_tool_charles/website/how_capture_app/complex_https/https_ssl_pinning/>APP上破解https的SSL Pinning</a></p>
<h3 id=wireshark>wireshark</h3>
<p>抓取网卡上的所有TCP、UDP的数据</p>
<h4 id=https的解密>HTTPS的解密</h4>
<ul>
<li>通过私钥来解密, 咨询过运维，这种私钥是没办法提供的。 参考这边文档： <a href=https://wiki.wireshark.org/TLS>How to Decrypt SSL and TLS Traffic Using Wireshark</a></li>
<li><code>适合浏览器</code>通过设置环境变量截取浏览器的pre_master_secret,进而实现解密HTTPS的目的。 <a href=https://www.cnblogs.com/yurang/p/11505741.html>wireshark两种解密https方式</a></li>
<li><code>也只适合浏览器，其他客户端发送出的请求无法解密</code> 通过mitmproxy来获取SSLKEYLOGFILE， 参考 <a href=https://docs.mitmproxy.org/stable/howto-wireshark-tls/>Wireshark and SSL/TLS Master Secrets</a></li>
</ul>
<p>This mechanism (SSLKEYLOGFILE) currently(2019) does not work for Safari, Microsoft Edge, and others since their TLS libraries (Microsoft SChannel / Apple SecureTransport) do not suppport this mechanism.<br>
This mechanism works for applications other than web browser as will but it dependent on the TLS Libraries used by application. Examples of applications:</p>
<ul>
<li>Applicaitons using OPENSSL conld use <code>GDB or a LB_PRELOAD trick</code> to extract the secrets .</li>
<li>For Java programs</li>
<li>Python scripts can be edited to dump keys as well</li>
</ul>
<h2 id=参考>参考</h2>
<p>在Trello上记录所有待办事项。<br>
<a href=https://zhuanlan.zhihu.com/p/47003094>常用的HTTP抓包工具Fiddler之使用技巧</a> <br>
<a href=https://imququ.com/post/how-to-decrypt-https.html>三种解密HTTPS流量的方法</a><br>
<a href=https://program-think.blogspot.com/2019/04/Proxy-Tricks.html#head-6>杀手锏：如果让不支持代理的软件，通过代理进行联网</a><br>
<a href=https://www.javazhiyin.com/42166.html>如何使用透明代理抓HTTPS</a><br>
<a href=https://www.zoulei.net/2018/05/25/mitmproxy_transparent_model_network_capture/>Mac 上使用mitmproxy对ios app进行抓包</a> 比较详细的操作<br>
<a href=https://superuser.com/questions/398977/how-can-i-run-all-http-requests-through-charles-web-debugging-proxy-including>怎么让charles能代理所有的http(s)的请求呢？</a><br>
<a href=https://imququ.com/post/http-public-key-pinning.html>HTTP Public Key Pinning 介绍</a><br>
<a href=https://crifan.github.io/app_capture_package_tool_charles/website/>app 抓包利器.pdf</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-54611c3a046a2410da6e3c5810960b10>7.3 - SS 全军覆没，v2ray for Macos</h1>
<h2 id=简介>简介</h2>
<p>大国国庆，机会所有的ss挂了，查个个资料什么的确实不方便，一度使用了bing.com的“网页快照”来查看被墙的资料。<br>
国庆期间，陪完家人，开始搬砖。<br>
ss不能使用后，发现手机上v2ray 连上wifi时，是可以正常使用的（之前配置过服务器）. <br>
这次配置电脑上的v2ray client, 之前安装过v2rayx, 但是使用时出现无法连接的问题，加上UI版的配置无心使用, 这次把命令行的方式献上</p>
<h2 id=安装v2ray>安装v2ray</h2>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>brew tap qiwihui/v2ray   
brew install v2ray-core  
</code></pre></div><p>没有被强</p>
<h2 id=配置v2ray>配置v2ray</h2>
<p>参考 <a href=https://raw.githubusercontent.com/Dosimz/v2ray-config.json/master/config.json>config.json</a><br>
修改inbound.port，outbound里的address和port，users中的id和security</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vim /usr/local/etc/v2ray.config.json 
</code></pre></div><h2 id=启动v2ray--switchyomega>启动v2ray + SwitchyOmega</h2>
<p>ss 也有用到SwtichyOmega，这次只需要启动v2ray</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>v2ray -config<span style=color:#ce5c00;font-weight:700>=</span>/usr/local/etc/v2ray.config.json
</code></pre></div><p>开机启动的方式（亲测失败）</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>brew services start v2ray-core 
</code></pre></div><h2 id=问题汇总>问题汇总</h2>
<h4 id=network-is-unavailable>Network is Unavailable</h4>
<p>A: 真的重启了就好了。 服务真的不稳定，一年挂机好多次。不过现在速度真的是快。</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4f49ec87560075733c7999709debbce8>7.4 - fencview.vim + xshell + vim + 各种中文编码问题</h1>
<div class=lead>fencview.vim</div>
<p>c++ 老代码都不是utf-8编码，估计是gb2312或gbk编码，而javascript是utf-8编码<br>
咋办？<br>
vim中只设置过<br>
&ldquo;set encoding=gb2312 termencoding=utf-8 &ldquo;fileencoding=gbk</p>
<p>不同编码文件，怎么通过一个设置来搞定呢？ 疑惑！！！<br>
以前碰到不同文件后缀名能用不同的高亮，不同的格式化。 <br>
按此逻辑。。。<br>
不同的文件编码可以用不同的配置咯。</p>
<p>google 就如上帝！！！</p>
<p>发现了 <a href=http://edyfox.codecarver.org/html/vim_fileencodings_detection.html>http://edyfox.codecarver.org/html/vim_fileencodings_detection.html</a><br>
最后提到了统一解决办法 fencview.vim</p>
<p>杜绝眼高手低：搞起</p>
<p>一个小时&mldr;<br>
两个小时&mldr;<br>
搞定</p>
<ol>
<li>下载插件：fencview</li>
<li>配置.vimrc</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#204a87>set</span> <span style=color:#000>encoding</span><span style=color:#ce5c00;font-weight:700>=</span>utf-8
<span style=color:#204a87>set</span> <span style=color:#000>termencoding</span><span style=color:#ce5c00;font-weight:700>=</span>utf-8 <span style=color:#4e9a06>&#34;fileencoding=utf-8
</span><span style=color:#4e9a06>set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936
</span><span style=color:#4e9a06>let g:fencview_autodetect=1
</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87>let</span> g:fencview_auto_patterns<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;*&#39;</span>
</code></pre></div><p>最后一行注释掉： 因为不注释javascript 文件不高亮。</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-8cb6e4d23fc8071837e2452aeeb69fc9>7.5 - VIM 转 VSCODE</h1>
<p>VIM 适合折腾
VS Code 适合高效率业务开发
开始学习 VS Code 的快捷键</p>
<br>
## 更新记录
2019.07.08 还在用 VIM... 有毒？
<p>2021-10-24 继续使用，发现各种好特性，比如在一行中删除光标后所有字符到有括号")"，这些技巧提升了效率。以防忘记，统一在这里记录，便于翻阅。</p>
<h2 id=常用的编辑快捷键>常用的编辑快捷键</h2>
<h3 id=editing>Editing</h3>
<p>To delete forward up to character &lsquo;X&rsquo; type <code>dtX</code></p>
<p>To delete forward through character &lsquo;X&rsquo; type <code>dfX</code></p>
<p>To delete backward up to character &lsquo;X&rsquo; type <code>dTX</code></p>
<p>To delete backward through character &lsquo;X&rsquo; type <code>dFX</code></p>
<p>Aligning text with Tabular.vim <code>:tab \/</code></p>
<h3 id=navigation>Navigation</h3>
<h2 id=历史>历史</h2>
<p>vim-go 为什么错误这么让人不知所措，比如：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>gorename: can<span style=color:#a40000>&#39;</span>t find package containing

gometalinter: unkown linters: govet, typecheck, unsed, gosimple

--enable-all/--disable-all can not be combined

quickfix 没有显示出来，并且仅仅提示 GoMetaLinter Failed
</code></pre></div><p>解决办法有很多种，而在不断尝试过程中解决问题：</p>
<ul>
<li>对 vim-go 配置详细了解，比如<code>g:go_metalinter_enabled</code>和<code>g:go_metalinter_autosave_enabled</code></li>
<li>更换最新的版本，比如 vim-go 和 golangci-lint 的最新稳定版本，比如 gorename 最新版本并不支持 go modules 项目</li>
</ul>
<p>不深入了解 vim-go 的原理，用不来 vim-go， 期望：某天能跟 vscode golang 插件一样好用。 不过，在使用 vim-go 的过程中，对静态代码检查工具有了更多了解，比如有对 golang 代码的安全检查：gosec。</p>
<p>Updated At Thu Jul 18 13:34:37 2019</p>
<h2 id=参考>参考</h2>
<p>[1] vimcasts.org Learn Essential Vim Skills</p>
<p>[2] Casperfeng&rsquo;s Github: mastering-vim, Tring to become a proficient vim user.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-5d7b3c4086b6e4f35dd257f952928dbc>7.6 - 从Jekyll到hugo, 迁移Github Pages</h1>
<h2 id=背景>背景</h2>
<p><strong>原因</strong>:</p>
<ul>
<li>观察到一些技术blog把评论和github issue同步了(gitalk)，这个很赞。</li>
<li>后来想到还有一个原因：原来的主题真不好看（跟写blog关系不大呀)，强迫症犯了。</li>
</ul>
<p>于是想在jekyll搭建的blog下增加这种评论，按照教程操作。理应是一两个小时的事情，而因为GWF和Mac下Ruby环境的折腾一个大晚上。<br>
一觉后，不应浪费时间在这些网络问题上，blog主要是思考、怎么写、怎么表达。<br>
于是选择hugo来迁移Blog。</p>
<h2 id=实践>实践</h2>
<p>完全参考 <a href=https://mogeko.me/2018/018/>使用 Hugo + GitHub Pages 搭建个人博客</a><br>
连风格也完全一(lan)样(ren)。。。<br>
一天搭建完</p>
<h2 id=后续>后续</h2>
<p>hugo有很多有趣的功能，比如shortcode, 前段时间一直想通过shortcode让blog支持流程图和思维导图<br>
<strong>好处</strong></p>
<ul>
<li>现有的工具(xmind, 百度脑图等)生成，然后导出图片, 若更新图中内容时会比较麻烦.<br>
目前想到简单的办法是将xmind的源文件和图片同名保存, 更新图片内容，更新源文件的同时，导出同名的图片并覆盖.</li>
</ul>
<p><strong>坏处</strong></p>
<ul>
<li>如果后续迁移到其他Blog架构，会出现因为不支持shortcode显示导致页面显示流程的代码。</li>
</ul>
<p>结论：能不用shortcode的情况，换其他表达方式。</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-44220141a086ff3f15a0de739d16489c>8 - Daily 杂乱记录</h1>
<div class=lead>用于记录日常相关的笔记</div>
</div>
<div class=td-content>
<h1 id=pg-a3c4cafdba401e6278ffa23d11bab6bd>8.1 - 子网掩码</h1>
<h2 id=名词解释>名词解释</h2>
<p><strong>子网掩码</strong></p>
<p>它就是拿来划分子网的，更准确的说，划分子网的同时，还能通过它知道主机在子网里面的具体ip的具体地址。</p>
<p><strong>网络号（subnetwork）</strong></p>
<p>表示我住哪个小区。</p>
<p><strong>主机号(host)</strong></p>
<p>表示我家门牌号是多少。</p>
<p><strong>CIDR(无类别域间路由)/VLSM（可变长子网掩码）</strong></p>
<p>比如： 192.168.0.0/24</p>
<p><img src=https://pic1.zhimg.com/80/v2-6767be87e0f4936e77224461038d9eec_720w.jpg alt="更多 CIDR / VLSM 例子"></p>
<h2 id=参考>参考</h2>
<p>[1] 知乎 noopsphere: 什么是子网掩码</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-240830fcac0d44698ca10107f15b2e3c>8.2 - OAuth 2.0 Token Exchange协议解读</h1>
<p>S3、OSS使用了STS，但是对其原来并不了解。通过这篇文档梳理对STS实现有一定的了解.</p>
<h1 id=名词解释>名词解释</h1>
<p><strong>security token</strong>: a set of information that facilitates the sharing of identity and security information in heterogeneous environments or across security domains. Examples of security tokens include JSON Web Tokens (JWTs) and Security Assertion Markup Language (SAML) 2.0 assertions. Security tokens are typically signed to achieve integrity and sometimes also encrypted to archive confidentiality.</p>
<h1 id=实践>实践</h1>
<p>需要找一个实现的开源代码看看.</p>
<h1 id=参考>参考</h1>
<p>OAuth 2.0 Token Exchange： a protocol extending OAuth 2.0 that enable clients to request and obtain security tokens from authorization servers acting in the role of an STS . <a href=https://tools.ietf.org/html/rfc8693>https://tools.ietf.org/html/rfc8693</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-fc19e4d4f6f294cb8a15c2e4677f0cc8>8.3 - OIDC（OPENID CONNECT）身份认证授权</h1>
<p>只有一张图！</p>
<p>OIDC = （identity，authentication） + OAuth2.0，在<a href=https://tools.ietf.org/html/rfc6749>OAuth2.0</a> 上构建了一个身份层，是一个基于OAuth2.0协议的身份认证标准协议。<br>
<img src=http://www.csharpkit.com/Data/csharpkit/upload/image/20170923/6364180189599301186875856.png alt=OIDC应用场景></p>
<p>再来一张图吧！
<img src=https://hyvi.github.io/blog-images/20200405/oidc_2020-04-06_00-50-25.png alt=基于OAuth的认证与身份协议的各个组件></p>
<h2 id=名词解释>名词解释</h2>
<p><strong>RP</strong>: 在新的协议语境中，客户端叫依赖方，或者叫 RP</p>
<p><strong>IdP</strong>: 从概念上将手段服务器和受保护资源合并为身份提供方</p>
<p><strong>ID令牌</strong>： 用于携带有关身份认证事件本身的信息。解决不同身份提供者的协议各不相同的问题。</p>
<h2 id=身份认证>身份认证</h2>
<ul>
<li>资源拥有者要在授权服务器上授权端点上进行身份认证
为什么有？想想。“忽略了一个环节：对资源拥有者进行身份认证”。</li>
<li>客户端要在授权服务器的令牌端点进行身份认证</li>
<li>最后，基于OAuth实现的身份认证 - OpenID Connect</li>
</ul>
<h2 id=发现协议>发现协议</h2>
<p>openid-connect discovery 动态服务器发现， 客户端需要知道 IdP的发布者URL。</p>
<ul>
<li>可以直接配置，比如NASAR</li>
<li>也可以基于WebFinger协议来发现发布者。</li>
</ul>
<h2 id=客户端注册协议>客户端注册协议</h2>
<p>可以昂客户端向新的身份提供者注册。与OAuth动态客户端注册协议扩展并行，两者是相互兼容的， 参考OAuth动态客户端注册扩展。</p>
<ul>
<li>如果客户端需要访问的API是由多个不同的服务器提供的。</li>
<li>如果客户端软件有多个实例，每个实例都需要与同一个授权服务器交互。</li>
</ul>
<h2 id=不同的openid-connect客户端>不同的OpenID Connect客户端</h2>
<h3 id=authorization-code-flow>Authorization Code Flow</h3>
<p><img src=http://www.csharpkit.com/Data/csharpkit/upload/image/20170923/6364180189635879511255253.jpg alt="Authorization Code Flow"></p>
<h3 id=implicit-flow>Implicit Flow</h3>
<p>在<code>Successful Authentication Response</code>里返回id_token和token, 而不是code</p>
<h3 id=hybrid-flow>Hybrid Flow</h3>
<p>区别在与reponse_type 可以为 <code>code id_token</code>, <code>code token</code> or <code>code id_token token</code><br>
不同的返回适用于什么样的场景了？</p>
<h2 id=其他>其他</h2>
<h3 id=access-token>Access Token</h3>
<p><a href=https://tools.ietf.org/html/draft-ietf-oauth-access-token-jwt-03#section-2.2>JSON Web Token(JWT) Profile for OAuth2.0 Access Tokens </a><br>
定义了Token的Data Structure，以及发布和消费Access Token具体的内容</p>
<h2 id=实践>实践</h2>
<p>Kong OpenID Connect 支持多种授权流程.罗列下常见的流程</p>
<ul>
<li>Session Authentication</li>
<li>JWT Access Token Authentication</li>
<li>User Info Authentication</li>
<li>Introspection Authentication</li>
<li>Authorization Code Flow</li>
</ul>
<p>更多内容，见参考</p>
<p><a href=https://github.com/apache/apisix/blob/master/apisix/plugins/openid-connect.lua> Apache Apisix </a> 支持的认证非常少，比如 Authorization Code Flow 不支持。</p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>OIDC 身份认证授权<br>
<a href=http://www.csharpkit.com/2017-09-23_58568.html>http://www.csharpkit.com/2017-09-23_58568.html</a></p>
</li>
<li>
<p>OpenID Connect Core 1.0 incorporating errata set 1<br>
<a href=https://openid.net/specs/openid-connect-core-1_0.html>https://openid.net/specs/openid-connect-core-1_0.html</a></p>
</li>
<li>
<p>User Authentication with OAuth 2.0
<a href=https://oauth.net/articles/authentication/>https://oauth.net/articles/authentication/</a></p>
</li>
<li>
<p>OAuth 2.0 实战
在web.kamiapp.com里</p>
</li>
<li>
<p>OpenID Connect Plugin <a href=https://docs.konghq.com/hub/kong-inc/openid-connect/>https://docs.konghq.com/hub/kong-inc/openid-connect/</a></p>
</li>
</ol>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-23b1c06675f6773e272050c6049f3aa0>8.4 - Io wait 告警问题</h1>
<blockquote>
<p><code>%iowait</code> 表示在一个采样周期内有百分之几的时间属于以下情况：CPU空闲、并且仍未完成的I/O请求。</p>
</blockquote>
<p>Percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.</p>
<p>两个误解：</p>
<ul>
<li><code>%iowait</code> 表示 CPU 不能工作的时间</li>
<li><code>%iowait</code> 表示 I/O 有瓶颈</li>
</ul>
<h2 id=参考>参考：</h2>
<p><a href="http://linuxperf.com/?p=33">理解%IOWAIT(%WIO)</a></p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-76534db6d623a41b5cf87ab45c00cae7>8.5 - Daily 0201</h1>
<h2 id=docker-compose>docker-compose</h2>
<p>docker-compose 在同一个目录下启动两个容器，不出现覆盖的情况</p>
<pre tabindex=0><code>docker-compose -p dev  up
docker-compose -p test up 


</code></pre><p>很方便了</p>
<p><a href=https://stackoverflow.com/questions/41831582/how-do-i-run-the-same-docker-compose-yml-several-times-on-same-docker-daemon-wit>How do I run the same docker-compose.yml several times on same docker daemon with different names?</a></p>
<h2 id=iterm-2>Iterm 2</h2>
<p>前进后退一个单词是不是伤老壳，终于解决了</p>
<p>vim中使用<code>ESC + b/f</code> 来前进或者后退一个单词，ESC真远<br>
设置profile - key来搞定一切 <code>Option + b/f</code></p>
<p><a href=http://aaronmoment.cn/iterm2/>参考文档 item2常用快捷键总结</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b1b82d75a4a886e569e8c6c0b1e05147>8.6 - Daily 0321</h1>
<h2 id=mysql-character_set>mysql character_set</h2>
<p>show variables like &lsquo;character%’;<br>
从my.ini下手（标签下没有的添加，有的修改）</p>
<pre tabindex=0><code>      [client]
       default-character-set=utf8
      [mysql]
       default-character-set=utf8
      [mysqld]
      default-character-set=utf8
</code></pre><p>Set character_set_database = utf8 重启失效</p>
<p><a href=https://stackoverflow.com/questions/3942888/unicodeencodeerror-latin-1-codec-cant-encode-character>unicodeencodeerror-latin-1-codec-cant-encode-character</a></p>
<h2 id=gerrit-admin-and-h2-database>gerrit admin and h2 database</h2>
<p>问题： gerrit admin没有实际的权限</p>
<blockquote>
<p>Since UUID from groups file and db table account_groups were different I;ve updated table with correct hashes from the group file and added my accont to Administrators group.</p>
</blockquote>
<blockquote>
<p>e.g. update account_groups set group_uuid=&lsquo;9d3ab2b20b498a1793e2e6112d7bdcb01b852588&rsquo;, owner_group_uuid=&lsquo;9d3ab2b20b498a1793e2e6112d7bdcb01b852588&rsquo; where group_id=1;
INSERT INTO account_group_members (account_id, group_id) VALUES ( &ldquo;1&rdquo;, &ldquo;1&rdquo;);</p>
</blockquote>
<p><a href=https://groups.google.com/forum/#!topic/repo-discuss/LuJS8E5j0vQ>Admin group member cannot create</a></p>
<p>问题：怎么进入h2数据库</p>
<pre tabindex=0><code>java -cp  h2-1.3.175.jar  org.h2.tools.Script -url jdbc:h2:/home/gerrit/db/ReviewDB
</code></pre><p>查找h2的jar包，然后找到ReviewDB的数据库文件位置</p>
<h2 id=docker服务器时间同步>docker服务器时间同步</h2>
<ol>
<li>安装tzdata软件(apt-get install -y tzdata)</li>
<li>ENV TZ America/Los_Angeles</li>
</ol>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-6c7014cb8bf3434c55dd33c4ecc3e910>8.7 - Daily 0503</h1>
<h2 id=vcpu的解释>vCPU的解释</h2>
<p>虛擬主機（Virtual Machine，VM）的CPU稱之為vCPU，當虛擬主機需要CPU運算資源的時候，VMkernel會將此虛擬主機需要的運算資源對應（Mapping）到實體伺服器的CPU核心運算HEC（Hardware Execution Context）能力，以使得虛擬主機得以進行運算。簡單來說，HEC就是實體伺服器的CPU核心數（Cores）。</p>
<p>所以，如圖5所示當虛擬主機配有1 vCPU，在需要運算資源時，只要VMkernel對應到實體主機上其中一個HEC就可以執行運算；若虛擬主機配有2 vCPU，在需要運算資源時，則必須對應到2個HEC才能運算；若4 vCPU則要對應4個HEC才能運算。</p>
<p><img src=https://hyvi.github.io/blog-images/20180503/NP120109000212031413512801.png alt=虛擬主機vCPU與實體伺服器HEC對應>
<a href="http://www.netadmin.com.tw/article_content.aspx?sn=1201090002&jump=2">更多内容 </a></p>
<h2 id=google-python-style-guide>google python style guide</h2>
<p>Python 是 Google主要的脚本语言。这本风格指南主要包含的是针对python的编程准则。<br>
<a href=https://github.com/zh-google-styleguide/zh-google-styleguide/tree/master/google-python-styleguide>中文版Git</a></p>
<h2 id=elk>elk</h2>
<p>更新license: <a href=https://www.elastic.co/guide/en/elasticsearch/reference/6.2/update-license.html>Update License API</a><br>
注册之后，可以使用xpack, 后台日志不会重复打</p>
<pre tabindex=0><code class=language-log data-lang=log>logstash_1       | [2018-05-03T11:31:00,614][INFO ][logstash.licensechecker.licensereader] Running health check to see if an Elasticsearch connection is working {:healthcheck_url=&gt;http://logstash_system:xxxxxx@elasticsearch:9200/, :path=&gt;&quot;/&quot;}
logstash_1       | [2018-05-03T11:31:00,615][WARN ][logstash.licensechecker.licensereader] Attempted to resurrect connection to dead ES instance, but got an error. {:url=&gt;&quot;http://logstash_system:xxxxxx@elasticsearch:9200/&quot;, :error_type=&gt;LogStash::Outputs::ElasticSearch::HttpClient::Pool::BadResponseCodeError, :error=&gt;&quot;Got response code '401' contacting Elasticsearch at URL 'http://elasticsearch:9200/'&quot;}
logstash_1       | [2018-05-03T11:31:03,796][INFO ][logstash.outputs.elasticsearch] Running health check to see if an Elasticsearch connection is working {:healthcheck_url=&gt;http://logstash_system:xxxxxx@elasticsearch:9200/, :path=&gt;&quot;/&quot;}
logstash_1       | [2018-05-03T11:31:03,797][WARN ][logstash.outputs.elasticsearch] Attempted to resurrect connection to dead ES instance, but got an error. {:url=&gt;&quot;http://logstash_system:xxxxxx@elasticsearch:9200/&quot;, :error_type=&gt;LogStash::Outputs::ElasticSearch::HttpClient::Pool::BadResponseCodeError, :error=&gt;&quot;Got response code '401' contacting Elasticsearch at URL 'http://elasticsearch:9200/'&quot;}
</code></pre><h2 id=elastalert>elastalert</h2>
<p>docker elastalert</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#4e9a06> python:2.7</span><span style=color:#a40000>
</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>WORKDIR</span><span style=color:#4e9a06> /</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> git clone https://github.com/Yelp/elastalert.git<span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#204a87>cd</span>  elastalert <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> git checkout v0.1.30 <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> pip install -r requirements.txt<span style=color:#a40000>
</span><span style=color:#a40000>
</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>WORKDIR</span><span style=color:#4e9a06> /elastalert/</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> ls -l <span style=color:#a40000>
</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> apt-get install -y tzdata<span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>ENV</span> TZ Asia/Shanghai<span style=color:#a40000>
</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>CMD</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;python&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;elastalert/elastalert.py&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span><span style=color:#a40000>
</span></code></pre></div><p>参考文档：<br>
<a href=https://mannekentech.com/2018/01/19/using-elastalert/>Using ElastAlert</a><br>
<a href=https://engineeringblog.yelp.com/2015/10/elastalert-alerting-at-scale-with-elasticsearch.html>ElastAlert: Alerting At Scale With Elasticsearch </a> 各种异常机制</p>
<p>index_not_found_exception 定位python报错行, 问题在于： elastalert判断elastsearch存在index，而实际上并不存在<br>
<a href=https://github.com/Yelp/elastalert/issues/1139> github elastert isssue 1 </a><br>
解决办法：<br>
<a href=https://github.com/Yelp/elastalert/blob/master/elastalert/create_index.py> create_index.py </a> 244行注释掉delete函数</p>
<h2 id=elasticsearch>elasticsearch</h2>
<p>some Elasticsearch terminology:
an Elasticsearch <code>cluster</code> is made up of one or more <code>nodes</code>. Each of these nodes contains <code>indexes</code> which are split into multiple <code>shards</code>. Elasticsearch makes copies of these shards called <code>replicas</code>. These (primary) shards and replicas are then placed on various nodes throughout the cluster.<br>
<a href=http://chrissimpson.co.uk/elasticsearch-yellow-cluster-status-explained.html>更多内容</a></p>
<p>Elasticsearch 中写一致性原理以及quorum机制</p>
<blockquote>
<p>[查看详情](Elasticsearch 中写一致性原理以及quorum机制)</p>
</blockquote>
<p><a href=https://luyiisme.github.io/2017/05/06/elasticsearch-docker-on-one-vm/>Elasticsearch 5 docker 集群部署&ndash;单虚拟机多容器实例</a></p>
<h3 id=实践>实践</h3>
<p>基于 《Elasticsearch: The Definitive Guide》的笔记</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>

GET /my_index/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match_phrase&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;names&#34;</span>: <span style=color:#4e9a06>&#34;Lincoln Smith&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /_analyze
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;analyzer&#34;</span>: <span style=color:#4e9a06>&#34;standard&#34;</span>,
  <span style=color:#4e9a06>&#34;text&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
    <span style=color:#4e9a06>&#34;John Abraham&#34;</span>,
    <span style=color:#4e9a06>&#34;Lincoln Smith&#34;</span>
  <span style=color:#ce5c00;font-weight:700>]</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /my_index/_doc/9 

PUT /my_index/_doc/9  
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;names&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;John Abraham&#34;</span>, <span style=color:#4e9a06>&#34;Lincoln Smith&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>
<span style=color:#ce5c00;font-weight:700>}</span>


GET /my_blog/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match_phrase&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;body&#34;</span>: <span style=color:#4e9a06>&#34;quick brown fox&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /my_blog/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;dis_max&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;queries&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;Quick pets&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>,
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;body&#34;</span>: <span style=color:#4e9a06>&#34;Quick pets&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>]</span>,
      <span style=color:#4e9a06>&#34;tie_breaker&#34;</span>: 0.7
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>



GET /my_blog/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;dis_max&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;queries&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;Brown fox&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>,
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;body&#34;</span>: <span style=color:#4e9a06>&#34;Brown fox&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>




<span style=color:#8f5902;font-style:italic># 返回了并不是用户想要的结果 </span>
GET /my_blog/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;bool&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;should&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;Brown fox&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>,
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;body&#34;</span>: <span style=color:#4e9a06>&#34;Brown fox&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>



PUT /my_blog/_doc/2
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;Keeping pets healthy&#34;</span>,    
  <span style=color:#4e9a06>&#34;body&#34;</span>:  <span style=color:#4e9a06>&#34;My quick brown fox eats rabbits on a regular basis.&#34;</span>
<span style=color:#ce5c00;font-weight:700>}</span>

PUT /my_blog/_doc/1
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;Quick brown rabbits&#34;</span>,    
  <span style=color:#4e9a06>&#34;body&#34;</span>:  <span style=color:#4e9a06>&#34;Brown rabbits are commonly seen.&#34;</span>
<span style=color:#ce5c00;font-weight:700>}</span>


PUT /my_blog



GET /my_index/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#4e9a06>&#34;BROWN DOG&#34;</span>,
        <span style=color:#4e9a06>&#34;operator&#34;</span>: <span style=color:#4e9a06>&#34;and&#34;</span>
      <span style=color:#ce5c00;font-weight:700>}</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /my_index/_search 
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;QUICK!&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


POST /my_index/_bulk
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;The quick brown fox&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>}}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;The quick brown fox jumps over the lazy dog&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;The quick brown fox jumps over the quick dog&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#ce5c00;font-weight:700>}}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;Brown fox brown dog&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span>


<span style=color:#8f5902;font-style:italic># 为什么 shard 为 1 </span>
PUT /my_index
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;settings&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;number_of_shards&#34;</span>: <span style=color:#0000cf;font-weight:700>1</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
  
<span style=color:#ce5c00;font-weight:700>}</span>


DELETE /my_index 


GET /my_store/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;bool&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;should&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;term&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;productID&#34;</span>: <span style=color:#4e9a06>&#34;KDKE-B-9947-#kL5&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>,
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;bool&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;must&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
              <span style=color:#ce5c00;font-weight:700>{</span>
                <span style=color:#4e9a06>&#34;term&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
                  <span style=color:#4e9a06>&#34;price&#34;</span>: <span style=color:#4e9a06>&#34;30&#34;</span>
                <span style=color:#ce5c00;font-weight:700>}</span>
              <span style=color:#ce5c00;font-weight:700>}</span>,
              <span style=color:#ce5c00;font-weight:700>{</span>
                <span style=color:#4e9a06>&#34;term&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
                  <span style=color:#4e9a06>&#34;productID&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
                    <span style=color:#4e9a06>&#34;value&#34;</span>: <span style=color:#4e9a06>&#34;JODL-X-1937-#pV7&#34;</span>
                  <span style=color:#ce5c00;font-weight:700>}</span>
                <span style=color:#ce5c00;font-weight:700>}</span>
              <span style=color:#ce5c00;font-weight:700>}</span>
            <span style=color:#ce5c00;font-weight:700>]</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


DELETE /my_store

GET /my_store/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;bool&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;must&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
        <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;match_all&#34;</span>: <span style=color:#ce5c00;font-weight:700>{}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>]</span>, 
      <span style=color:#4e9a06>&#34;filter&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;term&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;productID&#34;</span>: <span style=color:#4e9a06>&#34;XHDK-A-1293-#fJ3&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


PUT /my_store 
<span style=color:#ce5c00;font-weight:700>{</span>     
  <span style=color:#4e9a06>&#34;mappings&#34;</span> : <span style=color:#ce5c00;font-weight:700>{</span>         
      <span style=color:#4e9a06>&#34;properties&#34;</span> : <span style=color:#ce5c00;font-weight:700>{</span>                 
        <span style=color:#4e9a06>&#34;productID&#34;</span> : <span style=color:#ce5c00;font-weight:700>{</span>                     
          <span style=color:#4e9a06>&#34;type&#34;</span> : <span style=color:#4e9a06>&#34;keyword&#34;</span>
        <span style=color:#ce5c00;font-weight:700>}</span>            
        <span style=color:#ce5c00;font-weight:700>}</span>        
      <span style=color:#ce5c00;font-weight:700>}</span>     
    <span style=color:#ce5c00;font-weight:700>}</span>


POST /my_store/_doc/_bulk 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>}}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;price&#34;</span> : 10, <span style=color:#4e9a06>&#34;productID&#34;</span> : <span style=color:#4e9a06>&#34;XHDK-A-1293-#fJ3&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>}}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;price&#34;</span> : 20, <span style=color:#4e9a06>&#34;productID&#34;</span> : <span style=color:#4e9a06>&#34;KDKE-B-9947-#kL5&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>3</span> <span style=color:#ce5c00;font-weight:700>}}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;price&#34;</span> : 30, <span style=color:#4e9a06>&#34;productID&#34;</span> : <span style=color:#4e9a06>&#34;JODL-X-1937-#pV7&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;_id&#34;</span>: <span style=color:#0000cf;font-weight:700>4</span> <span style=color:#ce5c00;font-weight:700>}}</span> 
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;price&#34;</span> : 30, <span style=color:#4e9a06>&#34;productID&#34;</span> : <span style=color:#4e9a06>&#34;QQPX-R-3956-#aD8&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span>



GET /us-tweet/_search
<span style=color:#ce5c00;font-weight:700>{</span> 
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match_all&#34;</span>: <span style=color:#ce5c00;font-weight:700>{}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
  , <span style=color:#4e9a06>&#34;_source&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;tweet&#34;</span>, <span style=color:#4e9a06>&#34;date&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /us-tweet

GET /us-tweet/_search?search_type<span style=color:#ce5c00;font-weight:700>=</span>dfs_query_then_fetch

<span style=color:#8f5902;font-style:italic># explain API to understand why one particular document matched or, more important, why it didn&#39;t match .</span>
GET /us-tweet/_doc/12/_explain 
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;bool&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;filter&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;term&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;user_id&#34;</span>: <span style=color:#4e9a06>&#34;3&#34;</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>}</span>,
      <span style=color:#4e9a06>&#34;must&#34;</span>: 
        <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
            <span style=color:#4e9a06>&#34;tweet&#34;</span>: <span style=color:#4e9a06>&#34;honeymoon&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /_search?explain<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>true</span>
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;tweet&#34;</span>: <span style=color:#4e9a06>&#34;honeymoon&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;bool&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;must&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;tweet&#34;</span>: <span style=color:#4e9a06>&#34;managee text search&#34;</span>
        <span style=color:#ce5c00;font-weight:700>}</span> 
      <span style=color:#ce5c00;font-weight:700>}</span>,
      <span style=color:#4e9a06>&#34;filter&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
        <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;term&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;user_id&#34;</span>: <span style=color:#4e9a06>&#34;2&#34;</span>
          <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>]</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>



GET /us-tweet/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;bool&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;filter&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;term&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;user_id&#34;</span>: <span style=color:#0000cf;font-weight:700>1</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>}</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>,
  <span style=color:#4e9a06>&#34;sort&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;date&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;order&#34;</span>: <span style=color:#4e9a06>&#34;desc&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


GET /_search

PUT /us-user
PUT /gb-user
PUT /gb-tweet
PUT /us-tweet

POST /_bulk
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;us-user&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;email&#34;</span>:<span style=color:#4e9a06>&#34;john@smith.com&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;John Smith&#34;</span>,<span style=color:#4e9a06>&#34;username&#34;</span>:<span style=color:#4e9a06>&#34;@john&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;gb-user&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;email&#34;</span>:<span style=color:#4e9a06>&#34;mary@jones.com&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Mary Jones&#34;</span>,<span style=color:#4e9a06>&#34;username&#34;</span>:<span style=color:#4e9a06>&#34;@mary&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;gb-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-13&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Mary Jones&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;Elasticsearch means full text search has never been so easy&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:2<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;us-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;4&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-14&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;John Smith&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;@mary it is not just text, it does everything&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:1<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;gb-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-15&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Mary Jones&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;However did I manage before Elasticsearch?&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:2<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;us-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;6&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-16&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;John Smith&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;The Elasticsearch API is really easy to use&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:1<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;gb-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;7&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-17&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Mary Jones&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;The Query DSL is really powerful and flexible&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:2<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;us-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;8&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-18&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;John Smith&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:1<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;gb-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;9&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-19&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Mary Jones&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;Geo-location aggregations are really cool&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:2<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;us-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-20&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;John Smith&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;Elasticsearch surely is one of the hottest new NoSQL products&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:1<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;gb-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;11&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-21&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Mary Jones&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;Elasticsearch is built for the cloud, easy to scale&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:2<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;us-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;12&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-22&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;John Smith&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;Elasticsearch and I have left the honeymoon stage, and I still love her.&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:1<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;gb-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;13&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-23&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;Mary Jones&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;So yes, I am an Elasticsearch fanboy&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:2<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;create&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_index&#34;</span>:<span style=color:#4e9a06>&#34;us-tweet&#34;</span>,<span style=color:#4e9a06>&#34;_id&#34;</span>:<span style=color:#4e9a06>&#34;14&#34;</span><span style=color:#ce5c00;font-weight:700>}}</span>
<span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;date&#34;</span>:<span style=color:#4e9a06>&#34;2014-09-24&#34;</span>,<span style=color:#4e9a06>&#34;name&#34;</span>:<span style=color:#4e9a06>&#34;John Smith&#34;</span>,<span style=color:#4e9a06>&#34;tweet&#34;</span>:<span style=color:#4e9a06>&#34;How many more cheesy tweets do I have to write?&#34;</span>,<span style=color:#4e9a06>&#34;user_id&#34;</span>:1<span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#8f5902;font-style:italic># Don&#39;t Repeat Yourself</span>
<span style=color:#8f5902;font-style:italic># 出错，从 7.0 开始，一个索引下一个类型</span>
POST /website/_bulk
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;index&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;_type&#34;</span>: <span style=color:#4e9a06>&#34;blog&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;User logged in&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span>

GET /website/
<span style=color:#8f5902;font-style:italic># 不要其他的元数据</span>
GET /website/blog/123/_source

<span style=color:#8f5902;font-style:italic># 检索文档的一部分 </span>
GET /website/blog/123?_source<span style=color:#ce5c00;font-weight:700>=</span>title,text

GET /website/blog/123?pretty

POST /website/blog/
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;My second Blog entry&#34;</span>  , 
  <span style=color:#4e9a06>&#34;text&#34;</span>: <span style=color:#4e9a06>&#34;still tying this out .... &#34;</span>, 
  <span style=color:#4e9a06>&#34;date&#34;</span>: <span style=color:#4e9a06>&#34;2014/01/02&#34;</span>
  
<span style=color:#ce5c00;font-weight:700>}</span>

PUT /website/blog/123
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;title&#34;</span>: <span style=color:#4e9a06>&#34;My First Blog entry&#34;</span>  , 
  <span style=color:#4e9a06>&#34;text&#34;</span>: <span style=color:#4e9a06>&#34;just tying this out .... &#34;</span>, 
  <span style=color:#4e9a06>&#34;date&#34;</span>: <span style=color:#4e9a06>&#34;2014/01/01&#34;</span>
  
<span style=color:#ce5c00;font-weight:700>}</span>

PUT /website

GET _search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match_all&#34;</span>: <span style=color:#ce5c00;font-weight:700>{}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

PUT /megacorp

PUT /megacorp/employee/1 
<span style=color:#ce5c00;font-weight:700>{</span>     <span style=color:#4e9a06>&#34;first_name&#34;</span> : <span style=color:#4e9a06>&#34;John&#34;</span>,     <span style=color:#4e9a06>&#34;last_name&#34;</span> :  <span style=color:#4e9a06>&#34;Smith&#34;</span>,     <span style=color:#4e9a06>&#34;age&#34;</span> :        25,     <span style=color:#4e9a06>&#34;about&#34;</span> :      <span style=color:#4e9a06>&#34;I love to go rock climbing&#34;</span>,     <span style=color:#4e9a06>&#34;interests&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#4e9a06>&#34;sports&#34;</span>, <span style=color:#4e9a06>&#34;music&#34;</span> <span style=color:#ce5c00;font-weight:700>]</span> 
  
<span style=color:#ce5c00;font-weight:700>}</span>

PUT /megacorp/employee/2 
<span style=color:#ce5c00;font-weight:700>{</span>     <span style=color:#4e9a06>&#34;first_name&#34;</span> :  <span style=color:#4e9a06>&#34;Jane&#34;</span>,     <span style=color:#4e9a06>&#34;last_name&#34;</span> :   <span style=color:#4e9a06>&#34;Smith&#34;</span>,     <span style=color:#4e9a06>&#34;age&#34;</span> :         32,     <span style=color:#4e9a06>&#34;about&#34;</span> :       <span style=color:#4e9a06>&#34;I like to collect rock albums&#34;</span>,     <span style=color:#4e9a06>&#34;interests&#34;</span>:  <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#4e9a06>&#34;music&#34;</span> <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>}</span>

PUT /megacorp/employee/3 
<span style=color:#ce5c00;font-weight:700>{</span>     <span style=color:#4e9a06>&#34;first_name&#34;</span> :  <span style=color:#4e9a06>&#34;Douglas&#34;</span>,     <span style=color:#4e9a06>&#34;last_name&#34;</span> :   <span style=color:#4e9a06>&#34;Fir&#34;</span>,     <span style=color:#4e9a06>&#34;age&#34;</span> :         35,     <span style=color:#4e9a06>&#34;about&#34;</span>:        <span style=color:#4e9a06>&#34;I like to build cabinets&#34;</span>,     <span style=color:#4e9a06>&#34;interests&#34;</span>:  <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#4e9a06>&#34;forestry&#34;</span> <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>}</span>

GET /megacorp/employee/1

GET /megacorp/employee/_search 

GET /megacorp/employee/_search?q<span style=color:#ce5c00;font-weight:700>=</span>last_name:Smith 

<span style=color:#8f5902;font-style:italic># DSL 查询</span>
GET /megacorp/employee/_search 
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;last_name&#34;</span>: <span style=color:#4e9a06>&#34;Smitch&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


<span style=color:#8f5902;font-style:italic># 年龄大于30岁的员工。</span>

GET /megacorp/employee/_search 
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;bool&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;filter&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;range&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;age&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;gt&#34;</span>: <span style=color:#0000cf;font-weight:700>30</span> <span style=color:#ce5c00;font-weight:700>}</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>}</span>,
      <span style=color:#4e9a06>&#34;must&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;last_name&#34;</span>: <span style=color:#4e9a06>&#34;smitch&#34;</span>
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>}</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /megacorp/employee/_search 
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;about&#34;</span>: <span style=color:#4e9a06>&#34;rock climbing&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


GET /megacorp/employee/_search 
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match_phrase&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;about&#34;</span>: <span style=color:#4e9a06>&#34;rock climbing&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic># 因为我要聚合的字段 「interests」没有进行优化，也类似没有加索引 </span>
<span style=color:#8f5902;font-style:italic># 没有优化的字段 es 默认是禁止聚合/排序操作的。 </span>
PUT /megacorp/_mapping?pretty
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;properties&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;interests&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;text&#34;</span>, 
      <span style=color:#4e9a06>&#34;fielddata&#34;</span>: <span style=color:#204a87>true</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic># 让我们找到所有职员中最大的共同点是什么？</span>
GET /megacorp/employee/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;aggs&#34;</span>:<span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;all_interests&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;terms&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;field&#34;</span>: <span style=color:#4e9a06>&#34;interests&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


GET /megacorp/employee/_search 
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;query&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;match&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;last_name&#34;</span>: <span style=color:#4e9a06>&#34;smith&#34;</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>, 
  <span style=color:#4e9a06>&#34;aggs&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;all_interests&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;terms&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;field&#34;</span>: <span style=color:#4e9a06>&#34;interests&#34;</span>
      <span style=color:#ce5c00;font-weight:700>}</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>

GET /megacorp/employee/_search
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;aggs&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;all_interests&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;terms&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;field&#34;</span>: <span style=color:#4e9a06>&#34;interests&#34;</span>
      <span style=color:#ce5c00;font-weight:700>}</span>, 
      <span style=color:#4e9a06>&#34;aggs&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
        <span style=color:#4e9a06>&#34;avg_age&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
          <span style=color:#4e9a06>&#34;avg&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;field&#34;</span>: <span style=color:#4e9a06>&#34;age&#34;</span><span style=color:#ce5c00;font-weight:700>}</span> 
        <span style=color:#ce5c00;font-weight:700>}</span>
      <span style=color:#ce5c00;font-weight:700>}</span>
    <span style=color:#ce5c00;font-weight:700>}</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


PUT /blogs
<span style=color:#ce5c00;font-weight:700>{</span>
  <span style=color:#4e9a06>&#34;settings&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
    <span style=color:#4e9a06>&#34;number_of_shards&#34;</span>: 3,
    <span style=color:#4e9a06>&#34;number_of_replicas&#34;</span>: <span style=color:#0000cf;font-weight:700>1</span>
  <span style=color:#ce5c00;font-weight:700>}</span>
<span style=color:#ce5c00;font-weight:700>}</span>


GET /_cluster/health

</code></pre></div><h2 id=nginx配置>nginx配置</h2>
<p>(location =) > (location 完整路径) > (location ^~ 路径) > (location ~,~* 正则顺序) > (location 部分起始路径) > (/)<br>
<a href=http://seanlook.com/2015/05/17/nginx-location-rewrite/>更多详情</a></p>
<h2 id=tornado>tornado</h2>
<p>sqlalchemy 和 tornado的结合： session管理放在了每次的request的请求中处理为最佳，以及每次请求经来时，实例化session, 请求结束后, 将session关闭<br>
scoped_session session 注册表，从中取用和还取，并保证多次取用的为统一session<br>
此处的sqlalchemy的数据库查询，并不是异步，当使用tornado 的异步特性时，遇到查询数据库慢时，还是会阻塞的，此时我们更多的需要考虑的</p>
<p><a href=https://segmentfault.com/a/1190000008650442>我心中的 tornado 最佳实践</a></p>
<p><a href=https://groups.google.com/forum/#!msg/python-tornado/t-Tbn7n0IZY/ehV_o8uU3xgJ>handle blocking tasks in Tornado</a><br>
其中Ben Darnell回复的,</p>
<blockquote>
<p>A ThreadPoolExecutor is the recommended way to use blocking functions that cannot be easily rewritten as non-blocking. When you call <code>yield self._exe(n)</code>, that handler will be suspended and the main thread will return to the HTTPServer so it is free to handle other requests. The suspended handler will wake up when the task is completed and the IOLoop is not busy.
The new thread pool is created by the main thread but is not &ldquo;in&rdquo; the thread. Thread pools should generally be either global or class variables; not instance variables. It is a good practice to have one thread pool for each kind of resource: e.g. one thread pool for database queries and second pool for image processing. This lets you set and monitor separate limits for each one.</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>tornado.web</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>tornado.concurrent</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>run_on_executor</span>
<span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>concurrent.futures</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>ThreadPoolExecutor</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>time</span>

<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>MainHandler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tornado</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>web</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>RequestHandler</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Hello, world </span><span style=color:#4e9a06>%s</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>())</span>


<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SleepHandler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tornado</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>web</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>RequestHandler</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#5c35cc;font-weight:700>@property</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>executor</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>application</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>executor</span>

    <span style=color:#5c35cc;font-weight:700>@tornado</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>gen</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>coroutine</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>n</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>yield</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>_exe</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Awake! </span><span style=color:#4e9a06>%s</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>())</span>
        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>finish</span><span style=color:#000;font-weight:700>()</span>

    <span style=color:#5c35cc;font-weight:700>@run_on_executor</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>_exe</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#4e9a06>&#34;&#34;&#34;
</span><span style=color:#4e9a06>        This is a long time job and may block the server,such as a complex DB query or Http request.
</span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
        <span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>float</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>))</span>
        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>n</span>


<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>App</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tornado</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>web</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Application</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#000>handlers</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
                        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>r</span><span style=color:#4e9a06>&#34;/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>MainHandler</span><span style=color:#000;font-weight:700>),</span>
                        <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>r</span><span style=color:#4e9a06>&#34;/sleep/(\d+)&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>SleepHandler</span><span style=color:#000;font-weight:700>),</span>
                    <span style=color:#000;font-weight:700>]</span>
        <span style=color:#000>tornado</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>web</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Application</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>handlers</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>executor</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>ThreadPoolExecutor</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>max_workers</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>60</span><span style=color:#000;font-weight:700>)</span>


<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;__main__&#34;</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>application</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>App</span><span style=color:#000;font-weight:700>()</span>
    <span style=color:#000>application</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>listen</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>8888</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>tornado</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ioloop</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>IOLoop</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>instance</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>start</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><h2 id=python>python</h2>
<p>MD，最喜欢的还是贴好文章的链接<br>
<a href=http://www.wklken.me/posts/2013/07/18/python-translate-yield.html>PYTHON中YIELD的解释</a>: 这个代码解释详细了，什么是“鸭子类型" (duck typing)</p>
<p>再来一个链接: <a href=http://nvie.com/posts/iterators-vs-generators/>Iterables vs. Iterators vs. Generators</a> 原来generators还有两种类型(Type): generator functions and generator expressions</p>
<blockquote>
<p>这真是一个很长的story啊</p>
</blockquote>
<p>futrue使用<br>
Futrue模式的主要使用场景： 当前线程需要依赖另一线程的返回数据并且处理数据的线程又相当耗时，那么Futrue模式就可以使主线程提交数据请求给另一线程处理业务逻辑，等需要时将另一线程返回，很好的利用了等待时间<br>
<a href=https://manjusaka.itscoder.com/2017/11/28/something-about-concurrent-future/>Python concurrent.future 使用教程及源码初剖</a></p>
<p>yield 协程<br>
yield并没有指定当前进程要将执行权利移交给谁，只是放弃运行权利，至于下面由谁来运行，完全看进程调度schedule();多用于I/O等待时，进程短暂wait，但是并没有退出运行队列。<br>
<a href=https://blog.csdn.net/sunnybeike/article/details/6947137> 进程管理之yield </a><br>
[ Yield 和 Coroutine ] (<a href=http://wsfdl.com/python/2016/11/13/yield_and_croutine.html>http://wsfdl.com/python/2016/11/13/yield_and_croutine.html</a>)</p>
<p>Python (at least in the CPython implementation) has a Global Interpreter Lock which prevents multiple threads from executing Python code at the same time. In particular, anything which runs in a single Python opcode is uninterruptible unless it calls a C function which explicitly releases the GIL. A large exponentation with ** holds the GIL the whole time and thus blocks all other python threads, while a call to bcrypt() will release the GIL so other threads can continue to work.</p>
<p><a href=http://python.jobbole.com/87743/>深入理解 GIL：如何写出高性能及线程安全的 Python 代码 </a> 介绍了GIL</p>
<h2 id=参考>参考</h2>
<p>[1] Clinton Gormley and Zachary Tong: Elasticsearch: The Definitive Guide</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-1ca7c71430af3a9f7980b371807adbe9>8.8 - Daily 0607</h1>
<h1 id=python-import>python import</h1>
<p><a href=http://codingpy.com/article/python-import-101/>Python导入模块的几种姿势</a> 文中介绍了如下几种导入：</p>
<ul>
<li>常规导入(regular imports)</li>
<li>使用from语句导入</li>
<li>相对导入(relative imports)</li>
<li>可选导入(optional imports)</li>
<li>本地/局部导入(local imports)</li>
<li>导入注意事项 ： 循环导入(circular imports) 和 覆盖导入(shadowed imports)</li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-42dc9af5b2030b909b1e6cdc427a47f8>8.9 - Daily 0612</h1>
<h1 id=使用pip-packege拆分项目>使用pip packege拆分项目</h1>
<h2 id=pip-安装git仓库>pip 安装git仓库</h2>
<p><a href=https://stackoverflow.com/questions/20101834/pip-install-from-git-repo-branch>pip install from git repo branch </a> 介绍几种导入安装方式</p>
<h2 id=为什么不使用git-submodule方式来拆分项目>为什么不使用git submodule方式来拆分项目</h2>
<p>更新子项目的方式使运维工作变得麻烦。</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-11c618c16edab1f3526f5402311e74c4>8.10 - Daily 0813</h1>
<h1 id=区块链>区块链</h1>
<h2 id=参考资料>参考资料</h2>
<p><a href="https://www.ibm.com/developerworks/community/blogs/3302cc3b-074e-44da-90b1-5055f1dc0d9c/entry/opentech-blockchain?lang=zh">区块链和 HyperLedger 系列课程（共十讲</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-79d997335fbe9696d3f0e05d03d6384e>8.11 - Daily 0821 chrome app/extension</h1>
<h2 id=入门>入门</h2>
<h2 id=深入>深入</h2>
<h2 id=扩展>扩展</h2>
<h2 id=参考>参考</h2>
<p><a href=https://crxdoc-zh.appspot.com/apps/first_app>app 创建第一个应用</a><br>
<a href=https://github.com/SingleClickApps/disable-cookies>disable cookies</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4a62dfb087d1255a1733eafeca76273f>8.12 - Daily 10/09</h1>
<h2 id=学习>学习</h2>
<h3 id=vue>Vue</h3>
<p>Directive <a href=https://vuejs.org/v2/guide/custom-directive.html>官网介绍</a></p>
<h3 id=webpack>webpack</h3>
<p><a href=https://github.com/webpack/webpack/issues/1788#issuecomment-166759703>webpack babel对import不一样</a> 这个问题很困惑<code>TODO</code></p>
<p><a href=https://stackoverflow.com/questions/43814830/destructuring-a-default-export-object>Destructuring a default export object</a> 这个问题正是我的问题</p>
<p><a href=https://blog.kentcdodds.com/misunderstanding-es6-modules-upgrading-babel-tears-and-a-solution-ad2d5ab93ce0>Misunderstanding ES6 Modules, Upgrading Babel, Tears, and a Solution</a> 做个总结</p>
<h3 id=es6>ES6</h3>
<p><a href=https://aotu.io/notes/2016/09/22/es6-import-with-babel/index.html>通过 Babel 使用 ES6 的 import</a></p>
<h3 id=mobile-web>mobile web</h3>
<p><a href=http://framework7.taobao.org/>Framework7 特色的HTML框架 可以创建精美的iOS应用</a></p>
<p><a href=https://gist.github.com/ximan/9778174>reset.css</a> 重置移动设备的css</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b208d2437975111a7aff23977621a97d>8.13 - Daily 10/15 配置https</h1>
<p>阿里云免费签发的CA证书，然后下载到服务器，配置nginx</p>
<pre tabindex=0><code>  ssl_certificate   cert/213970811020013.pem;
  ssl_certificate_key  cert/213970811020013.key;
</code></pre><p>对80端口的域名访问做好跳转</p>
<pre tabindex=0><code>server {
	listen 80;
    server_name server.com www.server.com;
    return 301 https://www.server.com$request_uri;
}

</code></pre>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4ae1457ece262608778b9af9debde46d>8.14 - Daily 10/16</h1>
<h2 id=学习>学习</h2>
<h3 id=uuid>UUID</h3>
<p><a href=https://github.com/simongong/js-stackoverflow-highest-votes/blob/master/questions1-10/how-to-create-a-UUID-in-javascript.md>How to create a GUID / UUID in Javascript?</a> 很全面的UUID资料</p>
<h3 id=vue-统一的数据请求接口>VUE 统一的数据请求接口</h3>
<p><a href=https://github.com/vuejs/vuex/blob/dev/examples/shopping-cart/api/shop.js>shop.js</a> 接口案例 <a href=https://vuex.vuejs.org/zh-cn/structure.html>项目结构</a></p>
<h3 id=web>Web</h3>
<p><a href=https://www.zhihu.com/question/24918722>html5 控制 andorid端 input输入框 不弹出输入法？</a> 前端input 不弹输入框</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#0000cf;font-weight:700>1</span><span style=color:#a40000>）</span><span style=color:#000>onfocus</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;this.blur();&#39;</span>

<span style=color:#0000cf;font-weight:700>2</span><span style=color:#a40000>）</span><span style=color:#000>readOnly</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;readOnly&#39;</span>

</code></pre></div><p><a href=https://stackoverflow.com/questions/41097909/dynamic-component-click-event-in-vue>Dynamic component click event in Vue</a> 动态组件添加click事件，使用<code>@click.native</code></p>
<p><a href=http://justcoding.iteye.com/blog/2032627>所不知的 CSS ::before 和 ::after 伪元素用法</a> 多看几次<code>TODO</code></p>
<p><a href=http://www.zhangxinxu.com/wordpress/2012/04/inline-block-space-remove-%E5%8E%BB%E9%99%A4%E9%97%B4%E8%B7%9D/>去除inline-block元素间间距的N种方</a> 两个元素之间没有任何元素，却有空格的解决办法，是inline-block本身存在的问题</p>
<p><a href=https://github.com/evrone/postcss-px-to-viewport>postcss</a> postcss-px-to-viewport 解决设计稿到代码的像素的转化 <code>TODO</code>没有webpack加入方式</p>
<p><a href=https://www.w3cplus.com/css/vw-for-layout.html>再聊移动端页面的适配</a> 移动页面的适配最新解决方式</p>
<p><a href=https://www.w3cplus.com/css/the-important-css-declaration-how-and-when-to-use-it.html>如何和何时使用CSS的!important</a> 解释了为什么使用 !important</p>
<p><a href=http://light7.org/examples/>light7</a> 优秀的移动端框架</p>
<p><a href=http://cubic-bezier.com/#.72,.17,.44,.54>cubic</a> 很酷 <code>TODO</code></p>
<p><a href=https://github.com/purifycss/purifycss>purifycss</a> 去掉无用的css</p>
<p><a href=https://github.com/sagalbot/vue-select/tree/master/docs/components>vue select</a> 下拉选项vue集成</p>
<p><a href=https://github.com/vum-team/vum>vue demo</a> 结构清晰，耦合很小</p>
<p><a href=https://github.com/innofed/ufe-spec>团队编码规范</a> 参考学习</p>
<h3 id=vtiger>Vtiger</h3>
<p><a href=https://wiki.vtiger.com/index.php/Webservices_tutorials#API_Call_characterstics>vtiger Webservice tutorials</a> api修改crm数据</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-639931eb8e570838e56327173dc99821>8.15 - Daily 10/18</h1>
<h2 id=学习>学习</h2>
<h3 id=eslint>Eslint</h3>
<p><a href=https://eslint.org/docs/rules/quotes>enforce the consistent use of either backticks, double, or single quotes</a> 禁用quotes规则，在文件头</p>
<pre tabindex=0><code>/* eslint-disable quotes */
</code></pre>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b58d2181d1aacb4305b0c2a0a310c79c>8.16 - Daily 10/19 三个月</h1>
<h2 id=学习>学习</h2>
<h3 id=webpack-express-配置proxy-http---https-修改header参数>webpack express 配置proxy (http -> https), 修改header参数</h3>
<p>webpack dev环境下使用中间件<a href=https://github.com/chimurai/http-proxy-middleware>http=proxy-middleware</a><br>
通过配置参数<em>option.onProxyReq</em>来设置</p>
<pre tabindex=0><code>function onProxyReq(proxyReq, req, res) {
    // add custom header to request
    proxyReq.setHeader('x-added', 'foobar');
    // or log the req
}
</code></pre><p><a href=https://github.com/nodejitsu/node-http-proxy/blob/master/examples/http/proxy-http-to-https.js>node-http-proxy</a> 很多代理的示例，参考用</p>
<pre tabindex=0><code>httpProxy.createProxyServer({
  target: 'https://google.com',
  agent  : https.globalAgent,
  headers: {
    host: 'google.com'
  }
}).listen(8011);

</code></pre><p><a href=https://github.com/nodejitsu/node-http-proxy#setup-a-stand-alone-proxy-server-with-proxy-request-header-re-writing>https->http 或者 https->https</a> 配示例</p>
<h3 id=qs>Qs</h3>
<p><code>qs</code> 处理http参数的库，用上了很方便</p>
<h3 id=vue>Vue</h3>
<p>编程式的导航</p>
<pre tabindex=0><code>router.push({ path: 'home' })
</code></pre><p>自定义指令</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#8f5902;font-style:italic>// 注册一个全局自定义指令 v-focus
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Vue</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>directive</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;focus&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#8f5902;font-style:italic>// 当绑定元素插入到 DOM 中。
</span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>inserted</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>el</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>// 聚焦元素
</span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>el</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>focus</span><span style=color:#000;font-weight:700>()</span>
  <span style=color:#000;font-weight:700>}</span>
<span style=color:#000;font-weight:700>})</span>
</code></pre></div><h3 id=eslint>ESLint</h3>
<p><a href=http://eslint.cn/docs/rules/>Rules</a></p>
<h3 id=css-切图>CSS 切图</h3>
<p><a href=https://segmentfault.com/a/1190000009709719>页面制作（切图）第一章</a> 从sketch切图</p>
<p><a href=http://www.infoq.com/cn/articles/netease-ios-vision-to-app#anch136359>从视觉到App：网易有钱iOS项目切图与适配实践</a> 这个项目过程，谁做什么事情很清楚</p>
<p><a href=http://www.uisdc.com/sketch-canvas-smaller>为何sketch预置画布尺寸比真实分辨率小？</a> md再看</p>
<p><a href=https://jinlong.github.io/2015/05/24/css-retina-hairlines/>Retina屏的移动设备如何实现真正1px的线？</a> <code>TODO</code></p>
<p><a href=https://github.com/modood/Administrative-divisions-of-China>中华人民共和国行政区划：省份、城市、区县、乡镇（街道）</a> 很齐全呀</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-72467628488feb8684a76493e89c7548>8.17 - Daily 10/24</h1>
<h2 id=学习>学习</h2>
<h3 id=vue>Vue</h3>
<p>[form validation表单验证](<a href=https://www.zhihu.com/question/37099220>https://www.zhihu.com/question/37099220</a>） 使用va.js 方便验证</p>
<p><a href=https://cn.vuejs.org/v2/guide/custom-directive.html#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0>自定义指令</a> 各种参数说明</p>
<h3 id=csshtml>CSS+HTML</h3>
<p><a href=http://yijiebuyi.com/blog/957bfb7468d2cc53d72ddebc2b5d39d3.html>HTML5页面滑动到最底部触发内容加载 javascript实现</a></p>
<blockquote>
<p>文档高度 这是整个页面的高度
可视窗口高度 这是你看到的浏览器可视屏幕高度
滚动条滚动高度 滚动条下滑过的高度</p>
</blockquote>
<p><a href="http://blog.163.com/prevBlogPerma.do?host=zctya&srl=12091782010321346288&mode=prev">CSS: 解决Div float后，父Div无法高度自适应的问题 </a> 使用clear:both解决</p>
<h3 id=js>js</h3>
<p>箭头函数没有它自己的this值，箭头函数内的this值继承自外围作用域。<br>
<a href=http://www.infoq.com/cn/articles/es6-in-depth-arrow-functions>深入浅出ES6（七）：箭头函数 Arrow Functions</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-51864cb2d6aa3f64fe663dbf073b454f>8.18 - Daily 10/30</h1>
<h2 id=学习>学习</h2>
<h3 id=vue>Vue</h3>
<p>vue中input绑定回车事件</p>
<pre tabindex=0><code>@keyup.13=&quot;search&quot;
</code></pre><p><a href=http://www.cnblogs.com/lzrabbit/archive/2011/10/23/2221643.html>javascript 验证身份的有效性</a></p>
<h3 id=css>CSS</h3>
<p><code>:first-child</code> 使用:first-child伪类时一定要保证前面没有兄弟节点，把h1去掉就可以；或者使用div包住article，然后css：div article:first-child</p>
<p><a href=http://www.cnblogs.com/lovesueee/p/4618454.html>移动端高清、多屏适配方案</a> 1)Retina下图片高清问题, 2)retina下，border: 1px问题,3)多屏适配布局问题,</p>
<h3 id=python>python</h3>
<p>python 命令行传参，避免敏感信息硬编码在代码中</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>argparse</span>

<span style=color:#000>parser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>argparse</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ArgumentParser</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>description</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Process some integers.&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>parser</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add_argument</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;integers&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>metavar</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;N&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>nargs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;+&#39;</span><span style=color:#000;font-weight:700>,</span>
                    <span style=color:#000>help</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;an integer for the accumulator&#39;</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>args</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>parser</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>parse_args</span><span style=color:#000;font-weight:700>()</span>
</code></pre></div><p>split 第一个参数默认值、所有的空字符(空格、换行（\n)、制表符(\t), 第二个参数表示分隔次数</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87>str</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Line1-abcdef </span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>Line2-abc </span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>Line4-abcd&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87>print</span> <span style=color:#204a87>str</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>split</span><span style=color:#000;font-weight:700>(</span> <span style=color:#000;font-weight:700>);</span>
<span style=color:#204a87>print</span> <span style=color:#204a87>str</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>split</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39; &#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>  
<a href=http://python3-cookbook.readthedocs.io/zh_CN/latest/c02/p08_regexp_for_multiline_partterns.html>多行匹配模式</a><br>
这个问题很典型的出现在当你用点(.)去匹配任意字符的时候，忘记了点(.)不能匹配换行符的事实。<br>
re.compile() 函数接受一个标志参数叫 re.DOTALL</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>comment</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>re</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>compile</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>r</span><span style=color:#4e9a06>&#39;/\*(.*?)\*/&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>re</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>DOTALL</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h3 id=gerrit>Gerrit</h3>
<p><a href=http://gotgit.readthedocs.io/en/latest/05-git-server/055-gerrit.html>Gerrit代码审核服务器</a> 详细的文章介绍
<a href=http://whjgithub.github.io/2015/07/22/2015-07-22-225035/>Gerrit代码审查-简介</a></p>
<p><a href=https://stackoverflow.com/questions/14789666/import-repository-from-git-to-gerrit>git仓库导入到gerrit</a></p>
<blockquote>
<p>I imported many GIT projects to gerrit, the easiest way I found was to copy the xy.git Directory of the git repository to the directory where gerrit deposits the git repos. After restart of gerrit process the new project is in the list of new projects and you can edit description and access rights.</p>
</blockquote>
<p><a href=https://stackoverflow.com/questions/30503447/gerrit-admin-does-not-have-access-database-capability>Gerrit内置数据库H2访问权限修改</a>
修改project.config文件</p>
<pre tabindex=0><code>[capability]
       accessDatabase = group Administrators
</code></pre><p><a href=http://lipeng1667.github.io/2017/01/18/gerrit-guide/>Gerrit工作流程及使用手册</a> 介绍gerrit安装http</p>
<p><a href=http://www.vogella.com/tutorials/Gerrit/article.html#gerritsetup_repository>Gerrit英文学习资料</a></p>
<h3 id=git>GIT</h3>
<p>修改远程仓库地址：</p>
<pre tabindex=0><code>git remote set-url origin [url]

</code></pre>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d170c7dffbbbee2dd73fe23d5e9f7249>8.19 - Daily 1018 vim go + Ycm</h1>
<p>记录配置vim+go开发环境de折腾过程.</p>
<h2 id=输入点号后没有任何提示不知所措甚至怀疑就到这里了>输入".&ldquo;点号后没有任何提示,不知所措，甚至怀疑就到这里了。</h2>
<p>当没有日志，我无从下手解决问题。<br>
我更新了所有的go库，重装了go-code/vim-go，依然没有解决，没有给我任何错误提示。<br>
开始怀疑“人生苦短，我用python&rdquo;，<br>
不服输，爱折腾。</p>
<p>我重装了vim-go/ gocode之后，我开始怀疑ycm这个玩意。</p>
<p>原来真的是需要升级，而且安装时要注意go</p>
<p>"""
/.vim/bundle/YouCompleteMe$ ../install.sh &ndash;clang-completer &ndash;go-completer</p>
<p>"""
安装时，加上go-completer的参数</p>
<p>最后重启了 ycm服务器<br>
大功告成!!!</p>
<h2 id=参考>参考</h2>
<p><a href=https://github.com/fatih/vim-go/issues/659>Autocomplete stopped working</a> 当我看完这个时，我确定了gocode没有问题。问题可能在ycm;</p>
<p><a href=https://blog.csdn.net/haidonglin/article/details/78411968>YouCompleteMe 支持 golang vim 自动补全</a></p>
<p><a href=http://qwding.github.io/post/vim_golang/>用VIM写GOLANG踩坑</a> 这里提到为什么go自动提示的那么慢，原因就在go而非ycm, 最后autobuild的操作置为false</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-c121e9bd4252f17d6df7f51fad46f50a>8.20 - Daily 11.08 Docker安装</h1>
<h3 id=环境>环境</h3>
<pre tabindex=0><code>Distributor ID:	Ubuntu
Description:	Ubuntu 14.04.5 LTS
Release:	14.04
Codename:	trusty
</code></pre><h3 id=install>Install</h3>
<p><a href=https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/>Get Docker CE for Ubuntu</a> 官方教程</p>
<h4 id=安装前>安装前</h4>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sudo apt-get install <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  linux-image-extra-<span style=color:#204a87;font-weight:700>$(</span>uname -r<span style=color:#204a87;font-weight:700>)</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>  linux-image-extra-virtual

</code></pre></div><h3 id=docker>docker</h3>
<p><a href=https://yeasy.gitbooks.io/docker_practice/content/compose/yml_ref.md>docker中文教程</a> 初学者必看,很有用呀</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-64dc87cf8322fe024db1792709e6060b>8.21 - Daily 11/03</h1>
<h2 id=学习>学习</h2>
<h3 id=command-t>command-t</h3>
<p>mac 上command-t 依赖的ruby 的版本与vim的版本不一样：</p>
<ul>
<li>vim安装通过brew来安装的，依赖的brew中的ruby</li>
<li>command-t生成Makefile文件的时候依赖系统环境下ruby</li>
<li>系统环境下ruby根据$path路径查找:/usr/local/bin;/usr/bin等等</li>
<li>通过软链接brew下的ruby版本号到/usr/local/bin目录下即可，修改系统环境下ruby版本</li>
<li>重新编译，开始享受vim下查找文件的便利吧</li>
</ul>
<h3 id=gerrit>Gerrit</h3>
<p><a href=http://zengestudy.blog.51cto.com/1702365/1774176>Gerrit 权限控制详细介绍</a> forge author,和 forge committer这个有用</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-57b85631ef070b92b6eaadec0585d0ce>8.22 - Daily 1104</h1>
<h2 id=学习>学习</h2>
<h3 id=gerrit>Gerrit</h3>
<p><a href=http://zengestudy.blog.51cto.com/1702365/1774176> 5、Gerrit权限控制</a> 详细的权限控制<br>
<a href=http://www.vogella.com/tutorials/Gerrit/article.html#gerrit_problems>Gerrit code review - Tutorial</a> 留着慢慢看吧</p>
<h3 id=python>Python</h3>
<p><a href=https://stackoverflow.com/questions/18176733/python-xml-pretty-print-not-working>python xml pretty print not working</a> 配置xml字符解析</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>
<span style=color:#000>mport</span> <span style=color:#000>StringIO</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>lxml.etree</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>etree</span>

<span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>prettify</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xml_text</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#4e9a06>&#34;&#34;&#34;Pretty prints xml.&#34;&#34;&#34;</span>
    <span style=color:#000>parser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>etree</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>XMLParser</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>remove_blank_text</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>file_obj</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>StringIO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>StringIO</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>xml_text</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000>tree</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>etree</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>file_obj</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>parser</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>etree</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>tostring</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tree</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>pretty_print</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>)</span>

</code></pre></div><h3 id=web>Web</h3>
<p><a href=https://docs.docker.com/engine/installation/#supported-platforms>页面anchor随着内容变化</a> 这个很有必要，当内容太长的时候</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-6df3950e09f1ed7855c966a0b3a9511d>8.23 - Daily 1110 DOCKER部署实践总结</h1>
<h2 id=学习>学习</h2>
<p>总算把docker整完了</p>
<h3 id=dockerfile>Dockerfile</h3>
<p>镜像构建文件，</p>
<blockquote>
<p>Dockerfile 是一个文本文件，其内包含了一条条的指令(Instruction)，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</p>
</blockquote>
<p><a href=https://github.com/yeasy/docker_practice/tree/master/image/dockerfile>docker_practice github 上dockerfile中文介绍</a> 讲的很详细</p>
<p>查看别人是怎么写Dockerfile：上docker hub上搜索官方的镜像，对应有github仓库地址，查看构建文件.<br>
比如redis构建文件Dockerfile: <a href=https://github.com/docker-library/redis/blob/29b44c477011c5450dd89fd41af4c04e0c71e5b2/4.0/32bit/Dockerfile>Dockerfile</a></p>
<p>看完就知道redis的数据库文件放在什么位置，redis配置文件在哪里，然后可以数据迁移了</p>
<h3 id=redis>redis</h3>
<p><a href=https://mengkang.net/424.html>redis 数据迁移笔记</a></p>
<h3 id=docker-compose>docker-compose</h3>
<p>为什么容器服务器启动了，<code>docker-compose ps </code> 查看端口也打开，为什么连接的时候出现connect refused.</p>
<pre tabindex=0><code>docker rm 容器
</code></pre><p>然后build过程中加上 &ndash;no-cache</p>
<h3 id=docker>Docker</h3>
<p>为了检查构建的镜像是否成功，需要进入容器检查文件
问题是如何进Docker容器了：</p>
<p><a href=http://warjiang.github.io/devcat/2016/11/28/%E5%87%A0%E7%A7%8D%E8%AE%BF%E9%97%AEDocker%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%B9%E6%B3%95/> 几种访问Docker容器的方法</a></p>
<p>attach 居然卡死，不知道为何/</p>
<p>换种方式,</p>
<pre tabindex=0><code>//查看已经在运行的容器ID
docker ps -a
//通过exec命令对指定的容器执行bash
docker exec -it 31ced27e1684 /bin/bash

</code></pre><p><a href=https://github.com/qianlei90/Blog/issues/35>深入了解DOCKER</a> 深入，<code>TODO</code></p>
<h3 id=docker-nginx>Docker nginx</h3>
<p>需要知道nginx默认配置文件，将自己的配置文件复制粘贴进去</p>
<h3 id=docker-mysql>Docker mysql</h3>
<p><a href=http://www.51woshou.com/?p/6c202e1c3d61>在docker中运行sql文件</a></p>
<p>还有个问题，mysql密码怎么设置，免密码失效</p>
<pre tabindex=0><code>RROR 2002 (HY000): Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' (2
</code></pre><p>解决办法是指定<br>
mysql -h localhost -P 3306 &ndash;protocol=tcp -u root</p>
<p><a href=https://github.com/cloudposse/mysql>导入mysql数据的脚本</a> 直接的学习 <code>TODO</code></p>
<h3 id=tornado-redis>Tornado redis</h3>
<p>怎么在Tornado中写redis
<a href=https://github.com/leporo/tornado-redis/blob/master/demos/sockjs/app.py>tornado-redis</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-4e1ee5882d9e62d65822dde8d3e442ea>8.24 - Daily 1116</h1>
<h2 id=学习>学习</h2>
<h3 id=docker>Docker</h3>
<p>Build, Ship, and Run Any App, Anywhere</p>
<p><a href=https://docs.docker.com/engine/admin/start-containers-automatically/>Use a restart policy</a> 重启规则：</p>
<p>1） no\no-failure\unless-stopped\always <code>TODO</code> on-failure\always 有什么区别</p>
<p><a href=http://wiki.jikexueyuan.com/project/docker-technology-and-combat/supervisor.html>docker 使用 supervisor</a> 配置supervisor在前台运行</p>
<pre tabindex=0><code>[supervisord]
nodaemon=true
</code></pre><p>第一段 supervsord 配置软件本身，使用 nodaemon 参数来运行</p>
<p><a href=https://docs.docker.com/engine/admin/multi-service_container/>Run multiple services in a container</a> 借助了supervisor</p>
<p><a href=https://www.systutorials.com/qa/56/howto-ssh-automatically-add-new-hosts-to-the-list-known-hosts>Howto: ssh automatically add new hosts to the list of known hosts</a> 配置ssh 解决首次登录时候需要加入known hosts的问题</p>
<pre tabindex=0><code>Host 10.*
   StrictHostKeyChecking no
</code></pre><p><a href=https://docs.docker.com/compose/compose-file/compose-file-v2/>Compose file 文档</a></p>
<p><a href=http://blog.csdn.net/scholar_ii/article/details/72191042>如何告诉git哪个私钥要使用？</a> 最终还是直接使用.ssh/id_rsa默认的私钥了</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-163d016ec3b8a0cea24d349cd91a92d0>8.25 - Daily 1127 MYSQL </h1>
<p><a href=https://www.awaimai.com/1578.html>选择性复制表数据</a> 这个可, 数据库批量处理必备</p>
<h2 id=亿级数据库设计>亿级数据库设计</h2>
<p>详细见 <a href=https://article.itxueyuan.com/7JAoD>千万级汇总查询优化</a></p>
<p><a href=https://cloud.tencent.com/developer/article/1456270>基于Mysql数据库亿级数据的设计</a></p>
<blockquote>
<p>Mysql 单标可以存储10亿级的数据，但这个时候性能非常，项目中大量的实验证明，Mysql单表容量在500万左右，性能处于最佳状态。</p>
</blockquote>
<p>一张表无法搞定，那么</p>
<h3 id=解决办法>解决办法</h3>
<h4 id=分区>分区</h4>
<p>根据<strong>查询索引列</strong>将单表进行分区，当然这些变化对应用层是无法感知的。</p>
<table>
<thead>
<tr>
<th>分区类型</th>
<th>说明</th>
<th>使用频率</th>
</tr>
</thead>
<tbody>
<tr>
<td>Range 分区</td>
<td>根据数值范围，根据时间区间或 ID 区间来切分</td>
<td>较多</td>
</tr>
<tr>
<td>List 分区</td>
<td>离散值集合</td>
<td>较少</td>
</tr>
<tr>
<td>Hash 分区</td>
<td>根据数值取模</td>
<td>较多</td>
</tr>
<tr>
<td>KEY 分区</td>
<td>KEY 分区支持 text 和 BLOB， KEY 分区不允许用用户自定义的表达式分区。</td>
<td>较少</td>
</tr>
</tbody>
</table>
<ul>
<li>Hash 分区，基于给定的分区个数，将数据分配到不同的分区。例如会员表的这种表。 HASH 分区只能针对整数进 HASH，对于非整形的字段只能通过表达式将其转换为整数。</li>
</ul>
<blockquote>
<p>如果基于绑定编号（ID）来做range或者list分区，绑定编号没有实际的业务含义，无法通过它进行查询， 因此，我们剩下了HASH分区和Key分区，HASH分区仅支持int类型的列的分区，且是其中的一列。 如果基于绑定的时间列进行分区，查询依然很慢。基于搜索列来进行分区，可以保证查询的速度。</p>
</blockquote>
<h4 id=分库>分库</h4>
<p>垂直分库：根据业务的耦合性，将关联度低的不同表存储在不同的数据库，以达到资源的饱和利用率。这样每个微服务系统使用独立的一个数据库。</p>
<h4 id=分表>分表</h4>
<p>分表分为水平分表和垂直分表（也能避免跨页问题）<sup>[7]</sup>。</p>
<blockquote>
<p>MySQL 底层是通过数据页存储的，一条记录占用空间过大会导致跨页，造成额外的性能开销。另外数据库以行为单位将数据加载到内存中，这样表中字段长度较短且访问频率较高，内存能加载更多的数据，命中率更高，减少了磁盘IO，从而提升了数据库性能。</p>
</blockquote>
<p>在业务层增加一张业务和数据存储的表之间的关系表，比如在此方案<sup>[4]</sup>中增加了 <strong>设备-动态数据关系表（表名t_device_table_map）</strong> 来存储设备和动态数据表的关系。</p>
<p>最后，梳理下分表 VS 分区</p>
<ul>
<li>分区就是水平分表的数据库实现版本，水平分表的优点是可以将单张表的数据切分到多个服务器上，每个服务器具有相应的库和子表。</li>
<li>分区只是一张表中的数据和索引的存储位置发生变化，分表是真实的有多套表的配置文件</li>
<li>分区没法突破数据库层面，而分表可以将子表分配在同一个库中，也可以分配在不同的库中。</li>
</ul>
<h4 id=nosqlnewsql-todo>NoSql/NewSql #TODO</h4>
<h2 id=index-scan-vs-bitmap-scan-vs-sequuentianl-scan>Index scan vs Bitmap scan vs Sequuentianl scan</h2>
<p>PostgreSQL will first scan the index and compile those rows / blocks, which are needed at the end of the scan. Then PostgreSQL will take this list and go to the table to really fetch those rows. The beauty is that this mechanism even works if you are using more than just one index.<sup>[1]</sup></p>
<p><img src=https://www.cybertec-postgresql.com/wp-content/uploads/2018/01/03_PostgreSQL-Bitmap-scan.jpg alt="PostgreSQL Bitmap-scan"></p>
<h2 id=联合索引>联合索引</h2>
<p>回表，在执行计划中，table access by index rowid 代表是回表动作。</p>
<p>联合索引的理解<sup>[6]</sup>: 联合索引结构也是 B+Tree，即按照第一个关键字进行索引，然后在叶子节点上按照第一个关键字、第二个关键字、第三个关键字&mldr;进行排序。</p>
<p>最左原则。</p>
<p>如何设计之一： 等值查询中，查询条件a返回的条目比较多，查询条件b返回的条目比较多，而同时查询a、b返回的条目比较少，那么适合建立联合索引；</p>
<p>如何设计之二： 等值查询、范围查询，等值查询的列建在前、范围查询的列建在后。</p>
<h2 id=其他>其他</h2>
<p>导出数据库</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mysqldump -u root -p news &gt; news.sql
</code></pre></div><p><a href=http://sunnyingit.github.io/book/section_python/SQLalchemy-session.html>sqlalchemy session</a> 详细介绍sqlalchemy session 几种状态，以及最佳实践。</p>
<h2 id=docker>Docker</h2>
<p><a href=https://docs.docker.com/engine/reference/commandline/rm/>docker 使用</a> docker 命令使用</p>
<p>Docker: Are you trying to connect to a TLS-enabled daemon without TLS?</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo docker images
</code></pre></div><p>export save 区别</p>
<p><a href=https://docs.docker.com/engine/reference/commandline/export/>docker export</a> Export a container’s filesystem as a tar archive<br>
<a href=http://www.jianshu.com/p/8408e06b7273>Docker images导出和导入</a> 实践</p>
<h2 id=bash>BASH</h2>
<p>tar 压缩文件夹，exclude排除文件</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tar --exclude<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;./folder1&#39;</span>--exclude<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;./folder&#39;</span> --exclude<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;./upload/folder2&#39;</span> -zcvf /backup/filename.tgz .
</code></pre></div><p><a href=https://cn.vuejs.org/v2/guide/render-function.html>VUE 渲染函数</a></p>
<h2 id=参考>参考</h2>
<p>[1] Hans-Jürgen Schönig: POSTGRESQL INDEXING: INDEX SCAN VS. BITMAP SCAN VS. SEQUENTIAL SCAN (BASICS)</p>
<p>[2] zhanlijun 的博客园: 位图索引:原理（BitMap index）</p>
<p>[3] Markus Winand: Pagination Done the Right Way(PPT)</p>
<p>[4] Chaexsy 掘金: MySql 数据库分表分区实践</p>
<p>[5] 茶谪仙 掘金： 数据库分区一篇就透了</p>
<p>[6] houbb: 数据库索引-07-联合索引</p>
<p>[7] PHP 架构师布乐： Mysql 的分区/分库/分表总结</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-0f7abe9fd840584d9989a663fa49cc9c>8.26 - Daily 1208</h1>
<div class=lead>这段时间太忙了,忙不是理由，chrome tab 都推挤密密麻麻了</div>
<h2 id=学习>学习</h2>
<h3 id=docker>Docker</h3>
<p><a href=https://runnable.com/docker/docker-compose-networking>docker 网络</a> 得仔细学习～，使用自定义的网络,&ndash;link不生效，有依赖的docker容器启动时
提示没办法找到服务</p>
<p><a href=https://github.com/docker/compose/issues/982>Setting mac address for container</a> docker还可以固定mac地址，mac地址都有了安全很重要</p>
<p><a href=https://www.poftut.com/get-docker-container-ip-mac-address/>How To Get Docker Container Ip and Mac Address</a> 查询ip地址与mac地址</p>
<p><a href=https://gerrit.googlesource.com/docker-gerrit/>docker 下部署gerrit</a> 这个非常方便，一键搞定</p>
<h3 id=积累>积累</h3>
<p>几十个tab下来都是docker的内容，最近被docker折腾的死去活来，要固定ip，要固定mac地址, 最后还是因为网络无办法访问取消了。</p>
<p>开始改bug</p>
<h3 id=感情>感情</h3>
<p>压力山大</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-1b89093d737fb3e3735edc770710201b>8.27 - Daily 1215</h1>
<h2 id=学习>学习</h2>
<h3 id=understanding-rest>Understanding REST</h3>
<p>Principles of REST:</p>
<ul>
<li><strong>Resources</strong> expose easily understood directory structure URIs.</li>
<li><strong>Representations</strong> transfer JSON or XML to represent data objects and attributes.</li>
<li><strong>Messages</strong> use HTTP methods explicitly (for example, GET, POST, PUT, and DELETE).</li>
<li><strong>Stateless</strong> interactions store no client context on the server between requests. State dependencies limit and restrict scalability. The client holds session state.</li>
</ul>
<p><strong>Idempotency</strong> 新词，中文翻译过来是：冪等, 这是put与post的最大的区别</p>
<blockquote>
<p>idempotent 的意思是如果相同的操作再執行第二遍第三遍，結果還是跟第一遍的結果一樣 (也就是說不管執行幾次，結果都跟只有執行一次一樣)。</p>
</blockquote>
<h3 id=vue>Vue</h3>
<p><a href=https://vuejs.org/v2/guide/components.html#Async-Components>Vue Async Components</a> 异步加载组件</p>
<pre tabindex=0><code>Vue.component('async-webpack-example', function (resolve) {
  // This special require syntax will instruct Webpack to
  // automatically split your built code into bundles which
  // are loaded over Ajax requests.
  require(['./my-async-component'], resolve)
})
</code></pre><p>但是，如下webpack 2 + ES2015代码却不行了</p>
<pre tabindex=0><code>Vue.component(
  'async-webpack-example',
  // The `import` function returns a `Promise`.
  () =&gt; import('./my-async-component')
)
</code></pre><p><code>TODO</code></p>
<h3 id=vim>vim</h3>
<p><a href=https://github.com/Valloric/YouCompleteMe#full-installation-guide>YCM vue不支持</a> 打开vue文件导致ycm server挂了，没找到合适的办法解决<br>
目前手动启动ycm server:<code>YcmRestartServer</code></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-e8bc88a079e7284d75958ee9e69d263e>8.28 - Daily 1229</h1>
<p><a href=https://chase-seibert.github.io/blog/2010/07/23/django-zip-files-create-dynamic-in-memory-archives-with-pythons-zipfile.html>Django zip files (create dynamic in-memory archives with Python’s zipfile)</a> 动态打包文件 并输出到浏览器端</p>
<pre tabindex=0><code>
from StringIO import StringIO
from zipfile import ZipFile
from django.http import HttpResponse

def download(request, company_id):

    in_memory = StringIO()
    zip = ZipFile(in_memory, &quot;a&quot;)

    zip.writestr(&quot;file1.txt&quot;, &quot;some text contents&quot;)
    zip.writestr(&quot;file2.csv&quot;, &quot;csv,data,here&quot;)

    # fix for Linux zip files read in Windows
    for file in zip.filelist:
        file.create_system = 0

    zip.close()

    response = HttpResponse(mimetype=&quot;application/zip&quot;)
    response[&quot;Content-Disposition&quot;] = &quot;attachment; filename=two_files.zip&quot;

    in_memory.seek(0)
    response.write(in_memory.read())

    return response
</code></pre><h2 id=using-the-forwarded-header>Using the Forwarded header</h2>
<pre tabindex=0><code>proxy_set_header Forwarded $proxy_add_forwarded;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</code></pre><p>获取真实的地址：
<a href=https://stackoverflow.com/questions/3110919/how-do-i-get-the-client-ip-of-a-tornado-request>How do I get the client IP of a Tornado request?</a></p>
<pre tabindex=0><code>x_real_ip = self.request.headers.get(&quot;X-Real-IP&quot;)
remote_ip = x_real_ip or self.request.remote_ip
</code></pre>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-cd168b78dd4295e42ebc6ea7c8951f33>8.29 - Daily 2021/11/01 Postive Discipline</h1>
<h2 id=正面管教的原则>正面管教的原则</h2>
<h3 id=正面管教构成的要素>正面管教构成的要素</h3>
<ul>
<li>相互尊重</li>
<li>理解行为背后的信念</li>
<li>理解孩子的发展和适龄行为。</li>
<li>有效的沟通</li>
<li>能教给孩子技能的管教</li>
<li>专注于解决方案，而非惩罚</li>
<li>鼓励</li>
<li>孩子在感觉更好时才会做的更好。</li>
</ul>
<h3 id=应当避免的管教方式>应当避免的管教方式</h3>
<p>如果你在对孩子大声喊叫或说教，请停下来。如果你在孩子的屁股或打手心，请停下来。如果你在试图通过威胁、警告、贿赂或说教让孩子顺从，请停下来。 所有这些方式都是不尊重的，并且会导致孩子的怀疑、羞愧、内疚，不仅在当时，而且包括未来。</p>
<h3 id=孩子真正需要的是什么>孩子真正需要的是什么？</h3>
<ol>
<li>归属感（情感联结）</li>
<li>个人的力量和自主（有能力）</li>
<li>社会和人生技能（有贡献）</li>
<li>和善而坚定的指导，教给孩子的技能的管教（以尊严和尊重的方式）</li>
</ol>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-a6591dd7049ab03f1d864f15c9b03dac>8.30 - Daily 2022/01/13</h1>
<p>PPT 养成日记</p>
<p>写PPT还是非常耗时的, 一张 PPT 已经修改了100多个版本了。</p>
<p>那如何写好每一张 PPT 呢？ 就是如何制作一张漂亮的网页一样。</p>
<h2 id=配色>配色</h2>
<h2 id=内容框架>内容框架</h2>
<h2 id=每一张-ppt-的构图>每一张 PPT 的构图</h2>
<p>这里有很多模版可以参考，比如 slide team 上虽然是收费的，但是上面的画图思路很值得学习。</p>
<h2 id=参考>参考</h2>
<p>[1] PPT 作图思路 <a href=https://www.slideteam.net/>https://www.slideteam.net/</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d7217e8c6dcba63b859a27c5f6578cf8>8.31 - Daily 5/31</h1>
<h3 id=此时>此时</h3>
<p>今天是2017年前半年最后一天了，时间真快，过年前大家还在说2017年要实现什么目标，可是我真的没离目标靠近了多少，真伤感。偶尔我真的大叫一声释放下此时的压力。</p>
<h3 id=此事>此事</h3>
<p>事业：1、办公家具事情在开年出现几次问题，其中最大问题是工厂发出的货是次品，让我产生想退出办公家具贸易，做自己的产品，从而把控生产质量与包装，减少售后；2、做外贸树脂产品、现在一个月出几单实在让人头疼，接下来走多平台多流量；3、WISH一个店铺因为发货太慢每况愈下，其他店铺正在审核或在上架产品。4、 偶尔又想去上班、今天试着让微信朋友投了一份简历出去。5、每天工作到6-7点就感觉要去跑步锻炼了，不然头晕。<br>
感情：事业压力大，偶尔不想去碰感情的事情，回头一想年纪也算大了，得抓紧时间了</p>
<h3 id=以后>以后</h3>
<p>选产品上架出单，不断学习，或工作或继续外贸内贸，感觉后者几率大一些，加油呀！</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-0a97a012d24ad5724bc2bb78e1c4660f>8.32 - Daily 6/1</h1>
<h3 id=流水账>流水账</h3>
<p>今天上午完成30个产品上传，舒爽！明天坚持30个&mldr;<br>
下午胡思乱想网络传真服务的事情：是否进入做：</p>
<ol>
<li>一个月销售额4万，成本一万，月赚3万。</li>
<li>传真是个没落行业，市场需要就那么大，再进去做顶多做到一半的市场，2万！才两万！除去成本没剩多少了</li>
<li>以最低的成本找人一起做这个服务。</li>
</ol>
<p>打包发货开关贴，包装跟产品一样重量，要减重减重减重<br>
晚上加班制作视频，还是不太熟练Ulead Video Studio 11，摸索摸索。明天正确把视频做出来，接下来拍照开关贴
回来俯卧撑，涡轮推，倒立，洗澡睡觉<br>
嘴角上火，吃粽子吃多了，饮食乱了。</p>
<h4 id=六一快乐一去不复返的时间--看了别人上川岛的露营照片景真是美等着忙完就去>六一快乐，一去不复返的时间 | 看了别人上川岛的露营照片，景真是美，等着，忙完就去</h4>
<h2 id=多年以后回想此时此情此事>多年以后回想此时此情此事</h2>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-0b39f164c21923e4713cfe173a4d8037>8.33 - Daily 6/3</h1>
<h3 id=ulead-video-studio-视频中音频处理>Ulead Video Studio 视频中音频处理</h3>
<p>今天抽空对视频的声音进行优化：整个视频由图片以及拍摄的视频组成，当播放从图片到录制视频之间，
声音是突然地从无到有过程，感觉很不协调，正常应该是从无开始、声音慢慢变大、到最大持续、最后随着结束慢慢变小、最后没有声音的过程。而Ulead Video Studio中<code>fade in</code> & <code>fade out</code> 很好的处理这个需求，而且可以调整声音变化的快慢<br>
总算认真学习了《会声会影 11 教学影片大纲：第三单元 影片剪接与素材调整》 这个课程真的很实用，
台湾课程，非常赞，再学习其他单元（为了打开MDF、MDS文件，也是找遍了大半个百度，也算值了，教程这么好）<br>
视频制作告一段落！</p>
<h3 id=计划>计划</h3>
<p><strong>亚马逊平台</strong>：开2-3款树脂产品<br>
<strong>WISH平台</strong>： 继续每天30款产品上架（MD今天偷懒了，明天继续)<br>
<strong>淘宝平台</strong>：家具产品</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-83405704c229ae1f822f152500ebd082>8.34 - Daily 9/11</h1>
<h2 id=学习>学习</h2>
<h3 id=nerdtree>NERDTree</h3>
<p>隐藏指定后缀名的文件</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>let</span> <span style=color:#000>NERDTreeIgnore</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;\.pyc$&#39;</span><span style=color:#000;font-weight:700>]</span>
</code></pre></div><h3 id=ctrlsf>Ctrlsf</h3>
<p>In CtrlSF Window:</p>
<ul>
<li><code>O</code> - Like <code>Enter</code> but always leave CtrlSF window opening.</li>
<li><code>t</code> - Like <code>Enter</code> but open file in a new tab.</li>
</ul>
<pre tabindex=0><code>nnoremap &lt;C-F&gt;t :CtrlSFToggle&lt;CR&gt;
inoremap &lt;C-F&gt;t &lt;Esc&gt;:CtrlSFToggle&lt;CR&gt;
</code></pre><h3 id=command-t>Command-t</h3>
<p>检索出文件，需要在新的split window打开文件</p>
<pre tabindex=0><code>&lt;C-CR&gt;      open the selected file in a new split window
&lt;C-s&gt;       open the selected file in a new split window
&lt;C-v&gt;       open the selected file in a new vertical split window
&lt;C-t&gt;       open the selected file in a new tab
</code></pre><h3 id=vim>vim</h3>
<h4 id=split>split</h4>
<ul>
<li><code>Ctrl-w =</code> resize 所有的窗口一样大小</li>
<li><code>Ctrl-w |</code> 宽度最大化</li>
<li><code>Ctrl-w _</code> 高度最大化</li>
</ul>
<h4 id=search>search</h4>
<pre tabindex=0><code>:noh
</code></pre><p>turn off highlighting util the next search</p>
<h3 id=ycm>ycm</h3>
<p>选择快捷键</p>
<pre tabindex=0><code>let g:ycm_key_list_select_completion = ['&lt;TAB&gt;', '&lt;Down&gt;']
</code></pre><h3 id=sqlachemy>SQLachemy</h3>
<p><a href="https://bitbucket.org/zzzeek/pycon2014_atmcraft/src/f50cbe745a19?at=master">atmcraft</a> model 目录下的meta是做什么用的</p>
<h3 id=tornado>Tornado</h3>
<p><a href=https://github.com/puentesarrin/selene/tree/44bb9ef98627a2b581dca9fe78dab6852472b8ff>selene</a> 案例学习，集成数据库monogoDB异步查询 <code>代码阅读</code><br>
<a href=https://github.com/no13bus/ohmyrepo>ohmyrepo</a> 简单的案例，集成了Cache。 <code>代码阅读</code></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-a9ba4dfbcd416be7150b8304aa335be1>8.35 - Daily 9/12</h1>
<h2 id=学习>学习</h2>
<h3 id=bash-history>Bash History</h3>
<p>修改命令记录数量</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#204a87>export</span> <span style=color:#000>HISTFILESIZE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10000</span>
<span style=color:#204a87>export</span> <span style=color:#000>HISTSIZE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1000</span>
</code></pre></div><h3 id=mac-terminal-tab>MAC Terminal TAB</h3>
<p>tab切换快捷键
<code>Command + shit + {</code>或<code>Command + Shit + ←</code> 向左切换<br>
<code>Command + shit + }</code>或<code>Command + Shit + →</code> 向左切换</p>
<h3 id=gerrit>Gerrit</h3>
<p><code>gerrit query</code> Query the change database <a href=https://git.eclipse.org/r/Documentation/cmd-query.html>gerrit query</a><br>
<a href=https://stackoverflow.com/questions/22264533/obtain-the-latest-refspec-on-a-gerrit-change>gerrit query : Obtain the latest refspec on a Gerrit Change</a> 详细讲解gerrit query<br>
<code>gerrit stream-events</code> 提交事件<br>
<a href=https://gerrit-review.googlesource.com/Documentation/cmd-stream-events.html>gerrit stream-events</a> Provides a portal into the major events occurring on the server, outputting activity data in real-time to the client. Events are filtered by the caller’s access permissions, ensuring the caller only receives events for changes they can view on the web, or in the project repository.</p>
<h3 id=git>GIT</h3>
<h4 id=git_ssh_command>GIT_SSH_COMMAND</h4>
<p>用于git ssh链接访问仓库时，默认设置<br>
<a href=https://git-scm.com/docs/git#git-codeGITSSHCOMMANDcode>GIT_SSH_COMMAND</a> $GIT_SSH_COMMAND takes precedence over $GIT_SSH, and is interpreted by the shell, which allows additional arguments to be included.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#000>GIT_SSH_COMMAND</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;ssh -i %s&#39;</span> git fetch 
</code></pre></div><h4 id=fetch_head>FETCH_HEAD</h4>
<p><a href=https://ruby-china.org/topics/4768>FETCH_HEAD</a> 指的是: 某个branch在服务器上的最新状态'. 每一个执行过fetch操作的项目&rsquo;都会存在一个FETCH_HEAD列表, 这个列表保存在 .git/FETCH_HEAD 文件中, 其中每一行对应于远程服务器的一个分支. 当前分支指向的FETCH_HEAD, 就是这个文件第一行对应的那个分支.</p>
<h3 id=vim>Vim</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#000;font-weight:700>:</span><span style=color:#000>set</span> <span style=color:#000>wrap</span> <span style=color:#8f5902;font-style:italic>&#34;设置自动换行</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#000;font-weight:700>:</span><span style=color:#000>set</span> <span style=color:#000>nowrap</span> <span style=color:#8f5902;font-style:italic>&#34;设置不自动换行</span><span style=color:#a40000>
</span></code></pre></div><h3 id=python>Python</h3>
<p><code>rfind</code> returns the last index whre the substring is found, or -1 if no such index exists</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87>str</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>rfind</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>str</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>beg</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000>end</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>string</span><span style=color:#000;font-weight:700>))</span>
</code></pre></div><p>获取当前时间的时间戳</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>time</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>())</span>
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-5abb1d58ec4fe4729ab279df0840251d>8.36 - Daily 9/13</h1>
<h2 id=学习>学习</h2>
<h3 id=python>Python</h3>
<h4 id=super>super</h4>
<p><a href=https://laike9m.com/blog/li-jie-python-super,70/>理解 Python super</a> 不要一说到 super 就想到父类！super 指的是 MRO 中的下一个类！</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Root</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87>object</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;this is Root&#34;</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>B</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Root</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;enter B&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#8f5902;font-style:italic># print(self)  # this will print &lt;__main__.D object at 0x...&gt;</span>
        <span style=color:#204a87>super</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>B</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__init__</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;leave B&#34;</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>C</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Root</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>__init__</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
        <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;enter C&#34;</span><span style=color:#000;font-weight:700>)</span>
        <span style=color:#204a87>super</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>C</span><span style=color:#000;font-weight:700>,</span> <span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__init__</span><span style=color:#000;font-weight:700>()</span>
        <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;leave C&#34;</span><span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>D</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>B</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>C</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>pass</span>

<span style=color:#000>d</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>D</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>d</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__class__</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__mro__</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><h4 id=mixin>mixin</h4>
<p><a href=http://www.jianshu.com/p/933a22ac0eb7>Python mixin模式</a> Python的Mixin模式可以通过多继承的方式来实现</p>
<h3 id=vim>Vim</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>g</span>:<span style=color:#000>UltiSnipsExpandTrigger</span><span style=color:#000;font-weight:700>=</span><span style=color:#4e9a06>&#34;&lt;c-j&gt;&#34;</span><span style=color:#a40000>
</span></code></pre></div><p><a href=https://github.com/sirver/ultisnips>ultisnips</a> 自动完成跟YCM的<code>&lt;tab></code>快捷键冲突<br>
<a href=http://mednoter.com/UltiSnips.html>UltiSnips 让 Vim 飞起来</a> vim snippets详细设置过程</p>
<h3 id=andoid>Andoid</h3>
<p><a href=https://looksok.wordpress.com/2014/07/12/compile-gradle-project-with-another-project-as-a-dependency/>Compile gradle project with another project as a dependency</a> 编译两个独立的项目，需要制定依赖的路径<br>
<a href=https://docs.gradle.org/current/userguide/dependency_management.html>Dependency Management</a> Gradle依赖</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-78e7f3d24a774bffb8590129b266410b>8.37 - Daily 9/14</h1>
<h2 id=学习>学习</h2>
<h3 id=vue>Vue</h3>
<p><a href=https://github.com/Andiedie/vue-history-api-fallback>vue-history-api-fallback</a> 解决url中包含句的问题</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>history</span><span style=color:#000;font-weight:700>({</span>
  <span style=color:#000>router</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>disableDotRule</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span>
<span style=color:#000;font-weight:700>});</span>
</code></pre></div><h3 id=webpack>webpack</h3>
<p>利用<code>historyApiFallback</code>选项，可以重写url</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>historyApiFallback</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>rewrites</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
        <span style=color:#8f5902;font-style:italic>// shows views/landing.html as the landing page
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>from</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>/^\/$/</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>to</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;/views/landing.html&#39;</span> <span style=color:#000;font-weight:700>},</span>
        <span style=color:#8f5902;font-style:italic>// shows views/subpage.html for all routes starting with /subpage
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>from</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>/^\/subpage/</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>to</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;/views/subpage.html&#39;</span> <span style=color:#000;font-weight:700>},</span>
        <span style=color:#8f5902;font-style:italic>// shows views/404.html on all other pages
</span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000;font-weight:700>{</span> <span style=color:#000>from</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>/./</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>to</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;/views/404.html&#39;</span> <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>],</span>
<span style=color:#000;font-weight:700>},</span>
</code></pre></div><h3 id=javascript>Javascript</h3>
<p><code>import</code> <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import>用法</a> used to import functions, objects, or primitives which are defined in and exported by an external module, script, or the like.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>defaultMember</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>as</span> <span style=color:#000>name</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>member</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>member</span> <span style=color:#000>as</span> <span style=color:#000>alias</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>member1</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#000>member2</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>member1</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#000>member2</span> <span style=color:#000>as</span> <span style=color:#000>alias2</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[...]</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>defaultMember</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>member</span> <span style=color:#000;font-weight:700>[</span> <span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>[...]</span> <span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>defaultMember</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>as</span> <span style=color:#000>name</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;module-name&#34;</span><span style=color:#000;font-weight:700>;</span>
</code></pre></div><h3 id=tornado>Tornado</h3>
<p><a href=http://www.nowamagic.net/academy/part/13/325/>Python与Tornado</a> 一个系列 抽时间通读 <code>#TODO</code></p>
<h3 id=python>Python</h3>
<p><a href=https://stackoverflow.com/questions/1549801/differences-between-isinstance-and-type-in-python>Differences between isinstance() and type() in python</a> isinstance与type</p>
<p><a href=https://stackoverflow.com/questions/6159900/correct-way-to-write-line-to-file-in-python>Correct way to write line to file in Python</a> print也可以写入文件里</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-0fb0beed72ec94421cecb4332c0f17f6>8.38 - Daily 9/18</h1>
<h2 id=学习>学习</h2>
<h3 id=redis>redis</h3>
<p><a href=https://segmentfault.com/a/1190000005052628>Redis持久化-RDB与AOF</a> 同一个redis实例可以配置两种持久化方案<br>
<a href=https://www.douban.com/group/topic/15516593/>Redis 查询所有的key</a> 查询所有的key<br>
<a href=https://segmentfault.com/a/1190000002906345>Redis持久化</a> redis持久化两种方式的对比</p>
<h3 id=python-重命令>python 重命令</h3>
<p><a href=https://stackoverflow.com/questions/8735312/how-to-change-folder-names-in-python>os.rename</a> How to change folder names in python?</p>
<h3 id=vim>Vim</h3>
<p><a href=http://973797893.blog.51cto.com/3057158/1725780>mac vim 配置文件</a> mac vim 记住上次打开的位置</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#000>set</span> <span style=color:#000>viminfo</span><span style=color:#000;font-weight:700>=</span>&#39;<span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span>\&#34;<span style=color:#0000cf;font-weight:700>100</span><span style=color:#000;font-weight:700>,</span>:<span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>,</span>%<span style=color:#000;font-weight:700>,</span><span style=color:#000>n</span><span style=color:#000;font-weight:700>~</span>/.<span style=color:#000>viminfo</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#000>au</span> <span style=color:#000>BufReadPost</span> * <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>line</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;\&#34;&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>|</span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>line</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;\&#34;&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>&lt;=</span> <span style=color:#000>line</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;$&#34;</span><span style=color:#000;font-weight:700>)|</span><span style=color:#000>exe</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;norm &#39;\&#34;&#34;</span><span style=color:#000;font-weight:700>)|</span><span style=color:#204a87;font-weight:700>else</span><span style=color:#000;font-weight:700>|</span><span style=color:#000>exe</span> <span style=color:#4e9a06>&#34;norm $&#34;</span><span style=color:#000;font-weight:700>|</span><span style=color:#204a87;font-weight:700>endif</span><span style=color:#000;font-weight:700>|</span><span style=color:#204a87;font-weight:700>endif</span><span style=color:#a40000>
</span></code></pre></div><p><a href=http://www.cnblogs.com/ifantastic/p/3524751.html>vim 语法高亮</a> 对于大文件，语法高亮</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#000>syn</span> <span style=color:#000>sync</span> <span style=color:#000>fromstart</span><span style=color:#a40000>
</span></code></pre></div><p><a href=http://www.dreamxu.com/books/vim/plugin/youcompleteme.html>vim YCM插件自动补全比较慢的解决办法</a> 第三个字母开始自动完成提示</p>
<p><a href=http://blog.jobbole.com/58978/>vim YCM跳转到定义跳转到申明</a> 使用往前跳和往后跳的快捷键为Ctrl+O以及Ctrl+I。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=color:#000>nnoremap</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>leader</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000>gl</span> :<span style=color:#000>YcmCompleter</span> <span style=color:#000>GoToDeclaration</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>CR</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#000>nnoremap</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>leader</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000>gf</span> :<span style=color:#000>YcmCompleter</span> <span style=color:#000>GoToDefinition</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>CR</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#a40000>
</span><span style=color:#a40000></span><span style=color:#000>nnoremap</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>leader</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#000>gg</span> :<span style=color:#000>YcmCompleter</span> <span style=color:#000>GoToDefinitionElseDeclaration</span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#000>CR</span><span style=color:#000;font-weight:700>&gt;</span><span style=color:#a40000>
</span></code></pre></div><p><a href=http://www.cnblogs.com/jianyungsun/archive/2011/02/14/1954057.html>vim bookmark</a> 字母书签的功能</p>
<p><a href=https://stackoverflow.com/questions/1527784/what-is-vim-recording-and-how-can-it-be-disabled> <strong>[vim recording]</strong> What is vim recording and how can it be disabled?</a> 偶尔按错键，导致左下角出现&rsquo;recording @q&rsquo;等字样</p>
<h3 id=javascript>javascript</h3>
<p><a href=https://github.com/marcuswestin/WebViewJavascriptBridge>IOS webview 与js通信方案</a> 跟java代码有点区别，不能统一吗</p>
<p><a href=https://github.com/webpack/webpack-dev-server/issues/147>Server can&rsquo;t be accessed via IP</a> webpack-server如何配置通过IP访问</p>
<h3 id=python-序列化与反序列化>python 序列化与反序列化</h3>
<p><a href=https://docs.python.org/2/library/pickle.html>pickle — Python object serialization¶</a> 用于redis cache 缓存</p>
<h3 id=confluence>confluence</h3>
<p>这个跟jira如何协作的？</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-3098fe12d2ae39d8528f92beb761a9af>8.39 - Daily 9/21</h1>
<h2 id=学习>学习</h2>
<h3 id=python-unittest-tornado>python unittest tornado</h3>
<p><a href=https://github.com/puentesarrin/selene/blob/master/test/test_handlers.py>test_handlers.py 案例代码</a> selene项目测试案例</p>
<p><a href=https://gist.github.com/didip/867589>request_handler_test.py 案例代码</a> 设置项目根目录、父类构建</p>
<p><a href=https://www.rddoc.com/doc/Tornado-4.4.2/testing/>tornado.testing —单元测试支持异步代码</a> 支持异步测试</p>
<p><a href=https://stackoverflow.com/questions/18285947/how-to-use-a-test-tornado-server-handler-that-authenticates-a-user-via-a-secure>How to use a test tornado server handler that authenticates a user via a secure cookie</a> mock cookie</p>
<p><a href=https://docs.python.org/2/library/unittest.html>命令行下执行单个unittest</a> 更多的参数</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python -m unittest test_module1 test_module2
python -m unittest test_module.TestClass
python -m unittest test_module.TestClass.test_method
</code></pre></div><p><a href=https://emptysqua.re/blog/tornado-unittesting-eventually-correct/>setup 使用，初始化数据</a> <code>TODO</code></p>
<p><a href=https://github.com/bootandy/tornado_sample/tree/master/sample>tornado sample</a> 有接口测试的项目</p>
<p><a href=http://pyunit.sourceforge.net/pyunit_cn.html#WHERE>python unittest文档</a></p>
<p><a href=https://gxnotes.com/article/79239.html>python unittest执行顺序问题</a> 字母的顺序执行</p>
<p><a href=https://stackoverflow.com/questions/26323090/how-to-mock-get-current-user-in-tornado-for-unittest>python mock handler</a></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>MyUT</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tornado</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>AsyncHTTPTestCase</span><span style=color:#000;font-weight:700>):</span>
  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>get_app</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#000>settings</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#4e9a06>&#34;template_path&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#39;../../../templates&#39;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;cookie_secret&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#39;secret&#39;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;login_url&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#39;/admin/login&#39;</span><span style=color:#000;font-weight:700>,</span>
      <span style=color:#4e9a06>&#34;debug&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>True</span>
    <span style=color:#000;font-weight:700>}</span>

    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>Application</span><span style=color:#000;font-weight:700>([</span>
      <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>r</span><span style=color:#4e9a06>&#39;/admin/create/super&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>handlers</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>CreateSuperUserHandler</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>],</span> <span style=color:#ce5c00;font-weight:700>**</span><span style=color:#000>settings</span><span style=color:#000;font-weight:700>)</span>


  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>testGet</span><span style=color:#000;font-weight:700>(</span><span style=color:#3465a4>self</span><span style=color:#000;font-weight:700>):</span>
    <span style=color:#204a87;font-weight:700>with</span> <span style=color:#000>mock</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>patch</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>object</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>handlers</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>CreateSuperUserHandler</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;get_current_user&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>m</span><span style=color:#000;font-weight:700>:</span>
      <span style=color:#000>m</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>return_value</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{}</span>
      <span style=color:#000>response</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>fetch</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;/admin/create/super&#39;</span><span style=color:#000;font-weight:700>)</span>

    <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#3465a4>self</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>assertGreater</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>index</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;create&#39;</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><a href=https://segmentfault.com/a/1190000002965620>mock handler更详细的例子</a> patch和patch.object 使用</p>
<h3 id=python>Python</h3>
<p><a href=https://www.polarxiong.com/archives/Python-%E6%93%8D%E4%BD%9Cdict%E6%97%B6%E9%81%BF%E5%85%8D%E5%87%BA%E7%8E%B0KeyError%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95.html>操作dict时避免出现KeyError的几种方法</a> 使用get方法更好<br>
<a href=https://stackoverflow.com/questions/18176602/how-to-get-name-of-exception-that-was-caught-in-python>How to get name of exception that was caught in Python?</a> 获取异常的的类名</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>try</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>bar</span>
<span style=color:#204a87;font-weight:700>except</span> <span style=color:#c00;font-weight:700>Exception</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>exception</span><span style=color:#000;font-weight:700>:</span>
    <span style=color:#204a87;font-weight:700>assert</span> <span style=color:#204a87>type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>exception</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;NameError&#39;</span>
    <span style=color:#204a87;font-weight:700>assert</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__class__</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>__name__</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;NameError&#39;</span>
</code></pre></div><p><a href=https://stackoverflow.com/questions/27155819/delete-a-key-and-value-from-an-ordereddict>删除dict里面的元素</a> use <code>del</code></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87;font-weight:700>from</span> <span style=color:#000>collections</span> <span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>OrderedDict</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>dct</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>OrderedDict</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>dct</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;a&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>dct</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;b&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>dct</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;c&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>dct</span>
<span style=color:#000>OrderedDict</span><span style=color:#000;font-weight:700>([(</span><span style=color:#4e9a06>&#39;a&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;b&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;c&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)])</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#204a87;font-weight:700>del</span> <span style=color:#000>dct</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;b&#39;</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span> <span style=color:#000>dct</span>
<span style=color:#000>OrderedDict</span><span style=color:#000;font-weight:700>([(</span><span style=color:#4e9a06>&#39;a&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;c&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)])</span>
<span style=color:#ce5c00;font-weight:700>&gt;&gt;&gt;</span>
</code></pre></div><p><a href=http://www.runoob.com/python/python-object.html>python面向对象</a> 入门级介绍 <code>TODO</code></p>
<p><a href=http://blog.csdn.net/business122/article/details/7541486>python set 集合操做</a> 比如删除某个元素 set.remove(key)</p>
<p><a href=https://stackoverflow.com/questions/5631624/how-to-get-exit-code-when-using-python-subprocess-communicate-method>subprocess returncode</a> 什么时候为0</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>subprocess</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>sp</span>
<span style=color:#000>child</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Popen</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>openRTSP</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>opts</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>split</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>sp</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PIPE</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000>streamdata</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>child</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>communicate</span><span style=color:#000;font-weight:700>()[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span>
<span style=color:#000>rc</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>child</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>returncode</span>
</code></pre></div><h3 id=tornado>Tornado</h3>
<p><a href=http://www.jianshu.com/p/3d20a092588d>Tornado异步与延迟任务</a> Tornado异步通俗易懂的教程<br>
<a href=http://tornado-zh.readthedocs.io/zh/latest/guide/coroutines.html>协程</a> 官方文档 难懂<br>
<a href=http://strawhatfy.github.io/2015/07/22/Tornado.gen/>tornado.gen源码解析</a> <code>TODO</code></p>
<h3 id=git>GIT</h3>
<pre tabindex=0><code>*
!.gitignore
</code></pre><p><a href=https://segmentfault.com/a/1190000006866280>git中如何提交空目录</a> 空文件</p>
<p><a href=https://github.com/geeeeeeeeek/git-recipes/wiki/5.2-%E4%BB%A3%E7%A0%81%E5%9B%9E%E6%BB%9A%EF%BC%9AReset%E3%80%81Checkout%E3%80%81Revert-%E7%9A%84%E9%80%89%E6%8B%A9>git 提交撤销</a></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git reset HEAD~2
</code></pre></div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-c727370ca88bf63f507c67e9642157c1>8.40 - Daily 9/22</h1>
<h2 id=学习>学习</h2>
<h3 id=项目>项目</h3>
<p>项目周报的编写参考confluence里面的优秀的周报日志，<code>TODO</code><br>
模版如下：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=color:purple;font-weight:700>### 本周工作
</span><span style=color:purple;font-weight:700></span>---
<span style=color:#204a87;font-weight:700>1.</span> 学习vue
<span style=color:#204a87;font-weight:700>2.</span> 完成登录页面开发
...

<span style=color:purple;font-weight:700>### 下周计划
</span><span style=color:purple;font-weight:700></span>---
<span style=color:#204a87;font-weight:700>1.</span> 继续学习vue
<span style=color:#204a87;font-weight:700>2.</span> 继续完成登录页面开发

<span style=color:purple;font-weight:700>### issues
</span><span style=color:purple;font-weight:700></span>---
<span style=color:#204a87;font-weight:700>-</span> 我觉得我们团队棒棒哒，就是女生少了一点
<span style=color:#204a87;font-weight:700>-</span> webpack的打包时间越来越长，我们可以考虑优化它
</code></pre></div><h3 id=vue>VUE</h3>
<p>合作的同事去了其他部门，我开始接口VUE开发工作，然后问题来了
<a href=https://cn.vuejs.org/v2/api/#watch>Watch 对比更改前的值oldValue</a></p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#000>a</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>val</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>oldVal</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
      <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;new: %s, old: %s&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>val</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>oldVal</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>},</span>
</code></pre></div><h3 id=vim>Vim</h3>
<p><a href=https://github.com/posva/vim-vue>vim-vue 下vue文件居然高亮了前部分</a></p>
<pre tabindex=0><code>autocmd FileType vue syntax sync fromstart
</code></pre><p>加上上面的配置就可以了</p>
<p>支持NERDCommenter的解决办法。</p>
<pre tabindex=0><code>let g:ft = ''
function! NERDCommenter_before()
  if &amp;ft == 'vue'
    let g:ft = 'vue'
    let stack = synstack(line('.'), col('.'))
    if len(stack) &gt; 0
      let syn = synIDattr((stack)[0], 'name')
      if len(syn) &gt; 0
        exe 'setf ' . substitute(tolower(syn), '^vue_', '', '')
      endif
    endif
  endif
endfunction
function! NERDCommenter_after()
  if g:ft == 'vue'
    setf vue
    let g:ft = ''
  endif
endfunction
</code></pre><h3 id=codepenio>Codepen.io</h3>
<p>在线编辑代码，可见即可得，学习的好工具，支持zencoding<br>
<em>login in by github</em></p>
<h3 id=css>CSS</h3>
<p><a href=https://coolshell.cn/articles/6840.html>布局</a> 40个教程、技巧、例子和最佳实践</p>
<p><a href=http://www.ruanyifeng.com/blog/2015/07/flex-grammar.html>css Flex</a> flex布局，项目中用到比较多</p>
<h3 id=javascript>javascript</h3>
<p><a href=http://www.ruanyifeng.com/blog/2015/07/monad.html>Monad</a> 这是个什么鬼，第一次听说 还是无意中看到 <code>TODO</code></p>
<h3 id=processon>processon</h3>
<p>流程图的好工具在线的<br>
已经开始使用了，简简单单画了三个图，太强大了。</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-ba27040cd5b9dd2964e945a84c423939>8.41 - Daily 9/25 #vpn</h1>
<h2 id=学习>学习</h2>
<h3 id=supervisor>Supervisor</h3>
<p><a href=http://supervisord.org>Supervisor</a> 是一个用 Python 写的进程管理工具，可以很方便的用来启动、重启、关闭进程（不仅仅是 Python 进程）。除了对单个进程的控制，还可以同时启动、关闭多个进程，比如很不幸的服务器出问题导致所有应用程序都被杀死，此时可以用 supervisor 同时启动所有应用程序而不是一个一个地敲命令启动。<br>
<a href=http://liyangliang.me/posts/2015/06/using-supervisor/>Supervisor 中文文档</a></p>
<h3 id=screen>Screen</h3>
<p><a href=http://easwy.com/blog/archives/display-window-list-on-title-bar-and-status-bar-of-screen/>在标题和状态栏中显示Screen的窗口名称</a></p>
<pre tabindex=0><code>caption always &quot;%{= kw}%-w%{= kG}%{+b}[%n %t]%{-b}%{= kw}%+w %=%d %M %0c %{g}%H%{-}&quot;
</code></pre><h3 id=vpn>Vpn</h3>
<p>今天vpn可以看720P视频奇怪，接下来要做的事情是测试vpn速度，保证vpn24小时速度稳定</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-aa028a05e971916505636bfdb54422ab>8.42 - Daily 9/27 Git 相关知识点</h1>
<h2 id=学习>学习</h2>
<h3 id=bash-history>Bash history</h3>
<p>编辑文件<code>.bash_profile</code></p>
<pre tabindex=0><code>HISTFILESIZE=100000
</code></pre><p>重启下终端，看看~/.bash_history 是不是就可以存储更多的历史命令了。</p>
<h3 id=git-tag>Git tag</h3>
<p>补打标签</p>
<pre tabindex=0><code>git tag -a v1.2 9fceb02
</code></pre><p>分享标签</p>
<pre tabindex=0><code>git push origin [tagname]
</code></pre><h3 id=git-stash>Git stash</h3>
<p>多个分支共享 stash list, 为什么<code>git stash apply</code>时不区分分支。</p>
<blockquote>
<p>今天碰到的一问题，<code>git stash</code>完美解决问题： 我在 dev 分支上更改了一个小 bug，我需要把这个升级到线上，但是 dev 分支上正在进行项目 A 的开发很久了，没办法直接把 dev 上线，怎么办？ 只有先<code>git stash</code>储藏起来，然后切换分支，通过<code>git stash apply</code> 应用到切换后的分支即可，然后把提交，上线新分支。切换回 dev 继续开发项目 A</p>
</blockquote>
<h3 id=git-checkout-revert-reset>Git checkout revert reset</h3>
<p><a href=https://github.com/geeeeeeeeek/git-recipes/wiki/5.2-%E4%BB%A3%E7%A0%81%E5%9B%9E%E6%BB%9A%EF%BC%9AReset%E3%80%81Checkout%E3%80%81Revert-%E7%9A%84%E9%80%89%E6%8B%A9>代码回滚：Reset、Checkout、Revert 的选择</a> 好详细的介绍</p>
<p><a href=https://github.com/geeeeeeeeek/git-recipes/wiki/5.1-%E4%BB%A3%E7%A0%81%E5%90%88%E5%B9%B6%EF%BC%9AMerge%E3%80%81Rebase-%E7%9A%84%E9%80%89%E6%8B%A9>代码合并：Merge、Rebase 的选择</a> git rebase 黄金法则</p>
<blockquote>
<p>有没有别人正在这个分支上工作？</p>
</blockquote>
<h3 id=git-rebase>Git rebase</h3>
<p><a href=https://blog.yorkxin.org/2011/07/29/git-rebase>Git-rebase 小筆記</a> 介绍各种 rebase 详细技巧</p>
<p><a href=https://github.com/doggy8088/Learn-Git-in-30-days/blob/master/zh-tw/23.md>修正 commit 過的版本歷史紀錄 Part 5</a> 实战 Rebase 能做的事</p>
<h3 id=git-tree>Git tree</h3>
<p><a href=https://stackoverflow.com/questions/1064361/unable-to-show-a-git-tree-in-terminal> show a Git tree in terminal </a></p>
<pre tabindex=0><code>git log --graph --oneline --all
</code></pre><p>配置 git tree</p>
<pre tabindex=0><code>git config --global alias.tree &quot;log --graph --decorate --pretty=oneline --abbrev-commit&quot;
</code></pre><h3 id=git-push--f>Git push -f</h3>
<p><a href="http://www.bysocket.com/?p=926">Git 回滚远程版本</a> 真的想不到这个都可以，太强大了</p>
<pre tabindex=0><code>git log
git reset --soft ${commit-id}
git stash
git push -f
</code></pre><h3 id=git-log>Git log</h3>
<p>一直以来对于 git log &ndash;graph 有一种似懂非懂的感觉。
<a href=http://gitbook.liuhui998.com/3_4.html>来自 Git Community Book 中文版 - 查看历史 - Git 日志</a> 提到<code>日志排序</code>的几种</p>
<ul>
<li>逆时间顺序 (reverse chronological)： 默认情况下为这种方式</li>
<li>拓扑顺序 (&ndash;topo-order): 子提交在他们的福提交前显示，这种方式会看到”开发线“(development lines) 都会集合在一起</li>
<li>提交日期顺序</li>
</ul>
<blockquote>
<p>Talk is cheap，Show me the code or money~</p>
</blockquote>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-3b05a0a3b23c3b160359824339a7ea82>8.43 - Daily 9/5</h1>
<p>一直要做的事情：知识的系统化梳理<br>
LP生气了，换了微信头像，发了朋友圈，哽咽几下，而我说了一堆话，不知道有没有用</p>
<ul>
<li>vue+webpack重构了整个项目，明天上线新系统，工作上事情很多,做不完的工作,学不完的知识（系统化多重要）
<ul>
<li>工作上的发展方向是怎样的，这个问题一直不想，TMCD！</li>
</ul>
</li>
<li>贸易上的事情进展太慢了
<ul>
<li>Amazon上产品</li>
<li>开模新产品</li>
<li>产品包装：产品尺寸定做包装</li>
<li>发货还是个问题，FBA</li>
</ul>
</li>
</ul>
<p>说了一句话：“我对自己也不满意” ，英文翻译过去应该是&rsquo;fuck yourself, or What'.<br>
睡觉，长叹一口气！</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-3e7749c7032db639158bfd853be29f21>8.44 - Daily 9/6</h1>
<h3 id=感情>感情</h3>
<p>关进了小黑(la)屋(hei)</p>
<p>过了2个小时，出来了！上次也是关了几个小时。<br>
生气了一会就自我恢复了。</p>
<h3 id=工作>工作</h3>
<p>新系统顺利上线了</p>
<h3 id=学习>学习</h3>
<p><a href=https://hughfdjackson.com/javascript/why-curry-helps/> Curry 编程</a> Currying is the process of turning a function that expects multiple parameters into one that, when supplied fewer parameters, returns a new function that awaits the remaining ones.</p>
<p><a href=http://ramdajs.com/>Ramda.js</a> A practical functional library for JavaScript programmers.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b614d07cd7c901562de1ae291997c681>8.45 - Daily 9/8</h1>
<h3 id=学习>学习</h3>
<br>
#### Python时间处理
[Python dateutil](https://dateutil.readthedocs.io/en/stable/index.html) 非常强大的时间处理，对这种数据'Fri, 21 Jul 2017 14:42:50 +0800'轻易解析
[strftime](http://strftime.org/) 最详细的时间格式说明
[3.15 字符串转换为日期](http://python3-cookbook.readthedocs.io/zh_CN/latest/c03/p15_convert_strings_into_datetimes.html)官网文档datetime.strptime
```python
date.today().strftime(u'%Y年%m月%d日'.encode('utf-8')).decode('utf-8')
```
<br>
#### EMAIL收发邮件
[官网email](https://docs.python.org/2/library/email-examples.html)发送邮件的详细例子
[POP3收取邮件](https://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/001408244819215430d726128bf4fa78afe2890bec57736000) 详细教程
[Reply to email using python 3.4](https://stackoverflow.com/questions/31433633/reply-to-email-using-python-3-4)回复邮件的代码
[邮件解析](http://blog.donews.com/limodou/archive/2004/12/30/220588.aspx) 编码问题
[邮件详细解析](http://www.cnblogs.com/zixuan-zhang/p/3402821.html) 这个更详细
<br>
<br>
#### PYTHON GIT
[pygit2](http://www.pygit2.org/merge.html) python api for git
<br>
### 生活
周日去香港徒步，16公里
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d317738cb1682d537736db77b07bded5>8.46 - 又是一年最长假-国庆 Daily 9/29</h1>
<h2 id=生活>生活</h2>
<p>国庆长假对于工作的人真是长假! 回！</p>
<h2 id=学习>学习</h2>
<h3 id=vim>Vim</h3>
<p><a href=http://vim.wikia.com/wiki/Switching_case_of_characters>Switching case of characters</a> 还是官网文档比较给力</p>
<h3 id=javascript>Javascript</h3>
<p><a href=https://stackoverflow.com/questions/4994201/is-object-empty>Is object empty? </a> JS中如何判断一个空的对象</p>
<p>Array最后一个元素</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#204a87>Array</span><span style=color:#000;font-weight:700>([</span><span style=color:#4e9a06>&#39;www&#39;</span><span style=color:#000;font-weight:700>],[</span><span style=color:#4e9a06>&#39;phpernote&#39;</span><span style=color:#000;font-weight:700>],[</span><span style=color:#4e9a06>&#39;com&#39;</span><span style=color:#000;font-weight:700>]);</span>
<span style=color:#000>alert</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>pop</span><span style=color:#000;font-weight:700>());</span><span style=color:#8f5902;font-style:italic>//com
</span></code></pre></div><h3 id=正则表达式>正则表达式</h3>
<p><a href=http://www.vaikan.com/regular-expression-to-match-string-not-containing-a-word/>不匹配的问题</a></p>
<pre tabindex=0><code>^((?!hede).)*$
</code></pre><h3 id=webpack>Webpack</h3>
<p>修改dev server的根目录</p>
<pre tabindex=0><code>devServer: {
  contentBase: path.join(__dirname, &quot;dist&quot;),
  compress: true,
  port: 9000
}
</code></pre><p>当js文件名webpack打包生成的时候，不能写死在html中，如何让js文件自动加入到html文件中</p>
<p><code>HtmlWebpackPlugin</code> 插件解决了这个问题</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>HtmlWebpackPlugin</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;html-webpack-plugin&#39;</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>webpackConfig</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>entry</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;index.js&#39;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#000>output</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>__dirname</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;/dist&#39;</span><span style=color:#000;font-weight:700>,</span>
    <span style=color:#000>filename</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;index_bundle.js&#39;</span>
  <span style=color:#000;font-weight:700>},</span>
  <span style=color:#000>plugins</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HtmlWebpackPlugin</span><span style=color:#000;font-weight:700>()]</span>
<span style=color:#000;font-weight:700>};</span>
</code></pre></div><p><a href=https://github.com/jantimon/html-webpack-plugin>github 项目地址</a></p>
<h3 id=vue>VUE</h3>
<p>Vue.js 带来的良好的开发模式：模板，数据绑定，组件化，自动化，资源统一化</p>
<p><a href=http://blog.csdn.net/lihongxun945/article/details/51841072>vue-mobile - 一个基于VUE的UI框架</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-b87911a9f23050e07816f368281711dc>9 - Others</h1>
<div class=lead>关于生活、学习、工作</div>
</div>
<div class=td-content>
<h1 id=pg-884b3d38fd53570e0807a61750cf4594>9.1 - 年底的沟通记录</h1>
<h2 id=背景>背景</h2>
<p>没有反思的人生是不值得一过的， 年底了， leader问你的哪些的问题还记得吗？ 是否有更好的方式回答了。</p>
<h2 id=问题列表>问题列表</h2>
<p><strong>对其他同事的规划是怎样的</strong><br>
这个问题并没有思考太多，临场发挥了，一一说明了大家目前的情况和优缺点。</p>
<p><strong>对上一级的评价</strong><br>
从业务、沟通、技术能力三方评价吧， 自我感觉还挺好的</p>
<p><strong>介绍了年终奖后，对年终奖的满意度</strong><br>
比较诚实的回答， 也不清楚是否有更好的答案，跟其他同事聊天的时候，其他同事会回答“满意”</p>
<p><strong>对2020年在业务上的规划</strong><br>
并没有做任何的准备，根据最近的思考回答了这个问题。<br>
如果提前有准备，我相信回答的更好的，不仅仅是在这种情况下需要介绍规划，在其他情况下也是有必要能够清晰说出我们的是什么，我们走向何方？</p>
<p><strong>（自己问题）回顾2019年</strong><br>
去年年底年会时候的想法在年中的时候，突然发生了变化。对于团队，并没有带领他们做出非常出色的工作和成果，或者做出做他人有影响的事情</p>
<br>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-742aaec0cddf6176565d7164d847d1be>9.2 - What We Concern</h1>
<h2 id=背景>背景</h2>
<h2 id=我们的问题>我们的问题</h2>
<h3 id=效率>效率</h3>
<p>效率，不只是开发、测试、需求，指的是迭代上线的效率。</p>
<h3 id=业务的价值和清晰>业务的价值和清晰</h3>
<p>做有价值的业务, 并有清晰的规划</p>
<ul>
<li>缺乏严格的需求评审</li>
</ul>
<h2 id=我们的改变>我们的改变</h2>
<h3 id=提高效率>提高效率</h3>
<ul>
<li>更改目前发版的流程， 不需要建版本，在发版完即可通知相关方。</li>
<li>更改目前的测试方式， 推动接口测试+单元测试， 不依赖与APP测试。</li>
<li>着力中台, 沉淀公共业务领域，提高小前台的的迭代速度</li>
<li>引入devops, 释放developer的参与的运维工作</li>
</ul>
<h3 id=清晰的业务和价值>清晰的业务和价值</h3>
<ul>
<li>需求流程优化</li>
<li>加强需求评审</li>
</ul>
<h3 id=应用能力平台化>应用能力平台化</h3>
<p>生态圈。 开放平台是生态圈的关键，把企业的服务以 Open API 的方式对外暴露，可以让更多的第三方软件提供商的软件接入到我们的平台中，从而造就一个广阔的生态圈。</p>
<h4 id=行业对标-银行生态云建设思路及架构参考>[行业对标] 银行生态云建设思路及架构参考</h4>
<p>内容来自： <a href=https://cloud.tencent.com/developer/article/1485632>银行生态云建设思路及架构参考</a></p>
<h5 id=技术路线>技术路线</h5>
<pre tabindex=0><code class=language-plantuml data-lang=plantuml>@startuml

actor &quot;开发人员&quot; as dev 
actor &quot;产品&amp;运营人员&quot; as run 


skinparam RectangleFontName Papyrus
skinparam RectangleFontSize 24
rectangle &quot; 云服务开发规范 &quot; as spec {

}

rectangle &quot;基础云平台&quot;  as plat {
    rectangle &quot;基础服务平台&quot; as basic
    rectangle &quot;安全接口&quot; as basic1
    rectangle &quot;审计接口&quot; as basic2
    rectangle &quot;计量接口&quot; as basic3
    rectangle &quot;计费接口&quot; as basic4

    basic -&gt; basic1 
    basic -&gt; basic2
    basic -&gt; basic3
    basic -&gt; basic4
    basic1 -[hidden]-&gt; basic2
    basic2 -[hidden]-&gt; basic3
    basic3 -[hidden]-&gt; basic4
}


rectangle &quot;标准云产品&quot; as product {

    rectangle &quot;安全接入&quot; as a 
    rectangle &quot;计量接入&quot; as b
    rectangle &quot;审计接入&quot; as c

    a -[hidden]-&gt; b 
    b -[hidden]-&gt; c
}
'spec -[hidden]-&gt; plat
plat --&gt; spec: 云平台提供标准接口和开发规范

product -&gt; plat: 通过接口接入，在运营平台上自动接入

spec --&gt; dev: 开发规范指导云服务产品开发

dev -&gt; product: 开发人员遵循各项接口标准


run --&gt; product
@enduml
@enduml
</code></pre><p>&ldquo;开放云平台+标准产品”的方式成就了<strong>典型生态云的持续运营能力</strong>。开放的云平台提供云基础服务，并以标准接口的方式把这些基本服务暴露给云产品开发人员。</p>
<pre tabindex=0><code class=language-plantuml data-lang=plantuml>@startmindmap

* 生态云技术路线
** 标准开放的云平台
*** 核心能力
**** 标准开放框架
*****_: 标准的开放框架是生态云能健康持续发展的基础，
定义了云服务构建的技术标准，允许快速开发标准产品
;
**** 产品服务能力？
*****_ 产品服务能力是生态云的价值体现。
**** 安全服务能力
*****_ 为云平台和云服务的租户提供**体系化**的安全管理能力
**** 持续运营能力
*****_: 提供客户运营、云服务产品运营及平台运营能力，
实现标准云产品的生命周期管理，实现客户自主服务。
;
**** 集中管控能力
*****_ 实现云资源和业务应用的统一管理、调度和监控、底层资源的扩缩容管理

** 标准产品
@endmindmap
</code></pre><h4 id=行业对标-华润集团云计算服务平台建设思路讨论>[行业对标] 华润集团云计算服务平台建设思路讨论</h4>
<p><a href=https://www.oracle.com/technetwork/cn/community/developer-day/10-cloud-computing-platform-1863872-zhs.pdf>Click PDF</a> 来自甲骨文首席架构师 刘翔</p>
<h5 id=对云计算的nist解释>对云计算的NIST解释</h5>
<blockquote>
<p>[NIST] 云计算是一种新的模式，基于此消费者能能够方便、按需地从网络访问到共享的可配置计算资源池（如， 网络、服务器、存储、应用程序和服务），且只需最小的管理或与服务提供方交互即可快速供应和释放这些资源。</p>
</blockquote>
<p>5个重要特征（<strong>STEAM</strong>)</p>
<ul>
<li>S<strong>按需自助服务</strong></li>
<li>T<strong>多租户的资源池</strong></li>
<li>E快速伸缩</li>
<li>A广泛的网络访问</li>
<li>M<strong>按使用量收费的服务</strong></li>
</ul>
<p>4种部署类型</p>
<ul>
<li>公有云</li>
<li>私有云</li>
<li>社区云</li>
<li>混合云</li>
</ul>
<p>3种服务模式</p>
<ul>
<li>SaaS</li>
<li>PaaS</li>
<li>IaaS</li>
</ul>
<h4 id=行业对标-谢冲---华为云-iot-生态开放架构与实践-v10>[行业对标] 谢冲 - 华为云 IoT 生态开放架构与实践 v1.0</h4>
<p><strong>生态开放除了涉及不仅要考虑软件架构还需要考虑开放三要素</strong></p>
<ol>
<li>开放层次</li>
<li>开放形式</li>
<li>开放平台</li>
</ol>
<h3 id=物联网平台化---iot>物联网平台化 - IoT</h3>
<p>这块知识是2020年需要成长的地方，硬件为主，赋能硬件是后续的趋势。</p>
<h4 id=架构是怎样的>架构是怎样的？</h4>
<p>案例/论文参考：</p>
<p><a href=https://en.wikipedia.org/wiki/Lambda_architecture>Lambda architecture</a> a data-processing architecture designed to handle massive quantities of data by take advantage of both batch and stream-processing methods.</p>
<p><a href=https://www.researchgate.net/publication/321639779_A_Distributed_Stream_Processing_based_Architecture_for_IoT_Smart_Grids_Monitoring>A Distributed Stream Processing based Architecture for IoT Smart Grids Monitoring .pdf</a></p>
<ul>
<li>Cyclic Architecture
<ul>
<li>Messaging Layer</li>
<li>Processing Layer</li>
<li>Volatile Layer</li>
</ul>
</li>
</ul>
<p><a href=https://www.infosys.com/it-services/validation-solutions/documents/testing-iot-applications.pdf>IoT: A web of interconnected layers.pdf</a> 点击链接查看多层架构。</p>
<ul>
<li>Device Layer</li>
<li>Data ingestion and transformation layer
<ul>
<li>Data from the device layer is transformed through different protocols to a <strong>standard format</strong>.</li>
</ul>
</li>
<li>Data processing layer</li>
<li>Application layer</li>
</ul>
<p><a href=https://www.oreilly.com/content/applying-the-kappa-architecture-in-the-telco-industry/>Applying the Kappa architecture in the telco industry</a></p>
<p><img src=https://www.oreilly.com/content/wp-content/uploads/sites/2/2019/06/figure2_kappa-architecture-51de195715f9d2417b0814c3e537c355.png alt></p>
<p><a href=https://docs.oracle.com/en/solutions/iot-streaming-oci/index.html#GUID-BAE48036-286B-49CE-A6AA-5870CAD689D2>Stream IoT data to an autonomous database using serverless functions</a></p>
<p>Oracle IoT Streaming Arch</p>
<p><img src=https://docs.oracle.com/en/solutions/iot-streaming-oci/img/oci-arch-iot-streaming.png alt="Oracle IOT 流架构"></p>
<p>参考</p>
<ol>
<li>
<p><a href=https://medium.com/@prashunjaveri>Architecture Patterns for IoT</a></p>
</li>
<li>
<p><a href=https://www.infosys.com/it-services/validation-solutions/documents/testing-iot-applications.pdf>Tesing IOT Applications.pdf</a></p>
</li>
<li>
<p>Infoq: The Perfect Pair: Digital Twins and Predictive Maintenance</p>
</li>
</ol>
<h4 id=行业对标-google-cloud-iot>[行业对标] Google Cloud IOT</h4>
<p>参考下面服务组件和数据流图: <a href="https://cloud.google.com/iot/resources/cloud-iot-overview3.png?hl=zh_CN">Cloud IoT Core</a></p>
<h5 id=名词解释>名词解释</h5>
<table>
<thead>
<tr>
<th>名词</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>device registry</td>
<td>a container of devices with shared properties</td>
</tr>
<tr>
<td>device</td>
<td>a &ldquo;Thing&rdquo; in &ldquo;Internet of Things&rdquo;; a processing unit that is capable of connecting to the internet (directly or indirectly) and exchanging data with the cloud.</td>
</tr>
</tbody>
</table>
<h5 id=实践>实践</h5>
<p>如下内容来自<a href="https://cloud.google.com/iot/docs/how-tos/devices?hl=zh_CN">Google IoT Core 指南</a></p>
<ul>
<li>Install Google Cloud SDK</li>
<li>Create devices registries
<ul>
<li>Create a device registry</li>
<li>IAM role for Pub/Sub publishing</li>
</ul>
</li>
<li>Creating device key pairs
<ul>
<li>First <code>create a pulbic/private key pair</code></li>
<li>When connecting to Cloud IoT Core, each device creates a <code>JSON Web Token(JWT)</code> signed with its private key, which Cloud IoT Core authenticate using the device&rsquo;s pulbic key
<ul>
<li>Cloud IoT Core can verify device public key certifcates against registry-level CA certificates? 用注册的CA证书验证设备公钥证书</li>
<li>作用：a verified cerficate attests that a <code>public/private key pair</code> belongs to a legitimate device. 当设备生产商创建公私钥后，私钥存储在设备中，而公钥被CA签名。</li>
<li>设备注册有CA证书时，那么只接受CA签名过公钥设备. 当平台需要兼容多种设备时，可以让设备添加到响应的设备注册里，不至于混乱添加，导致设备收到异常指令或者上报错误的信息。</li>
</ul>
</li>
</ul>
</li>
<li>Creating or editing a device
<ul>
<li>创建设备时<code>身份验证</code>可以选择公钥的格式。
<ul>
<li>公钥 (RS256 或 ES256)</li>
<li>公钥证书（被CA签名过的）</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre tabindex=0><code class=language-plantuml data-lang=plantuml>@startuml
!include &lt;awslib/AWSCommon&gt;
!include &lt;awslib/General/Client&gt;
!include &lt;awslib/Mobile/APIGateway&gt;

Client(device, drone, &quot;&quot;)
APIGateway(api, &quot;IoT Broker&quot;, &quot;&quot;)

device -&gt; api: 使用JWT认证方式\n以mqtt协议接入
@enduml

</code></pre><h4 id=行业对标-阿里云-iot>[行业对标] 阿里云 IOT</h4>
<h5 id=实践-1>实践</h5>
<p><em>TODO</em></p>
<h4 id=行业对标-emq-x>[行业对标] EMQ X</h4>
<ol>
<li>关键技术
<ul>
<li>分布式</li>
<li>容器化</li>
<li>桥接</li>
</ul>
</li>
<li>核心指标
<ul>
<li>多协议</li>
<li>并发量： 单服务器200万并发, 一个集群1000万并发(7个节点）</li>
<li>吞吐量： 单集成百万并发</li>
</ul>
</li>
</ol>
<h5 id=实践-2>实践</h5>
<p><em>TODO</em></p>
<h4 id=行业对标-azure-iot>[行业对标] Azure IoT</h4>
<p><a href=https://docs.microsoft.com/en-us/rest/api/iothub/> IoT Hub REST</a>, offer programmatic access to the device, messages ,and job service , as well as the resource provider, in IoT Hub.</p>
<p><a href=https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-mqtt-support>Communication with your IoT hub using the MQTT protocol </a> 如何定义与设备之间的接口</p>
<p><a href=https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-endpoints> IoT Hub endpoints </a></p>
<ul>
<li>Resource Provider</li>
<li>Device identity management</li>
<li>Device twin management</li>
<li>Jobs management</li>
<li>Device endpoint
<ul>
<li>send device-to-cloud messages</li>
<li>receive cloud-to-device messages</li>
<li>initiate file uploads</li>
<li>retrieve and update device twin properties</li>
<li>receive direct method request</li>
</ul>
</li>
<li>Service endpoint
<ul>
<li>receive device-to-cloud messages</li>
<li>send cloud-to-device messages and receive delivery acknowledgements</li>
<li>receive file notification</li>
<li>direct method invocation</li>
<li>receive operation monitoring events</li>
</ul>
</li>
</ul>
<p><strong><a href=https://docs.microsoft.com/zh-cn/azure/architecture/reference-architectures/iot>Azure IoT reference architecture</a></strong> show a recommended architecture for IoT applications on Azure using PaaS(platform-as-a-service) components</p>
<p><img src=https://docs.microsoft.com/zh-cn/azure/architecture/reference-architectures/_images/iot-refarch.svg alt></p>
<h5 id=two-way-to-process-telemetry-data>two way to process telemetry data:</h5>
<ul>
<li>hot path
<ul>
<li>the <strong>hot path</strong> analyzes data in near-real-time, as it arrives, In the hot path, telemetry must be processed with very low latency. The hot path is typically implemented using a stream processing engine(Azure Stream Analytics or <strong>Apache Spark</strong>). The output may trigger an alert, or be written to a structured format that can be queried using analytical tools.</li>
</ul>
</li>
<li>code path
<ul>
<li>The <strong>cold path</strong> performs batch processing at longer intervals(hourly or daily).</li>
</ul>
</li>
</ul>
<h5 id=data-storage>Data Storage</h5>
<p>For cold path storage, Azure Blob Storage is the most cost-effective option</p>
<p>For warm path storage, consider using Azure Cosmos DB.</p>
<h5 id=解决方案>解决方案</h5>
<p><strong><a href="https://docs.microsoft.com/zh-cn/azure/iot-edge/how-to-publish-subscribe?view=iotedge-2020-11#authorization">Publish and subscribe with Azure IoT Edge</a></strong> Azure IoT 如何解决 Topic pub/sub 权限的问题。</p>
<p><strong><a href=https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/real-time-analytics>Real Time Analytics on Big Data Architecure</a></strong> Get insights form live streaming data with ease.</p>
<p><img src=https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/media/real-time-analytics.png alt></p>
<p><strong><a href=https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/advanced-analytics-on-big-data>Advanced Analytics Architecture</a></strong> Transform your data into actionable insights using the best-in-class machine learning tools.
This architecture allows you to combine any data at any scale, and to build and deploy custom machine learning models at scale.</p>
<p><img src=https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/media/advanced-analytics-on-big-data.png alt></p>
<p><strong><a href=https://docs.microsoft.com/zh-cn/azure/architecture/example-scenario/data/realtime-analytics-vehicle-iot>Ingesting, processing and visualizing real-time vehichle data</a></strong>
<img src=https://docs.microsoft.com/zh-cn/azure/architecture/example-scenario/data/media/architecture-realtime-analytics-vehicle-data1.png alt></p>
<p><strong><a href=https://blog.csdn.net/u011596455/article/details/77925246>国外物联网平台初探（二） ——微软Azure IoT</a></strong> 平台定位: 连接设备、其它 M2M 资产和人员，以便在业务和操作中更好地利用数据</p>
<p><em><a href=http://images2015.cnblogs.com/blog/43267/201609/43267-20160907162226973-62747760.png>点击查看图片</a></em></p>
<h4 id=行业对标-华为云-iot-生态开放架构与实践-v10>[行业对标] 华为云 IoT 生态开放架构与实践 v1.0</h4>
<ol>
<li>
<p>IoT 发展面临的挑战与破局思路: 上能助力创新，中间业务使能，下能连接万物</p>
</li>
<li>
<p>华为云 IoT 生态开放架构与实践: 开放架构和开放三要素</p>
</li>
<li>
<p>落地方案分享</p>
</li>
</ol>
<h3 id=解决方案-1>解决方案</h3>
<h4 id=我们关心什么需求>我们关心什么需求</h4>
<ul>
<li>性能 (Performance)
<ul>
<li>MST, Maximum sustainable throughout</li>
<li>Lantacy</li>
</ul>
</li>
<li>可伸缩性 (Scalability）
<ul>
<li>Maximun number of supported concurrent connections</li>
<li>The time to start a new broker</li>
</ul>
</li>
<li>韧性/可用性 (Resilience)
<ul>
<li>The message loss count in case of a broker instance crashing</li>
</ul>
</li>
<li>安全 (Security)
<ul>
<li>only a side-aspect of security and
measures the overhead of enabled TLS encryption on the maximum sustainable
throughput (as percentage).</li>
</ul>
</li>
<li>可扩展性 (Extensibility)
<ul>
<li>offers plug-in mechanisms</li>
</ul>
</li>
<li>易用性 (Usability)</li>
</ul>
<h4 id=选择>选择</h4>
<p>EMQ X</p>
<h2 id=参考>参考</h2>
<ol>
<li>
<p>MQTT ESSENTIALS by HIVEMQ团队整理 <a href=https://www.hivemq.com/mqtt-essentials/>https://www.hivemq.com/mqtt-essentials/</a></p>
<ul>
<li>MQTT Basic</li>
<li>MQTT Features</li>
<li>MQTT Specials</li>
</ul>
</li>
<li>
<p>初识MQTT <a href=https://developer.ibm.com/zh/articles/iot-mqtt-why-good-for-iot/>https://developer.ibm.com/zh/articles/iot-mqtt-why-good-for-iot/</a></p>
<ul>
<li>为什么是MQTT而不是其他协议</li>
<li>MQTT协议是怎样的</li>
</ul>
</li>
<li>
<p>EMQ X <a href=https://github.com/emqx/emqx>https://github.com/emqx/emqx</a></p>
</li>
<li>
<p>NATS</p>
<ul>
<li>Does NATS support MQTT? <a href=https://github.com/nats-io/nats-server/issues/812>https://github.com/nats-io/nats-server/issues/812</a>
<ul>
<li>分支开发中，预计在Q4支持</li>
</ul>
</li>
<li>支持持久化存储 File Store / SQL Store <a href=https://docs.nats.io/nats-streaming-server/configuring/persistence>Persistence</a></li>
</ul>
</li>
<li>
<p>Comparison of MQTT Brokers for Distributed IoT Edge Computing <a href=http://www.koziolek.de/docs/Koziolek2020-ECSA-preprint.pdf>[pdf]</a></p>
</li>
</ol>
<p><br></p>
<center> ·End· </center>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-74d39ffcc81b3be2aaf814267528776a>9.3 - 4.2最美东湾露营-那些年我们在一起</h1>
<h2 id=第一次露营---hk东湾>第一次露营 - HK东湾</h2>
<p><img src=https://hyvi.github.io/blog-images/dongwan-beach/fulls/01.jpg alt></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-7f163d76f8d404899255ddfb0e6985c0>9.4 - INTERVIEW CONCLUSION</h1>
<div class=lead>2012-12-08 福田财富大厦 问题</div>
<h3 id=10万数字选取最大的100个数算法度>10万数字，选取最大的100个数。算法度</h3>
<p>这个题目当时没细想，估计面试官想问排序问题，然后说了下快速排序。<br>
其实完全没必要排序。遍历一次就可找出来最大的100数字。</p>
<p>类似问题： <a href=https://stackoverflow.com/questions/19227698/write-a-program-to-find-100-largest-numbers-out-of-an-array-of-1-billion-numbers>Write a program to find 100 largest numbers out of an array of 1 billion numbers</a></p>
<h3 id=xxxx年xx月xx日-xxxxxx-表示当前日期>xxxx年xx月xx日 xx:xx:xx 表示当前日期</h3>
<p><a href=http://codepen.io/Hyvi/pen/BheHd>代码</a> 终于重写到自己感觉满意了。</p>
<h3 id=给定个返回json的url有哪些方法获取数据然后显示在其他域的页面上>给定个返回json的url，有哪些方法获取数据然后显示在其他域的页面上</h3>
<ul>
<li>如果提供jsonp的调用,页面中调用jsonp方式</li>
<li>后端代理的方式。</li>
<li>Cross-domain Request(cors)</li>
<li>还有其他的方式吗？ Tell me!!!</li>
</ul>
<h2 id=算法时间复杂度与空间复杂度的计算>算法时间复杂度与空间复杂度的计算</h2>
<p><strong>时间频度</strong></p>
<p>一个算法所花费的时间与代码语句执行的次数成正比。我们把一个算法中的语句执行次数称为时间频度，记作 T(n)</p>
<p><strong>渐进时间复杂度</strong></p>
<p>在时间频度 T(n) 中，n 表示着问题的规模，当 n 不断变化时， T(n) 也会不断地随之变化。那么，如果我们想知道 T(n) 随着 n 变化时会呈现什么样的规律，那么就需要引入时间复杂度的概念。</p>
<p>如果存在某个函数 f(n)， 使得当 n 趋于无穷大时，T(n)/f(n)的极限值是不为零的常数，那么 f(n) 是 T(n) 同数量级的函数，记作 T(n) = O(f(n))，称 O(f(n)) 为算法的渐进时间复杂度，简称为时间的复杂度。</p>
<p>常见的时间复杂度有： O(1) 常数型； O(log<sub>n</sub>) 对数型；O(n) 线性型；O(nlog<sub>n</sub>) 线性对数型；O(n<sup>2</sup>) 平方型；O(n<sup>3</sup>) 立方型；O(n<sup>k</sup>) k次方型；O(2<sup>n</sup>) 指数型。</p>
<p>更多时间复杂度实例<sup>[1]</sup></p>
<h2 id=参考>参考</h2>
<p>[1] 程序新视界: <a href=https://cloud.tencent.com/developer/article/1769988>LeetCode0：学习算法必备知识：时间复杂度与空间复杂度的计算</a></p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-48aef7a1a6299bd1605c3305fefb810d>9.5 - 港岛径第八段-土地灣-龙脊-大浪灣</h1>
<h6 id=港岛径第八段-土地灣-打爛埕頂山-龍脊-馬塘坳-大浪灣>港岛径第八段： 土地灣-打爛埕頂山-龍脊-馬塘坳-大浪灣</h6>
<h6 id=港島徑第八段是港島徑最精彩開闊的路段國際雜誌也曾報導此路線龍脊上視野遼闊大潭港石澳及大浪灣盡入眼簾除了初段需要微升外其餘都是較平坦或下降的路段>港島徑第八段是港島徑最精彩開闊的路段，國際雜誌也曾報導此路線。龍脊上視野遼闊，大潭港、石澳及大浪灣盡入眼簾。除了初段需要微升外，其餘都是較平坦或下降的路段。</h6>
<h3 id=下地铁转公交这个指示牌非常显眼>下地铁转公交,这个指示牌非常显眼</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4040.jpg alt></p>
<h3 id=去的人还真不少走了两趟车坐上去10几分钟一趟>去的人还真不少，走了两趟车坐上去，10几分钟一趟</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4042.jpg alt></p>
<h3 id=土地湾公交站台下车入口一张地图往上走去龙脊>土地湾公交站台下车，入口一张地图，往上走去龙脊</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4043.jpg alt>
<img src=https://hyvi.github.io/blog-images/20170318/IMG_4044.jpg alt></p>
<h3 id=没多远到半山腰上看到对面岛光线太暗>没多远到半山腰上，看到对面岛，光线太暗</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4050.jpg alt></p>
<h3 id=龙脊拍照吃东西>龙脊，拍照吃东西</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4052.jpg alt>
<img src=https://hyvi.github.io/blog-images/20170318/IMG_4078.jpg alt>
<em>山顶上大石头</em></p>
<h3 id=一直沿着山脊走>一直沿着山脊走</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4079.jpg alt></p>
<h3 id=进入半山腰路的两边都是树木天热走起来很凉爽>进入半山腰，路的两边都是树木，天热走起来很凉爽</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4085.jpg alt></p>
<h3 id=分岔点也是休息处往大浪湾方向>分岔点，也是休息处，往大浪湾方向</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4086.jpg alt></p>
<h3 id=港岛径100到终点大浪湾>港岛径100，到终点：大浪湾</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4090.jpg alt></p>
<h3 id=感受下沙滩>感受下沙滩</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4092.jpg alt></p>
<h3 id=冲浪有点冷>冲浪，有点冷</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4094.jpg alt>
<img src=https://hyvi.github.io/blog-images/20170318/IMG_4096.jpg alt></p>
<h3 id=吃东西休息拍照坐巴士回铜锣湾地铁>吃东西休息拍照，坐巴士回铜锣湾地铁</h3>
<p><img src=https://hyvi.github.io/blog-images/20170318/IMG_4098.jpg alt>
<img src=https://hyvi.github.io/blog-images/20170318/IMG_4101.jpg alt></p>
<h2 id=over>OVER</h2>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-38834a78fac95d8292f7a33d0dcb970c>9.6 - 黄牛山 .麦理浩径第四段五段 狮子山 笔架山</h1>
<h3 id=打433公交到口岸大队早上6点50到福田口岸然后过关人非常少>打433公交到口岸大队，早上6点50到福田口岸然后过关，人非常少</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_001.jpg alt></p>
<h3 id=香港的出租车>香港的出租车</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_002.jpg alt></p>
<h3 id=来个集体照妹子们给力美丽又能爬山>来个集体照，妹子们给力，美丽又能爬山</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_003.jpg alt></p>
<h3 id=开始登山了一开始都是这种路>开始登山了，一开始都是这种路</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_004.jpg alt></p>
<h3 id=登山前热身运动开始第五套还是第8套广播体操>登山前热身运动开始，第五套还是第8套广播体操？</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_005.jpg alt></p>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_006.jpg alt></p>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_007.jpg alt></p>
<h3 id=开始下小雨路比较窄两边都是杂草重生>开始下小雨路比较窄两边都是杂草重生</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_008.jpg alt></p>
<h3 id=就是从下往上爬的时候拍的照片路面比较滑>就是从下往上爬的时候拍的照片，路面比较滑</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_009.jpg alt></p>
<h3 id=感受下寒风打脸上>感受下寒风打脸上！</h3>
<h3 id=草比人高>草比人高</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_010.jpg alt></p>
<h3 id=前方的能见度10米看不到前面的山头>前方的能见度10米，看不到前面的山头</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_011.jpg alt></p>
<h3 id=半山腰上的一块大石头下图是准备推石下山哈哈>半山腰上的一块大石头，下图是准备推石下山，哈哈</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_012.jpg alt></p>
<h3 id=准备把石头推下山崖去>准备把石头推下山崖去</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_013.jpg alt></p>
<h3 id=登顶黄牛山顶雨变大了一直以为是雾水>登顶黄牛山顶，雨变大了，一直以为是雾水。</h3>
<h3 id=风太大了照片都吹歪了>风太大了，照片都吹歪了！</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_014.jpg alt></p>
<h3 id=石门周边大石头全部生长在半山腰上好大一坨一坨>石门周边大石头，全部生长在半山腰上，好大一坨一坨</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_015.jpg alt></p>
<h3 id=石门拍照来黄牛山必来石门拍照人人留下黑黑背影天气不好逆光了悲催呀>石门拍照，来黄牛山必来石门拍照，人人留下黑黑背影，天气不好，逆光了，悲催呀</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_016.jpg alt></p>
<h3 id=金鸡独立>金鸡独立</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_017.jpg alt></p>
<h3 id=已成落汤鸡换了衣服继续>已成落汤鸡，换了衣服继续</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_018.jpg alt></p>
<h3 id=下山走麦理浩径第四段>下山走麦理浩径第四段</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_019.jpg alt></p>
<h3 id=看到熟悉的路标不用那么虐了>看到熟悉的路标，不用那么虐了。</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_020.jpg alt></p>
<h3 id=正走第四段>正走第四段</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_021.jpg alt></p>
<h3 id=老冒带走小路快速下山>老冒带走小路，快速下山</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_022.jpg alt></p>
<h3 id=沙田>沙田</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_023.jpg alt></p>
<h3 id=下山去沙田路上的猴子凶>下山去沙田路上的猴子，凶</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_024.jpg alt></p>
<h3 id=野猪图来自润林>野猪，图来自润林</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_025.jpg alt></p>
<h3 id=来个帅帅的侧面照>来个帅帅的侧面照</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_026.jpg alt></p>
<h3 id=这个路口我们解散了逛街的吃豆花往上走继续爬狮子山的往下走>这个路口，我们解散了，逛街的吃豆花往上走，继续爬狮子山的往下走！</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_027.jpg alt></p>
<h3 id=开始登狮子山>开始登狮子山，</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_028.jpg alt></p>
<h3 id=四人爬追随冬瓜走在倒数第二后腿拖住了>四人爬，追随冬瓜，走在倒数第二，后腿拖住了</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_029.jpg alt></p>
<h3 id=登顶拍照>登顶拍照</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_030.jpg alt></p>
<h3 id=虽然天气不给力背景好纯>虽然天气不给力，背景好纯</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_031.jpg alt></p>
<h3 id=海拔500米啥看不到往下看才觉得好刺激深不见底呀>海拔500米，啥看不到，往下看才觉得好刺激，深不见底呀</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_032.jpg alt></p>
<h3 id=一路险峻>一路险峻</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_033.jpg alt></p>
<h3 id=山顶都是石头山顶消失在迷雾中>山顶都是石头，山顶消失在迷雾中</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_034.jpg alt></p>
<h3 id=下山路这本不是路双手不够用>下山路，这本不是路，双手不够用。</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_035.jpg alt></p>
<h3 id=侧脸狮子头看到了吗>侧脸狮子头，看到了吗？</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_036.jpg alt></p>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_037.jpg alt></p>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_038.jpg alt></p>
<h3 id=登顶笔架山>登顶笔架山</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_039.jpg alt></p>
<h3 id=半山腰上养的各种鱼金色红色黄色>半山腰上养的各种鱼，金色，红色，黄色</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_040.jpg alt></p>
<h3 id=下山结束了我走最后面了脚板疼>下山，结束了，我走最后面了，脚板疼.</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_041.jpg alt></p>
<h3 id=走了21公里图来自南>走了21公里，图来自南🐺</h3>
<p><img src=https://hyvi.github.io/blog-images/20170315/pic_042.jpg alt></p>
<h2 id=over>OVER</h2>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 Elon All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>隐私政策</a></small>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js integrity="sha256-OxcsE7YsK+qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin=anonymous></script>
</body>
</html>